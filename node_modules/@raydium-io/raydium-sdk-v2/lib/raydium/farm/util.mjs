var fr=Object.defineProperty,mr=Object.defineProperties;var pr=Object.getOwnPropertyDescriptors;var pt=Object.getOwnPropertySymbols;var gr=Object.prototype.hasOwnProperty,hr=Object.prototype.propertyIsEnumerable;var gt=(e,t,r)=>t in e?fr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,O=(e,t)=>{for(var r in t||(t={}))gr.call(t,r)&&gt(e,r,t[r]);if(pt)for(var r of pt(t))hr.call(t,r)&&gt(e,r,t[r]);return e},G=(e,t)=>mr(e,pr(t));import z from"bn.js";import{PublicKey as vn}from"@solana/web3.js";import{MINT_SIZE as eu,TOKEN_PROGRAM_ID as tu,getTransferFeeConfig as ru,unpackMint as nu}from"@solana/spl-token";import{get as ht,set as wr}from"lodash";var He=class{constructor(t){this.logLevel=t.logLevel!==void 0?t.logLevel:0,this.name=t.name}set level(t){this.logLevel=t}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(t){return t<=this.logLevel}error(...t){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...t),this):this}logWithError(...t){let r=t.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(r)}warning(...t){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...t),this):this}info(...t){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...t),this):this}debug(...t){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...t),this):this}},wt={},yr={};function K(e){let t=ht(wt,e);if(!t){let r=ht(yr,e);t=new He({name:e,logLevel:r}),wr(wt,e,t)}return t}import{PublicKey as Nn}from"@solana/web3.js";import Cn from"bn.js";import Bn from"big.js";import Ve from"bn.js";import j from"bn.js";var le=9e15,se=1e9,je="0123456789abcdef",Be="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",ke="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",ze={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-le,maxE:le,crypto:!1},xt,$,b=!0,Ne="[DecimalError] ",oe=Ne+"Invalid argument: ",Pt=Ne+"Precision limit exceeded",St=Ne+"crypto unavailable",Lt="[object Decimal]",q=Math.floor,v=Math.pow,br=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Tr=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,xr=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,At=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,X=1e7,w=7,Pr=9007199254740991,Sr=Be.length-1,Ze=ke.length-1,m={toStringTag:Lt};m.absoluteValue=m.abs=function(){var e=new this.constructor(this);return e.s<0&&(e.s=1),h(e)};m.ceil=function(){return h(new this.constructor(this),this.e+1,2)};m.clampedTo=m.clamp=function(e,t){var r,n=this,i=n.constructor;if(e=new i(e),t=new i(t),!e.s||!t.s)return new i(NaN);if(e.gt(t))throw Error(oe+t);return r=n.cmp(e),r<0?e:n.cmp(t)>0?t:new i(n)};m.comparedTo=m.cmp=function(e){var t,r,n,i,o=this,s=o.d,a=(e=new o.constructor(e)).d,c=o.s,u=e.s;if(!s||!a)return!c||!u?NaN:c!==u?c:s===a?0:!s^c<0?1:-1;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(o.e!==e.e)return o.e>e.e^c<0?1:-1;for(n=s.length,i=a.length,t=0,r=n<i?n:i;t<r;++t)if(s[t]!==a[t])return s[t]>a[t]^c<0?1:-1;return n===i?0:n>i^c<0?1:-1};m.cosine=m.cos=function(){var e,t,r=this,n=r.constructor;return r.d?r.d[0]?(e=n.precision,t=n.rounding,n.precision=e+Math.max(r.e,r.sd())+w,n.rounding=1,r=Lr(n,Ct(n,r)),n.precision=e,n.rounding=t,h($==2||$==3?r.neg():r,e,t,!0)):new n(1):new n(NaN)};m.cubeRoot=m.cbrt=function(){var e,t,r,n,i,o,s,a,c,u,l=this,d=l.constructor;if(!l.isFinite()||l.isZero())return new d(l);for(b=!1,o=l.s*v(l.s*l,1/3),!o||Math.abs(o)==1/0?(r=W(l.d),e=l.e,(o=(e-r.length+1)%3)&&(r+=o==1||o==-2?"0":"00"),o=v(r,1/3),e=q((e+1)/3)-(e%3==(e<0?-1:2)),o==1/0?r="5e"+e:(r=o.toExponential(),r=r.slice(0,r.indexOf("e")+1)+e),n=new d(r),n.s=l.s):n=new d(o.toString()),s=(e=d.precision)+3;;)if(a=n,c=a.times(a).times(a),u=c.plus(l),n=N(u.plus(l).times(a),u.plus(c),s+2,1),W(a.d).slice(0,s)===(r=W(n.d)).slice(0,s))if(r=r.slice(s-3,s+1),r=="9999"||!i&&r=="4999"){if(!i&&(h(a,e+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,i=1}else{(!+r||!+r.slice(1)&&r.charAt(0)=="5")&&(h(n,e+1,1),t=!n.times(n).times(n).eq(l));break}return b=!0,h(n,e,d.rounding,t)};m.decimalPlaces=m.dp=function(){var e,t=this.d,r=NaN;if(t){if(e=t.length-1,r=(e-q(this.e/w))*w,e=t[e],e)for(;e%10==0;e/=10)r--;r<0&&(r=0)}return r};m.dividedBy=m.div=function(e){return N(this,new this.constructor(e))};m.dividedToIntegerBy=m.divToInt=function(e){var t=this,r=t.constructor;return h(N(t,new r(e),0,1,1),r.precision,r.rounding)};m.equals=m.eq=function(e){return this.cmp(e)===0};m.floor=function(){return h(new this.constructor(this),this.e+1,3)};m.greaterThan=m.gt=function(e){return this.cmp(e)>0};m.greaterThanOrEqualTo=m.gte=function(e){var t=this.cmp(e);return t==1||t===0};m.hyperbolicCosine=m.cosh=function(){var e,t,r,n,i,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;r=s.precision,n=s.rounding,s.precision=r+Math.max(o.e,o.sd())+4,s.rounding=1,i=o.d.length,i<32?(e=Math.ceil(i/3),t=(1/Ie(4,e)).toString()):(e=16,t="2.3283064365386962890625e-10"),o=de(s,1,o.times(t),new s(1),!0);for(var c,u=e,l=new s(8);u--;)c=o.times(o),o=a.minus(c.times(l.minus(c.times(l))));return h(o,s.precision=r,s.rounding=n,!0)};m.hyperbolicSine=m.sinh=function(){var e,t,r,n,i=this,o=i.constructor;if(!i.isFinite()||i.isZero())return new o(i);if(t=o.precision,r=o.rounding,o.precision=t+Math.max(i.e,i.sd())+4,o.rounding=1,n=i.d.length,n<3)i=de(o,2,i,i,!0);else{e=1.4*Math.sqrt(n),e=e>16?16:e|0,i=i.times(1/Ie(5,e)),i=de(o,2,i,i,!0);for(var s,a=new o(5),c=new o(16),u=new o(20);e--;)s=i.times(i),i=i.times(a.plus(s.times(c.times(s).plus(u))))}return o.precision=t,o.rounding=r,h(i,t,r,!0)};m.hyperbolicTangent=m.tanh=function(){var e,t,r=this,n=r.constructor;return r.isFinite()?r.isZero()?new n(r):(e=n.precision,t=n.rounding,n.precision=e+7,n.rounding=1,N(r.sinh(),r.cosh(),n.precision=e,n.rounding=t)):new n(r.s)};m.inverseCosine=m.acos=function(){var e,t=this,r=t.constructor,n=t.abs().cmp(1),i=r.precision,o=r.rounding;return n!==-1?n===0?t.isNeg()?Y(r,i,o):new r(0):new r(NaN):t.isZero()?Y(r,i+4,o).times(.5):(r.precision=i+6,r.rounding=1,t=t.asin(),e=Y(r,i+4,o).times(.5),r.precision=i,r.rounding=o,e.minus(t))};m.inverseHyperbolicCosine=m.acosh=function(){var e,t,r=this,n=r.constructor;return r.lte(1)?new n(r.eq(1)?0:NaN):r.isFinite()?(e=n.precision,t=n.rounding,n.precision=e+Math.max(Math.abs(r.e),r.sd())+4,n.rounding=1,b=!1,r=r.times(r).minus(1).sqrt().plus(r),b=!0,n.precision=e,n.rounding=t,r.ln()):new n(r)};m.inverseHyperbolicSine=m.asinh=function(){var e,t,r=this,n=r.constructor;return!r.isFinite()||r.isZero()?new n(r):(e=n.precision,t=n.rounding,n.precision=e+2*Math.max(Math.abs(r.e),r.sd())+6,n.rounding=1,b=!1,r=r.times(r).plus(1).sqrt().plus(r),b=!0,n.precision=e,n.rounding=t,r.ln())};m.inverseHyperbolicTangent=m.atanh=function(){var e,t,r,n,i=this,o=i.constructor;return i.isFinite()?i.e>=0?new o(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(e=o.precision,t=o.rounding,n=i.sd(),Math.max(n,e)<2*-i.e-1?h(new o(i),e,t,!0):(o.precision=r=n-i.e,i=N(i.plus(1),new o(1).minus(i),r+e,1),o.precision=e+4,o.rounding=1,i=i.ln(),o.precision=e,o.rounding=t,i.times(.5))):new o(NaN)};m.inverseSine=m.asin=function(){var e,t,r,n,i=this,o=i.constructor;return i.isZero()?new o(i):(t=i.abs().cmp(1),r=o.precision,n=o.rounding,t!==-1?t===0?(e=Y(o,r+4,n).times(.5),e.s=i.s,e):new o(NaN):(o.precision=r+6,o.rounding=1,i=i.div(new o(1).minus(i.times(i)).sqrt().plus(1)).atan(),o.precision=r,o.rounding=n,i.times(2)))};m.inverseTangent=m.atan=function(){var e,t,r,n,i,o,s,a,c,u=this,l=u.constructor,d=l.precision,f=l.rounding;if(u.isFinite()){if(u.isZero())return new l(u);if(u.abs().eq(1)&&d+4<=Ze)return s=Y(l,d+4,f).times(.25),s.s=u.s,s}else{if(!u.s)return new l(NaN);if(d+4<=Ze)return s=Y(l,d+4,f).times(.5),s.s=u.s,s}for(l.precision=a=d+10,l.rounding=1,r=Math.min(28,a/w+2|0),e=r;e;--e)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(b=!1,t=Math.ceil(a/w),n=1,c=u.times(u),s=new l(u),i=u;e!==-1;)if(i=i.times(c),o=s.minus(i.div(n+=2)),i=i.times(c),s=o.plus(i.div(n+=2)),s.d[t]!==void 0)for(e=t;s.d[e]===o.d[e]&&e--;);return r&&(s=s.times(2<<r-1)),b=!0,h(s,l.precision=d,l.rounding=f,!0)};m.isFinite=function(){return!!this.d};m.isInteger=m.isInt=function(){return!!this.d&&q(this.e/w)>this.d.length-2};m.isNaN=function(){return!this.s};m.isNegative=m.isNeg=function(){return this.s<0};m.isPositive=m.isPos=function(){return this.s>0};m.isZero=function(){return!!this.d&&this.d[0]===0};m.lessThan=m.lt=function(e){return this.cmp(e)<0};m.lessThanOrEqualTo=m.lte=function(e){return this.cmp(e)<1};m.logarithm=m.log=function(e){var t,r,n,i,o,s,a,c,u=this,l=u.constructor,d=l.precision,f=l.rounding,p=5;if(e==null)e=new l(10),t=!0;else{if(e=new l(e),r=e.d,e.s<0||!r||!r[0]||e.eq(1))return new l(NaN);t=e.eq(10)}if(r=u.d,u.s<0||!r||!r[0]||u.eq(1))return new l(r&&!r[0]?-1/0:u.s!=1?NaN:r?0:1/0);if(t)if(r.length>1)o=!0;else{for(i=r[0];i%10===0;)i/=10;o=i!==1}if(b=!1,a=d+p,s=ie(u,a),n=t?Re(l,a+10):ie(e,a),c=N(s,n,a,1),ge(c.d,i=d,f))do if(a+=10,s=ie(u,a),n=t?Re(l,a+10):ie(e,a),c=N(s,n,a,1),!o){+W(c.d).slice(i+1,i+15)+1==1e14&&(c=h(c,d+1,0));break}while(ge(c.d,i+=10,f));return b=!0,h(c,d,f)};m.minus=m.sub=function(e){var t,r,n,i,o,s,a,c,u,l,d,f,p=this,T=p.constructor;if(e=new T(e),!p.d||!e.d)return!p.s||!e.s?e=new T(NaN):p.d?e.s=-e.s:e=new T(e.d||p.s!==e.s?p:NaN),e;if(p.s!=e.s)return e.s=-e.s,p.plus(e);if(u=p.d,f=e.d,a=T.precision,c=T.rounding,!u[0]||!f[0]){if(f[0])e.s=-e.s;else if(u[0])e=new T(p);else return new T(c===3?-0:0);return b?h(e,a,c):e}if(r=q(e.e/w),l=q(p.e/w),u=u.slice(),o=l-r,o){for(d=o<0,d?(t=u,o=-o,s=f.length):(t=f,r=l,s=u.length),n=Math.max(Math.ceil(a/w),s)+2,o>n&&(o=n,t.length=1),t.reverse(),n=o;n--;)t.push(0);t.reverse()}else{for(n=u.length,s=f.length,d=n<s,d&&(s=n),n=0;n<s;n++)if(u[n]!=f[n]){d=u[n]<f[n];break}o=0}for(d&&(t=u,u=f,f=t,e.s=-e.s),s=u.length,n=f.length-s;n>0;--n)u[s++]=0;for(n=f.length;n>o;){if(u[--n]<f[n]){for(i=n;i&&u[--i]===0;)u[i]=X-1;--u[i],u[n]+=X}u[n]-=f[n]}for(;u[--s]===0;)u.pop();for(;u[0]===0;u.shift())--r;return u[0]?(e.d=u,e.e=Ce(u,r),b?h(e,a,c):e):new T(c===3?-0:0)};m.modulo=m.mod=function(e){var t,r=this,n=r.constructor;return e=new n(e),!r.d||!e.s||e.d&&!e.d[0]?new n(NaN):!e.d||r.d&&!r.d[0]?h(new n(r),n.precision,n.rounding):(b=!1,n.modulo==9?(t=N(r,e.abs(),0,3,1),t.s*=e.s):t=N(r,e,0,n.modulo,1),t=t.times(e),b=!0,r.minus(t))};m.naturalExponential=m.exp=function(){return Ye(this)};m.naturalLogarithm=m.ln=function(){return ie(this)};m.negated=m.neg=function(){var e=new this.constructor(this);return e.s=-e.s,h(e)};m.plus=m.add=function(e){var t,r,n,i,o,s,a,c,u,l,d=this,f=d.constructor;if(e=new f(e),!d.d||!e.d)return!d.s||!e.s?e=new f(NaN):d.d||(e=new f(e.d||d.s===e.s?d:NaN)),e;if(d.s!=e.s)return e.s=-e.s,d.minus(e);if(u=d.d,l=e.d,a=f.precision,c=f.rounding,!u[0]||!l[0])return l[0]||(e=new f(d)),b?h(e,a,c):e;if(o=q(d.e/w),n=q(e.e/w),u=u.slice(),i=o-n,i){for(i<0?(r=u,i=-i,s=l.length):(r=l,n=o,s=u.length),o=Math.ceil(a/w),s=o>s?o+1:s+1,i>s&&(i=s,r.length=1),r.reverse();i--;)r.push(0);r.reverse()}for(s=u.length,i=l.length,s-i<0&&(i=s,r=l,l=u,u=r),t=0;i;)t=(u[--i]=u[i]+l[i]+t)/X|0,u[i]%=X;for(t&&(u.unshift(t),++n),s=u.length;u[--s]==0;)u.pop();return e.d=u,e.e=Ce(u,n),b?h(e,a,c):e};m.precision=m.sd=function(e){var t,r=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(oe+e);return r.d?(t=Bt(r.d),e&&r.e+1>t&&(t=r.e+1)):t=NaN,t};m.round=function(){var e=this,t=e.constructor;return h(new t(e),e.e+1,t.rounding)};m.sine=m.sin=function(){var e,t,r=this,n=r.constructor;return r.isFinite()?r.isZero()?new n(r):(e=n.precision,t=n.rounding,n.precision=e+Math.max(r.e,r.sd())+w,n.rounding=1,r=Br(n,Ct(n,r)),n.precision=e,n.rounding=t,h($>2?r.neg():r,e,t,!0)):new n(NaN)};m.squareRoot=m.sqrt=function(){var e,t,r,n,i,o,s=this,a=s.d,c=s.e,u=s.s,l=s.constructor;if(u!==1||!a||!a[0])return new l(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(b=!1,u=Math.sqrt(+s),u==0||u==1/0?(t=W(a),(t.length+c)%2==0&&(t+="0"),u=Math.sqrt(t),c=q((c+1)/2)-(c<0||c%2),u==1/0?t="5e"+c:(t=u.toExponential(),t=t.slice(0,t.indexOf("e")+1)+c),n=new l(t)):n=new l(u.toString()),r=(c=l.precision)+3;;)if(o=n,n=o.plus(N(s,o,r+2,1)).times(.5),W(o.d).slice(0,r)===(t=W(n.d)).slice(0,r))if(t=t.slice(r-3,r+1),t=="9999"||!i&&t=="4999"){if(!i&&(h(o,c+1,0),o.times(o).eq(s))){n=o;break}r+=4,i=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(h(n,c+1,1),e=!n.times(n).eq(s));break}return b=!0,h(n,c,l.rounding,e)};m.tangent=m.tan=function(){var e,t,r=this,n=r.constructor;return r.isFinite()?r.isZero()?new n(r):(e=n.precision,t=n.rounding,n.precision=e+10,n.rounding=1,r=r.sin(),r.s=1,r=N(r,new n(1).minus(r.times(r)).sqrt(),e+10,0),n.precision=e,n.rounding=t,h($==2||$==4?r.neg():r,e,t,!0)):new n(NaN)};m.times=m.mul=function(e){var t,r,n,i,o,s,a,c,u,l=this,d=l.constructor,f=l.d,p=(e=new d(e)).d;if(e.s*=l.s,!f||!f[0]||!p||!p[0])return new d(!e.s||f&&!f[0]&&!p||p&&!p[0]&&!f?NaN:!f||!p?e.s/0:e.s*0);for(r=q(l.e/w)+q(e.e/w),c=f.length,u=p.length,c<u&&(o=f,f=p,p=o,s=c,c=u,u=s),o=[],s=c+u,n=s;n--;)o.push(0);for(n=u;--n>=0;){for(t=0,i=c+n;i>n;)a=o[i]+p[n]*f[i-n-1]+t,o[i--]=a%X|0,t=a/X|0;o[i]=(o[i]+t)%X|0}for(;!o[--s];)o.pop();return t?++r:o.shift(),e.d=o,e.e=Ce(o,r),b?h(e,d.precision,d.rounding):e};m.toBinary=function(e,t){return Je(this,2,e,t)};m.toDecimalPlaces=m.toDP=function(e,t){var r=this,n=r.constructor;return r=new n(r),e===void 0?r:(H(e,0,se),t===void 0?t=n.rounding:H(t,0,8),h(r,e+r.e+1,t))};m.toExponential=function(e,t){var r,n=this,i=n.constructor;return e===void 0?r=J(n,!0):(H(e,0,se),t===void 0?t=i.rounding:H(t,0,8),n=h(new i(n),e+1,t),r=J(n,!0,e+1)),n.isNeg()&&!n.isZero()?"-"+r:r};m.toFixed=function(e,t){var r,n,i=this,o=i.constructor;return e===void 0?r=J(i):(H(e,0,se),t===void 0?t=o.rounding:H(t,0,8),n=h(new o(i),e+i.e+1,t),r=J(n,!1,e+n.e+1)),i.isNeg()&&!i.isZero()?"-"+r:r};m.toFraction=function(e){var t,r,n,i,o,s,a,c,u,l,d,f,p=this,T=p.d,y=p.constructor;if(!T)return new y(p);if(u=r=new y(1),n=c=new y(0),t=new y(n),o=t.e=Bt(T)-p.e-1,s=o%w,t.d[0]=v(10,s<0?w+s:s),e==null)e=o>0?t:u;else{if(a=new y(e),!a.isInt()||a.lt(u))throw Error(oe+a);e=a.gt(t)?o>0?t:u:a}for(b=!1,a=new y(W(T)),l=y.precision,y.precision=o=T.length*w*2;d=N(a,t,0,1,1),i=r.plus(d.times(n)),i.cmp(e)!=1;)r=n,n=i,i=u,u=c.plus(d.times(i)),c=i,i=t,t=a.minus(d.times(i)),a=i;return i=N(e.minus(r),n,0,1,1),c=c.plus(i.times(u)),r=r.plus(i.times(n)),c.s=u.s=p.s,f=N(u,n,o,1).minus(p).abs().cmp(N(c,r,o,1).minus(p).abs())<1?[u,n]:[c,r],y.precision=l,b=!0,f};m.toHexadecimal=m.toHex=function(e,t){return Je(this,16,e,t)};m.toNearest=function(e,t){var r=this,n=r.constructor;if(r=new n(r),e==null){if(!r.d)return r;e=new n(1),t=n.rounding}else{if(e=new n(e),t===void 0?t=n.rounding:H(t,0,8),!r.d)return e.s?r:e;if(!e.d)return e.s&&(e.s=r.s),e}return e.d[0]?(b=!1,r=N(r,e,0,t,1).times(e),b=!0,h(r)):(e.s=r.s,r=e),r};m.toNumber=function(){return+this};m.toOctal=function(e,t){return Je(this,8,e,t)};m.toPower=m.pow=function(e){var t,r,n,i,o,s,a=this,c=a.constructor,u=+(e=new c(e));if(!a.d||!e.d||!a.d[0]||!e.d[0])return new c(v(+a,u));if(a=new c(a),a.eq(1))return a;if(n=c.precision,o=c.rounding,e.eq(1))return h(a,n,o);if(t=q(e.e/w),t>=e.d.length-1&&(r=u<0?-u:u)<=Pr)return i=kt(c,a,r,n),e.s<0?new c(1).div(i):h(i,n,o);if(s=a.s,s<0){if(t<e.d.length-1)return new c(NaN);if((e.d[t]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return r=v(+a,u),t=r==0||!isFinite(r)?q(u*(Math.log("0."+W(a.d))/Math.LN10+a.e+1)):new c(r+"").e,t>c.maxE+1||t<c.minE-1?new c(t>0?s/0:0):(b=!1,c.rounding=a.s=1,r=Math.min(12,(t+"").length),i=Ye(e.times(ie(a,n+r)),n),i.d&&(i=h(i,n+5,1),ge(i.d,n,o)&&(t=n+10,i=h(Ye(e.times(ie(a,t+r)),t),t+5,1),+W(i.d).slice(n+1,n+15)+1==1e14&&(i=h(i,n+1,0)))),i.s=s,b=!0,c.rounding=o,h(i,n,o))};m.toPrecision=function(e,t){var r,n=this,i=n.constructor;return e===void 0?r=J(n,n.e<=i.toExpNeg||n.e>=i.toExpPos):(H(e,1,se),t===void 0?t=i.rounding:H(t,0,8),n=h(new i(n),e,t),r=J(n,e<=n.e||n.e<=i.toExpNeg,e)),n.isNeg()&&!n.isZero()?"-"+r:r};m.toSignificantDigits=m.toSD=function(e,t){var r=this,n=r.constructor;return e===void 0?(e=n.precision,t=n.rounding):(H(e,1,se),t===void 0?t=n.rounding:H(t,0,8)),h(new n(r),e,t)};m.toString=function(){var e=this,t=e.constructor,r=J(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()&&!e.isZero()?"-"+r:r};m.truncated=m.trunc=function(){return h(new this.constructor(this),this.e+1,1)};m.valueOf=m.toJSON=function(){var e=this,t=e.constructor,r=J(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()?"-"+r:r};function W(e){var t,r,n,i=e.length-1,o="",s=e[0];if(i>0){for(o+=s,t=1;t<i;t++)n=e[t]+"",r=w-n.length,r&&(o+=ne(r)),o+=n;s=e[t],n=s+"",r=w-n.length,r&&(o+=ne(r))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function H(e,t,r){if(e!==~~e||e<t||e>r)throw Error(oe+e)}function ge(e,t,r,n){var i,o,s,a;for(o=e[0];o>=10;o/=10)--t;return--t<0?(t+=w,i=0):(i=Math.ceil((t+1)/w),t%=w),o=v(10,w-t),a=e[i]%o|0,n==null?t<3?(t==0?a=a/100|0:t==1&&(a=a/10|0),s=r<4&&a==99999||r>3&&a==49999||a==5e4||a==0):s=(r<4&&a+1==o||r>3&&a+1==o/2)&&(e[i+1]/o/100|0)==v(10,t-2)-1||(a==o/2||a==0)&&(e[i+1]/o/100|0)==0:t<4?(t==0?a=a/1e3|0:t==1?a=a/100|0:t==2&&(a=a/10|0),s=(n||r<4)&&a==9999||!n&&r>3&&a==4999):s=((n||r<4)&&a+1==o||!n&&r>3&&a+1==o/2)&&(e[i+1]/o/1e3|0)==v(10,t-3)-1,s}function Ae(e,t,r){for(var n,i=[0],o,s=0,a=e.length;s<a;){for(o=i.length;o--;)i[o]*=t;for(i[0]+=je.indexOf(e.charAt(s++)),n=0;n<i.length;n++)i[n]>r-1&&(i[n+1]===void 0&&(i[n+1]=0),i[n+1]+=i[n]/r|0,i[n]%=r)}return i.reverse()}function Lr(e,t){var r,n,i;if(t.isZero())return t;n=t.d.length,n<32?(r=Math.ceil(n/3),i=(1/Ie(4,r)).toString()):(r=16,i="2.3283064365386962890625e-10"),e.precision+=r,t=de(e,1,t.times(i),new e(1));for(var o=r;o--;){var s=t.times(t);t=s.times(s).minus(s).times(8).plus(1)}return e.precision-=r,t}var N=function(){function e(n,i,o){var s,a=0,c=n.length;for(n=n.slice();c--;)s=n[c]*i+a,n[c]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function t(n,i,o,s){var a,c;if(o!=s)c=o>s?1:-1;else for(a=c=0;a<o;a++)if(n[a]!=i[a]){c=n[a]>i[a]?1:-1;break}return c}function r(n,i,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<i[o]?1:0,n[o]=a*s+n[o]-i[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,i,o,s,a,c){var u,l,d,f,p,T,y,L,P,V,R,D,xe,Q,Ue,Pe,pe,qe,Z,Se,Le=n.constructor,Ge=n.s==i.s?1:-1,U=n.d,C=i.d;if(!U||!U[0]||!C||!C[0])return new Le(!n.s||!i.s||(U?C&&U[0]==C[0]:!C)?NaN:U&&U[0]==0||!C?Ge*0:Ge/0);for(c?(p=1,l=n.e-i.e):(c=X,p=w,l=q(n.e/p)-q(i.e/p)),Z=C.length,pe=U.length,P=new Le(Ge),V=P.d=[],d=0;C[d]==(U[d]||0);d++);if(C[d]>(U[d]||0)&&l--,o==null?(Q=o=Le.precision,s=Le.rounding):a?Q=o+(n.e-i.e)+1:Q=o,Q<0)V.push(1),T=!0;else{if(Q=Q/p+2|0,d=0,Z==1){for(f=0,C=C[0],Q++;(d<pe||f)&&Q--;d++)Ue=f*c+(U[d]||0),V[d]=Ue/C|0,f=Ue%C|0;T=f||d<pe}else{for(f=c/(C[0]+1)|0,f>1&&(C=e(C,f,c),U=e(U,f,c),Z=C.length,pe=U.length),Pe=Z,R=U.slice(0,Z),D=R.length;D<Z;)R[D++]=0;Se=C.slice(),Se.unshift(0),qe=C[0],C[1]>=c/2&&++qe;do f=0,u=t(C,R,Z,D),u<0?(xe=R[0],Z!=D&&(xe=xe*c+(R[1]||0)),f=xe/qe|0,f>1?(f>=c&&(f=c-1),y=e(C,f,c),L=y.length,D=R.length,u=t(y,R,L,D),u==1&&(f--,r(y,Z<L?Se:C,L,c))):(f==0&&(u=f=1),y=C.slice()),L=y.length,L<D&&y.unshift(0),r(R,y,D,c),u==-1&&(D=R.length,u=t(C,R,Z,D),u<1&&(f++,r(R,Z<D?Se:C,D,c))),D=R.length):u===0&&(f++,R=[0]),V[d++]=f,u&&R[0]?R[D++]=U[Pe]||0:(R=[U[Pe]],D=1);while((Pe++<pe||R[0]!==void 0)&&Q--);T=R[0]!==void 0}V[0]||V.shift()}if(p==1)P.e=l,xt=T;else{for(d=1,f=V[0];f>=10;f/=10)d++;P.e=d+l*p-1,h(P,a?o+P.e+1:o,s,T)}return P}}();function h(e,t,r,n){var i,o,s,a,c,u,l,d,f,p=e.constructor;e:if(t!=null){if(d=e.d,!d)return e;for(i=1,a=d[0];a>=10;a/=10)i++;if(o=t-i,o<0)o+=w,s=t,l=d[f=0],c=l/v(10,i-s-1)%10|0;else if(f=Math.ceil((o+1)/w),a=d.length,f>=a)if(n){for(;a++<=f;)d.push(0);l=c=0,i=1,o%=w,s=o-w+1}else break e;else{for(l=a=d[f],i=1;a>=10;a/=10)i++;o%=w,s=o-w+i,c=s<0?0:l/v(10,i-s-1)%10|0}if(n=n||t<0||d[f+1]!==void 0||(s<0?l:l%v(10,i-s-1)),u=r<4?(c||n)&&(r==0||r==(e.s<0?3:2)):c>5||c==5&&(r==4||n||r==6&&(o>0?s>0?l/v(10,i-s):0:d[f-1])%10&1||r==(e.s<0?8:7)),t<1||!d[0])return d.length=0,u?(t-=e.e+1,d[0]=v(10,(w-t%w)%w),e.e=-t||0):d[0]=e.e=0,e;if(o==0?(d.length=f,a=1,f--):(d.length=f+1,a=v(10,w-o),d[f]=s>0?(l/v(10,i-s)%v(10,s)|0)*a:0),u)for(;;)if(f==0){for(o=1,s=d[0];s>=10;s/=10)o++;for(s=d[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(e.e++,d[0]==X&&(d[0]=1));break}else{if(d[f]+=a,d[f]!=X)break;d[f--]=0,a=1}for(o=d.length;d[--o]===0;)d.pop()}return b&&(e.e>p.maxE?(e.d=null,e.e=NaN):e.e<p.minE&&(e.e=0,e.d=[0])),e}function J(e,t,r){if(!e.isFinite())return Nt(e);var n,i=e.e,o=W(e.d),s=o.length;return t?(r&&(n=r-s)>0?o=o.charAt(0)+"."+o.slice(1)+ne(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(e.e<0?"e":"e+")+e.e):i<0?(o="0."+ne(-i-1)+o,r&&(n=r-s)>0&&(o+=ne(n))):i>=s?(o+=ne(i+1-s),r&&(n=r-i-1)>0&&(o=o+"."+ne(n))):((n=i+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),r&&(n=r-s)>0&&(i+1===s&&(o+="."),o+=ne(n))),o}function Ce(e,t){var r=e[0];for(t*=w;r>=10;r/=10)t++;return t}function Re(e,t,r){if(t>Sr)throw b=!0,r&&(e.precision=r),Error(Pt);return h(new e(Be),t,1,!0)}function Y(e,t,r){if(t>Ze)throw Error(Pt);return h(new e(ke),t,r,!0)}function Bt(e){var t=e.length-1,r=t*w+1;if(t=e[t],t){for(;t%10==0;t/=10)r--;for(t=e[0];t>=10;t/=10)r++}return r}function ne(e){for(var t="";e--;)t+="0";return t}function kt(e,t,r,n){var i,o=new e(1),s=Math.ceil(n/w+4);for(b=!1;;){if(r%2&&(o=o.times(t),bt(o.d,s)&&(i=!0)),r=q(r/2),r===0){r=o.d.length-1,i&&o.d[r]===0&&++o.d[r];break}t=t.times(t),bt(t.d,s)}return b=!0,o}function yt(e){return e.d[e.d.length-1]&1}function Rt(e,t,r){for(var n,i=new e(t[0]),o=0;++o<t.length;)if(n=new e(t[o]),n.s)i[r](n)&&(i=n);else{i=n;break}return i}function Ye(e,t){var r,n,i,o,s,a,c,u=0,l=0,d=0,f=e.constructor,p=f.rounding,T=f.precision;if(!e.d||!e.d[0]||e.e>17)return new f(e.d?e.d[0]?e.s<0?0:1/0:1:e.s?e.s<0?0:e:0/0);for(t==null?(b=!1,c=T):c=t,a=new f(.03125);e.e>-2;)e=e.times(a),d+=5;for(n=Math.log(v(2,d))/Math.LN10*2+5|0,c+=n,r=o=s=new f(1),f.precision=c;;){if(o=h(o.times(e),c,1),r=r.times(++l),a=s.plus(N(o,r,c,1)),W(a.d).slice(0,c)===W(s.d).slice(0,c)){for(i=d;i--;)s=h(s.times(s),c,1);if(t==null)if(u<3&&ge(s.d,c-n,p,u))f.precision=c+=10,r=o=a=new f(1),l=0,u++;else return h(s,f.precision=T,p,b=!0);else return f.precision=T,s}s=a}}function ie(e,t){var r,n,i,o,s,a,c,u,l,d,f,p=1,T=10,y=e,L=y.d,P=y.constructor,V=P.rounding,R=P.precision;if(y.s<0||!L||!L[0]||!y.e&&L[0]==1&&L.length==1)return new P(L&&!L[0]?-1/0:y.s!=1?NaN:L?0:y);if(t==null?(b=!1,l=R):l=t,P.precision=l+=T,r=W(L),n=r.charAt(0),Math.abs(o=y.e)<15e14){for(;n<7&&n!=1||n==1&&r.charAt(1)>3;)y=y.times(e),r=W(y.d),n=r.charAt(0),p++;o=y.e,n>1?(y=new P("0."+r),o++):y=new P(n+"."+r.slice(1))}else return u=Re(P,l+2,R).times(o+""),y=ie(new P(n+"."+r.slice(1)),l-T).plus(u),P.precision=R,t==null?h(y,R,V,b=!0):y;for(d=y,c=s=y=N(y.minus(1),y.plus(1),l,1),f=h(y.times(y),l,1),i=3;;){if(s=h(s.times(f),l,1),u=c.plus(N(s,new P(i),l,1)),W(u.d).slice(0,l)===W(c.d).slice(0,l))if(c=c.times(2),o!==0&&(c=c.plus(Re(P,l+2,R).times(o+""))),c=N(c,new P(p),l,1),t==null)if(ge(c.d,l-T,V,a))P.precision=l+=T,u=s=y=N(d.minus(1),d.plus(1),l,1),f=h(y.times(y),l,1),i=a=1;else return h(c,P.precision=R,V,b=!0);else return P.precision=R,c;c=u,i+=2}}function Nt(e){return String(e.s*e.s/0)}function Xe(e,t){var r,n,i;for((r=t.indexOf("."))>-1&&(t=t.replace(".","")),(n=t.search(/e/i))>0?(r<0&&(r=n),r+=+t.slice(n+1),t=t.substring(0,n)):r<0&&(r=t.length),n=0;t.charCodeAt(n)===48;n++);for(i=t.length;t.charCodeAt(i-1)===48;--i);if(t=t.slice(n,i),t){if(i-=n,e.e=r=r-n-1,e.d=[],n=(r+1)%w,r<0&&(n+=w),n<i){for(n&&e.d.push(+t.slice(0,n)),i-=w;n<i;)e.d.push(+t.slice(n,n+=w));t=t.slice(n),n=w-t.length}else n-=i;for(;n--;)t+="0";e.d.push(+t),b&&(e.e>e.constructor.maxE?(e.d=null,e.e=NaN):e.e<e.constructor.minE&&(e.e=0,e.d=[0]))}else e.e=0,e.d=[0];return e}function Ar(e,t){var r,n,i,o,s,a,c,u,l;if(t.indexOf("_")>-1){if(t=t.replace(/(\d)_(?=\d)/g,"$1"),At.test(t))return Xe(e,t)}else if(t==="Infinity"||t==="NaN")return+t||(e.s=NaN),e.e=NaN,e.d=null,e;if(Tr.test(t))r=16,t=t.toLowerCase();else if(br.test(t))r=2;else if(xr.test(t))r=8;else throw Error(oe+t);for(o=t.search(/p/i),o>0?(c=+t.slice(o+1),t=t.substring(2,o)):t=t.slice(2),o=t.indexOf("."),s=o>=0,n=e.constructor,s&&(t=t.replace(".",""),a=t.length,o=a-o,i=kt(n,new n(r),o,o*2)),u=Ae(t,r,X),l=u.length-1,o=l;u[o]===0;--o)u.pop();return o<0?new n(e.s*0):(e.e=Ce(u,l),e.d=u,b=!1,s&&(e=N(e,i,a*4)),c&&(e=e.times(Math.abs(c)<54?v(2,c):Fe.pow(2,c))),b=!0,e)}function Br(e,t){var r,n=t.d.length;if(n<3)return t.isZero()?t:de(e,2,t,t);r=1.4*Math.sqrt(n),r=r>16?16:r|0,t=t.times(1/Ie(5,r)),t=de(e,2,t,t);for(var i,o=new e(5),s=new e(16),a=new e(20);r--;)i=t.times(t),t=t.times(o.plus(i.times(s.times(i).minus(a))));return t}function de(e,t,r,n,i){var o,s,a,c,u=1,l=e.precision,d=Math.ceil(l/w);for(b=!1,c=r.times(r),a=new e(n);;){if(s=N(a.times(c),new e(t++*t++),l,1),a=i?n.plus(s):n.minus(s),n=N(s.times(c),new e(t++*t++),l,1),s=a.plus(n),s.d[d]!==void 0){for(o=d;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,u++}return b=!0,s.d.length=d+1,s}function Ie(e,t){for(var r=e;--t;)r*=e;return r}function Ct(e,t){var r,n=t.s<0,i=Y(e,e.precision,1),o=i.times(.5);if(t=t.abs(),t.lte(o))return $=n?4:1,t;if(r=t.divToInt(i),r.isZero())$=n?3:2;else{if(t=t.minus(r.times(i)),t.lte(o))return $=yt(r)?n?2:3:n?4:1,t;$=yt(r)?n?1:4:n?3:2}return t.minus(i).abs()}function Je(e,t,r,n){var i,o,s,a,c,u,l,d,f,p=e.constructor,T=r!==void 0;if(T?(H(r,1,se),n===void 0?n=p.rounding:H(n,0,8)):(r=p.precision,n=p.rounding),!e.isFinite())l=Nt(e);else{for(l=J(e),s=l.indexOf("."),T?(i=2,t==16?r=r*4-3:t==8&&(r=r*3-2)):i=t,s>=0&&(l=l.replace(".",""),f=new p(1),f.e=l.length-s,f.d=Ae(J(f),10,i),f.e=f.d.length),d=Ae(l,10,i),o=c=d.length;d[--c]==0;)d.pop();if(!d[0])l=T?"0p+0":"0";else{if(s<0?o--:(e=new p(e),e.d=d,e.e=o,e=N(e,f,r,n,0,i),d=e.d,o=e.e,u=xt),s=d[r],a=i/2,u=u||d[r+1]!==void 0,u=n<4?(s!==void 0||u)&&(n===0||n===(e.s<0?3:2)):s>a||s===a&&(n===4||u||n===6&&d[r-1]&1||n===(e.s<0?8:7)),d.length=r,u)for(;++d[--r]>i-1;)d[r]=0,r||(++o,d.unshift(1));for(c=d.length;!d[c-1];--c);for(s=0,l="";s<c;s++)l+=je.charAt(d[s]);if(T){if(c>1)if(t==16||t==8){for(s=t==16?4:3,--c;c%s;c++)l+="0";for(d=Ae(l,i,t),c=d.length;!d[c-1];--c);for(s=1,l="1.";s<c;s++)l+=je.charAt(d[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>c)for(o-=c;o--;)l+="0";else o<c&&(l=l.slice(0,o)+"."+l.slice(o))}l=(t==16?"0x":t==2?"0b":t==8?"0o":"")+l}return e.s<0?"-"+l:l}function bt(e,t){if(e.length>t)return e.length=t,!0}function kr(e){return new this(e).abs()}function Rr(e){return new this(e).acos()}function Nr(e){return new this(e).acosh()}function Cr(e,t){return new this(e).plus(t)}function Ir(e){return new this(e).asin()}function Fr(e){return new this(e).asinh()}function Er(e){return new this(e).atan()}function _r(e){return new this(e).atanh()}function Mr(e,t){e=new this(e),t=new this(t);var r,n=this.precision,i=this.rounding,o=n+4;return!e.s||!t.s?r=new this(NaN):!e.d&&!t.d?(r=Y(this,o,1).times(t.s>0?.25:.75),r.s=e.s):!t.d||e.isZero()?(r=t.s<0?Y(this,n,i):new this(0),r.s=e.s):!e.d||t.isZero()?(r=Y(this,o,1).times(.5),r.s=e.s):t.s<0?(this.precision=o,this.rounding=1,r=this.atan(N(e,t,o,1)),t=Y(this,o,1),this.precision=n,this.rounding=i,r=e.s<0?r.minus(t):r.plus(t)):r=this.atan(N(e,t,o,1)),r}function Vr(e){return new this(e).cbrt()}function vr(e){return h(e=new this(e),e.e+1,2)}function Dr(e,t,r){return new this(e).clamp(t,r)}function Or(e){if(!e||typeof e!="object")throw Error(Ne+"Object expected");var t,r,n,i=e.defaults===!0,o=["precision",1,se,"rounding",0,8,"toExpNeg",-le,0,"toExpPos",0,le,"maxE",0,le,"minE",-le,0,"modulo",0,9];for(t=0;t<o.length;t+=3)if(r=o[t],i&&(this[r]=ze[r]),(n=e[r])!==void 0)if(q(n)===n&&n>=o[t+1]&&n<=o[t+2])this[r]=n;else throw Error(oe+r+": "+n);if(r="crypto",i&&(this[r]=ze[r]),(n=e[r])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[r]=!0;else throw Error(St);else this[r]=!1;else throw Error(oe+r+": "+n);return this}function Kr(e){return new this(e).cos()}function Wr(e){return new this(e).cosh()}function It(e){var t,r,n;function i(o){var s,a,c,u=this;if(!(u instanceof i))return new i(o);if(u.constructor=i,Tt(o)){u.s=o.s,b?!o.d||o.e>i.maxE?(u.e=NaN,u.d=null):o.e<i.minE?(u.e=0,u.d=[0]):(u.e=o.e,u.d=o.d.slice()):(u.e=o.e,u.d=o.d?o.d.slice():o.d);return}if(c=typeof o,c==="number"){if(o===0){u.s=1/o<0?-1:1,u.e=0,u.d=[0];return}if(o<0?(o=-o,u.s=-1):u.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;b?s>i.maxE?(u.e=NaN,u.d=null):s<i.minE?(u.e=0,u.d=[0]):(u.e=s,u.d=[o]):(u.e=s,u.d=[o]);return}else if(o*0!==0){o||(u.s=NaN),u.e=NaN,u.d=null;return}return Xe(u,o.toString())}else if(c!=="string")throw Error(oe+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),u.s=-1):(a===43&&(o=o.slice(1)),u.s=1),At.test(o)?Xe(u,o):Ar(u,o)}if(i.prototype=m,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.EUCLID=9,i.config=i.set=Or,i.clone=It,i.isDecimal=Tt,i.abs=kr,i.acos=Rr,i.acosh=Nr,i.add=Cr,i.asin=Ir,i.asinh=Fr,i.atan=Er,i.atanh=_r,i.atan2=Mr,i.cbrt=Vr,i.ceil=vr,i.clamp=Dr,i.cos=Kr,i.cosh=Wr,i.div=Ur,i.exp=qr,i.floor=Gr,i.hypot=Hr,i.ln=jr,i.log=zr,i.log10=Yr,i.log2=Zr,i.max=Xr,i.min=Jr,i.mod=Qr,i.mul=$r,i.pow=en,i.random=tn,i.round=rn,i.sign=nn,i.sin=on,i.sinh=sn,i.sqrt=an,i.sub=un,i.sum=cn,i.tan=ln,i.tanh=dn,i.trunc=fn,e===void 0&&(e={}),e&&e.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],t=0;t<n.length;)e.hasOwnProperty(r=n[t++])||(e[r]=this[r]);return i.config(e),i}function Ur(e,t){return new this(e).div(t)}function qr(e){return new this(e).exp()}function Gr(e){return h(e=new this(e),e.e+1,3)}function Hr(){var e,t,r=new this(0);for(b=!1,e=0;e<arguments.length;)if(t=new this(arguments[e++]),t.d)r.d&&(r=r.plus(t.times(t)));else{if(t.s)return b=!0,new this(1/0);r=t}return b=!0,r.sqrt()}function Tt(e){return e instanceof Fe||e&&e.toStringTag===Lt||!1}function jr(e){return new this(e).ln()}function zr(e,t){return new this(e).log(t)}function Zr(e){return new this(e).log(2)}function Yr(e){return new this(e).log(10)}function Xr(){return Rt(this,arguments,"lt")}function Jr(){return Rt(this,arguments,"gt")}function Qr(e,t){return new this(e).mod(t)}function $r(e,t){return new this(e).mul(t)}function en(e,t){return new this(e).pow(t)}function tn(e){var t,r,n,i,o=0,s=new this(1),a=[];if(e===void 0?e=this.precision:H(e,1,se),n=Math.ceil(e/w),this.crypto)if(crypto.getRandomValues)for(t=crypto.getRandomValues(new Uint32Array(n));o<n;)i=t[o],i>=429e7?t[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=i%1e7;else if(crypto.randomBytes){for(t=crypto.randomBytes(n*=4);o<n;)i=t[o]+(t[o+1]<<8)+(t[o+2]<<16)+((t[o+3]&127)<<24),i>=214e7?crypto.randomBytes(4).copy(t,o):(a.push(i%1e7),o+=4);o=n/4}else throw Error(St);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],e%=w,n&&e&&(i=v(10,w-e),a[o]=(n/i|0)*i);a[o]===0;o--)a.pop();if(o<0)r=0,a=[0];else{for(r=-1;a[0]===0;r-=w)a.shift();for(n=1,i=a[0];i>=10;i/=10)n++;n<w&&(r-=w-n)}return s.e=r,s.d=a,s}function rn(e){return h(e=new this(e),e.e+1,this.rounding)}function nn(e){return e=new this(e),e.d?e.d[0]?e.s:0*e.s:e.s||NaN}function on(e){return new this(e).sin()}function sn(e){return new this(e).sinh()}function an(e){return new this(e).sqrt()}function un(e,t){return new this(e).sub(t)}function cn(){var e=0,t=arguments,r=new this(t[e]);for(b=!1;r.s&&++e<t.length;)r=r.plus(t[e]);return b=!0,h(r,this.precision,this.rounding)}function ln(e){return new this(e).tan()}function dn(e){return new this(e).tanh()}function fn(e){return h(e=new this(e),e.e+1,1)}m[Symbol.for("nodejs.util.inspect.custom")]=m.toString;m[Symbol.toStringTag]="Decimal";var Fe=m.constructor=It(ze);Be=new Fe(Be);ke=new Fe(ke);import{PublicKey as tt}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as mn}from"@solana/spl-token";import{PublicKey as I,SystemProgram as Ft,SYSVAR_RENT_PUBKEY as pn}from"@solana/web3.js";function Qe({pubkey:e,isSigner:t=!1,isWritable:r=!0}){return{pubkey:e,isWritable:r,isSigner:t}}var fi=[Qe({pubkey:mn,isWritable:!1}),Qe({pubkey:Ft.programId,isWritable:!1}),Qe({pubkey:pn,isWritable:!1})];function Et({publicKey:e,transformSol:t}){let r=et(e.toString());if(r instanceof I)return t&&r.equals(he)?$e:r;if(t&&r.toString()===he.toBase58())return $e;if(typeof r=="string"){if(r===I.default.toBase58())return I.default;try{return new I(r)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function et(e){try{return new I(e)}catch{return e}}var mi=new I("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),pi=new I("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),gi=new I("SysvarRent111111111111111111111111111111111"),hi=new I("SysvarC1ock11111111111111111111111111111111"),wi=new I("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),yi=new I("Sysvar1nstructions1111111111111111111111111"),bi=Ft.programId,Ti=new I("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),xi=new I("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Pi=new I("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Si=new I("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Li=new I("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Ai=new I("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Bi=new I("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),ki=new I("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Ri=new I("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Ni=new I("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Ci=new I("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),$e=new I("So11111111111111111111111111111111111111112"),he=I.default;import{PublicKey as gn}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as _t}from"@solana/spl-token";var Mt={chainId:101,address:gn.default.toBase58(),programId:_t.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},ae={chainId:101,address:"So11111111111111111111111111111111111111112",programId:_t.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var rt=class{constructor({mint:t,decimals:r,symbol:n,name:i,skipMint:o=!1,isToken2022:s=!1}){if(t===he.toBase58()||t instanceof tt&&he.equals(t)){this.decimals=ae.decimals,this.symbol=ae.symbol,this.name=ae.name,this.mint=new tt(ae.address),this.isToken2022=!1;return}this.decimals=r,this.symbol=n||t.toString().substring(0,6),this.name=i||t.toString().substring(0,6),this.mint=o?tt.default:Et({publicKey:t}),this.isToken2022=s}equals(t){return this===t?!0:this.mint.equals(t.mint)}},ue=rt;ue.WSOL=new rt(G(O({},ae),{mint:ae.address}));import _e from"big.js";import yn from"bn.js";import bn from"decimal.js-light";import hn from"toformat";var wn=hn,we=wn;var Ee=K("module/fraction"),nt=we(_e),ye=we(bn),Tn={[0]:ye.ROUND_DOWN,[1]:ye.ROUND_HALF_UP,[2]:ye.ROUND_UP},xn={[0]:_e.roundDown,[1]:_e.roundHalfUp,[2]:_e.roundUp},k=class{constructor(t,r=new yn(1)){this.numerator=M(t),this.denominator=M(r)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new k(this.denominator,this.numerator)}add(t){let r=t instanceof k?t:new k(M(t));return this.denominator.eq(r.denominator)?new k(this.numerator.add(r.numerator),this.denominator):new k(this.numerator.mul(r.denominator).add(r.numerator.mul(this.denominator)),this.denominator.mul(r.denominator))}sub(t){let r=t instanceof k?t:new k(M(t));return this.denominator.eq(r.denominator)?new k(this.numerator.sub(r.numerator),this.denominator):new k(this.numerator.mul(r.denominator).sub(r.numerator.mul(this.denominator)),this.denominator.mul(r.denominator))}mul(t){let r=t instanceof k?t:new k(M(t));return new k(this.numerator.mul(r.numerator),this.denominator.mul(r.denominator))}div(t){let r=t instanceof k?t:new k(M(t));return new k(this.numerator.mul(r.denominator),this.denominator.mul(r.numerator))}toSignificant(t,r={groupSeparator:""},n=1){Number.isInteger(t)||Ee.logWithError(`${t} is not an integer.`),t<=0&&Ee.logWithError(`${t} is not positive.`),ye.set({precision:t+1,rounding:Tn[n]});let i=new ye(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(t);return i.toFormat(i.decimalPlaces(),r)}toFixed(t,r={groupSeparator:""},n=1){return Number.isInteger(t)||Ee.logWithError(`${t} is not an integer.`),t<0&&Ee.logWithError(`${t} is negative.`),nt.DP=t,nt.RM=xn[n]||1,new nt(this.numerator.toString()).div(this.denominator.toString()).toFormat(t,r)}isZero(){return this.numerator.isZero()}};var Sn=K("Raydium_price"),ee=class extends k{constructor(r){let{baseToken:n,quoteToken:i,numerator:o,denominator:s}=r;super(o,s);this.baseToken=n,this.quoteToken=i,this.scalar=new k(it(n.decimals),it(i.decimals))}get raw(){return new k(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new ee({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(r){this.quoteToken!==r.baseToken&&Sn.logWithError("mul token not equals");let n=super.mul(r);return new ee({baseToken:this.baseToken,quoteToken:r.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(r=this.quoteToken.decimals,n,i){return this.adjusted.toSignificant(r,n,i)}toFixed(r=this.quoteToken.decimals,n,i){return this.adjusted.toFixed(r,n,i)}};var ot=class{constructor({decimals:t,symbol:r="UNKNOWN",name:n="UNKNOWN"}){this.decimals=t,this.symbol=r,this.name=n}equals(t){return this===t}},Me=ot;Me.SOL=new ot(Mt);import Ln from"bn.js";var Vt=new k(new Ln(100)),fe=class extends k{toSignificant(t=5,r,n){return this.mul(Vt).toSignificant(t,r,n)}toFixed(t=2,r,n){return this.mul(Vt).toFixed(t,r,n)}};var An=new j(0),Ro=new j(1),No=new j(2),Co=new j(3),Io=new j(5),st=new j(10),Fo=new j(100),Eo=new j(1e3),_o=new j(1e4),vt=9007199254740991;function M(e){let t=K("Raydium_parseBigNumberish");if(e instanceof j)return e;if(typeof e=="string"){if(e.match(/^-?[0-9]+$/))return new j(e);t.logWithError(`invalid BigNumberish string: ${e}`)}return typeof e=="number"?(e%1&&t.logWithError(`BigNumberish number underflow: ${e}`),(e>=vt||e<=-vt)&&t.logWithError(`BigNumberish number overflow: ${e}`),new j(String(e))):typeof e=="bigint"?new j(e.toString()):(t.error(`invalid BigNumberish value: ${e}`),new j(0))}function it(e){return st.pow(M(e))}var kn=K("Raydium_amount"),Ot=we(Bn);function Rn(e,t){let r="0",n="0";if(e.includes(".")){let i=e.split(".");i.length===2?([r,n]=i,n=n.padEnd(t,"0")):kn.logWithError(`invalid number string, num: ${e}`)}else r=e;return[r,n.slice(0,t)||n]}var te=class extends k{constructor(r,n,i=!0,o){let s=new Ve(0),a=st.pow(new Ve(r.decimals));if(i)s=M(n);else{let c=new Ve(0),u=new Ve(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,d]=Rn(n.toString(),r.decimals);c=M(l),u=M(d)}c=c.mul(a),s=c.add(u)}super(s,a);this.logger=K(o||"TokenAmount"),this.token=r}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(r){return this.token.equals(r.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(r.raw)}lt(r){return this.token.equals(r.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(r.raw)}add(r){return this.token.equals(r.token)||this.logger.logWithError("add token not equals"),new te(this.token,this.raw.add(r.raw))}subtract(r){return this.token.equals(r.token)||this.logger.logWithError("sub token not equals"),new te(this.token,this.raw.sub(r.raw))}toSignificant(r=this.token.decimals,n,i=0){return super.toSignificant(r,n,i)}toFixed(r=this.token.decimals,n,i=0){return r>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(r,n,i)}toExact(r={groupSeparator:""}){return Ot.DP=this.token.decimals,new Ot(this.numerator.toString()).div(this.denominator.toString()).toFormat(r)}};function Dt(e){return typeof e=="object"&&e!==null&&![ue,te,Nn,k,Cn,ee,fe].some(t=>typeof t=="object"&&e instanceof t)}function ve(e){return typeof e=="string"?et(e):Array.isArray(e)?e.map(t=>ve(t)):Dt(e)?Object.fromEntries(Object.entries(e).map(([t,r])=>[t,ve(r)])):e}import{PublicKey as Os,sendAndConfirmTransaction as Ks,Transaction as Us,TransactionMessage as Gs,VersionedTransaction as Hs}from"@solana/web3.js";import Zs from"axios";import{PublicKey as In,ComputeBudgetProgram as ls,Transaction as fs,TransactionMessage as ps,Keypair as gs,VersionedTransaction as ws}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Ts}from"@solana/spl-token";var Ss=K("Raydium_txUtil");function be(e,t){let[r,n]=In.findProgramAddressSync(e,t);return{publicKey:r,nonce:n}}import{PublicKey as Fn,AddressLookupTableAccount as Kt}from"@solana/web3.js";var En={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new Kt({key:new Fn("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:Kt.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};function at(e,t=1,r=[]){let n=[...e];if(t<=0)return r;for(;n.length;)r.push(n.splice(0,t));return r}var Ut=e=>typeof e=="number";function qt(e,t,r){let n=Ut(t)?t*((r==null?void 0:r.unit)==="s"?1e3:1):t;return new Date(e).getTime()<=n}function Gt(e,t,r){let n=Ut(t)?t*((r==null?void 0:r.unit)==="s"?1e3:1):t;return new Date(e).getTime()>n}import{PublicKey as S}from"@solana/web3.js";var Ht=new S("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),jt=new S("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),zt=new S("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),ia=new S("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),oa=new S("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),sa=new S("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),aa=new S("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),ua=new S("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),ca=new S("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),la=new S("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),da=new S("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),fa=new S("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),ma=new S("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),pa=new S("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),ga=new S("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),ha=new S("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),wa=new S("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),ya=new S("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),ba=new S("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),_n=new S("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),Mn=new S("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),Vn=new S("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2");var Ta={SERUM_MARKET:S.default,OPENBOOK_MARKET:new S("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:S.default,FarmV3:new S("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new S("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new S("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new S("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new S("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new S("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),Router:new S("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:_n,CREATE_CPMM_POOL_AUTH:Mn,CREATE_CPMM_POOL_FEE_ACC:Vn,FEE_DESTINATION_ID:new S("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR")};import{PublicKey as Sa}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Ba}from"@solana/spl-token";import Na from"bn.js";var ut=K("Raydium_accountInfo_util");async function Wt(e,t,r){let{batchRequest:n,commitment:i="confirmed",chunkCount:o=100}=O({batchRequest:!1},r),s=at(t,o),a=new Array(s.length).fill([]);if(n){let c=s.map(d=>{let f=e._buildArgs([d.map(p=>p.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:f}}),u=at(c,10);a=(await(await Promise.all(u.map(async d=>await e._rpcBatchRequest(d)))).flat()).map(d=>(d.error&&ut.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${d.error.message}`),d.result.value.map(f=>{if(f){let{data:p,executable:T,lamports:y,owner:L,rentEpoch:P}=f;return p.length!==2&&p[1]!=="base64"&&ut.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:T,lamports:y,owner:new vn(L),rentEpoch:P}}return null})))}else try{a=await Promise.all(s.map(c=>e.getMultipleAccountsInfo(c,i)))}catch(c){c instanceof Error&&ut.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return a.flat()}async function Zt(e,t,r){let n=await Wt(e,t.map(i=>i.pubkey),r);return t.map((i,o)=>G(O({},i),{accountInfo:n[o]}))}import{PublicKey as Gn}from"@solana/web3.js";import Qt,{isBN as $t}from"bn.js";import{bits as uu,BitStructure as cu,blob as Dn,Blob as lu,cstr as du,f32 as fu,f32be as mu,f64 as pu,f64be as gu,greedy as hu,Layout as On,ns64 as wu,ns64be as yu,nu64 as bu,nu64be as Tu,offset as xu,s16 as Pu,s16be as Su,s24 as Lu,s24be as Au,s32 as Bu,s32be as ku,s40 as Ru,s40be as Nu,s48 as Cu,s48be as Iu,s8 as Fu,seq as Kn,struct as Eu,Structure as Wn,u16 as _u,u16be as Mu,u24 as Vu,u24be as vu,u32 as Du,u32be as Ou,u40 as Ku,u40be as Wu,u48 as Uu,u48be as qu,u8 as Un,UInt as qn,union as Gu,Union as Hu,unionLayoutDiscriminator as ju,utf8 as zu}from"@solana/buffer-layout";var ct=On,Yt=Wn;var lt=qn;var Xt=Un;var Jt=Kn;var ce=Dn;var me=class extends ct{constructor(r,n,i){super(r,i);this.blob=ce(r),this.signed=n}decode(r,n=0){let i=new Qt(this.blob.decode(r,n),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(r,n,i=0){return typeof r=="number"&&(r=new Qt(r)),this.signed&&(r=r.toTwos(this.span*8)),this.blob.encode(r.toArrayLike(Buffer,"le",this.span),n,i)}};function _(e){return new lt(1,e)}function Oe(e){return new lt(4,e)}function g(e){return new me(8,!1,e)}function re(e){return new me(16,!1,e)}function er(e){return new me(1,!0,e)}function Ke(e){return new me(8,!0,e)}var De=class extends ct{constructor(r,n,i,o){super(r.span,o);this.layout=r,this.decoder=n,this.encoder=i}decode(r,n){return this.decoder(this.layout.decode(r,n))}encode(r,n,i){return this.layout.encode(this.encoder(r),n,i)}getSpan(r,n){return this.layout.getSpan(r,n)}};function x(e){return new De(ce(32),t=>new Gn(t),t=>t.toBuffer(),e)}function ft(e){return new De(Xt(),Hn,jn,e)}function Hn(e){if(e===0)return!1;if(e===1)return!0;throw new Error("Invalid bool: "+e)}function jn(e){return e?1:0}var dt=class extends Yt{decode(t,r){return super.decode(t,r)}};function F(e,t,r){return new dt(e,t,r)}function E(e,t,r){let n,i=typeof t=="number"?t:$t(t)?t.toNumber():new Proxy(t,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=$t(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return Jt(e,i,r)}var mt=F([x("mint"),x("owner"),g("amount"),Oe("delegateOption"),x("delegate"),_("state"),Oe("isNativeOption"),g("isNative"),g("delegatedAmount"),Oe("closeAuthorityOption"),x("closeAuthority")]);import{PublicKey as cr}from"@solana/web3.js";var mc=F([_("instruction")]),pc=F([_("instruction")]),zn=F([g("rewardState"),g("rewardOpenTime"),g("rewardEndTime"),g("rewardLastUpdateTime"),g("totalReward"),g("totalRewardEmissioned"),g("rewardClaimed"),g("rewardPerSecond"),re("accRewardPerShare"),x("rewardVault"),x("rewardMint"),x("rewardSender"),g("rewardType"),E(g(),15,"padding")]),Zn=F([g("state"),g("nonce"),x("lpVault"),x("rewardVault"),x(),x(),g(),g(),g("totalReward"),re("perShareReward"),g("lastSlot"),g("perSlotReward")]),Yn=F([g("state"),g("nonce"),x("lpVault"),x("rewardVaultA"),g("totalRewardA"),re("perShareRewardA"),g("perSlotRewardA"),_("option"),x("rewardVaultB"),ce(7),g("totalRewardB"),re("perShareRewardB"),g("perSlotRewardB"),g("lastSlot"),x()]),Xn=F([g(),g("state"),g("nonce"),g("validRewardTokenNum"),re("rewardMultiplier"),g("rewardPeriodMax"),g("rewardPeriodMin"),g("rewardPeriodExtend"),x("lpMint"),x("lpVault"),E(zn,5,"rewardInfos"),x("creator"),x(),E(g(),32,"padding")]),tr=new Proxy(Zn,{get(e,t,r){return t==="decode"?(...n)=>{let i=e.decode(...n);return G(O({},i),{version:3,rewardInfos:[{rewardVault:i.rewardVault,totalReward:i.totalReward,perSlotReward:i.perSlotReward,perShareReward:i.perShareReward}]})}:Reflect.get(e,t,r)}}),rr=new Proxy(Yn,{get(e,t,r){return t==="decode"?(...n)=>{let i=e.decode(...n);return G(O({},i),{version:5,rewardInfos:[{rewardVault:i.rewardVaultA,totalReward:i.totalRewardA,perSlotReward:i.perSlotRewardA,perShareReward:i.perShareRewardA},{rewardVault:i.rewardVaultB,totalReward:i.totalRewardB,perSlotReward:i.perSlotRewardB,perShareReward:i.perShareRewardB}]})}:Reflect.get(e,t,r)}}),nr=new Proxy(Xn,{get(e,t,r){return t==="decode"?(...n)=>{let i=e.decode(...n);return G(O({},i),{version:6,rewardInfos:i.rewardInfos.map(o=>{var s;return G(O({},o),{rewardType:((s=Object.entries(We).find(a=>String(a[1])===o.rewardType.toString()))!=null?s:["Standard SPL"])[0]})})})}:Reflect.get(e,t,r)}}),Jn=F([g("isSet"),g("rewardPerSecond"),g("rewardOpenTime"),g("rewardEndTime"),g("rewardType")]),gc=F([_("instruction"),g("nonce"),E(Jn,5,"rewardTimeInfo")]),hc=F([_("instruction"),g("rewardReopenTime"),g("rewardEndTime"),g("rewardPerSecond")]),wc=F([_("instruction"),g("isSet"),g("rewardPerSecond"),g("rewardOpenTime"),g("rewardEndTime"),g("rewardType")]),yc=F([g("state"),x("id"),x("owner"),g("deposited"),E(g(),1,"rewardDebts")]),ir=F([g("state"),x("id"),x("owner"),g("deposited"),E(re(),1,"rewardDebts"),g(""),g("voteLockedBalance"),E(g(),15)]),bc=F([g("state"),x("id"),x("owner"),g("deposited"),E(g(),2,"rewardDebts")]),or=F([g("state"),x("id"),x("owner"),g("deposited"),E(re(),2,"rewardDebts"),E(g(),17)]),sr=F([g(),g("state"),x("id"),x("owner"),g("deposited"),E(re(),5,"rewardDebts"),E(g(),16)]),Tc=F([_("instruction"),g("amount")]),Qn=F([x("mint"),x("grantAuthority"),g("baselineVoteWeightScaledFactor"),g("maxExtraLockupVoteWeightScaledFactor"),g("lockupSaturationSecs"),er("digitShift"),E(_(),7,"reserved1"),E(g(),7,"reserved2")]),ar=F([ce(8),x("governanceProgramId"),x("realm"),x("realmGoverningTokenMint"),x("realmAuthority"),E(_(),32,"reserved1"),E(Qn,4,"votingMints"),Ke("timeOffset"),_("bump"),E(_(),7,"reserved2"),E(g(),11,"reserved3")]),$n=F([Ke("startTime"),Ke("endTime"),_("kind"),E(_(),15,"reserved")]),ei=F([E($n,1,"lockup"),g("amountDeposited_native"),g("amountInitiallyLockedNative"),ft("isUsed"),ft("allowClawback"),_("votingMintConfigIdx"),E(_(),29,"reserved")]),ur=F([ce(8),x("voterAuthority"),x("registrar"),E(ei,32,"deposits"),_("voterBump"),_("voterWweightRecordBump"),E(_(),94,"reserved")]);var Rc=K("Raydium_farm_config"),Nc=new cr("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Cc=new cr("FrspKwj8i3pNmKwXreTveC4fu7KL5ZbGeXdZBe2XViu1"),lr={3:tr,5:rr,6:nr},dr={3:ir,5:or,6:sr};var We={"Standard SPL":0,"Option tokens":1},Ic={[Ht.toString()]:3,[jt.toString()]:5,[zt.toString()]:6};var Te=K("Raydium.farm.util");function jc({programId:e,poolId:t,mint:r,type:n}){let{publicKey:i}=be([t.toBuffer(),r.toBuffer(),Buffer.from(n==="lpVault"?"lp_vault_associated_seed":n==="rewardVault"?"reward_vault_associated_seed":"","utf-8")],e);return i}function ti({programId:e,poolId:t,owner:r,version:n}){let{publicKey:i}=be([t.toBuffer(),r.toBuffer(),Buffer.from(n===6?"farmer_info_associated_seed":"staker_info_v2_associated_seed","utf-8")],e);return i}var zc=({programId:e,poolId:t})=>be([t.toBuffer()],e);function Zc(e){return{isSet:new z(1),rewardPerSecond:M(e.perSecond),rewardOpenTime:M(e.openTime),rewardEndTime:M(e.endTime),rewardType:M(We[e.rewardType])}}function Yc(e){return M(e.endTime).sub(M(e.openTime)).mul(M(e.perSecond))}function ri(e){let t=dr[e];return t||Te.logWithError("invalid version",e),t}function ni(e){let t=lr[e];return t||Te.logWithError("invalid version",e),t}function ii(e,t,r,n){if(e.version===3||e.version===5){if(e.lastSlot.gte(new z(r)))return e;let i=new z(r).sub(e.lastSlot);e.lastSlot=new z(r);for(let o of e.rewardInfos){if(t.amount.eq(new z(0)))continue;let s=o.perSlotReward.mul(i);o.perShareReward=o.perShareReward.add(s.mul(new z(10).pow(new z(e.version===3?9:15))).div(t.amount)),o.totalReward=o.totalReward.add(s)}}else if(e.version===6)for(let i of e.rewardInfos){if(i.rewardState.eq(new z(0)))continue;let o=z.min(new z(n),i.rewardEndTime);if(i.rewardOpenTime.gte(o))continue;let a=o.sub(i.rewardLastUpdateTime).mul(i.rewardPerSecond),c=i.totalReward.sub(i.totalRewardEmissioned);c.lt(a)?(a=c,i.rewardLastUpdateTime=i.rewardLastUpdateTime.add(c.div(i.rewardPerSecond))):i.rewardLastUpdateTime=o,!t.amount.eq(new z(0))&&(i.accRewardPerShare=i.accRewardPerShare.add(a.mul(e.rewardMultiplier).div(t.amount)),i.totalRewardEmissioned=i.totalRewardEmissioned.add(a))}return e}async function Xc({connection:e,farmPools:t,owner:r,config:n,chainTime:i}){let o=!1,s=!1,a=new z(10),c=[];for(let f of t){let p=ve(f);p.version===6?s=!0:o=!0,c.push({pubkey:p.id,version:p.version,key:"state",poolId:p.id},{pubkey:p.lpVault,version:p.version,key:"lpVault",poolId:p.id}),r&&c.push({pubkey:ti({programId:p.programId,poolId:p.id,owner:r,version:f.version}),version:p.version,key:"ledger",poolId:p.id})}let u={},l=await Zt(e,c,n);for(let{pubkey:f,version:p,key:T,poolId:y,accountInfo:L}of l){let P=y.toBase58();if(u[P]=O({},u[P]),T==="state"){let V=ni(p);(!L||!L.data||L.data.length!==V.span)&&Te.logWithError(`invalid farm state account info, pools.id, ${f}`),u[P].state=V.decode(L.data)}else if(T==="lpVault")(!L||!L.data||L.data.length!==mt.span)&&Te.logWithError(`invalid farm lp vault account info, pools.lpVault, ${f}`),u[P].lpVault=mt.decode(L.data);else if(T==="ledger"){let V=ri(p);L&&L.data&&(L.data.length!==V.span&&Te.logWithError(`invalid farm ledger account info, ledger, ${f}`),u[P].ledger=V.decode(L.data))}}let d=s||o?await e.getSlot():0;for(let f of Object.keys(u))u[f]!==void 0&&(u[f].state=ii(u[f].state,u[f].lpVault,d,i));for(let[f,{state:p,ledger:T}]of Object.entries(u))if(T){let y=p.version===6?p.rewardMultiplier:p.rewardInfos.length===1?a.pow(new z(9)):a.pow(new z(15)),L=p.rewardInfos.map((P,V)=>{let R=T.rewardDebts[V];return T.deposited.mul(p.version===6?P.accRewardPerShare:P.perShareReward).div(y).sub(R)});u[f].wrapped=G(O({},u[f].wrapped),{pendingRewards:L})}return u}function Jc(e,t=Date.now()){if(e.version===6){let r=e.state.rewardInfos;if(r.every(({rewardOpenTime:n})=>qt(t,n.toNumber(),{unit:"s"})))return"upcoming pool";if(r.every(({rewardEndTime:n})=>Gt(t,n.toNumber(),{unit:"s"})))return"closed pool"}else{let r=e.state.rewardInfos.map(({perSlotReward:n})=>n);if(r.length===2){if(String(r[0])==="0"&&String(r[1])!=="0")return"normal fusion pool";if(String(r[0])!=="0"&&String(r[1])!=="0")return"dual fusion pool";if(String(r[0])==="0"&&String(r[1])==="0")return"closed pool"}else if(r.length===1&&String(r[0])==="0")return"closed pool"}}async function Qc(e,t,r,n){let i=await e.getAccountInfo(t);if(i===null)throw Error("registrar info check error");let s=ar.decode(i.data).votingMints.findIndex(l=>l.mint.equals(n));if(s===-1)throw Error("find voter mint error");let a=await e.getAccountInfo(r);if(a===null)return{index:s,isInit:!1};let u=ur.decode(a.data).deposits.findIndex(l=>l.isUsed&&l.votingMintConfigIdx===s);return u===-1?{index:s,isInit:!1}:{index:u,isInit:!0}}export{Yc as calFarmRewardAmount,Zc as farmRewardInfoToConfig,Xc as fetchMultipleFarmInfoAndUpdate,zc as getAssociatedAuthority,ti as getAssociatedLedgerAccount,jc as getAssociatedLedgerPoolAccount,Qc as getDepositEntryIndex,ri as getFarmLedgerLayout,ni as getFarmStateLayout,Jc as judgeFarmType,ii as updateFarmPoolInfo};
//# sourceMappingURL=util.mjs.map