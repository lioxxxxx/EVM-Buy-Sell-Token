var I=Object.create;var d=Object.defineProperty;var j=Object.getOwnPropertyDescriptor;var H=Object.getOwnPropertyNames,D=Object.getOwnPropertySymbols,J=Object.getPrototypeOf,E=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var M=(r,t,e)=>t in r?d(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,S=(r,t)=>{for(var e in t||(t={}))E.call(t,e)&&M(r,e,t[e]);if(D)for(var e of D(t))X.call(t,e)&&M(r,e,t[e]);return r};var Z=(r,t)=>{for(var e in t)d(r,e,{get:t[e],enumerable:!0})},Q=(r,t,e,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let u of H(t))!E.call(r,u)&&u!==e&&d(r,u,{get:()=>t[u],enumerable:!(o=j(t,u))||o.enumerable});return r};var $=(r,t,e)=>(e=r!=null?I(J(r)):{},Q(t||!r||!r.__esModule?d(e,"default",{value:r,enumerable:!0}):e,r)),ee=r=>Q(d({},"__esModule",{value:!0}),r);var re={};Z(re,{initializeMarket:()=>Y,makeCreateMarketInstruction:()=>ne});module.exports=ee(re);var g=require("@solana/web3.js"),C=require("@solana/spl-token"),V=require("@solana/spl-token"),i=require("@solana/web3.js");var z=require("@solana/web3.js"),m=$(require("bn.js"));var n=require("@solana/buffer-layout"),P=n.Layout,W=n.Structure;var f=n.UInt;var O=n.u16;var L=n.u32;var y=n.blob;var h=n.bits;var T=class extends P{constructor(e,o,u){super(e,u);this.blob=y(e),this.signed=o}decode(e,o=0){let u=new m.default(this.blob.decode(e,o),10,"le");return this.signed?u.fromTwos(this.span*8).clone():u}encode(e,o,u=0){return typeof e=="number"&&(e=new m.default(e)),this.signed&&(e=e.toTwos(this.span*8)),this.blob.encode(e.toArrayLike(Buffer,"le",this.span),o,u)}},l=class extends P{constructor(e){super(8,e);this._lower=h(L(),!1),this._upper=h(L(),!1)}addBoolean(e){this._lower.fields.length<32?this._lower.addBoolean(e):this._upper.addBoolean(e)}decode(e,o=0){let u=this._lower.decode(e,o),p=this._upper.decode(e,o+this._lower.span);return S(S({},u),p)}encode(e,o,u=0){return this._lower.encode(e,o,u)+this._upper.encode(e,o,u+this._lower.span)}};function k(r){return new f(1,r)}function G(r){return new f(4,r)}function s(r){return new T(8,!1,r)}var w=class extends P{constructor(e,o,u,p){super(e.span,p);this.layout=e,this.decoder=o,this.encoder=u}decode(e,o){return this.decoder(this.layout.decode(e,o))}encode(e,o,u){return this.layout.encode(this.encoder(e),o,u)}getSpan(e,o){return this.layout.getSpan(e,o)}};function c(r){return new w(y(32),t=>new z.PublicKey(t),t=>t.toBuffer(),r)}var B=class extends W{decode(t,e){return super.decode(t,e)}};function x(r,t,e){return new B(r,t,e)}function te(r="accountFlags"){let t=new l(r);return t.addBoolean("initialized"),t.addBoolean("market"),t.addBoolean("openOrders"),t.addBoolean("requestQueue"),t.addBoolean("eventQueue"),t.addBoolean("bids"),t.addBoolean("asks"),t}var A=x([y(5),te("accountFlags"),c("ownAddress"),s("vaultSignerNonce"),c("baseMint"),c("quoteMint"),c("baseVault"),s("baseDepositsTotal"),s("baseFeesAccrued"),c("quoteVault"),s("quoteDepositsTotal"),s("quoteFeesAccrued"),s("quoteDustThreshold"),c("requestQueue"),c("eventQueue"),c("bids"),c("asks"),s("baseLotSize"),s("quoteLotSize"),s("feeRateBps"),s("referrerRebatesAccrued"),y(7)]);var a={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut"};function Y({programId:r,marketInfo:t}){let e=x([k("version"),G("instruction"),s("baseLotSize"),s("quoteLotSize"),O("feeRateBps"),s("vaultSignerNonce"),s("quoteDustThreshold")]),o=[{pubkey:t.id,isSigner:!1,isWritable:!0},{pubkey:t.requestQueue,isSigner:!1,isWritable:!0},{pubkey:t.eventQueue,isSigner:!1,isWritable:!0},{pubkey:t.bids,isSigner:!1,isWritable:!0},{pubkey:t.asks,isSigner:!1,isWritable:!0},{pubkey:t.baseVault,isSigner:!1,isWritable:!0},{pubkey:t.quoteVault,isSigner:!1,isWritable:!0},{pubkey:t.baseMint,isSigner:!1,isWritable:!1},{pubkey:t.quoteMint,isSigner:!1,isWritable:!1},{pubkey:t.authority?t.quoteMint:g.SYSVAR_RENT_PUBKEY,isSigner:!1,isWritable:!1}].concat(t.authority?{pubkey:t.authority,isSigner:!1,isWritable:!1}:[]).concat(t.authority&&t.pruneAuthority?{pubkey:t.pruneAuthority,isSigner:!1,isWritable:!1}:[]),u=Buffer.alloc(e.span);return e.encode({version:0,instruction:0,baseLotSize:t.baseLotSize,quoteLotSize:t.quoteLotSize,feeRateBps:t.feeRateBps,vaultSignerNonce:t.vaultSignerNonce,quoteDustThreshold:t.quoteDustThreshold},u),new g.TransactionInstruction({keys:o,programId:r,data:u})}async function ne({connection:r,wallet:t,marketInfo:e}){var _,q,K,U,R,F,v,N;let o=new i.Transaction,u=await r.getMinimumBalanceForRentExemption(165);o.add(i.SystemProgram.createAccountWithSeed({fromPubkey:t,basePubkey:t,seed:e.baseVault.seed,newAccountPubkey:e.baseVault.publicKey,lamports:u,space:165,programId:C.TOKEN_PROGRAM_ID}),i.SystemProgram.createAccountWithSeed({fromPubkey:t,basePubkey:t,seed:e.quoteVault.seed,newAccountPubkey:e.quoteVault.publicKey,lamports:u,space:165,programId:C.TOKEN_PROGRAM_ID}),(0,V.createInitializeAccountInstruction)(e.baseVault.publicKey,e.baseMint,e.vaultOwner),(0,V.createInitializeAccountInstruction)(e.quoteVault.publicKey,e.quoteMint,e.vaultOwner));let p=new i.Transaction;return p.add(i.SystemProgram.createAccountWithSeed({fromPubkey:t,basePubkey:t,seed:e.id.seed,newAccountPubkey:e.id.publicKey,lamports:await r.getMinimumBalanceForRentExemption(A.span),space:A.span,programId:e.programId}),i.SystemProgram.createAccountWithSeed({fromPubkey:t,basePubkey:t,seed:e.requestQueue.seed,newAccountPubkey:e.requestQueue.publicKey,lamports:await r.getMinimumBalanceForRentExemption((_=e.requestQueueSpace)!=null?_:5120+12),space:(q=e.requestQueueSpace)!=null?q:5120+12,programId:e.programId}),i.SystemProgram.createAccountWithSeed({fromPubkey:t,basePubkey:t,seed:e.eventQueue.seed,newAccountPubkey:e.eventQueue.publicKey,lamports:await r.getMinimumBalanceForRentExemption((K=e.eventQueueSpace)!=null?K:262144+12),space:(U=e.eventQueueSpace)!=null?U:262144+12,programId:e.programId}),i.SystemProgram.createAccountWithSeed({fromPubkey:t,basePubkey:t,seed:e.bids.seed,newAccountPubkey:e.bids.publicKey,lamports:await r.getMinimumBalanceForRentExemption((R=e.orderbookQueueSpace)!=null?R:65536+12),space:(F=e.orderbookQueueSpace)!=null?F:65536+12,programId:e.programId}),i.SystemProgram.createAccountWithSeed({fromPubkey:t,basePubkey:t,seed:e.asks.seed,newAccountPubkey:e.asks.publicKey,lamports:await r.getMinimumBalanceForRentExemption((v=e.orderbookQueueSpace)!=null?v:65536+12),space:(N=e.orderbookQueueSpace)!=null?N:65536+12,programId:e.programId}),Y({programId:e.programId,marketInfo:{id:e.id.publicKey,requestQueue:e.requestQueue.publicKey,eventQueue:e.eventQueue.publicKey,bids:e.bids.publicKey,asks:e.asks.publicKey,baseVault:e.baseVault.publicKey,quoteVault:e.quoteVault.publicKey,baseMint:e.baseMint,quoteMint:e.quoteMint,baseLotSize:e.baseLotSize,quoteLotSize:e.quoteLotSize,feeRateBps:e.feeRateBps,vaultSignerNonce:e.vaultSignerNonce,quoteDustThreshold:e.quoteDustThreshold}})),[{transaction:o,signer:[],instructionTypes:[a.CreateAccount,a.CreateAccount,a.InitAccount,a.InitAccount]},{transaction:p,signer:[],instructionTypes:[a.CreateAccount,a.CreateAccount,a.CreateAccount,a.CreateAccount,a.CreateAccount,a.InitMarket]}]}0&&(module.exports={initializeMarket,makeCreateMarketInstruction});
//# sourceMappingURL=instrument.js.map