var Yi=Object.defineProperty,Hi=Object.defineProperties;var Zi=Object.getOwnPropertyDescriptors;var Wn=Object.getOwnPropertySymbols;var ji=Object.prototype.hasOwnProperty,Ji=Object.prototype.propertyIsEnumerable;var qn=(i,e,t)=>e in i?Yi(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,j=(i,e)=>{for(var t in e||(e={}))ji.call(e,t)&&qn(i,t,e[t]);if(Wn)for(var t of Wn(e))Ji.call(e,t)&&qn(i,t,e[t]);return i},ee=(i,e)=>Hi(i,Zi(e));import{PublicKey as _g}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Wg,TOKEN_2022_PROGRAM_ID as qg,createTransferInstruction as Gg}from"@solana/spl-token";import{get as Gn,set as $i}from"lodash";var rn=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Un={},er={};function ie(i){let e=Gn(Un,i);if(!e){let t=Gn(er,i);e=new rn({name:i,logLevel:t}),$i(Un,i,e)}return e}import{PublicKey as lo}from"@solana/web3.js";import po from"bn.js";import uo from"big.js";import zt from"bn.js";import Ke from"bn.js";var bt=9e15,ot=1e9,on="0123456789abcdef",Ft="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",vt="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",sn={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-bt,maxE:bt,crypto:!1},Yn,Ze,V=!0,Dt="[DecimalError] ",rt=Dt+"Invalid argument: ",Hn=Dt+"Precision limit exceeded",Zn=Dt+"crypto unavailable",jn="[object Decimal]",he=Math.floor,de=Math.pow,tr=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,nr=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,ir=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Jn=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,_e=1e7,_=7,rr=9007199254740991,or=Ft.length-1,an=vt.length-1,P={toStringTag:jn};P.absoluteValue=P.abs=function(){var i=new this.constructor(this);return i.s<0&&(i.s=1),M(i)};P.ceil=function(){return M(new this.constructor(this),this.e+1,2)};P.clampedTo=P.clamp=function(i,e){var t,n=this,r=n.constructor;if(i=new r(i),e=new r(e),!i.s||!e.s)return new r(NaN);if(i.gt(e))throw Error(rt+e);return t=n.cmp(i),t<0?i:n.cmp(e)>0?e:new r(n)};P.comparedTo=P.cmp=function(i){var e,t,n,r,o=this,s=o.d,a=(i=new o.constructor(i)).d,u=o.s,c=i.s;if(!s||!a)return!u||!c?NaN:u!==c?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-c:0;if(u!==c)return u;if(o.e!==i.e)return o.e>i.e^u<0?1:-1;for(n=s.length,r=a.length,e=0,t=n<r?n:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^u<0?1:-1;return n===r?0:n>r^u<0?1:-1};P.cosine=P.cos=function(){var i,e,t=this,n=t.constructor;return t.d?t.d[0]?(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+_,n.rounding=1,t=sr(n,ii(n,t)),n.precision=i,n.rounding=e,M(Ze==2||Ze==3?t.neg():t,i,e,!0)):new n(1):new n(NaN)};P.cubeRoot=P.cbrt=function(){var i,e,t,n,r,o,s,a,u,c,m=this,l=m.constructor;if(!m.isFinite()||m.isZero())return new l(m);for(V=!1,o=m.s*de(m.s*m,1/3),!o||Math.abs(o)==1/0?(t=Pe(m.d),i=m.e,(o=(i-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=de(t,1/3),i=he((i+1)/3)-(i%3==(i<0?-1:2)),o==1/0?t="5e"+i:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+i),n=new l(t),n.s=m.s):n=new l(o.toString()),s=(i=l.precision)+3;;)if(a=n,u=a.times(a).times(a),c=u.plus(m),n=ne(c.plus(m).times(a),c.plus(u),s+2,1),Pe(a.d).slice(0,s)===(t=Pe(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(M(a,i+1,0),a.times(a).times(a).eq(m))){n=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(M(n,i+1,1),e=!n.times(n).times(n).eq(m));break}return V=!0,M(n,i,l.rounding,e)};P.decimalPlaces=P.dp=function(){var i,e=this.d,t=NaN;if(e){if(i=e.length-1,t=(i-he(this.e/_))*_,i=e[i],i)for(;i%10==0;i/=10)t--;t<0&&(t=0)}return t};P.dividedBy=P.div=function(i){return ne(this,new this.constructor(i))};P.dividedToIntegerBy=P.divToInt=function(i){var e=this,t=e.constructor;return M(ne(e,new t(i),0,1,1),t.precision,t.rounding)};P.equals=P.eq=function(i){return this.cmp(i)===0};P.floor=function(){return M(new this.constructor(this),this.e+1,3)};P.greaterThan=P.gt=function(i){return this.cmp(i)>0};P.greaterThanOrEqualTo=P.gte=function(i){var e=this.cmp(i);return e==1||e===0};P.hyperbolicCosine=P.cosh=function(){var i,e,t,n,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(i=Math.ceil(r/3),e=(1/Wt(4,i)).toString()):(i=16,e="2.3283064365386962890625e-10"),o=yt(s,1,o.times(e),new s(1),!0);for(var u,c=i,m=new s(8);c--;)u=o.times(o),o=a.minus(u.times(m.minus(u.times(m))));return M(o,s.precision=t,s.rounding=n,!0)};P.hyperbolicSine=P.sinh=function(){var i,e,t,n,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,n=r.d.length,n<3)r=yt(o,2,r,r,!0);else{i=1.4*Math.sqrt(n),i=i>16?16:i|0,r=r.times(1/Wt(5,i)),r=yt(o,2,r,r,!0);for(var s,a=new o(5),u=new o(16),c=new o(20);i--;)s=r.times(r),r=r.times(a.plus(s.times(u.times(s).plus(c))))}return o.precision=e,o.rounding=t,M(r,e,t,!0)};P.hyperbolicTangent=P.tanh=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+7,n.rounding=1,ne(t.sinh(),t.cosh(),n.precision=i,n.rounding=e)):new n(t.s)};P.inverseCosine=P.acos=function(){var i,e=this,t=e.constructor,n=e.abs().cmp(1),r=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?ve(t,r,o):new t(0):new t(NaN):e.isZero()?ve(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),i=ve(t,r+4,o).times(.5),t.precision=r,t.rounding=o,i.minus(e))};P.inverseHyperbolicCosine=P.acosh=function(){var i,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(i=n.precision,e=n.rounding,n.precision=i+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,V=!1,t=t.times(t).minus(1).sqrt().plus(t),V=!0,n.precision=i,n.rounding=e,t.ln()):new n(t)};P.inverseHyperbolicSine=P.asinh=function(){var i,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,V=!1,t=t.times(t).plus(1).sqrt().plus(t),V=!0,n.precision=i,n.rounding=e,t.ln())};P.inverseHyperbolicTangent=P.atanh=function(){var i,e,t,n,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(i=o.precision,e=o.rounding,n=r.sd(),Math.max(n,i)<2*-r.e-1?M(new o(r),i,e,!0):(o.precision=t=n-r.e,r=ne(r.plus(1),new o(1).minus(r),t+i,1),o.precision=i+4,o.rounding=1,r=r.ln(),o.precision=i,o.rounding=e,r.times(.5))):new o(NaN)};P.inverseSine=P.asin=function(){var i,e,t,n,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(i=ve(o,t+4,n).times(.5),i.s=r.s,i):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,r.times(2)))};P.inverseTangent=P.atan=function(){var i,e,t,n,r,o,s,a,u,c=this,m=c.constructor,l=m.precision,d=m.rounding;if(c.isFinite()){if(c.isZero())return new m(c);if(c.abs().eq(1)&&l+4<=an)return s=ve(m,l+4,d).times(.25),s.s=c.s,s}else{if(!c.s)return new m(NaN);if(l+4<=an)return s=ve(m,l+4,d).times(.5),s.s=c.s,s}for(m.precision=a=l+10,m.rounding=1,t=Math.min(28,a/_+2|0),i=t;i;--i)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(V=!1,e=Math.ceil(a/_),n=1,u=c.times(c),s=new m(c),r=c;i!==-1;)if(r=r.times(u),o=s.minus(r.div(n+=2)),r=r.times(u),s=o.plus(r.div(n+=2)),s.d[e]!==void 0)for(i=e;s.d[i]===o.d[i]&&i--;);return t&&(s=s.times(2<<t-1)),V=!0,M(s,m.precision=l,m.rounding=d,!0)};P.isFinite=function(){return!!this.d};P.isInteger=P.isInt=function(){return!!this.d&&he(this.e/_)>this.d.length-2};P.isNaN=function(){return!this.s};P.isNegative=P.isNeg=function(){return this.s<0};P.isPositive=P.isPos=function(){return this.s>0};P.isZero=function(){return!!this.d&&this.d[0]===0};P.lessThan=P.lt=function(i){return this.cmp(i)<0};P.lessThanOrEqualTo=P.lte=function(i){return this.cmp(i)<1};P.logarithm=P.log=function(i){var e,t,n,r,o,s,a,u,c=this,m=c.constructor,l=m.precision,d=m.rounding,p=5;if(i==null)i=new m(10),e=!0;else{if(i=new m(i),t=i.d,i.s<0||!t||!t[0]||i.eq(1))return new m(NaN);e=i.eq(10)}if(t=c.d,c.s<0||!t||!t[0]||c.eq(1))return new m(t&&!t[0]?-1/0:c.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(V=!1,a=l+p,s=it(c,a),n=e?_t(m,a+10):it(i,a),u=ne(s,n,a,1),kt(u.d,r=l,d))do if(a+=10,s=it(c,a),n=e?_t(m,a+10):it(i,a),u=ne(s,n,a,1),!o){+Pe(u.d).slice(r+1,r+15)+1==1e14&&(u=M(u,l+1,0));break}while(kt(u.d,r+=10,d));return V=!0,M(u,l,d)};P.minus=P.sub=function(i){var e,t,n,r,o,s,a,u,c,m,l,d,p=this,g=p.constructor;if(i=new g(i),!p.d||!i.d)return!p.s||!i.s?i=new g(NaN):p.d?i.s=-i.s:i=new g(i.d||p.s!==i.s?p:NaN),i;if(p.s!=i.s)return i.s=-i.s,p.plus(i);if(c=p.d,d=i.d,a=g.precision,u=g.rounding,!c[0]||!d[0]){if(d[0])i.s=-i.s;else if(c[0])i=new g(p);else return new g(u===3?-0:0);return V?M(i,a,u):i}if(t=he(i.e/_),m=he(p.e/_),c=c.slice(),o=m-t,o){for(l=o<0,l?(e=c,o=-o,s=d.length):(e=d,t=m,s=c.length),n=Math.max(Math.ceil(a/_),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=c.length,s=d.length,l=n<s,l&&(s=n),n=0;n<s;n++)if(c[n]!=d[n]){l=c[n]<d[n];break}o=0}for(l&&(e=c,c=d,d=e,i.s=-i.s),s=c.length,n=d.length-s;n>0;--n)c[s++]=0;for(n=d.length;n>o;){if(c[--n]<d[n]){for(r=n;r&&c[--r]===0;)c[r]=_e-1;--c[r],c[n]+=_e}c[n]-=d[n]}for(;c[--s]===0;)c.pop();for(;c[0]===0;c.shift())--t;return c[0]?(i.d=c,i.e=Vt(c,t),V?M(i,a,u):i):new g(u===3?-0:0)};P.modulo=P.mod=function(i){var e,t=this,n=t.constructor;return i=new n(i),!t.d||!i.s||i.d&&!i.d[0]?new n(NaN):!i.d||t.d&&!t.d[0]?M(new n(t),n.precision,n.rounding):(V=!1,n.modulo==9?(e=ne(t,i.abs(),0,3,1),e.s*=i.s):e=ne(t,i,0,n.modulo,1),e=e.times(i),V=!0,t.minus(e))};P.naturalExponential=P.exp=function(){return un(this)};P.naturalLogarithm=P.ln=function(){return it(this)};P.negated=P.neg=function(){var i=new this.constructor(this);return i.s=-i.s,M(i)};P.plus=P.add=function(i){var e,t,n,r,o,s,a,u,c,m,l=this,d=l.constructor;if(i=new d(i),!l.d||!i.d)return!l.s||!i.s?i=new d(NaN):l.d||(i=new d(i.d||l.s===i.s?l:NaN)),i;if(l.s!=i.s)return i.s=-i.s,l.minus(i);if(c=l.d,m=i.d,a=d.precision,u=d.rounding,!c[0]||!m[0])return m[0]||(i=new d(l)),V?M(i,a,u):i;if(o=he(l.e/_),n=he(i.e/_),c=c.slice(),r=o-n,r){for(r<0?(t=c,r=-r,s=m.length):(t=m,n=o,s=c.length),o=Math.ceil(a/_),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=c.length,r=m.length,s-r<0&&(r=s,t=m,m=c,c=t),e=0;r;)e=(c[--r]=c[r]+m[r]+e)/_e|0,c[r]%=_e;for(e&&(c.unshift(e),++n),s=c.length;c[--s]==0;)c.pop();return i.d=c,i.e=Vt(c,n),V?M(i,a,u):i};P.precision=P.sd=function(i){var e,t=this;if(i!==void 0&&i!==!!i&&i!==1&&i!==0)throw Error(rt+i);return t.d?(e=$n(t.d),i&&t.e+1>e&&(e=t.e+1)):e=NaN,e};P.round=function(){var i=this,e=i.constructor;return M(new e(i),i.e+1,e.rounding)};P.sine=P.sin=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+_,n.rounding=1,t=ur(n,ii(n,t)),n.precision=i,n.rounding=e,M(Ze>2?t.neg():t,i,e,!0)):new n(NaN)};P.squareRoot=P.sqrt=function(){var i,e,t,n,r,o,s=this,a=s.d,u=s.e,c=s.s,m=s.constructor;if(c!==1||!a||!a[0])return new m(!c||c<0&&(!a||a[0])?NaN:a?s:1/0);for(V=!1,c=Math.sqrt(+s),c==0||c==1/0?(e=Pe(a),(e.length+u)%2==0&&(e+="0"),c=Math.sqrt(e),u=he((u+1)/2)-(u<0||u%2),c==1/0?e="5e"+u:(e=c.toExponential(),e=e.slice(0,e.indexOf("e")+1)+u),n=new m(e)):n=new m(c.toString()),t=(u=m.precision)+3;;)if(o=n,n=o.plus(ne(s,o,t+2,1)).times(.5),Pe(o.d).slice(0,t)===(e=Pe(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(M(o,u+1,0),o.times(o).eq(s))){n=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(M(n,u+1,1),i=!n.times(n).eq(s));break}return V=!0,M(n,u,m.rounding,i)};P.tangent=P.tan=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+10,n.rounding=1,t=t.sin(),t.s=1,t=ne(t,new n(1).minus(t.times(t)).sqrt(),i+10,0),n.precision=i,n.rounding=e,M(Ze==2||Ze==4?t.neg():t,i,e,!0)):new n(NaN)};P.times=P.mul=function(i){var e,t,n,r,o,s,a,u,c,m=this,l=m.constructor,d=m.d,p=(i=new l(i)).d;if(i.s*=m.s,!d||!d[0]||!p||!p[0])return new l(!i.s||d&&!d[0]&&!p||p&&!p[0]&&!d?NaN:!d||!p?i.s/0:i.s*0);for(t=he(m.e/_)+he(i.e/_),u=d.length,c=p.length,u<c&&(o=d,d=p,p=o,s=u,u=c,c=s),o=[],s=u+c,n=s;n--;)o.push(0);for(n=c;--n>=0;){for(e=0,r=u+n;r>n;)a=o[r]+p[n]*d[r-n-1]+e,o[r--]=a%_e|0,e=a/_e|0;o[r]=(o[r]+e)%_e|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),i.d=o,i.e=Vt(o,t),V?M(i,l.precision,l.rounding):i};P.toBinary=function(i,e){return mn(this,2,i,e)};P.toDecimalPlaces=P.toDP=function(i,e){var t=this,n=t.constructor;return t=new n(t),i===void 0?t:(Se(i,0,ot),e===void 0?e=n.rounding:Se(e,0,8),M(t,i+t.e+1,e))};P.toExponential=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Xe(n,!0):(Se(i,0,ot),e===void 0?e=r.rounding:Se(e,0,8),n=M(new r(n),i+1,e),t=Xe(n,!0,i+1)),n.isNeg()&&!n.isZero()?"-"+t:t};P.toFixed=function(i,e){var t,n,r=this,o=r.constructor;return i===void 0?t=Xe(r):(Se(i,0,ot),e===void 0?e=o.rounding:Se(e,0,8),n=M(new o(r),i+r.e+1,e),t=Xe(n,!1,i+n.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};P.toFraction=function(i){var e,t,n,r,o,s,a,u,c,m,l,d,p=this,g=p.d,f=p.constructor;if(!g)return new f(p);if(c=t=new f(1),n=u=new f(0),e=new f(n),o=e.e=$n(g)-p.e-1,s=o%_,e.d[0]=de(10,s<0?_+s:s),i==null)i=o>0?e:c;else{if(a=new f(i),!a.isInt()||a.lt(c))throw Error(rt+a);i=a.gt(e)?o>0?e:c:a}for(V=!1,a=new f(Pe(g)),m=f.precision,f.precision=o=g.length*_*2;l=ne(a,e,0,1,1),r=t.plus(l.times(n)),r.cmp(i)!=1;)t=n,n=r,r=c,c=u.plus(l.times(r)),u=r,r=e,e=a.minus(l.times(r)),a=r;return r=ne(i.minus(t),n,0,1,1),u=u.plus(r.times(c)),t=t.plus(r.times(n)),u.s=c.s=p.s,d=ne(c,n,o,1).minus(p).abs().cmp(ne(u,t,o,1).minus(p).abs())<1?[c,n]:[u,t],f.precision=m,V=!0,d};P.toHexadecimal=P.toHex=function(i,e){return mn(this,16,i,e)};P.toNearest=function(i,e){var t=this,n=t.constructor;if(t=new n(t),i==null){if(!t.d)return t;i=new n(1),e=n.rounding}else{if(i=new n(i),e===void 0?e=n.rounding:Se(e,0,8),!t.d)return i.s?t:i;if(!i.d)return i.s&&(i.s=t.s),i}return i.d[0]?(V=!1,t=ne(t,i,0,e,1).times(i),V=!0,M(t)):(i.s=t.s,t=i),t};P.toNumber=function(){return+this};P.toOctal=function(i,e){return mn(this,8,i,e)};P.toPower=P.pow=function(i){var e,t,n,r,o,s,a=this,u=a.constructor,c=+(i=new u(i));if(!a.d||!i.d||!a.d[0]||!i.d[0])return new u(de(+a,c));if(a=new u(a),a.eq(1))return a;if(n=u.precision,o=u.rounding,i.eq(1))return M(a,n,o);if(e=he(i.e/_),e>=i.d.length-1&&(t=c<0?-c:c)<=rr)return r=ei(u,a,t,n),i.s<0?new u(1).div(r):M(r,n,o);if(s=a.s,s<0){if(e<i.d.length-1)return new u(NaN);if((i.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=de(+a,c),e=t==0||!isFinite(t)?he(c*(Math.log("0."+Pe(a.d))/Math.LN10+a.e+1)):new u(t+"").e,e>u.maxE+1||e<u.minE-1?new u(e>0?s/0:0):(V=!1,u.rounding=a.s=1,t=Math.min(12,(e+"").length),r=un(i.times(it(a,n+t)),n),r.d&&(r=M(r,n+5,1),kt(r.d,n,o)&&(e=n+10,r=M(un(i.times(it(a,e+t)),e),e+5,1),+Pe(r.d).slice(n+1,n+15)+1==1e14&&(r=M(r,n+1,0)))),r.s=s,V=!0,u.rounding=o,M(r,n,o))};P.toPrecision=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Xe(n,n.e<=r.toExpNeg||n.e>=r.toExpPos):(Se(i,1,ot),e===void 0?e=r.rounding:Se(e,0,8),n=M(new r(n),i,e),t=Xe(n,i<=n.e||n.e<=r.toExpNeg,i)),n.isNeg()&&!n.isZero()?"-"+t:t};P.toSignificantDigits=P.toSD=function(i,e){var t=this,n=t.constructor;return i===void 0?(i=n.precision,e=n.rounding):(Se(i,1,ot),e===void 0?e=n.rounding:Se(e,0,8)),M(new n(t),i,e)};P.toString=function(){var i=this,e=i.constructor,t=Xe(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()&&!i.isZero()?"-"+t:t};P.truncated=P.trunc=function(){return M(new this.constructor(this),this.e+1,1)};P.valueOf=P.toJSON=function(){var i=this,e=i.constructor,t=Xe(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()?"-"+t:t};function Pe(i){var e,t,n,r=i.length-1,o="",s=i[0];if(r>0){for(o+=s,e=1;e<r;e++)n=i[e]+"",t=_-n.length,t&&(o+=nt(t)),o+=n;s=i[e],n=s+"",t=_-n.length,t&&(o+=nt(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function Se(i,e,t){if(i!==~~i||i<e||i>t)throw Error(rt+i)}function kt(i,e,t,n){var r,o,s,a;for(o=i[0];o>=10;o/=10)--e;return--e<0?(e+=_,r=0):(r=Math.ceil((e+1)/_),e%=_),o=de(10,_-e),a=i[r]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(i[r+1]/o/100|0)==de(10,e-2)-1||(a==o/2||a==0)&&(i[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(i[r+1]/o/1e3|0)==de(10,e-3)-1,s}function Et(i,e,t){for(var n,r=[0],o,s=0,a=i.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=on.indexOf(i.charAt(s++)),n=0;n<r.length;n++)r[n]>t-1&&(r[n+1]===void 0&&(r[n+1]=0),r[n+1]+=r[n]/t|0,r[n]%=t)}return r.reverse()}function sr(i,e){var t,n,r;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),r=(1/Wt(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),i.precision+=t,e=yt(i,1,e.times(r),new i(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return i.precision-=t,e}var ne=function(){function i(n,r,o){var s,a=0,u=n.length;for(n=n.slice();u--;)s=n[u]*r+a,n[u]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,r,o,s){var a,u;if(o!=s)u=o>s?1:-1;else for(a=u=0;a<o;a++)if(n[a]!=r[a]){u=n[a]>r[a]?1:-1;break}return u}function t(n,r,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<r[o]?1:0,n[o]=a*s+n[o]-r[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,r,o,s,a,u){var c,m,l,d,p,g,f,y,A,T,w,C,D,B,E,O,z,h,v,ge,le=n.constructor,xe=n.s==r.s?1:-1,ue=n.d,$=r.d;if(!ue||!ue[0]||!$||!$[0])return new le(!n.s||!r.s||(ue?$&&ue[0]==$[0]:!$)?NaN:ue&&ue[0]==0||!$?xe*0:xe/0);for(u?(p=1,m=n.e-r.e):(u=_e,p=_,m=he(n.e/p)-he(r.e/p)),v=$.length,z=ue.length,A=new le(xe),T=A.d=[],l=0;$[l]==(ue[l]||0);l++);if($[l]>(ue[l]||0)&&m--,o==null?(B=o=le.precision,s=le.rounding):a?B=o+(n.e-r.e)+1:B=o,B<0)T.push(1),g=!0;else{if(B=B/p+2|0,l=0,v==1){for(d=0,$=$[0],B++;(l<z||d)&&B--;l++)E=d*u+(ue[l]||0),T[l]=E/$|0,d=E%$|0;g=d||l<z}else{for(d=u/($[0]+1)|0,d>1&&($=i($,d,u),ue=i(ue,d,u),v=$.length,z=ue.length),O=v,w=ue.slice(0,v),C=w.length;C<v;)w[C++]=0;ge=$.slice(),ge.unshift(0),h=$[0],$[1]>=u/2&&++h;do d=0,c=e($,w,v,C),c<0?(D=w[0],v!=C&&(D=D*u+(w[1]||0)),d=D/h|0,d>1?(d>=u&&(d=u-1),f=i($,d,u),y=f.length,C=w.length,c=e(f,w,y,C),c==1&&(d--,t(f,v<y?ge:$,y,u))):(d==0&&(c=d=1),f=$.slice()),y=f.length,y<C&&f.unshift(0),t(w,f,C,u),c==-1&&(C=w.length,c=e($,w,v,C),c<1&&(d++,t(w,v<C?ge:$,C,u))),C=w.length):c===0&&(d++,w=[0]),T[l++]=d,c&&w[0]?w[C++]=ue[O]||0:(w=[ue[O]],C=1);while((O++<z||w[0]!==void 0)&&B--);g=w[0]!==void 0}T[0]||T.shift()}if(p==1)A.e=m,Yn=g;else{for(l=1,d=T[0];d>=10;d/=10)l++;A.e=l+m*p-1,M(A,a?o+A.e+1:o,s,g)}return A}}();function M(i,e,t,n){var r,o,s,a,u,c,m,l,d,p=i.constructor;e:if(e!=null){if(l=i.d,!l)return i;for(r=1,a=l[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=_,s=e,m=l[d=0],u=m/de(10,r-s-1)%10|0;else if(d=Math.ceil((o+1)/_),a=l.length,d>=a)if(n){for(;a++<=d;)l.push(0);m=u=0,r=1,o%=_,s=o-_+1}else break e;else{for(m=a=l[d],r=1;a>=10;a/=10)r++;o%=_,s=o-_+r,u=s<0?0:m/de(10,r-s-1)%10|0}if(n=n||e<0||l[d+1]!==void 0||(s<0?m:m%de(10,r-s-1)),c=t<4?(u||n)&&(t==0||t==(i.s<0?3:2)):u>5||u==5&&(t==4||n||t==6&&(o>0?s>0?m/de(10,r-s):0:l[d-1])%10&1||t==(i.s<0?8:7)),e<1||!l[0])return l.length=0,c?(e-=i.e+1,l[0]=de(10,(_-e%_)%_),i.e=-e||0):l[0]=i.e=0,i;if(o==0?(l.length=d,a=1,d--):(l.length=d+1,a=de(10,_-o),l[d]=s>0?(m/de(10,r-s)%de(10,s)|0)*a:0),c)for(;;)if(d==0){for(o=1,s=l[0];s>=10;s/=10)o++;for(s=l[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(i.e++,l[0]==_e&&(l[0]=1));break}else{if(l[d]+=a,l[d]!=_e)break;l[d--]=0,a=1}for(o=l.length;l[--o]===0;)l.pop()}return V&&(i.e>p.maxE?(i.d=null,i.e=NaN):i.e<p.minE&&(i.e=0,i.d=[0])),i}function Xe(i,e,t){if(!i.isFinite())return ni(i);var n,r=i.e,o=Pe(i.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+nt(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(i.e<0?"e":"e+")+i.e):r<0?(o="0."+nt(-r-1)+o,t&&(n=t-s)>0&&(o+=nt(n))):r>=s?(o+=nt(r+1-s),t&&(n=t-r-1)>0&&(o=o+"."+nt(n))):((n=r+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(r+1===s&&(o+="."),o+=nt(n))),o}function Vt(i,e){var t=i[0];for(e*=_;t>=10;t/=10)e++;return e}function _t(i,e,t){if(e>or)throw V=!0,t&&(i.precision=t),Error(Hn);return M(new i(Ft),e,1,!0)}function ve(i,e,t){if(e>an)throw Error(Hn);return M(new i(vt),e,t,!0)}function $n(i){var e=i.length-1,t=e*_+1;if(e=i[e],e){for(;e%10==0;e/=10)t--;for(e=i[0];e>=10;e/=10)t++}return t}function nt(i){for(var e="";i--;)e+="0";return e}function ei(i,e,t,n){var r,o=new i(1),s=Math.ceil(n/_+4);for(V=!1;;){if(t%2&&(o=o.times(e),zn(o.d,s)&&(r=!0)),t=he(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),zn(e.d,s)}return V=!0,o}function Xn(i){return i.d[i.d.length-1]&1}function ti(i,e,t){for(var n,r=new i(e[0]),o=0;++o<e.length;)if(n=new i(e[o]),n.s)r[t](n)&&(r=n);else{r=n;break}return r}function un(i,e){var t,n,r,o,s,a,u,c=0,m=0,l=0,d=i.constructor,p=d.rounding,g=d.precision;if(!i.d||!i.d[0]||i.e>17)return new d(i.d?i.d[0]?i.s<0?0:1/0:1:i.s?i.s<0?0:i:0/0);for(e==null?(V=!1,u=g):u=e,a=new d(.03125);i.e>-2;)i=i.times(a),l+=5;for(n=Math.log(de(2,l))/Math.LN10*2+5|0,u+=n,t=o=s=new d(1),d.precision=u;;){if(o=M(o.times(i),u,1),t=t.times(++m),a=s.plus(ne(o,t,u,1)),Pe(a.d).slice(0,u)===Pe(s.d).slice(0,u)){for(r=l;r--;)s=M(s.times(s),u,1);if(e==null)if(c<3&&kt(s.d,u-n,p,c))d.precision=u+=10,t=o=a=new d(1),m=0,c++;else return M(s,d.precision=g,p,V=!0);else return d.precision=g,s}s=a}}function it(i,e){var t,n,r,o,s,a,u,c,m,l,d,p=1,g=10,f=i,y=f.d,A=f.constructor,T=A.rounding,w=A.precision;if(f.s<0||!y||!y[0]||!f.e&&y[0]==1&&y.length==1)return new A(y&&!y[0]?-1/0:f.s!=1?NaN:y?0:f);if(e==null?(V=!1,m=w):m=e,A.precision=m+=g,t=Pe(y),n=t.charAt(0),Math.abs(o=f.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)f=f.times(i),t=Pe(f.d),n=t.charAt(0),p++;o=f.e,n>1?(f=new A("0."+t),o++):f=new A(n+"."+t.slice(1))}else return c=_t(A,m+2,w).times(o+""),f=it(new A(n+"."+t.slice(1)),m-g).plus(c),A.precision=w,e==null?M(f,w,T,V=!0):f;for(l=f,u=s=f=ne(f.minus(1),f.plus(1),m,1),d=M(f.times(f),m,1),r=3;;){if(s=M(s.times(d),m,1),c=u.plus(ne(s,new A(r),m,1)),Pe(c.d).slice(0,m)===Pe(u.d).slice(0,m))if(u=u.times(2),o!==0&&(u=u.plus(_t(A,m+2,w).times(o+""))),u=ne(u,new A(p),m,1),e==null)if(kt(u.d,m-g,T,a))A.precision=m+=g,c=s=f=ne(l.minus(1),l.plus(1),m,1),d=M(f.times(f),m,1),r=a=1;else return M(u,A.precision=w,T,V=!0);else return A.precision=w,u;u=c,r+=2}}function ni(i){return String(i.s*i.s/0)}function cn(i,e){var t,n,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(n,r),e){if(r-=n,i.e=t=t-n-1,i.d=[],n=(t+1)%_,t<0&&(n+=_),n<r){for(n&&i.d.push(+e.slice(0,n)),r-=_;n<r;)i.d.push(+e.slice(n,n+=_));e=e.slice(n),n=_-e.length}else n-=r;for(;n--;)e+="0";i.d.push(+e),V&&(i.e>i.constructor.maxE?(i.d=null,i.e=NaN):i.e<i.constructor.minE&&(i.e=0,i.d=[0]))}else i.e=0,i.d=[0];return i}function ar(i,e){var t,n,r,o,s,a,u,c,m;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),Jn.test(e))return cn(i,e)}else if(e==="Infinity"||e==="NaN")return+e||(i.s=NaN),i.e=NaN,i.d=null,i;if(nr.test(e))t=16,e=e.toLowerCase();else if(tr.test(e))t=2;else if(ir.test(e))t=8;else throw Error(rt+e);for(o=e.search(/p/i),o>0?(u=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=i.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=ei(n,new n(t),o,o*2)),c=Et(e,t,_e),m=c.length-1,o=m;c[o]===0;--o)c.pop();return o<0?new n(i.s*0):(i.e=Vt(c,m),i.d=c,V=!1,s&&(i=ne(i,r,a*4)),u&&(i=i.times(Math.abs(u)<54?de(2,u):wt.pow(2,u))),V=!0,i)}function ur(i,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:yt(i,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/Wt(5,t)),e=yt(i,2,e,e);for(var r,o=new i(5),s=new i(16),a=new i(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function yt(i,e,t,n,r){var o,s,a,u,c=1,m=i.precision,l=Math.ceil(m/_);for(V=!1,u=t.times(t),a=new i(n);;){if(s=ne(a.times(u),new i(e++*e++),m,1),a=r?n.plus(s):n.minus(s),n=ne(s.times(u),new i(e++*e++),m,1),s=a.plus(n),s.d[l]!==void 0){for(o=l;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,c++}return V=!0,s.d.length=l+1,s}function Wt(i,e){for(var t=i;--e;)t*=i;return t}function ii(i,e){var t,n=e.s<0,r=ve(i,i.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return Ze=n?4:1,e;if(t=e.divToInt(r),t.isZero())Ze=n?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return Ze=Xn(t)?n?2:3:n?4:1,e;Ze=Xn(t)?n?1:4:n?3:2}return e.minus(r).abs()}function mn(i,e,t,n){var r,o,s,a,u,c,m,l,d,p=i.constructor,g=t!==void 0;if(g?(Se(t,1,ot),n===void 0?n=p.rounding:Se(n,0,8)):(t=p.precision,n=p.rounding),!i.isFinite())m=ni(i);else{for(m=Xe(i),s=m.indexOf("."),g?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(m=m.replace(".",""),d=new p(1),d.e=m.length-s,d.d=Et(Xe(d),10,r),d.e=d.d.length),l=Et(m,10,r),o=u=l.length;l[--u]==0;)l.pop();if(!l[0])m=g?"0p+0":"0";else{if(s<0?o--:(i=new p(i),i.d=l,i.e=o,i=ne(i,d,t,n,0,r),l=i.d,o=i.e,c=Yn),s=l[t],a=r/2,c=c||l[t+1]!==void 0,c=n<4?(s!==void 0||c)&&(n===0||n===(i.s<0?3:2)):s>a||s===a&&(n===4||c||n===6&&l[t-1]&1||n===(i.s<0?8:7)),l.length=t,c)for(;++l[--t]>r-1;)l[t]=0,t||(++o,l.unshift(1));for(u=l.length;!l[u-1];--u);for(s=0,m="";s<u;s++)m+=on.charAt(l[s]);if(g){if(u>1)if(e==16||e==8){for(s=e==16?4:3,--u;u%s;u++)m+="0";for(l=Et(m,r,e),u=l.length;!l[u-1];--u);for(s=1,m="1.";s<u;s++)m+=on.charAt(l[s])}else m=m.charAt(0)+"."+m.slice(1);m=m+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)m="0"+m;m="0."+m}else if(++o>u)for(o-=u;o--;)m+="0";else o<u&&(m=m.slice(0,o)+"."+m.slice(o))}m=(e==16?"0x":e==2?"0b":e==8?"0o":"")+m}return i.s<0?"-"+m:m}function zn(i,e){if(i.length>e)return i.length=e,!0}function cr(i){return new this(i).abs()}function mr(i){return new this(i).acos()}function lr(i){return new this(i).acosh()}function dr(i,e){return new this(i).plus(e)}function pr(i){return new this(i).asin()}function fr(i){return new this(i).asinh()}function br(i){return new this(i).atan()}function yr(i){return new this(i).atanh()}function gr(i,e){i=new this(i),e=new this(e);var t,n=this.precision,r=this.rounding,o=n+4;return!i.s||!e.s?t=new this(NaN):!i.d&&!e.d?(t=ve(this,o,1).times(e.s>0?.25:.75),t.s=i.s):!e.d||i.isZero()?(t=e.s<0?ve(this,n,r):new this(0),t.s=i.s):!i.d||e.isZero()?(t=ve(this,o,1).times(.5),t.s=i.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(ne(i,e,o,1)),e=ve(this,o,1),this.precision=n,this.rounding=r,t=i.s<0?t.minus(e):t.plus(e)):t=this.atan(ne(i,e,o,1)),t}function Ar(i){return new this(i).cbrt()}function Pr(i){return M(i=new this(i),i.e+1,2)}function kr(i,e,t){return new this(i).clamp(e,t)}function wr(i){if(!i||typeof i!="object")throw Error(Dt+"Object expected");var e,t,n,r=i.defaults===!0,o=["precision",1,ot,"rounding",0,8,"toExpNeg",-bt,0,"toExpPos",0,bt,"maxE",0,bt,"minE",-bt,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=sn[t]),(n=i[t])!==void 0)if(he(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(rt+t+": "+n);if(t="crypto",r&&(this[t]=sn[t]),(n=i[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(Zn);else this[t]=!1;else throw Error(rt+t+": "+n);return this}function hr(i){return new this(i).cos()}function Tr(i){return new this(i).cosh()}function ri(i){var e,t,n;function r(o){var s,a,u,c=this;if(!(c instanceof r))return new r(o);if(c.constructor=r,Qn(o)){c.s=o.s,V?!o.d||o.e>r.maxE?(c.e=NaN,c.d=null):o.e<r.minE?(c.e=0,c.d=[0]):(c.e=o.e,c.d=o.d.slice()):(c.e=o.e,c.d=o.d?o.d.slice():o.d);return}if(u=typeof o,u==="number"){if(o===0){c.s=1/o<0?-1:1,c.e=0,c.d=[0];return}if(o<0?(o=-o,c.s=-1):c.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;V?s>r.maxE?(c.e=NaN,c.d=null):s<r.minE?(c.e=0,c.d=[0]):(c.e=s,c.d=[o]):(c.e=s,c.d=[o]);return}else if(o*0!==0){o||(c.s=NaN),c.e=NaN,c.d=null;return}return cn(c,o.toString())}else if(u!=="string")throw Error(rt+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),c.s=-1):(a===43&&(o=o.slice(1)),c.s=1),Jn.test(o)?cn(c,o):ar(c,o)}if(r.prototype=P,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=wr,r.clone=ri,r.isDecimal=Qn,r.abs=cr,r.acos=mr,r.acosh=lr,r.add=dr,r.asin=pr,r.asinh=fr,r.atan=br,r.atanh=yr,r.atan2=gr,r.cbrt=Ar,r.ceil=Pr,r.clamp=kr,r.cos=hr,r.cosh=Tr,r.div=Br,r.exp=Ir,r.floor=xr,r.hypot=Sr,r.ln=Kr,r.log=Cr,r.log10=Rr,r.log2=Nr,r.max=Or,r.min=Lr,r.mod=Mr,r.mul=Er,r.pow=Fr,r.random=vr,r.round=_r,r.sign=Dr,r.sin=Vr,r.sinh=Wr,r.sqrt=qr,r.sub=Gr,r.sum=Ur,r.tan=Xr,r.tanh=zr,r.trunc=Qr,i===void 0&&(i={}),i&&i.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)i.hasOwnProperty(t=n[e++])||(i[t]=this[t]);return r.config(i),r}function Br(i,e){return new this(i).div(e)}function Ir(i){return new this(i).exp()}function xr(i){return M(i=new this(i),i.e+1,3)}function Sr(){var i,e,t=new this(0);for(V=!1,i=0;i<arguments.length;)if(e=new this(arguments[i++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return V=!0,new this(1/0);t=e}return V=!0,t.sqrt()}function Qn(i){return i instanceof wt||i&&i.toStringTag===jn||!1}function Kr(i){return new this(i).ln()}function Cr(i,e){return new this(i).log(e)}function Nr(i){return new this(i).log(2)}function Rr(i){return new this(i).log(10)}function Or(){return ti(this,arguments,"lt")}function Lr(){return ti(this,arguments,"gt")}function Mr(i,e){return new this(i).mod(e)}function Er(i,e){return new this(i).mul(e)}function Fr(i,e){return new this(i).pow(e)}function vr(i){var e,t,n,r,o=0,s=new this(1),a=[];if(i===void 0?i=this.precision:Se(i,1,ot),n=Math.ceil(i/_),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=n/4}else throw Error(Zn);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],i%=_,n&&i&&(r=de(10,_-i),a[o]=(n/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=_)a.shift();for(n=1,r=a[0];r>=10;r/=10)n++;n<_&&(t-=_-n)}return s.e=t,s.d=a,s}function _r(i){return M(i=new this(i),i.e+1,this.rounding)}function Dr(i){return i=new this(i),i.d?i.d[0]?i.s:0*i.s:i.s||NaN}function Vr(i){return new this(i).sin()}function Wr(i){return new this(i).sinh()}function qr(i){return new this(i).sqrt()}function Gr(i,e){return new this(i).sub(e)}function Ur(){var i=0,e=arguments,t=new this(e[i]);for(V=!1;t.s&&++i<e.length;)t=t.plus(e[i]);return V=!0,M(t,this.precision,this.rounding)}function Xr(i){return new this(i).tan()}function zr(i){return new this(i).tanh()}function Qr(i){return M(i=new this(i),i.e+1,1)}P[Symbol.for("nodejs.util.inspect.custom")]=P.toString;P[Symbol.toStringTag]="Decimal";var wt=P.constructor=ri(sn);Ft=new wt(Ft);vt=new wt(vt);var N=wt;import{PublicKey as bn}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Yr}from"@solana/spl-token";import{PublicKey as se,SystemProgram as oi,SYSVAR_RENT_PUBKEY as Hr}from"@solana/web3.js";function k({pubkey:i,isSigner:e=!1,isWritable:t=!0}){return{pubkey:i,isWritable:t,isSigner:e}}var Rs=[k({pubkey:Yr,isWritable:!1}),k({pubkey:oi.programId,isWritable:!1}),k({pubkey:Hr,isWritable:!1})];function ln({publicKey:i,transformSol:e}){let t=dn(i.toString());if(t instanceof se)return e&&t.equals(Tt)?ht:t;if(e&&t.toString()===Tt.toBase58())return ht;if(typeof t=="string"){if(t===se.default.toBase58())return se.default;try{return new se(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function dn(i){try{return new se(i)}catch{return i}}var qt=new se("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),pn=new se("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),ut=new se("SysvarRent111111111111111111111111111111111"),Os=new se("SysvarC1ock11111111111111111111111111111111"),gt=new se("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Ls=new se("Sysvar1nstructions1111111111111111111111111"),Zr=oi.programId,Ms=new se("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Es=new se("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Fs=new se("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),vs=new se("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),_s=new se("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Ds=new se("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Vs=new se("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Ws=new se("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),qs=new se("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Gs=new se("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Us=new se("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),ht=new se("So11111111111111111111111111111111111111112"),Tt=se.default;function At(i){return ln({publicKey:i,transformSol:!0})}import{PublicKey as jr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as si}from"@solana/spl-token";var fn={chainId:101,address:jr.default.toBase58(),programId:si.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},je={chainId:101,address:"So11111111111111111111111111111111111111112",programId:si.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var yn=class{constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:o=!1,isToken2022:s=!1}){if(e===Tt.toBase58()||e instanceof bn&&Tt.equals(e)){this.decimals=je.decimals,this.symbol=je.symbol,this.name=je.name,this.mint=new bn(je.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?bn.default:ln({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},De=yn;De.WSOL=new yn(ee(j({},je),{mint:je.address}));import Ut from"big.js";import eo from"bn.js";import to from"decimal.js-light";import Jr from"toformat";var $r=Jr,Bt=$r;var Gt=ie("module/fraction"),gn=Bt(Ut),It=Bt(to),no={[0]:It.ROUND_DOWN,[1]:It.ROUND_HALF_UP,[2]:It.ROUND_UP},io={[0]:Ut.roundDown,[1]:Ut.roundHalfUp,[2]:Ut.roundUp},J=class{constructor(e,t=new eo(1)){this.numerator=ae(e),this.denominator=ae(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new J(this.denominator,this.numerator)}add(e){let t=e instanceof J?e:new J(ae(e));return this.denominator.eq(t.denominator)?new J(this.numerator.add(t.numerator),this.denominator):new J(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof J?e:new J(ae(e));return this.denominator.eq(t.denominator)?new J(this.numerator.sub(t.numerator),this.denominator):new J(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof J?e:new J(ae(e));return new J(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof J?e:new J(ae(e));return new J(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||Gt.logWithError(`${e} is not an integer.`),e<=0&&Gt.logWithError(`${e} is not positive.`),It.set({precision:e+1,rounding:no[n]});let r=new It(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||Gt.logWithError(`${e} is not an integer.`),e<0&&Gt.logWithError(`${e} is negative.`),gn.DP=e,gn.RM=io[n]||1,new gn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var oo=ie("Raydium_price"),Ne=class extends J{constructor(t){let{baseToken:n,quoteToken:r,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=r,this.scalar=new J(An(n.decimals),An(r.decimals))}get raw(){return new J(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Ne({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&oo.logWithError("mul token not equals");let n=super.mul(t);return new Ne({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,r){return this.adjusted.toSignificant(t,n,r)}toFixed(t=this.quoteToken.decimals,n,r){return this.adjusted.toFixed(t,n,r)}};var Pn=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},Xt=Pn;Xt.SOL=new Pn(fn);import so from"bn.js";var ai=new J(new so(100)),Je=class extends J{toSignificant(e=5,t,n){return this.mul(ai).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(ai).toFixed(e,t,n)}};var ui=new Ke(0),ao=new Ke(1),Va=new Ke(2),Wa=new Ke(3),qa=new Ke(5),kn=new Ke(10),Ga=new Ke(100),Ua=new Ke(1e3),Xa=new Ke(1e4),ci=9007199254740991;function ae(i){let e=ie("Raydium_parseBigNumberish");if(i instanceof Ke)return i;if(typeof i=="string"){if(i.match(/^-?[0-9]+$/))return new Ke(i);e.logWithError(`invalid BigNumberish string: ${i}`)}return typeof i=="number"?(i%1&&e.logWithError(`BigNumberish number underflow: ${i}`),(i>=ci||i<=-ci)&&e.logWithError(`BigNumberish number overflow: ${i}`),new Ke(String(i))):typeof i=="bigint"?new Ke(i.toString()):(e.error(`invalid BigNumberish value: ${i}`),new Ke(0))}function An(i){return kn.pow(ae(i))}var co=ie("Raydium_amount"),li=Bt(uo);function mo(i,e){let t="0",n="0";if(i.includes(".")){let r=i.split(".");r.length===2?([t,n]=r,n=n.padEnd(e,"0")):co.logWithError(`invalid number string, num: ${i}`)}else t=i;return[t,n.slice(0,e)||n]}var pe=class extends J{constructor(t,n,r=!0,o){let s=new zt(0),a=kn.pow(new zt(t.decimals));if(r)s=ae(n);else{let u=new zt(0),c=new zt(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[m,l]=mo(n.toString(),t.decimals);u=ae(m),c=ae(l)}u=u.mul(a),s=u.add(c)}super(s,a);this.logger=ie(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new pe(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new pe(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,r=0){return super.toSignificant(t,n,r)}toFixed(t=this.token.decimals,n,r=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,r)}toExact(t={groupSeparator:""}){return li.DP=this.token.decimals,new li(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};function mi(i){return typeof i=="object"&&i!==null&&![De,pe,lo,J,po,Ne,Je].some(e=>typeof e=="object"&&i instanceof e)}function Re(i){return typeof i=="string"?dn(i):Array.isArray(i)?i.map(e=>Re(e)):mi(i)?Object.fromEntries(Object.entries(i).map(([e,t])=>[e,Re(t)])):i}import{PublicKey as oc,sendAndConfirmTransaction as sc,Transaction as uc,TransactionMessage as mc,VersionedTransaction as lc}from"@solana/web3.js";import fc from"axios";var re={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut"};import{PublicKey as fo,ComputeBudgetProgram as ku,Transaction as hu,TransactionMessage as Bu,Keypair as Iu,VersionedTransaction as Su}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Nu}from"@solana/spl-token";var Lu=ie("Raydium_txUtil");function Be(i,e){let[t,n]=fo.findProgramAddressSync(i,e);return{publicKey:t,nonce:n}}import{PublicKey as yo,AddressLookupTableAccount as di}from"@solana/web3.js";import{PublicKey as bo}from"@solana/web3.js";import{MINT_SIZE as Vu,TOKEN_PROGRAM_ID as Wu,getTransferFeeConfig as qu,unpackMint as Gu}from"@solana/spl-token";var wn=ie("Raydium_accountInfo_util");async function st(i,e,t){let{batchRequest:n,commitment:r="confirmed",chunkCount:o=100}=j({batchRequest:!1},t),s=hn(e,o),a=new Array(s.length).fill([]);if(n){let u=s.map(l=>{let d=i._buildArgs([l.map(p=>p.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:d}}),c=hn(u,10);a=(await(await Promise.all(c.map(async l=>await i._rpcBatchRequest(l)))).flat()).map(l=>(l.error&&wn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${l.error.message}`),l.result.value.map(d=>{if(d){let{data:p,executable:g,lamports:f,owner:y,rentEpoch:A}=d;return p.length!==2&&p[1]!=="base64"&&wn.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:g,lamports:f,owner:new bo(y),rentEpoch:A}}return null})))}else try{a=await Promise.all(s.map(u=>i.getMultipleAccountsInfo(u,r)))}catch(u){u instanceof Error&&wn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.message}`)}return a.flat()}async function xt(i,e,t){let n=await st(i,e.map(r=>r.pubkey),t);return e.map((r,o)=>ee(j({},r),{accountInfo:n[o]}))}var go={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new di({key:new yo("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:di.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};function hn(i,e=1,t=[]){let n=[...i];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as Y}from"@solana/web3.js";var Bc=new Y("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Ic=new Y("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),xc=new Y("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Sc=new Y("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Kc=new Y("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),fi=new Y("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Po=new Y("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Cc=new Y("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),bi=new Y("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),ko=new Y("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Nc=new Y("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Rc=new Y("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Oc=new Y("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Lc=new Y("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Mc=new Y("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Ec=new Y("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),wo=new Y("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Fc=new Y("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),vc=new Y("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),ho=new Y("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),To=new Y("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),Bo=new Y("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2");var _c={SERUM_MARKET:Y.default,OPENBOOK_MARKET:new Y("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:Y.default,FarmV3:new Y("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new Y("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new Y("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new Y("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new Y("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new Y("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),Router:new Y("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:ho,CREATE_CPMM_POOL_AUTH:To,CREATE_CPMM_POOL_FEE_ACC:Bo,FEE_DESTINATION_ID:new Y("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR")};import{PublicKey as Io}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as xo}from"@solana/spl-token";function ze(i,e,t){return Be([i.toBuffer(),(t!=null?t:xo).toBuffer(),e.toBuffer()],new Io("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import Ve from"bn.js";var St=1e4;function ce(i,e,t,n){if(e===void 0)return{amount:i,fee:void 0,expirationTime:void 0};let r=ee(j({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,s=new Ve(o.maximumFee.toString()),a=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===St){let u=new Ve(o.maximumFee.toString());return{amount:i.add(u),fee:u,expirationTime:a}}else{let u=Qt(i.mul(new Ve(St)),new Ve(St-o.transferFeeBasisPoints)),c=new Ve(o.maximumFee.toString()),m=u.sub(i).gt(c)?i.add(c):u,l=Qt(m.mul(new Ve(o.transferFeeBasisPoints)),new Ve(St)),d=l.gt(s)?s:l;return{amount:m,fee:d,expirationTime:a}}else{let u=Qt(i.mul(new Ve(o.transferFeeBasisPoints)),new Ve(St)),c=u.gt(s)?s:u;return{amount:i,fee:c,expirationTime:a}}}function $e(i,e){return i===void 0?e:e===void 0?i:Math.min(i,e)}function Qt(i,e){let{div:t,mod:n}=i.divmod(e);return n.gt(new Ve(0))?t.add(new Ve(1)):t}import{createInitializeAccountInstruction as Cl,createCloseAccountInstruction as Nl,createTransferInstruction as Rl,TOKEN_PROGRAM_ID as Ol}from"@solana/spl-token";import{PublicKey as Fl,SystemProgram as _l}from"@solana/web3.js";import Wl from"bn.js";import{PublicKey as bl,Keypair as gl}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as kl}from"@solana/spl-token";import hl from"bn.js";import{PublicKey as Eo}from"@solana/web3.js";import Pi,{isBN as ki}from"bn.js";import{bits as bm,BitStructure as ym,blob as So,Blob as gm,cstr as Am,f32 as Pm,f32be as km,f64 as wm,f64be as hm,greedy as Tm,Layout as Ko,ns64 as Bm,ns64be as Im,nu64 as xm,nu64be as Sm,offset as Km,s16 as Cm,s16be as Nm,s24 as Rm,s24be as Om,s32 as Co,s32be as Lm,s40 as Mm,s40be as Em,s48 as Fm,s48be as vm,s8 as _m,seq as No,struct as Dm,Structure as Ro,u16 as Oo,u16be as Vm,u24 as Wm,u24be as qm,u32 as Gm,u32be as Um,u40 as Xm,u40be as zm,u48 as Qm,u48be as Ym,u8 as Lo,UInt as Mo,union as Hm,Union as Zm,unionLayoutDiscriminator as jm,utf8 as Jm}from"@solana/buffer-layout";var Tn=Ko,yi=Ro;var Bn=Mo;var gi=Lo,ct=Oo;var ke=Co;var Ai=No;var fe=So;var Pt=class extends Tn{constructor(t,n,r){super(t,r);this.blob=fe(t),this.signed=n}decode(t,n=0){let r=new Pi(this.blob.decode(t,n),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,n,r=0){return typeof t=="number"&&(t=new Pi(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,r)}};function W(i){return new Bn(1,i)}function Oe(i){return new Bn(4,i)}function b(i){return new Pt(8,!1,i)}function G(i){return new Pt(16,!1,i)}function wi(i){return new Pt(8,!0,i)}function hi(i){return new Pt(16,!0,i)}var Yt=class extends Tn{constructor(t,n,r,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=r}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,r){return this.layout.encode(this.encoder(t),n,r)}getSpan(t,n){return this.layout.getSpan(t,n)}};function S(i){return new Yt(fe(32),e=>new Eo(e),e=>e.toBuffer(),i)}function Ee(i){return new Yt(gi(),Fo,vo,i)}function Fo(i){if(i===0)return!1;if(i===1)return!0;throw new Error("Invalid bool: "+i)}function vo(i){return i?1:0}var In=class extends yi{decode(e,t){return super.decode(e,t)}};function F(i,e,t){return new In(i,e,t)}function Z(i,e,t){let n,r=typeof e=="number"?e:ki(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=ki(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return Ai(i,r,t)}var Ti=F([S("mint"),S("owner"),b("amount"),Oe("delegateOption"),S("delegate"),W("state"),Oe("isNativeOption"),b("isNative"),b("delegatedAmount"),Oe("closeAuthorityOption"),S("closeAuthority")]);var Il=ie("Raydium_Util");import Bi from"bn.js";var Zl=new Bi(25),jl=new Bi(1e4);var xn=F([W("instruction"),b("amountIn"),b("minAmountOut")]),Sn=F([W("instruction"),b("maxAmountIn"),b("amountOut")]),rd=F([W("instruction"),W("nonce")]),_o=F([W("instruction"),W("nonce"),b("startTime")]),Do=F([b("status"),b("nonce"),b("maxOrder"),b("depth"),b("baseDecimal"),b("quoteDecimal"),b("state"),b("resetFlag"),b("minSize"),b("volMaxCutRatio"),b("amountWaveRatio"),b("baseLotSize"),b("quoteLotSize"),b("minPriceMultiplier"),b("maxPriceMultiplier"),b("systemDecimalValue"),b("minSeparateNumerator"),b("minSeparateDenominator"),b("tradeFeeNumerator"),b("tradeFeeDenominator"),b("pnlNumerator"),b("pnlDenominator"),b("swapFeeNumerator"),b("swapFeeDenominator"),b("baseNeedTakePnl"),b("quoteNeedTakePnl"),b("quoteTotalPnl"),b("baseTotalPnl"),b("poolOpenTime"),b("punishPcAmount"),b("punishCoinAmount"),b("orderbookToInitTime"),G("swapBaseInAmount"),G("swapQuoteOutAmount"),b("swapBase2QuoteFee"),G("swapQuoteInAmount"),G("swapBaseOutAmount"),b("swapQuote2BaseFee"),S("baseVault"),S("quoteVault"),S("baseMint"),S("quoteMint"),S("lpMint"),S("openOrders"),S("marketId"),S("marketProgramId"),S("targetOrders"),S("withdrawQueue"),S("lpVault"),S("owner"),b("lpReserve"),Z(b(),3,"padding")]),od=F([b("accountType"),b("status"),b("nonce"),b("maxOrder"),b("depth"),b("baseDecimal"),b("quoteDecimal"),b("state"),b("resetFlag"),b("minSize"),b("volMaxCutRatio"),b("amountWaveRatio"),b("baseLotSize"),b("quoteLotSize"),b("minPriceMultiplier"),b("maxPriceMultiplier"),b("systemDecimalsValue"),b("abortTradeFactor"),b("priceTickMultiplier"),b("priceTick"),b("minSeparateNumerator"),b("minSeparateDenominator"),b("tradeFeeNumerator"),b("tradeFeeDenominator"),b("pnlNumerator"),b("pnlDenominator"),b("swapFeeNumerator"),b("swapFeeDenominator"),b("baseNeedTakePnl"),b("quoteNeedTakePnl"),b("quoteTotalPnl"),b("baseTotalPnl"),b("poolOpenTime"),b("punishPcAmount"),b("punishCoinAmount"),b("orderbookToInitTime"),G("swapBaseInAmount"),G("swapQuoteOutAmount"),G("swapQuoteInAmount"),G("swapBaseOutAmount"),b("swapQuote2BaseFee"),b("swapBase2QuoteFee"),S("baseVault"),S("quoteVault"),S("baseMint"),S("quoteMint"),S("lpMint"),S("modelDataAccount"),S("openOrders"),S("marketId"),S("marketProgramId"),S("targetOrders"),S("owner"),Z(b(),64,"padding")]),Vo=F([W("instruction"),b("baseAmountIn"),b("quoteAmountIn"),b("fixedSide")]),Wo=F([W("instruction"),b("amountIn")]);var sd=F([b("fee")]);import{PublicKey as tp}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ip}from"@solana/spl-token";import{PublicKey as md}from"@solana/web3.js";import{MintLayout as dd,TOKEN_PROGRAM_ID as fd}from"@solana/spl-token";import{PublicKey as hd}from"@solana/web3.js";var Id=ie("Raydium_liquidity_serum");import{PublicKey as qo}from"@solana/web3.js";var Kn=new qo("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Go=5e4,Uo=F([b("x"),b("y"),b("price")]),Nd=F([b("accountType"),b("status"),b("multiplier"),b("validDataCount"),Z(Uo,Go,"DataElement")]);import{TOKEN_PROGRAM_ID as xi,ASSOCIATED_TOKEN_PROGRAM_ID as Ld}from"@solana/spl-token";import{PublicKey as Ed,TransactionInstruction as Si,SystemProgram as Fd,SYSVAR_RENT_PUBKEY as vd}from"@solana/web3.js";var Ii=ie("Raydium_liquidity_instruction");function Xo({poolKeys:i,userKeys:e,amountIn:t,minAmountOut:n},r){let o=Re(i),s=Buffer.alloc(xn.span);xn.encode({instruction:9,amountIn:ae(t),minAmountOut:ae(n)},s);let a=[k({pubkey:xi,isWritable:!1}),k({pubkey:o.id}),k({pubkey:o.authority,isWritable:!1}),k({pubkey:o.openOrders})];return r===4&&a.push(k({pubkey:o.targetOrders})),a.push(k({pubkey:o.vault.A}),k({pubkey:o.vault.B})),r===5&&a.push(k({pubkey:Kn})),a.push(k({pubkey:o.marketProgramId,isWritable:!1}),k({pubkey:o.marketId}),k({pubkey:o.marketBids}),k({pubkey:o.marketAsks}),k({pubkey:o.marketEventQueue}),k({pubkey:o.marketBaseVault}),k({pubkey:o.marketQuoteVault}),k({pubkey:o.marketAuthority,isWritable:!1}),k({pubkey:e.tokenAccountIn}),k({pubkey:e.tokenAccountOut}),k({pubkey:e.owner,isWritable:!1})),new Si({programId:o.programId,keys:a,data:s})}function zo({poolKeys:i,userKeys:e,maxAmountIn:t,amountOut:n},r){let o=Re(i),s=Buffer.alloc(Sn.span);Sn.encode({instruction:11,maxAmountIn:ae(t),amountOut:ae(n)},s);let a=[k({pubkey:xi,isWritable:!1}),k({pubkey:o.id}),k({pubkey:o.authority,isWritable:!1}),k({pubkey:o.openOrders}),k({pubkey:o.targetOrders}),k({pubkey:o.vault.A}),k({pubkey:o.vault.B})];return r===5&&a.push(k({pubkey:Kn})),a.push(k({pubkey:o.marketProgramId,isWritable:!1}),k({pubkey:o.marketId}),k({pubkey:o.marketBids}),k({pubkey:o.marketAsks}),k({pubkey:o.marketEventQueue}),k({pubkey:o.marketBaseVault}),k({pubkey:o.marketQuoteVault}),k({pubkey:o.marketAuthority,isWritable:!1}),k({pubkey:e.tokenAccountIn}),k({pubkey:e.tokenAccountOut}),k({pubkey:e.owner,isWritable:!1,isSigner:!0})),new Si({programId:o.programId,keys:a,data:s})}function Ki(i){let{poolKeys:e,version:t,userKeys:n,amountIn:r,amountOut:o,fixedSide:s}=i;if(t===4||t===5){let a={poolKeys:e,userKeys:n};if(s==="in")return Xo(ee(j({},a),{amountIn:r,minAmountOut:o}),t);if(s==="out")return zo(ee(j({},a),{maxAmountIn:r,amountOut:o}),t);Ii.logWithError("invalid params","params",i)}throw Ii.logWithError("invalid version","poolKeys.version",t),new Error("invalid version")}import mp from"bn.js";import ns from"bn.js";function Ht(i){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,i,!1),new Uint8Array(e)}function Cn(i,e){let t=0;for(let n=i-1;n>=0&&!e.testn(n);n--)t++;return t}function Nn(i,e){let t=0;for(let n=0;n<i&&!e.testn(n);n++)t++;return t}function Kt(i,e){for(let t=0;t<i;t++)if(e.testn(t))return!1;return!0}function Ni(i,e){return Kt(i,e)?null:Cn(i,e)}function Ri(i,e){return Kt(i,e)?null:Nn(i,e)}var Bp=Buffer.from("amm_config","utf8"),Qo=Buffer.from("pool","utf8"),Yo=Buffer.from("pool_vault","utf8"),Ho=Buffer.from("pool_reward_vault","utf8"),Oi=Buffer.from("position","utf8"),Zo=Buffer.from("tick_array","utf8"),jo=Buffer.from("operation","utf8"),Jo=Buffer.from("pool_tick_array_bitmap_extension","utf8"),$o=Buffer.from("observation","utf8");function Li(i,e,t,n){return Be([Qo,e.toBuffer(),t.toBuffer(),n.toBuffer()],i)}function Rn(i,e,t){return Be([Yo,e.toBuffer(),t.toBuffer()],i)}function Mi(i,e,t){return Be([Ho,e.toBuffer(),t.toBuffer()],i)}function te(i,e,t){return Be([Zo,e.toBuffer(),Ht(t)],i)}function mt(i,e,t,n){return Be([Oi,e.toBuffer(),Ht(t),Ht(n)],i)}function We(i,e){return Be([Oi,e.toBuffer()],i)}function Zt(i){return Be([Buffer.from("metadata","utf8"),gt.toBuffer(),i.toBuffer()],gt)}function jt(i){return Be([jo],i)}function Ce(i,e){return Be([Jo,e.toBuffer()],i)}function Ei(i,e){return Be([$o,e.toBuffer()],i)}import Fe from"bn.js";var me=new Fe(0),Le=new Fe(1),et=new Fe(-1),Me=new Fe(1).shln(64),Jt=new Fe(1).shln(128),On=Me.sub(Le),Ct=64,Fi=Jt.subn(1),Te=-443636,Ie=-Te,Qe=new Fe("4295048016"),Ye=new Fe("79226673521066979257578248091"),$t=new Fe("4295048017"),en=new Fe("79226673521066979257578248090"),vi=16,_i="59543866431248",Di="184467440737095516",Vi="15793534762490258745",tn=new Fe(10).pow(new Fe(6));var Sp=new Fe("18446744073700000000");var es=15,Q=class{static async getTickArrays(e,t,n,r,o,s,a){let u=[],c=L.getTickArrayStartIndexByTick(r,o),m=L.getInitializedTickArrayInRange(s,a,o,c,Math.floor(es/2));for(let p=0;p<m.length;p++){let{publicKey:g}=te(t,n,m[p]);u.push(g)}let l=(await st(e,u)).map(p=>p!==null?Nt.decode(p.data):null),d={};for(let p=0;p<u.length;p++){let g=l[p];g!==null&&(d[g.startTickIndex]=ee(j({},g),{address:u[p]}))}return d}static nextInitializedTick(e,t,n,r,o,s){let{initializedTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}=this.nextInitializedTickInOneArray(e,t,n,r,o,s);for(;a==null||a.liquidityGross.lten(0);){if(c=L.getNextTickArrayStartIndex(c,o,s),this.checkIsValidStartIndex(c,o))throw new Error("No enough initialized tickArray");let m=n[c];if(m===void 0)continue;let{nextTick:l,tickArrayAddress:d,tickArrayStartTickIndex:p}=this.firstInitializedTickInOneArray(e,t,m,s);[a,u,c]=[l,d,p]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}}static nextInitializedTickArray(e,t,n,r,o){let s=Math.floor(e/Q.tickCount(t)),a=n?L.searchLowBitFromStart(r,o,s-1,1,t):L.searchHightBitFromStart(r,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let o;if(r){let a=be-1;for(;a>=0;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a-1}}else{let a=0;for(;a<be;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a+1}}let{publicKey:s}=te(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,o,s){let a=L.getTickArrayStartIndexByTick(r,o),u=Math.floor((r-a)/o),c=n[a];if(c==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let m;if(s)for(;u>=0;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){m=d;break}u=u-1}else for(u=u+1;u<be;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){m=d;break}u=u+1}let{publicKey:l}=te(e,t,a);return{initializedTick:m,tickArrayAddress:l,tickArrayStartTickIndex:c.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(L.checkIsOutOfBoundary(e)){if(e>Ie)return!1;let n=L.getTickArrayStartIndexByTick(Te,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return be*e}};import X from"bn.js";import{PublicKey as qe}from"@solana/web3.js";import oe from"bn.js";var Ln=14,tt=class{static maxTickInTickarrayBitmap(e){return e*be*lt}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);let o=n*r;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!Q.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=r?t-Q.tickCount(n):t+Q.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*be,u=s/a+512;s<0&&s%a!=0&&u--;let c=Math.abs(u);if(r){let m=e.shln(1024-c-1),l=Ni(1024,m);if(l!==null){let d=(c-l-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:-o}}else{let m=e.shrn(c),l=Ri(1024,m);if(l!==null){let d=(c+l-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:o-Q.tickCount(n)}}}},Rt=class{static getBitmapOffset(e,t){if(!Q.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=tt.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&r--,r}static getBitmap(e,t,n){let r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=tt.maxTickInTickarrayBitmap(e),n=-t;if(Ie<=t)throw Error(`extensionTickBoundary check error: ${Ie}, ${t}`);if(n<=Te)throw Error(`extensionTickBoundary check error: ${n}, ${Te}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:r}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:L.mergeTickArrayBitmap(r).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){let o=Q.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,r);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){let{minValue:o,maxValue:s}=tt.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(r){let u=L.mergeTickArrayBitmap(e).shln(lt-1-a),c=Kt(512,u)?null:Cn(512,u);if(c!==null){let m=t-c*Q.tickCount(n);return{isInit:!0,tickIndex:m}}else return{isInit:!1,tickIndex:o}}else{let u=L.mergeTickArrayBitmap(e).shrn(a),c=Kt(512,u)?null:Nn(512,u);if(c!==null){let m=t+c*Q.tickCount(n);return{isInit:!0,tickIndex:m}}else return{isInit:!1,tickIndex:s-Q.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%tt.maxTickInTickarrayBitmap(t),r=Math.floor(n/Q.tickCount(t));return e<0&&n!=0&&(r=lt-r),r}};import He from"bn.js";var Ot=class{static getfeeGrowthInside(e,t,n){let r=new He(0),o=new He(0);e.tickCurrent>=t.tick?(r=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new He(0),a=new He(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let u=U.wrappingSubU128(U.wrappingSubU128(e.feeGrowthGlobalX64A,r),s),c=U.wrappingSubU128(U.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:u,feeGrowthInsideBX64:c}}static GetPositionFees(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=U.mulDivFloor(U.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Me),u=t.tokenFeesOwedA.add(a),c=U.mulDivFloor(U.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Me),m=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:m}}static GetPositionFeesV2(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=U.mulDivFloor(U.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Me),u=t.tokenFeesOwedA.add(a),c=U.mulDivFloor(U.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Me),m=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:m}}static GetPositionRewardsV2(e,t,n,r){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],m=U.wrappingSubU128(u,c.growthInsideLastX64),l=U.mulDivFloor(m,t.liquidity,Me),d=c.rewardAmountOwed.add(l);o.push(d)}return o}static GetPositionRewards(e,t,n,r){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],m=U.wrappingSubU128(u,c.growthInsideLastX64),l=U.mulDivFloor(m,t.liquidity,Me),d=c.rewardAmountOwed.add(l);o.push(d)}return o}static getRewardGrowthInside(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new He(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new He(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(U.wrappingSubU128(U.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),u))}return o}static getRewardGrowthInsideV2(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new He(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new He(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(U.wrappingSubU128(U.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),u))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:r,add:o,epochInfo:s}){var y,A,T,w;let a=q.priceToSqrtPriceX64(new N(e.price),e.mintA.decimals,e.mintB.decimals),u=q.getSqrtPriceX64FromTick(t.tickLower),c=q.getSqrtPriceX64FromTick(t.tickUpper),m=o?1+r:1-r,l=H.getAmountsFromLiquidity(a,u,c,n,o),[d,p]=[ce(l.amountA,(y=e.mintA.extensions)==null?void 0:y.feeConfig,s,!0),ce(l.amountB,(A=e.mintB.extensions)==null?void 0:A.feeConfig,s,!0)],[g,f]=[ce(new He(new N(l.amountA.toString()).mul(m).toFixed(0)),(T=e.mintA.extensions)==null?void 0:T.feeConfig,s,!0),ce(new He(new N(l.amountB.toString()).mul(m).toFixed(0)),(w=e.mintB.extensions)==null?void 0:w.feeConfig,s,!0)];return{liquidity:n,amountA:d,amountB:p,amountSlippageA:g,amountSlippageB:f,expirationTime:$e(d.expirationTime,p.expirationTime)}}};import{TOKEN_2022_PROGRAM_ID as Wi}from"@solana/spl-token";var ye=class{static getOutputAmountAndRemainAccounts(e,t,n,r,o,s=!1){let a=n.toBase58()===e.mintA.address,u=[],{isExist:c,startIndex:m,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,a);if(!c||m===void 0||!l)throw new Error("Invalid tick array");u.push(l);let{allTrade:d,amountCalculated:p,accounts:g,sqrtPriceX64:f,feeAmount:y}=dt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,a,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r,m,o,s);return u.push(...g),{allTrade:d,expectedAmountOut:p.mul(et),remainingAccounts:u,executionPrice:f,feeAmount:y}}static getInputAmountAndRemainAccounts(e,t,n,r,o){let s=n.toBase58()===e.mintB.address,a=[],{isExist:u,startIndex:c,nextAccountMeta:m}=this.getFirstInitializedTickArray(e,s);if(!u||c===void 0||!m)throw new Error("Invalid tick array");try{let f=this.preInitializedTickArrayStartIndex(e,s);if(f.isExist){let{publicKey:y}=te(e.programId,e.id,f.nextStartIndex);a.push(y)}}catch{}a.push(m);let{amountCalculated:l,accounts:d,sqrtPriceX64:p,feeAmount:g}=dt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r.mul(et),c,o);return a.push(...d),{expectedAmountIn:l,remainingAccounts:a,executionPrice:p,feeAmount:g}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:r}=ye.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?Rt.checkTickArrayIsInit(Q.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):L.checkTickArrayIsInitialized(L.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=te(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,Q.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=te(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/Q.tickCount(e.tickSpacing)),r=t?L.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):L.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=Q.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:r,tickIndex:o}=tt.nextInitializedTickArrayStartIndex(L.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(r)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=Rt.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<Te||t>Ie)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:r,rewardInfos:o}){var a,u,c;let s=[];for(let m=0;m<o.length;m++){let l=o[m],d=(c=(a=t.rewardDefaultInfos[m])==null?void 0:a.mint.programId)!=null?c:(u=await e.getAccountInfo(l.tokenMint))==null?void 0:u.owner;if(d===void 0)throw Error("get new reward mint info error");let p=ee(j({},l),{perSecond:U.x64ToDecimal(l.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new qe(d)});if(p.tokenMint.equals(qe.default))continue;if(n<=p.openTime.toNumber()||r.eq(me)){s.push(p);continue}let g=new oe(Math.min(p.endTime.toNumber(),n)),f=g.sub(p.lastUpdateTime),y=U.mulDivFloor(f,p.emissionsPerSecondX64,r),A=p.rewardGrowthGlobalX64.add(y),T=U.mulDivFloor(f,p.emissionsPerSecondX64,Me),w=p.rewardTotalEmissioned.add(T);s.push(ee(j({},p),{rewardGrowthGlobalX64:A,rewardTotalEmissioned:w,lastUpdateTime:g}))}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:r}=this.tickRange(e);for(let o of t){let s=L.getTickArrayStartIndexByTick(o,e);if(s>=n||s<r)return!0}return!1}static tickRange(e){let t=tt.maxTickInTickarrayBitmap(e),n=-t;return t>Ie&&(t=Q.getArrayStartIndex(Ie,e)+Q.tickCount(e)),n<Te&&(n=Q.getArrayStartIndex(Te,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!Q.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/Q.tickCount(t)*lt}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let r=await xt(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of r)s.accountInfo!==null&&(o[s.pubkey.toString()]=qi.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let r={},o=[];for(let u of t){let c=L.getTickArrayStartIndexByTick(u.tickCurrent,u.tickSpacing),m=L.getInitializedTickArrayInRange(u.tickArrayBitmap,u.exBitmapInfo,u.tickSpacing,c,7);for(let l of m){let{publicKey:d}=te(u.programId,u.id,l);o.push({pubkey:d}),r[d.toString()]=u.id}}let s=await xt(e,o,{batchRequest:n}),a={};for(let u of s){if(!u.accountInfo)continue;let c=r[u.pubkey.toString()];if(!c)continue;a[c.toString()]===void 0&&(a[c.toString()]={});let m=Nt.decode(u.accountInfo.data);a[c.toString()][m.startTickIndex]=ee(j({},m),{address:u.pubkey})}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:r=!1,updateOwnerRewardAndFee:o=!0}){var a;let s=[];for(let u=0;u<e.length;u++){let c=e[u];c!==null&&(s.find(m=>m.equals(c.state.programId))||s.push(c.state.programId))}if(n){let u=n.tokenAccounts.map(d=>d.accountInfo.mint),c=[];for(let d of u)for(let p of s)c.push(We(p,d).publicKey);let m=await st(t,c,{batchRequest:r}),l={};for(let d of m){if(d===null)continue;let p=Mn.decode(d.data),g=p.poolId.toString(),f=e.find(O=>O.state.id.toBase58()===g);if(f===void 0)continue;let y=f.state,A=L._getTickPriceLegacy({poolInfo:y,tick:p.tickLower,baseIn:!0}),T=L._getTickPriceLegacy({poolInfo:y,tick:p.tickUpper,baseIn:!0}),{amountA:w,amountB:C}=H.getAmountsFromLiquidity(y.sqrtPriceX64,A.tickSqrtPriceX64,T.tickSqrtPriceX64,p.liquidity,!1),D=1/(1-Math.sqrt(Math.sqrt(A.price.div(T.price).toNumber())));f.positionAccount=[...(a=f.positionAccount)!=null?a:[],{poolId:p.poolId,nftMint:p.nftMint,priceLower:A.price,priceUpper:T.price,amountA:w,amountB:C,tickLower:p.tickLower,tickUpper:p.tickUpper,liquidity:p.liquidity,feeGrowthInsideLastX64A:p.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:p.feeGrowthInsideLastX64B,tokenFeesOwedA:p.tokenFeesOwedA,tokenFeesOwedB:p.tokenFeesOwedB,rewardInfos:p.rewardInfos.map(O=>ee(j({},O),{pendingReward:new oe(0)})),leverage:D,tokenFeeAmountA:new oe(0),tokenFeeAmountB:new oe(0)}];let B=await L.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickLower,f.state.tickSpacing),E=await L.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickUpper,f.state.tickSpacing);l[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickLower}`]=B,l[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickUpper}`]=E}if(o){let d=Object.values(l),p=await st(t,d,{batchRequest:r}),g={};for(let f=0;f<d.length;f++){let y=p[f];if(y===null)continue;let A=d[f].toString();g[A]=Nt.decode(y.data)}for(let{state:f,positionAccount:y}of e)if(!!y)for(let A of y){let T=`${f.programId.toString()}-${f.id.toString()}-${A.tickLower}`,w=`${f.programId.toString()}-${f.id.toString()}-${A.tickUpper}`,C=g[l[T].toString()],D=g[l[w].toString()],B=C.ticks[L.getTickOffsetInArray(A.tickLower,f.tickSpacing)],E=D.ticks[L.getTickOffsetInArray(A.tickUpper,f.tickSpacing)],{tokenFeeAmountA:O,tokenFeeAmountB:z}=await Ot.GetPositionFees(f,A,B,E),h=await Ot.GetPositionRewards(f,A,B,E);A.tokenFeeAmountA=O.gte(new oe(0))?O:new oe(0),A.tokenFeeAmountB=z.gte(new oe(0))?z:new oe(0);for(let v=0;v<h.length;v++)A.rewardInfos[v].pendingReward=h[v].gte(new oe(0))?h[v]:new oe(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountIn:o,slippage:s,priceLimit:a=new N(0),catchLiquidityInsufficient:u=!1}){var ge;let c,m=n.toBase58()===e.mintA.address,[l,d]=m?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];a.equals(new N(0))?c=m?Qe.add(new oe(1)):Ye.sub(new oe(1)):c=q.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let p=ce(o,l,r,!1),{allTrade:g,expectedAmountOut:f,remainingAccounts:y,executionPrice:A,feeAmount:T}=ye.getOutputAmountAndRemainAccounts(e,t,n,p.amount.sub((ge=p.fee)!=null?ge:me),c,u),w=ce(f,d,r,!1),C=q.sqrtPriceX64ToPrice(A,e.mintA.decimals,e.mintB.decimals),D=m?C:new N(1).div(C),B=f.mul(new oe(Math.floor((1-s)*1e10))).div(new oe(1e10)),E=ce(B,d,r,!1),O=m?e.currentPrice:new N(1).div(e.currentPrice),z=new N(D).sub(O).abs(),h=O,v=new Je(new N(z).mul(10**15).toFixed(0),new N(h).mul(10**15).toFixed(0));return{allTrade:g,realAmountIn:p,amountOut:w,minAmountOut:E,expirationTime:$e(p.expirationTime,w.expirationTime),currentPrice:e.currentPrice,executionPrice:D,priceImpact:v,fee:T,remainingAccounts:y,executionPriceX64:A}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:r,slippage:o,epochInfo:s,catchLiquidityInsufficient:a=!1}){let u=r.address===e.mintB.address,[c,m]=u?[e.mintA,e.mintB]:[e.mintB,e.mintA],[l,d]=[new De(ee(j({},c),{mint:c.address,isToken2022:c.programId===Wi.toBase58()})),new De(ee(j({},m),{mint:m.address,isToken2022:m.programId===Wi.toBase58()}))],{allTrade:p,realAmountIn:g,amountOut:f,minAmountOut:y,expirationTime:A,currentPrice:T,executionPrice:w,priceImpact:C,fee:D,remainingAccounts:B,executionPriceX64:E}=ye.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new qe(c.address),amountIn:n,slippage:o,epochInfo:s,catchLiquidityInsufficient:a}),O=ee(j({},g),{amount:new pe(l,g.amount),fee:g.fee===void 0?void 0:new pe(l,g.fee)}),z=ee(j({},f),{amount:new pe(d,f.amount),fee:f.fee===void 0?void 0:new pe(d,f.fee)}),h=ee(j({},y),{amount:new pe(d,y.amount),fee:y.fee===void 0?void 0:new pe(d,y.fee)}),v=new Ne({baseToken:l,denominator:new oe(10).pow(new oe(20+l.decimals)),quoteToken:d,numerator:T.mul(new N(10**(20+d.decimals))).toFixed(0)}),ge=new Ne({baseToken:l,denominator:new oe(10).pow(new oe(20+l.decimals)),quoteToken:d,numerator:w.mul(new N(10**(20+d.decimals))).toFixed(0)}),le=new pe(l,D);return{allTrade:p,realAmountIn:O,amountOut:z,minAmountOut:h,expirationTime:A,currentPrice:v,executionPrice:ge,priceImpact:C,fee:le,remainingAccounts:B,executionPriceX64:E}}static computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountOut:o,slippage:s,priceLimit:a=new N(0)}){var h;let u=n.toBase58()===e.mintA.address,c={[e.mintA.address]:e.mintA.extensions.feeConfig,[e.mintB.address]:e.mintB.extensions.feeConfig},m;a.equals(new N(0))?m=u?Ye.sub(new oe(1)):Qe.add(new oe(1)):m=q.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let l=ce(o,c[n.toString()],r,!0),{expectedAmountIn:d,remainingAccounts:p,executionPrice:g,feeAmount:f}=ye.getInputAmountAndRemainAccounts(e,t,n,l.amount.sub((h=l.fee)!=null?h:me),m),y=u?e.mintB.address:e.mintA.address,A=ce(d,c[y],r,!1),T=q.sqrtPriceX64ToPrice(g,e.mintA.decimals,e.mintB.decimals),w=u?T:new N(1).div(T),C=d.mul(new oe(Math.floor((1+s)*1e10))).div(new oe(1e10)),D=ce(C,c[y],r,!0),B=u?e.currentPrice:new N(1).div(e.currentPrice),E=new N(w).sub(B).abs(),O=B,z=new Je(new N(E).mul(10**15).toFixed(0),new N(O).mul(10**15).toFixed(0));return{amountIn:A,maxAmountIn:D,realAmountOut:l,expirationTime:$e(A.expirationTime,l.expirationTime),currentPrice:e.currentPrice,executionPrice:w,priceImpact:z,fee:f,remainingAccounts:p}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:r}){var g,f,y;let o=e[t],s=L.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=L.getTickPrice({poolInfo:e,tick:r,baseIn:!0}).price.toNumber(),u=Math.max(s,o.priceMin),m=Math.min(a,o.priceMax)-u,l=a-s,d=o.priceMax-o.priceMin,p;return m<=0?p=0:l===m?p=d/m:d===m?p=m/l:p=m/d*(m/l),{feeApr:o.feeApr*p,rewardsApr:[((g=o.rewardApr[0])!=null?g:0)*p,((f=o.rewardApr[1])!=null?f:0)*p,((y=o.rewardApr[2])!=null?y:0)*p],apr:o.apr*p}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:r,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:u}){let c=n==="day"?1:n==="week"?7:n==="month"?30:0,m=e[n],l=r[At(e.mintA.address).toString()],d=r[At(e.mintB.address).toString()],p=e.mintA.decimals,g=e.mintB.decimals;if(!m||!l||!d)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let f=q.priceToSqrtPriceX64(new N(e.price),e.mintA.decimals,e.mintB.decimals),y=q.getSqrtPriceX64FromTick(s),A=q.getSqrtPriceX64FromTick(a),{amountSlippageA:T,amountSlippageB:w}=H.getAmountsFromLiquidityWithSlippage(f,y,A,t,!1,!1,0),{amountSlippageA:C,amountSlippageB:D}=H.getAmountsFromLiquidityWithSlippage(f,y,A,o,!1,!1,0),B=new N(T.toString()).div(new N(10).pow(p)).mul(l.value).add(new N(w.toString()).div(new N(10).pow(g)).mul(d.value)),E=new N(C.toString()).div(new N(10).pow(p)).mul(l.value).add(new N(D.toString()).div(new N(10).pow(g)).mul(d.value)),O=new N(1).div(B.add(E)),h=new N(m.volumeFee).mul(365).div(c).mul(O).mul(100).toNumber(),v=3600*24*365,ge=e.rewardDefaultInfos.map(le=>{var $,Vn;let xe=le.mint.decimals,ue=r[le.mint.address];return u<(($=le.startTime)!=null?$:0)||u>((Vn=le.endTime)!=null?Vn:0)||!le.perSecond||!ue||xe===void 0?0:new N(ue.value).mul(new N(le.perSecond).mul(v)).div(new N(10).pow(xe)).mul(O).mul(100).toNumber()});return{feeApr:h,rewardsApr:ge,apr:h+ge.reduce((le,xe)=>le+xe,0)}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:r,amount:o,slippage:s,add:a,epochInfo:u,amountHasFee:c}){var A,T;let m=q.priceToSqrtPriceX64(new N(e.price),e.mintA.decimals,e.mintB.decimals),l=q.getSqrtPriceX64FromTick(n),d=q.getSqrtPriceX64FromTick(r),p=a?1-s:1+s,g=ce(o,(A=e[t?"mintA":"mintB"].extensions)==null?void 0:A.feeConfig,u,!c),f=new oe(new N(g.amount.sub((T=g.fee)!=null?T:me).toString()).mul(p).toFixed(0)),y;if(m.lte(l))y=t?H.getLiquidityFromTokenAmountA(l,d,f,!a):new oe(0);else if(m.lte(d)){let w=H.getLiquidityFromTokenAmountA(m,d,f,!a),C=H.getLiquidityFromTokenAmountB(l,m,f);y=t?w:C}else y=t?new oe(0):H.getLiquidityFromTokenAmountB(l,d,f);return ye.getAmountsFromLiquidity({epochInfo:u,poolInfo:e,tickLower:n,tickUpper:r,liquidity:y,slippage:s,add:a})}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:r,liquidity:o,slippage:s,add:a}){var y,A,T,w;let u=q.getSqrtPriceX64FromTick(n),c=q.getSqrtPriceX64FromTick(r),m=a?1+s:1-s,l=H.getAmountsFromLiquidity(q.priceToSqrtPriceX64(new N(t.price),t.mintA.decimals,t.mintB.decimals),u,c,o,a),[d,p]=[ce(l.amountA,(y=t.mintA.extensions)==null?void 0:y.feeConfig,e,!0),ce(l.amountB,(A=t.mintB.extensions)==null?void 0:A.feeConfig,e,!0)],[g,f]=[ce(l.amountA.muln(m),(T=t.mintA.extensions)==null?void 0:T.feeConfig,e,!0),ce(l.amountB.muln(m),(w=t.mintB.extensions)==null?void 0:w.feeConfig,e,!0)];return{liquidity:o,amountA:d,amountB:p,amountSlippageA:g,amountSlippageB:f,expirationTime:$e(d.expirationTime,p.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let r=t.filter(u=>!n[u.id]).map(u=>new qe(u.id));(await st(e,r)).forEach((u,c)=>{!u||(n[r[c].toBase58()]=nn.decode(u.data))});let s=t.map(u=>Ce(new qe(u.programId),new qe(u.id)).publicKey),a=await ye.fetchExBitmaps({connection:e,exBitmapAddress:s,batchRequest:!1});return t.reduce((u,c)=>ee(j({},u),{[c.id]:ee(j({},n[c.id]),{id:new qe(c.id),version:6,programId:new qe(c.programId),mintA:c.mintA,mintB:c.mintB,ammConfig:ee(j({},c.config),{id:new qe(c.config.id),fundOwner:""}),currentPrice:new N(c.price),exBitmapInfo:a[Ce(new qe(c.programId),new qe(c.id)).publicKey.toBase58()],startTime:n[c.id].startTime.toNumber()})}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};var U=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),o=r.div(n);return r.mod(n).eq(me)||(o=o.add(Le)),o}static mulDivFloor(e,t,n){if(n.eq(me))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(me))throw new Error("division by 0");return e.mul(t).add(n.sub(Le)).div(n)}static x64ToDecimal(e,t){return new N(e.toString()).div(N.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new X(e.mul(N.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(Jt).sub(t).mod(Jt)}};function Ae(i,e){return En(i.mul(e),64,256)}function ts(i,e,t){let n=i.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function En(i,e,t){let n=i.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var q=class{static sqrtPriceX64ToPrice(e,t,n){return U.x64ToDecimal(e).pow(2).mul(N.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return U.decimalToX64(e.mul(N.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(me))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(me))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(me))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(me))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(me))return e;let o=t.shln(Ct);if(r){let s=o,a=o.add(n.mul(e));return a.gte(s)?U.mulDivCeil(s,e,a):U.mulDivRoundingUp(s,Le,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return U.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let o=n.shln(Ct);if(r)return e.add(o.div(t));{let s=U.mulDivRoundingUp(o,Le,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<Te||e>Ie)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new X("18445821805675395072"):new X("18446744073709551616");return(t&2)!=0&&(n=Ae(n,new X("18444899583751176192"))),(t&4)!=0&&(n=Ae(n,new X("18443055278223355904"))),(t&8)!=0&&(n=Ae(n,new X("18439367220385607680"))),(t&16)!=0&&(n=Ae(n,new X("18431993317065453568"))),(t&32)!=0&&(n=Ae(n,new X("18417254355718170624"))),(t&64)!=0&&(n=Ae(n,new X("18387811781193609216"))),(t&128)!=0&&(n=Ae(n,new X("18329067761203558400"))),(t&256)!=0&&(n=Ae(n,new X("18212142134806163456"))),(t&512)!=0&&(n=Ae(n,new X("17980523815641700352"))),(t&1024)!=0&&(n=Ae(n,new X("17526086738831433728"))),(t&2048)!=0&&(n=Ae(n,new X("16651378430235570176"))),(t&4096)!=0&&(n=Ae(n,new X("15030750278694412288"))),(t&8192)!=0&&(n=Ae(n,new X("12247334978884435968"))),(t&16384)!=0&&(n=Ae(n,new X("8131365268886854656"))),(t&32768)!=0&&(n=Ae(n,new X("3584323654725218816"))),(t&65536)!=0&&(n=Ae(n,new X("696457651848324352"))),(t&131072)!=0&&(n=Ae(n,new X("26294789957507116"))),(t&262144)!=0&&(n=Ae(n,new X("37481735321082"))),e>0&&(n=Fi.div(n)),n}static getTickFromPrice(e,t,n){return q.getTickFromSqrtPriceX64(q.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(Ye)||e.lt(Qe))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new X(t-64),r=ts(n,32,128),o=new X("8000000000000000","hex"),s=0,a=new X(0),u=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new X(0))&&s<vi;){u=u.mul(u);let g=u.shrn(127);u=u.shrn(63+g.toNumber()),a=a.add(o.mul(g)),o=o.shrn(1),s+=1}let c=a.shrn(32),l=r.add(c).mul(new X(_i)),d=En(l.sub(new X(Di)),64,128).toNumber(),p=En(l.add(new X(Vi)),64,128).toNumber();return d==p?d:q.getSqrtPriceX64FromTick(p).lte(e)?p:d}},pt=class{static getTickWithPriceAndTickspacing(e,t,n,r){let s=q.getTickFromSqrtPriceX64(q.priceToSqrtPriceX64(e,n,r))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,r){let o=pt.getTickWithPriceAndTickspacing(e,t,n,r),s=q.getSqrtPriceX64FromTick(o);return q.sqrtPriceX64ToPrice(s,n,r)}},H=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(me))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(Ct),s=t.sub(e);return r?U.mulDivRoundingUp(U.mulDivCeil(o,s,t),Le,e):U.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(me))throw new Error("sqrtPriceX64A must greater than 0");return r?U.mulDivCeil(n,t.sub(e),Me):U.mulDivFloor(n,t.sub(e),Me)}static getLiquidityFromTokenAmountA(e,t,n,r){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return r?U.mulDivRoundingUp(a,Le,On):a.shrn(Ct)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),U.mulDivFloor(n,On,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return H.getLiquidityFromTokenAmountA(t,n,r,!1);if(e.lt(n)){let s=H.getLiquidityFromTokenAmountA(e,n,r,!1),a=H.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return H.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:H.getTokenAmountAFromLiquidity(t,n,r,o),amountB:new X(0)};if(e.lt(n)){let s=H.getTokenAmountAFromLiquidity(e,n,r,o),a=H.getTokenAmountBFromLiquidity(t,e,r,o);return{amountA:s,amountB:a}}else return{amountA:new X(0),amountB:H.getTokenAmountBFromLiquidity(t,n,r,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,r,o,s,a){let{amountA:u,amountB:c}=H.getAmountsFromLiquidity(e,t,n,r,s),m=o?1+a:1-a,l=new X(new N(u.toString()).mul(m).toFixed(0)),d=new X(new N(c.toString()).mul(m).toFixed(0));return{amountSlippageA:l,amountSlippageB:d}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:r,slippage:o,add:s,epochInfo:a,amountAddFee:u}){var T,w,C,D;let c=q.priceToSqrtPriceX64(new N(e.price),e.mintA.decimals,e.mintB.decimals),m=q.getSqrtPriceX64FromTick(t),l=q.getSqrtPriceX64FromTick(n),d=s?1+o:1-o,p=H.getAmountsFromLiquidity(c,m,l,r,s),[g,f]=[ce(p.amountA,(T=e.mintA.extensions)==null?void 0:T.feeConfig,a,u),ce(p.amountB,(w=e.mintB.extensions)==null?void 0:w.feeConfig,a,u)],[y,A]=[ce(new X(new N(p.amountA.toString()).mul(d).toFixed(0)),(C=e.mintA.extensions)==null?void 0:C.feeConfig,a,u),ce(new X(new N(p.amountB.toString()).mul(d).toFixed(0)),(D=e.mintB.extensions)==null?void 0:D.feeConfig,a,u)];return{liquidity:r,amountA:g,amountB:f,amountSlippageA:y,amountSlippageB:A,expirationTime:$e(g.expirationTime,f.expirationTime)}}},dt=class{static swapCompute(e,t,n,r,o,s,a,u,c,m,l,d,p,g,f=!1){if(d.eq(me))throw new Error("amountSpecified must not be 0");if(g||(g=s?Qe.add(Le):Ye.sub(Le)),s){if(g.lt(Qe))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(g.gte(l))throw new Error("sqrtPriceX64 must smaller than current")}else{if(g.gt(Ye))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(g.lte(l))throw new Error("sqrtPriceX64 must greater than current")}let y=d.gt(me),A={amountSpecifiedRemaining:d,amountCalculated:me,sqrtPriceX64:l,tick:c>p?Math.min(p+Q.tickCount(m)-1,c):p,accounts:[],liquidity:u,feeAmount:new X(0)},T=p,w=n[p],C=0,D=!s&&w.startTickIndex===A.tick;for(;!A.amountSpecifiedRemaining.eq(me)&&!A.sqrtPriceX64.eq(g);){C>10;let B={};B.sqrtPriceStartX64=A.sqrtPriceX64;let E=L.nextInitTick(w,A.tick,m,s,D),O=E||null,z=null;if(!(O!=null&&O.liquidityGross.gtn(0))){let v=ye.nextInitializedTickArrayStartIndex({tickCurrent:A.tick,tickSpacing:m,tickArrayBitmap:r,exBitmapInfo:o},T,s);if(!v.isExist){if(f)return{allTrade:!1,amountSpecifiedRemaining:A.amountSpecifiedRemaining,amountCalculated:A.amountCalculated,feeAmount:A.feeAmount,sqrtPriceX64:A.sqrtPriceX64,liquidity:A.liquidity,tickCurrent:A.tick,accounts:A.accounts};throw Error("swapCompute LiquidityInsufficient")}T=v.nextStartIndex;let{publicKey:ge}=te(e,t,T);z=ge,w=n[T];try{O=L.firstInitializedTick(w,s)}catch{throw Error("not found next tick info")}}B.tickNext=O.tick,B.initialized=O.liquidityGross.gtn(0),p!==T&&z&&(A.accounts.push(z),p=T),B.tickNext<Te?B.tickNext=Te:B.tickNext>Ie&&(B.tickNext=Ie),B.sqrtPriceNextX64=q.getSqrtPriceX64FromTick(B.tickNext);let h;if(s&&B.sqrtPriceNextX64.lt(g)||!s&&B.sqrtPriceNextX64.gt(g)?h=g:h=B.sqrtPriceNextX64,[A.sqrtPriceX64,B.amountIn,B.amountOut,B.feeAmount]=dt.swapStepCompute(A.sqrtPriceX64,h,A.liquidity,A.amountSpecifiedRemaining,a),A.feeAmount=A.feeAmount.add(B.feeAmount),y?(A.amountSpecifiedRemaining=A.amountSpecifiedRemaining.sub(B.amountIn.add(B.feeAmount)),A.amountCalculated=A.amountCalculated.sub(B.amountOut)):(A.amountSpecifiedRemaining=A.amountSpecifiedRemaining.add(B.amountOut),A.amountCalculated=A.amountCalculated.add(B.amountIn.add(B.feeAmount))),A.sqrtPriceX64.eq(B.sqrtPriceNextX64)){if(B.initialized){let v=O.liquidityNet;s&&(v=v.mul(et)),A.liquidity=H.addDelta(A.liquidity,v)}D=B.tickNext!=A.tick&&!s&&w.startTickIndex===B.tickNext,A.tick=s?B.tickNext-1:B.tickNext}else if(A.sqrtPriceX64!=B.sqrtPriceStartX64){let v=q.getTickFromSqrtPriceX64(A.sqrtPriceX64);D=v!=A.tick&&!s&&w.startTickIndex===v,A.tick=v}++C}try{let{nextStartIndex:B,isExist:E}=Q.nextInitializedTickArray(A.tick,m,s,r,o);E&&p!==B&&(A.accounts.push(te(e,t,B).publicKey),p=B)}catch{}return{allTrade:!0,amountSpecifiedRemaining:me,amountCalculated:A.amountCalculated,feeAmount:A.feeAmount,sqrtPriceX64:A.sqrtPriceX64,liquidity:A.liquidity,tickCurrent:A.tick,accounts:A.accounts}}static swapStepCompute(e,t,n,r,o){let s={sqrtPriceX64Next:new X(0),amountIn:new X(0),amountOut:new X(0),feeAmount:new X(0)},a=e.gte(t),u=r.gte(me);if(u){let m=U.mulDivFloor(r,tn.sub(new X(o.toString())),tn);s.amountIn=a?H.getTokenAmountAFromLiquidity(t,e,n,!0):H.getTokenAmountBFromLiquidity(e,t,n,!0),m.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=q.getNextSqrtPriceX64FromInput(e,n,m,a)}else s.amountOut=a?H.getTokenAmountBFromLiquidity(t,e,n,!1):H.getTokenAmountAFromLiquidity(e,t,n,!1),r.mul(et).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=q.getNextSqrtPriceX64FromOutput(e,n,r.mul(et),a);let c=t.eq(s.sqrtPriceX64Next);return a?(c&&u||(s.amountIn=H.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),c&&!u||(s.amountOut=H.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=c&&u?s.amountIn:H.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=c&&!u?s.amountOut:H.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!u&&s.amountOut.gt(r.mul(et))&&(s.amountOut=r.mul(et)),u&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=r.sub(s.amountIn):s.feeAmount=U.mulDivCeil(s.amountIn,new X(o),tn.sub(new X(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};var be=60,lt=512,L=class{static getTickArrayAddressByTick(e,t,n,r){let o=L.getTickArrayStartIndexByTick(n,r),{publicKey:s}=te(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=L.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=be)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=Q.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*Q.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*be,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*be,o=Math.floor(t/r)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*be:e+t*be}static mergeTickArrayBitmap(e){let t=new ns(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,o){let s=Math.floor(r/(n*be));return[...L.searchLowBitFromStart(e,t,s-1,o,n),...L.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return L.searchHightBitFromStart(e,t,0,lt,n)}static getAllInitializedTickArrayInfo(e,t,n,r,o){let s=[],a=L.getAllInitializedTickArrayStartIndex(n,r,o);for(let u of a){let{publicKey:c}=te(e,t,u);s.push({tickArrayStartIndex:u,tickArrayAddress:c})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>L.mergeTickArrayBitmap(c)),a=[];for(;n>=-7680;){let c=Math.floor((n+7680)/512),m=(n+7680)%512;if(s[c].testn(m)&&a.push(n),n--,a.length===r)break}let u=Q.tickCount(o);return a.map(c=>c*u)}static searchHightBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>L.mergeTickArrayBitmap(c)),a=[];for(;n<7680;){let c=Math.floor((n+7680)/512),m=(n+7680)%512;if(s[c].testn(m)&&a.push(n),n++,a.length===r)break}let u=Q.tickCount(o);return a.map(c=>c*u)}static checkIsOutOfBoundary(e){return e<Te||e>Ie}static nextInitTick(e,t,n,r,o){if(Q.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(r)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<be;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=be-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<be;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=q.getSqrtPriceX64FromTick(t),o=q.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new N(1).div(o),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new N(1).div(t),o=pt.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=q.getSqrtPriceX64FromTick(o),a=q.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new N(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=q.getSqrtPriceX64FromTick(t),o=q.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new N(1).div(o),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new N(1).div(t),o=pt.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=q.getSqrtPriceX64FromTick(o),a=q.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new N(1).div(a)}}};var is=F([fe(8),W("bump"),ct("index"),S(""),Oe("protocolFeeRate"),Oe("tradeFeeRate"),ct("tickSpacing"),Z(b(),8,"")]),rs=F([Oe("blockTimestamp"),wi("tickCumulative"),Z(b(),4)]),Gi=F([fe(8),Ee("initialized"),b("recentEpoch"),ct("observationIndex"),S("poolId"),Z(rs,100,"observations"),Z(b(),4)]),os=F([W("rewardState"),b("openTime"),b("endTime"),b("lastUpdateTime"),G("emissionsPerSecondX64"),b("rewardTotalEmissioned"),b("rewardClaimed"),S("tokenMint"),S("tokenVault"),S("creator"),G("rewardGrowthGlobalX64")]),nn=F([fe(8),W("bump"),S("ammConfig"),S("creator"),S("mintA"),S("mintB"),S("vaultA"),S("vaultB"),S("observationId"),W("mintDecimalsA"),W("mintDecimalsB"),ct("tickSpacing"),G("liquidity"),G("sqrtPriceX64"),ke("tickCurrent"),Oe(),G("feeGrowthGlobalX64A"),G("feeGrowthGlobalX64B"),b("protocolFeesTokenA"),b("protocolFeesTokenB"),G("swapInAmountTokenA"),G("swapOutAmountTokenB"),G("swapInAmountTokenB"),G("swapOutAmountTokenA"),W("status"),Z(W(),7,""),Z(os,3,"rewardInfos"),Z(b(),16,"tickArrayBitmap"),b("totalFeesTokenA"),b("totalFeesClaimedTokenA"),b("totalFeesTokenB"),b("totalFeesClaimedTokenB"),b("fundFeesTokenA"),b("fundFeesTokenB"),b("startTime"),Z(b(),15*4-3,"padding")]),ss=F([G("growthInsideLastX64"),b("rewardAmountOwed")]),Mn=F([fe(8),W("bump"),S("nftMint"),S("poolId"),ke("tickLower"),ke("tickUpper"),G("liquidity"),G("feeGrowthInsideLastX64A"),G("feeGrowthInsideLastX64B"),b("tokenFeesOwedA"),b("tokenFeesOwedB"),Z(ss,3,"rewardInfos"),Z(b(),8,"")]),Ff=F([fe(8),W("bump"),S("poolId"),ke("tickLowerIndex"),ke("tickUpperIndex"),G("liquidity"),G("feeGrowthInsideLastX64A"),G("feeGrowthInsideLastX64B"),b("tokenFeesOwedA"),b("tokenFeesOwedB"),Z(G(),3,"rewardGrowthInside"),Z(b(),8,"")]),as=F([ke("tick"),hi("liquidityNet"),G("liquidityGross"),G("feeGrowthOutsideX64A"),G("feeGrowthOutsideX64B"),Z(G(),3,"rewardGrowthsOutsideX64"),Z(Oe(),13,"")]),Nt=F([fe(8),S("poolId"),ke("startTickIndex"),Z(as,be,"ticks"),W("initializedTickCount"),Z(W(),115,"")]),us=F([fe(329),Z(S(),100,"whitelistMints")]),qi=F([fe(8),S("poolId"),Z(Z(b(),8),Ln,"positiveTickArrayBitmap"),Z(Z(b(),8),Ln,"negativeTickArrayBitmap")]);var Df=F([fe(8),W("bump"),Ee("disableCreatePool"),ct("index"),b("tradeFeeRate"),b("protocolFeeRate"),b("fundFeeRate"),b("createPoolFee"),S("protocolOwner"),S("fundOwner"),Z(b(),16)]),cs=F([fe(8),S("configId"),S("poolCreator"),S("vaultA"),S("vaultB"),S("mintLp"),S("mintA"),S("mintB"),S("mintProgramA"),S("mintProgramB"),S("observationId"),W("bump"),W("status"),W("lpDecimals"),W("mintDecimalA"),W("mintDecimalB"),b("lpAmount"),b("protocolFeesMintA"),b("protocolFeesMintB"),b("fundFeesMintA"),b("fundFeesMintB"),b("openTime"),Z(b(),32)]);import{TransactionInstruction as ms}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Xf,TOKEN_2022_PROGRAM_ID as zf,ASSOCIATED_TOKEN_PROGRAM_ID as Qf}from"@solana/spl-token";var Zf=ie("Raydium_cpmm"),ls={initialize:[175,175,109,31,13,152,155,237],deposit:[242,35,198,137,82,225,242,182],withdraw:[183,18,70,156,148,109,161,34],swapBaseInput:[143,190,90,218,196,30,51,222],swapBaseOutput:[55,217,98,86,163,74,180,173]};function Ui(i,e,t,n,r,o,s,a,u,c,m,l,d,p,g,f){let y=F([b("amountIn"),b("amounOutMin")]),A=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!0}],T=Buffer.alloc(y.span);return y.encode({amountIn:g,amounOutMin:f},T),new ms({keys:A,programId:i,data:Buffer.from([...ls.swapBaseInput,...T])})}var $f=Buffer.from("vault_and_lp_mint_auth_seed","utf8"),eb=Buffer.from("amm_config","utf8"),tb=Buffer.from("pool","utf8"),nb=Buffer.from("pool_lp_mint","utf8"),ib=Buffer.from("pool_vault","utf8"),rb=Buffer.from("observation","utf8");import Pb from"bn.js";import ds from"bn.js";var ab=new ds(1e6);import ps from"bn.js";var pb=new ps(0);import Bb from"decimal.js-light";import{PublicKey as Jb}from"@solana/web3.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Xi,TOKEN_2022_PROGRAM_ID as at,TOKEN_PROGRAM_ID as we}from"@solana/spl-token";import{Keypair as Fn,PublicKey as K,SystemProgram as Lt,TransactionInstruction as Ge}from"@solana/web3.js";import zi from"bn.js";Gi.span;var Qi=ie("Raydium_Clmm"),Ue={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},Mt=class{static createPoolInstruction(e,t,n,r,o,s,a,u,c,m,l,d,p,g){let f=F([G("sqrtPriceX64"),b("startTime")]),y=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:Lt.programId,isSigner:!1,isWritable:!1},{pubkey:ut,isSigner:!1,isWritable:!1}],A=Buffer.alloc(f.span);f.encode({sqrtPriceX64:p,startTime:g},A);let T=Buffer.from([...Ue.createPool,...A]);return new Ge({keys:y,programId:e,data:T})}static async createPoolInstructions(e){let{programId:t,owner:n,mintA:r,mintB:o,ammConfigId:s,initialPriceX64:a,startTime:u}=e,[c,m]=[new K(r.address),new K(o.address)],{publicKey:l}=Li(t,s,c,m),{publicKey:d}=Ei(t,l),{publicKey:p}=Rn(t,l,c),{publicKey:g}=Rn(t,l,m),f=[this.createPoolInstruction(t,l,n,s,d,c,p,new K(r.programId||we),m,g,new K(o.programId||we),Ce(t,l).publicKey,a,u)];return{signers:[],instructions:f,instructionTypes:[re.CreateAccount,re.ClmmCreatePool],address:{poolId:l,observationId:d,mintAVault:p,mintBVault:g},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,r,o,s,a,u,c,m,l,d,p,g,f,y,A,T,w,C,D,B,E,O,z,h){let v=F([ke("tickLowerIndex"),ke("tickUpperIndex"),ke("tickArrayLowerStartIndex"),ke("tickArrayUpperStartIndex"),G("liquidity"),b("amountMaxA"),b("amountMaxB"),Ee("withMetadata"),W("optionBaseFlag"),Ee("baseFlag")]),ge=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],le=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:ut,isSigner:!1,isWritable:!1},{pubkey:Lt.programId,isSigner:!1,isWritable:!1},{pubkey:we,isSigner:!1,isWritable:!1},{pubkey:Xi,isSigner:!1,isWritable:!1},{pubkey:gt,isSigner:!1,isWritable:!1},{pubkey:at,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:A,isSigner:!1,isWritable:!1},...ge],xe=Buffer.alloc(v.span);v.encode({tickLowerIndex:T,tickUpperIndex:w,tickArrayLowerStartIndex:C,tickArrayUpperStartIndex:D,liquidity:B,amountMaxA:E,amountMaxB:O,withMetadata:z==="create",baseFlag:!1,optionBaseFlag:0},xe);let ue=Buffer.from([...Ue.openPosition,...xe]);return new Ge({keys:le,programId:e,data:ue})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:m}){let l=[],[d,p]=[new K(e.programId),new K(e.id)],g;if(m)g=new K((await m(1))[0]);else{let O=Fn.generate();l.push(O),g=O.publicKey}let f=L.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=L.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:A}=te(d,p,f),{publicKey:T}=te(d,p,y),{publicKey:w}=ze(n.wallet,g,we),{publicKey:C}=Zt(g),{publicKey:D}=We(d,g),{publicKey:B}=mt(d,p,r,o),E=this.openPositionFromLiquidityInstruction(d,n.feePayer,p,n.wallet,g,w,C,B,A,T,D,n.tokenAccountA,n.tokenAccountB,new K(t.vault.A),new K(t.vault.B),new K(e.mintA.address),new K(e.mintB.address),r,o,f,y,s,a,u,c);return{signers:l,instructions:[E],instructionTypes:[re.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:g,tickArrayLower:A,tickArrayUpper:T,positionNftAccount:w,metadataAccount:C,personalPosition:D,protocolPosition:B}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:u,withMetadata:c,getEphemeralSigners:m}){let l=[],[d,p]=[new K(e.programId),new K(e.id)],g;if(m)g=new K((await m(1))[0]);else{let O=Fn.generate();l.push(O),g=O.publicKey}let f=L.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=L.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:A}=te(d,p,f),{publicKey:T}=te(d,p,y),{publicKey:w}=ze(n.wallet,g,we),{publicKey:C}=Zt(g),{publicKey:D}=We(d,g),{publicKey:B}=mt(d,p,r,o),E=this.openPositionFromBaseInstruction(d,n.feePayer,p,n.wallet,g,w,C,B,A,T,D,n.tokenAccountA,n.tokenAccountB,new K(t.vault.A),new K(t.vault.B),new K(e.mintA.address),new K(e.mintB.address),r,o,f,y,c,s,a,u,ye.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,y])?Ce(d,p).publicKey:void 0);return{address:{nftMint:g,tickArrayLower:A,tickArrayUpper:T,positionNftAccount:w,metadataAccount:C,personalPosition:D,protocolPosition:B},instructions:[E],signers:l,instructionTypes:[re.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,r,o,s,a,u,c,m,l,d,p,g,f,y,A,T,w,C,D,B,E,O,z,h){let v=F([ke("tickLowerIndex"),ke("tickUpperIndex"),ke("tickArrayLowerStartIndex"),ke("tickArrayUpperStartIndex"),G("liquidity"),b("amountMaxA"),b("amountMaxB"),Ee("withMetadata"),W("optionBaseFlag"),Ee("baseFlag")]),ge=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],le=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:ut,isSigner:!1,isWritable:!1},{pubkey:Lt.programId,isSigner:!1,isWritable:!1},{pubkey:we,isSigner:!1,isWritable:!1},{pubkey:Xi,isSigner:!1,isWritable:!1},{pubkey:gt,isSigner:!1,isWritable:!1},{pubkey:at,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:A,isSigner:!1,isWritable:!1},...ge],xe=Buffer.alloc(v.span);v.encode({tickLowerIndex:T,tickUpperIndex:w,tickArrayLowerStartIndex:C,tickArrayUpperStartIndex:D,liquidity:new zi(0),amountMaxA:E==="MintA"?O:z,amountMaxB:E==="MintA"?z:O,withMetadata:B==="create",baseFlag:E==="MintA",optionBaseFlag:1},xe);let ue=Buffer.from([...Ue.openPosition,...xe]);return new Ge({keys:le,programId:e,data:ue})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:m}){let l,d=[];if(m)l=new K((await m(1))[0]);else{let O=Fn.generate();d.push(O),l=O.publicKey}let[p,g]=[new K(e.programId),new K(e.id)],f=L.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=L.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:A}=te(p,g,f),{publicKey:T}=te(p,g,y),{publicKey:w}=ze(n.wallet,l,we),{publicKey:C}=Zt(l),{publicKey:D}=We(p,l),{publicKey:B}=mt(p,g,r,o),E=this.openPositionFromLiquidityInstruction(p,n.wallet,g,n.wallet,l,w,C,B,A,T,D,n.tokenAccountA,n.tokenAccountB,new K(t.vault.A),new K(t.vault.B),new K(t.mintA.address),new K(t.mintB.address),r,o,f,y,s,a,u,c,ye.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,y])?Ce(p,g).publicKey:void 0);return{address:{nftMint:l,tickArrayLower:A,tickArrayUpper:T,positionNftAccount:w,metadataAccount:C,personalPosition:D,protocolPosition:B},instructions:[E],signers:d,instructionTypes:[re.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,r,o){let s=F([]),a=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:Lt.programId,isSigner:!1,isWritable:!1},{pubkey:we,isSigner:!1,isWritable:!1}],u=Buffer.alloc(s.span);s.encode({},u);let c=Buffer.from([...Ue.closePosition,...u]);return new Ge({keys:a,programId:e,data:c})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:r}){let o=new K(e.programId),{publicKey:s}=ze(n.wallet,r.nftMint,we),{publicKey:a}=We(o,r.nftMint),u=[];return u.push(this.closePositionInstruction(o,n.wallet,r.nftMint,s,a)),{address:{positionNftAccount:s,personalPosition:a},signers:[],instructions:u,instructionTypes:[re.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,r,o,s,a,u,c,m,l,d,p,g,f,y,A,T){let w=F([G("liquidity"),b("amountMaxA"),b("amountMaxB"),W("optionBaseFlag"),Ee("baseFlag")]),C=[...T?[{pubkey:T,isSigner:!1,isWritable:!0}]:[]],D=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:we,isSigner:!1,isWritable:!1},{pubkey:at,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...C],B=Buffer.alloc(w.span);w.encode({liquidity:f,amountMaxA:y,amountMaxB:A,optionBaseFlag:0,baseFlag:!1},B);let E=Buffer.from([...Ue.increaseLiquidity,...B]);return new Ge({keys:D,programId:e,data:E})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMaxA:s,amountMaxB:a}){let[u,c]=[new K(e.programId),new K(e.id)],m=L.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),l=L.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=te(u,c,m),{publicKey:p}=te(u,c,l),{publicKey:g}=ze(r.wallet,n.nftMint,we),{publicKey:f}=We(u,n.nftMint),{publicKey:y}=mt(u,c,n.tickLower,n.tickUpper),A=this.increasePositionFromLiquidityInstruction(u,r.wallet,g,f,c,y,d,p,r.tokenAccountA,r.tokenAccountB,new K(t.vault.A),new K(t.vault.B),new K(e.mintA.address),new K(e.mintB.address),o,s,a,ye.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,l])?Ce(u,c).publicKey:void 0);return{address:{tickArrayLower:d,tickArrayUpper:p,positionNftAccount:g,personalPosition:f,protocolPosition:y},signers:[],instructions:[A],instructionTypes:[re.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,base:o,baseAmount:s,otherAmountMax:a}){let[u,c]=[new K(e.programId),new K(e.id)],m=L.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),l=L.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=te(u,c,m),{publicKey:p}=te(u,c,l),{publicKey:g}=ze(r.wallet,n.nftMint,we),{publicKey:f}=We(u,n.nftMint),{publicKey:y}=mt(u,c,n.tickLower,n.tickUpper);return{address:{tickArrayLower:d,tickArrayUpper:p,positionNftAccount:g,personalPosition:f,protocolPosition:y},instructions:[this.increasePositionFromBaseInstruction(u,r.wallet,g,f,c,y,d,p,r.tokenAccountA,r.tokenAccountB,new K(t.vault.A),new K(t.vault.B),new K(e.mintA.address),new K(e.mintB.address),o,s,a,ye.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,l])?Ce(u,c).publicKey:void 0)],signers:[],instructionTypes:[re.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,r,o,s,a,u,c,m,l,d,p,g,f,y,A,T){let w=F([G("liquidity"),b("amountMaxA"),b("amountMaxB"),W("optionBaseFlag"),Ee("baseFlag")]),C=[...T?[{pubkey:T,isSigner:!1,isWritable:!0}]:[]],D=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:we,isSigner:!1,isWritable:!1},{pubkey:at,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...C],B=Buffer.alloc(w.span);w.encode({liquidity:new zi(0),amountMaxA:f==="MintA"?y:A,amountMaxB:f==="MintA"?A:y,baseFlag:f==="MintA",optionBaseFlag:1},B);let E=Buffer.from([...Ue.increaseLiquidity,...B]);return new Ge({keys:D,programId:e,data:E})}static decreaseLiquidityInstruction(e,t,n,r,o,s,a,u,c,m,l,d,p,g,f,y,A,T,w){let C=F([G("liquidity"),b("amountMinA"),b("amountMinB")]),D=[...w?[{pubkey:w,isSigner:!1,isWritable:!0}]:[],...f.map(z=>[{pubkey:z.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:z.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:z.rewardMint,isSigner:!1,isWritable:!1}]).flat()],B=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:we,isSigner:!1,isWritable:!1},{pubkey:at,isSigner:!1,isWritable:!1},{pubkey:qt,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...D],E=Buffer.alloc(C.span);C.encode({liquidity:y,amountMinA:A,amountMinB:T},E);let O=Buffer.from([...Ue.decreaseLiquidity,...E]);return new Ge({keys:B,programId:e,data:O})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMinA:s,amountMinB:a,programId:u}){let[c,m]=[new K(e.programId),new K(e.id)],l=L.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=L.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:p}=te(c,m,l),{publicKey:g}=te(c,m,d),{publicKey:f}=ze(r.wallet,n.nftMint,u),{publicKey:y}=We(c,n.nftMint),{publicKey:A}=mt(c,m,n.tickLower,n.tickUpper),T=[];for(let C=0;C<e.rewardDefaultInfos.length;C++)T.push({poolRewardVault:new K(t.rewardInfos[C].vault),ownerRewardVault:r.rewardAccounts[C],rewardMint:new K(e.rewardDefaultInfos[C].mint.address)});let w=[];return w.push(this.decreaseLiquidityInstruction(c,r.wallet,f,y,m,A,p,g,r.tokenAccountA,r.tokenAccountB,new K(t.vault.A),new K(t.vault.B),new K(e.mintA.address),new K(e.mintB.address),T,o,s,a,ye.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,d])?Ce(c,m).publicKey:void 0)),{address:{tickArrayLower:p,tickArrayUpper:g,positionNftAccount:f,personalPosition:y,protocolPosition:A},signers:[],instructions:w,instructionTypes:[re.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,r,o,s,a,u,c,m,l,d,p,g,f,y,A){let T=F([b("amount"),b("otherAmountThreshold"),G("sqrtPriceLimitX64"),Ee("isBaseInput")]),w=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[],...l.map(E=>({pubkey:E,isSigner:!1,isWritable:!0}))],C=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:we,isSigner:!1,isWritable:!1},{pubkey:at,isSigner:!1,isWritable:!1},{pubkey:qt,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},...w],D=Buffer.alloc(T.span);T.encode({amount:p,otherAmountThreshold:g,sqrtPriceLimitX64:f,isBaseInput:y},D);let B=Buffer.from([...Ue.swap,...D]);return new Ge({keys:C,programId:e,data:B})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,inputMint:o,amountIn:s,amountOutMin:a,sqrtPriceLimitX64:u,remainingAccounts:c}){let[m,l]=[new K(e.programId),new K(e.id)],[d,p]=[new K(t.vault.A),new K(t.vault.B)],[g,f]=[new K(e.mintA.address),new K(e.mintB.address)],y=e.mintA.address===o.toString(),A=[this.swapInstruction(m,r.wallet,l,new K(e.config.id),y?r.tokenAccountA:r.tokenAccountB,y?r.tokenAccountB:r.tokenAccountA,y?d:p,y?p:d,y?g:f,y?f:g,c,n,s,a,u,!0,Ce(m,l).publicKey)];return{signers:[],instructions:A,instructionTypes:[re.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static makeSwapBaseOutInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,outputMint:o,amountOut:s,amountInMax:a,sqrtPriceLimitX64:u,remainingAccounts:c}){let[m,l]=[new K(e.programId),new K(e.id)],[d,p]=[new K(t.vault.A),new K(t.vault.B)],[g,f]=[new K(e.mintA.address),new K(e.mintB.address)],y=e.mintA.address===o.toBase58(),A=[this.swapInstruction(m,r.wallet,l,new K(e.config.id),y?r.tokenAccountB:r.tokenAccountA,y?r.tokenAccountA:r.tokenAccountB,y?p:d,y?d:p,y?f:g,y?g:f,c,n,s,a,u,!1,Ce(m,l).publicKey)];return{signers:[],instructions:A,instructionTypes:[re.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,r,o,s,a,u,c,m,l,d){let p=F([b("openTime"),b("endTime"),G("emissionsPerSecondX64")]),g=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:Lt.programId,isSigner:!1,isWritable:!1},{pubkey:ut,isSigner:!1,isWritable:!1}],f=Buffer.alloc(p.span);p.encode({openTime:ae(m),endTime:ae(l),emissionsPerSecondX64:d},f);let y=Buffer.from([...Ue.initReward,...f]);return new Ge({keys:g,programId:e,data:y})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new K(e.programId),new K(e.id)],a=Mi(o,s,r.mint).publicKey,u=jt(o).publicKey,c=[this.initRewardInstruction(o,n.wallet,s,u,new K(e.config.id),n.tokenAccount,r.programId,r.mint,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:u},signers:[],instructions:c,instructionTypes:[re.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,r,o,s,a,u,c,m,l,d){let p=F([W("rewardIndex"),G("emissionsPerSecondX64"),b("openTime"),b("endTime")]),g=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:we,isSigner:!1,isWritable:!1},{pubkey:at,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0}],f=Buffer.alloc(p.span);p.encode({rewardIndex:c,emissionsPerSecondX64:d,openTime:ae(m),endTime:ae(l)},f);let y=Buffer.from([...Ue.setRewardEmissions,...f]);return new Ge({keys:g,programId:e,data:y})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new K(e.programId),new K(e.id)],a,u,c;for(let d=0;d<e.rewardDefaultInfos.length;d++)e.rewardDefaultInfos[d].mint.address===r.mint.toString()&&(a=d,u=new K(t.rewardInfos[d].vault),c=new K(t.rewardInfos[d].mint.address));(a===void 0||u===void 0)&&Qi.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let m=jt(o).publicKey,l=[this.setRewardInstruction(o,n.wallet,s,m,new K(e.config.id),n.tokenAccount,u,c,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{rewardVault:u,operationId:m},signers:[],instructions:l,instructionTypes:[re.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,r,o,s,a){let u=F([W("rewardIndex")]),c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:we,isSigner:!1,isWritable:!1},{pubkey:at,isSigner:!1,isWritable:!1},{pubkey:qt,isSigner:!1,isWritable:!1}],m=Buffer.alloc(u.span);u.encode({rewardIndex:a},m);let l=Buffer.from([...Ue.collectReward,...m]);return new Ge({keys:c,programId:e,data:l})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:r}){let[o,s]=[new K(e.programId),new K(e.id)],a,u;for(let m=0;m<e.rewardDefaultInfos.length;m++)e.rewardDefaultInfos[m].mint.address===r.toString()&&(a=m,u=new K(t.rewardInfos[m].vault));(a===void 0||u===void 0)&&Qi.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let c=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,u,r,a)];return{address:{rewardVault:u},signers:[],instructions:c,instructionTypes:[re.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}};import by from"bn.js";import{AccountLayout as gy,TOKEN_PROGRAM_ID as Ay}from"@solana/spl-token";import Ts from"bn.js";var qy=F([Oe("mintAuthorityOption"),S("mintAuthority"),b("supply"),W("decimals"),W("isInitialized"),Oe("freezeAuthorityOption"),S("freezeAuthority")]);import{TOKEN_PROGRAM_ID as vn,TOKEN_2022_PROGRAM_ID as ys,ASSOCIATED_TOKEN_PROGRAM_ID as gs}from"@solana/spl-token";import{PublicKey as R,TransactionInstruction as _n,SystemProgram as Dn}from"@solana/web3.js";import ft from"bn.js";function og(i,e,t,n,r,o,s,a,u,c,m,l){let d=F([W("instruction"),b("amountIn"),b("amountOut")]),p=[{pubkey:Dn.programId,isSigner:!1,isWritable:!1},{pubkey:vn,isSigner:!1,isWritable:!1},{pubkey:new R(t.programId),isSigner:!1,isWritable:!1},{pubkey:new R(t.id),isSigner:!1,isWritable:!0},{pubkey:new R(n.id),isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let f=Re(t);p.push({pubkey:f.config.id,isSigner:!1,isWritable:!1},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.mintA.address.equals(u)?f.vault.A:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.mintA.address.equals(u)?f.vault.B:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0},...l.map(y=>({pubkey:y,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let f=Re(t);p.push({pubkey:f.authority,isSigner:!1,isWritable:!1},{pubkey:f.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:new R("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:f.openOrders,isSigner:!1,isWritable:!0},{pubkey:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.marketId,isSigner:!1,isWritable:!0},{pubkey:f.marketBids,isSigner:!1,isWritable:!0},{pubkey:f.marketAsks,isSigner:!1,isWritable:!0},{pubkey:f.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0})}else{let f=Re(t);p.push({pubkey:f.authority,isSigner:!1,isWritable:!1},{pubkey:f.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:f.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:f.openOrders,isSigner:!1,isWritable:!0},{pubkey:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.marketId,isSigner:!1,isWritable:!0},{pubkey:f.marketBids,isSigner:!1,isWritable:!0},{pubkey:f.marketAsks,isSigner:!1,isWritable:!0},{pubkey:f.marketEventQueue,isSigner:!1,isWritable:!0},...f.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:f.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:f.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0}])}let g=Buffer.alloc(d.span);return d.encode({instruction:4,amountIn:c,amountOut:m},g),new _n({keys:p,programId:i,data:g})}function sg(i,e,t,n,r,o,s,a,u,c){let m=F([W("instruction")]),l=[{pubkey:Dn.programId,isSigner:!1,isWritable:!1},{pubkey:vn,isSigner:!1,isWritable:!1},{pubkey:new R(String(n.programId)),isSigner:!1,isWritable:!1},{pubkey:new R(String(n.id)),isSigner:!1,isWritable:!0},{pubkey:new R(String(t.id)),isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let p=Re(n);l.push({pubkey:p.config.id,isSigner:!1,isWritable:!1},{pubkey:p.id,isSigner:!1,isWritable:!0},{pubkey:p.mintA.address.equals(u)?p.vault.A:p.vault.B,isSigner:!1,isWritable:!0},{pubkey:p.mintA.address.equals(u)?p.vault.B:p.vault.A,isSigner:!1,isWritable:!0},{pubkey:p.id,isSigner:!1,isWritable:!0},...c.map(g=>({pubkey:g,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let p=Re(n);l.push({pubkey:p.authority,isSigner:!1,isWritable:!1},{pubkey:p.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:p.id,isSigner:!1,isWritable:!0},{pubkey:new R("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:p.openOrders,isSigner:!1,isWritable:!0},{pubkey:p.vault.A,isSigner:!1,isWritable:!0},{pubkey:p.vault.B,isSigner:!1,isWritable:!0},{pubkey:p.marketId,isSigner:!1,isWritable:!0},{pubkey:p.marketBids,isSigner:!1,isWritable:!0},{pubkey:p.marketAsks,isSigner:!1,isWritable:!0},{pubkey:p.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:p.id,isSigner:!1,isWritable:!0},{pubkey:p.id,isSigner:!1,isWritable:!0})}else{let p=Re(n);l.push({pubkey:p.authority,isSigner:!1,isWritable:!1},{pubkey:p.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:p.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:p.openOrders,isSigner:!1,isWritable:!0},{pubkey:p.vault.A,isSigner:!1,isWritable:!0},{pubkey:p.vault.B,isSigner:!1,isWritable:!0},{pubkey:p.marketId,isSigner:!1,isWritable:!0},{pubkey:p.marketBids,isSigner:!1,isWritable:!0},{pubkey:p.marketAsks,isSigner:!1,isWritable:!0},{pubkey:p.marketEventQueue,isSigner:!1,isWritable:!0},...p.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:p.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:p.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:p.id,isSigner:!1,isWritable:!0},{pubkey:p.id,isSigner:!1,isWritable:!0}])}let d=Buffer.alloc(m.span);return m.encode({instruction:5},d),new _n({keys:l,programId:i,data:d})}function As(i,e,t,n,r,o,s,a,u,c,m,l,d,p,g){var B;let f=[],y=[k({pubkey:vn,isWritable:!1}),k({pubkey:ys,isWritable:!1}),k({pubkey:gs,isWritable:!1}),k({pubkey:Dn.programId,isWritable:!1}),k({pubkey:e,isSigner:!0})];y.push(k({pubkey:t})),y.push(k({pubkey:r}));let A=[u,c],T=[m,l],w=[o,s,a];for(let E=0;E<A.length;E++){let O=A[E],z=w[E]===O.mintA.address;if(y.push(k({pubkey:new R(O.programId),isWritable:!1})),E===A.length-1?y.push(k({pubkey:r})):y.push(k({pubkey:n})),y.push(k({pubkey:new R(w[E])})),y.push(k({pubkey:new R(w[E+1])})),O.version===6){let h=T[E];y.push(k({pubkey:new R(h.config.id)})),y.push(k({pubkey:new R(h.id)})),y.push(k({pubkey:new R(z?h.vault.A:h.vault.B)})),y.push(k({pubkey:new R(z?h.vault.B:h.vault.A)})),y.push(k({pubkey:new R(O.observationId)})),y.push(k({pubkey:pn})),y.push(k({pubkey:Ce(new R(O.programId),new R(O.id)).publicKey})),f.push(Ps(O.sqrtPriceX64.toString(),z));for(let v of(B=g[E])!=null?B:[])y.push(k({pubkey:new R(v)}))}else if(O.version===5){let h=T[E];y.push(k({pubkey:new R(h.id)})),y.push(k({pubkey:new R(h.authority),isWritable:!1})),y.push(k({pubkey:new R(h.marketProgramId)})),y.push(k({pubkey:new R(h.marketAuthority)})),y.push(k({pubkey:bi,isWritable:!1})),y.push(k({pubkey:new R(h.openOrders)})),y.push(k({pubkey:new R(h.vault.A)})),y.push(k({pubkey:new R(h.vault.B)})),y.push(k({pubkey:new R(h.id)})),y.push(k({pubkey:new R(h.id)})),y.push(k({pubkey:new R(h.id)})),y.push(k({pubkey:new R(h.id)})),y.push(k({pubkey:new R(h.id)})),y.push(k({pubkey:new R(h.id)})),y.push(k({pubkey:new R(h.marketId)})),y.push(k({pubkey:new R(h.marketBids)})),y.push(k({pubkey:new R(h.marketAsks)})),y.push(k({pubkey:new R(h.marketEventQueue)})),y.push(k({pubkey:new R(h.marketBaseVault)})),y.push(k({pubkey:new R(h.marketQuoteVault)}))}else if(O.version===4){let h=T[E],v=O.status!==1;y.push(k({pubkey:new R(h.id)})),y.push(k({pubkey:new R(h.authority),isWritable:!1})),y.push(k({pubkey:new R(v?h.id:h.marketProgramId)})),y.push(k({pubkey:new R(v?h.id:h.marketAuthority)})),y.push(k({pubkey:new R(v?h.id:h.openOrders)})),y.push(k({pubkey:new R(h.vault.A)})),y.push(k({pubkey:new R(h.vault.B)})),y.push(k({pubkey:new R(v?h.id:h.marketId)})),y.push(k({pubkey:new R(v?h.id:h.marketBids)})),y.push(k({pubkey:new R(v?h.id:h.marketAsks)})),y.push(k({pubkey:new R(v?h.id:h.marketEventQueue)})),y.push(k({pubkey:new R(v?h.id:h.marketBaseVault)})),y.push(k({pubkey:new R(v?h.id:h.marketQuoteVault)}))}else if(O.version===7){let h=T[E];y.push(k({pubkey:new R(h.authority)})),y.push(k({pubkey:new R(h.config.id)})),y.push(k({pubkey:new R(h.id)})),y.push(k({pubkey:new R(z?h.vault.A:h.vault.B)})),y.push(k({pubkey:new R(z?h.vault.B:h.vault.A)})),y.push(k({pubkey:new R(O.observationId)}))}else throw Error("pool type error")}let C=F([W("insId"),b("amountIn"),b("amountOut"),Z(G(),f.length,"clmmPriceLimit")]),D=Buffer.alloc(C.span);return C.encode({insId:0,amountIn:d,amountOut:p,clmmPriceLimit:f},D),new _n({keys:y,programId:i,data:D})}function Ps(i,e){if(i)if(e){let t=new ft(i).div(new ft(25));return t.gt($t)?t:$t}else{let t=new ft(i).mul(new ft(25));return t.lt(en)?t:en}else return e?$t:en}function ks({routeProgram:i,ownerInfo:e,inputMint:t,swapInfo:n}){var r,o,s,a,u,c,m;if(n.routeType==="amm")if(n.poolInfo[0].version===6){let l=n.poolKey[0],d=Re(l),p=t.equals(d.mintA.address)?Qe.add(Le):Ye.sub(Le);return Mt.makeSwapBaseInInstructions({poolInfo:l,poolKeys:l,observationId:n.poolInfo[0].observationId,ownerInfo:{wallet:e.wallet,tokenAccountA:d.mintA.address.equals(t)?e.sourceToken:e.destinationToken,tokenAccountB:d.mintA.address.equals(t)?e.destinationToken:e.sourceToken},inputMint:t,amountIn:n.amountIn.amount.raw,amountOutMin:n.minAmountOut.amount.raw.sub((o=(r=n.minAmountOut.fee)==null?void 0:r.raw)!=null?o:new ft(0)),sqrtPriceLimitX64:p,remainingAccounts:(s=n.remainingAccounts[0])!=null?s:[]})}else if(n.poolInfo[0].version===7){let l=n.poolInfo[0],d=t.toString()===n.poolInfo[0].mintA.address;return{signers:[],instructions:[Ui(l.programId,e.wallet,l.authority,l.configId,l.id,e.sourceToken,e.destinationToken,d?l.vaultA:l.vaultB,d?l.vaultB:l.vaultA,d?l.mintProgramA:l.mintProgramB,d?l.mintProgramB:l.mintProgramA,new R(l[d?"mintA":"mintB"].address),new R(l[d?"mintB":"mintA"].address),l.observationId,n.amountIn.amount.raw,n.minAmountOut.amount.raw)],lookupTableAddress:[],instructionTypes:[d?re.CpmmSwapBaseIn:re.CpmmSwapBaseOut],address:{}}}else{let l=n.poolKey[0];return{signers:[],instructions:[Ki({poolKeys:l,version:n.poolInfo[0].pooltype.includes("StablePool")?5:4,userKeys:{tokenAccountIn:e.sourceToken,tokenAccountOut:e.destinationToken,owner:e.wallet},amountIn:n.amountIn.amount.raw,amountOut:n.minAmountOut.amount.raw.sub((u=(a=n.minAmountOut.fee)==null?void 0:a.raw)!=null?u:new ft(0)),fixedSide:"in"})],lookupTableAddress:l.lookupTableAccount?[l.lookupTableAccount]:[],instructionTypes:[n.poolInfo[0].pooltype.includes("StablePool")?re.AmmV5SwapBaseIn:re.AmmV4SwapBaseIn],address:{}}}else if(n.routeType==="route"){let l=n.poolInfo[0],d=n.poolInfo[1],p=n.poolKey[0],g=n.poolKey[1];if(e.routeToken===void 0)throw Error("owner route token account check error");return{signers:[],instructions:[As(i,e.wallet,e.sourceToken,e.routeToken,e.destinationToken,t.toString(),n.middleToken.mint.toString(),n.outputMint.toString(),l,d,p,g,n.amountIn.amount.raw,n.minAmountOut.amount.raw.sub((m=(c=n.minAmountOut.fee)==null?void 0:c.raw)!=null?m:new ft(0)),n.remainingAccounts)],instructionTypes:[re.RouteSwap],lookupTableAddress:[p.lookupTableAccount,g.lookupTableAccount].filter(f=>f!==void 0),address:{}}}else throw Error("route type error")}var ws={[fi.toBase58()]:3};var hs=F([fe(5),fe(8),S("ownAddress"),b("vaultSignerNonce"),S("baseMint"),S("quoteMint"),S("baseVault"),b("baseDepositsTotal"),b("baseFeesAccrued"),S("quoteVault"),b("quoteDepositsTotal"),b("quoteFeesAccrued"),b("quoteDustThreshold"),S("requestQueue"),S("eventQueue"),S("bids"),S("asks"),b("baseLotSize"),b("quoteLotSize"),b("feeRateBps"),b("referrerRebatesAccrued"),fe(7)]);import{PublicKey as yg}from"@solana/web3.js";var wg=ie("Serum");var dA=new Ts(0);export{ks as makeSwapInstruction,og as route1Instruction,sg as route2Instruction,As as routeInstruction};
//# sourceMappingURL=index.mjs.map