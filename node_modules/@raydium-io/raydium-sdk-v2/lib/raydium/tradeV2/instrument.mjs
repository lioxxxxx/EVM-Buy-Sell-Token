var Gi=Object.defineProperty,Ui=Object.defineProperties;var Xi=Object.getOwnPropertyDescriptors;var Vn=Object.getOwnPropertySymbols;var zi=Object.prototype.hasOwnProperty,Hi=Object.prototype.propertyIsEnumerable;var qn=(i,e,t)=>e in i?Gi(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,J=(i,e)=>{for(var t in e||(e={}))zi.call(e,t)&&qn(i,t,e[t]);if(Vn)for(var t of Vn(e))Hi.call(e,t)&&qn(i,t,e[t]);return i},ee=(i,e)=>Ui(i,Xi(e));import{TOKEN_PROGRAM_ID as vn,TOKEN_2022_PROGRAM_ID as os,ASSOCIATED_TOKEN_PROGRAM_ID as ss}from"@solana/spl-token";import{PublicKey as C,TransactionInstruction as Wn,SystemProgram as _n}from"@solana/web3.js";import pt from"bn.js";import{PublicKey as Zd}from"@solana/web3.js";var ft=9e15,nt=1e9,nn="0123456789abcdef",Mt="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Et="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",rn={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-ft,maxE:ft,crypto:!1},zn,Qe,D=!0,vt="[DecimalError] ",tt=vt+"Invalid argument: ",Hn=vt+"Precision limit exceeded",Qn=vt+"crypto unavailable",Zn="[object Decimal]",Pe=Math.floor,de=Math.pow,Qi=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Zi=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,Yi=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Yn=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,ve=1e7,v=7,ji=9007199254740991,Ji=Mt.length-1,on=Et.length-1,w={toStringTag:Zn};w.absoluteValue=w.abs=function(){var i=new this.constructor(this);return i.s<0&&(i.s=1),O(i)};w.ceil=function(){return O(new this.constructor(this),this.e+1,2)};w.clampedTo=w.clamp=function(i,e){var t,n=this,r=n.constructor;if(i=new r(i),e=new r(e),!i.s||!e.s)return new r(NaN);if(i.gt(e))throw Error(tt+e);return t=n.cmp(i),t<0?i:n.cmp(e)>0?e:new r(n)};w.comparedTo=w.cmp=function(i){var e,t,n,r,o=this,s=o.d,a=(i=new o.constructor(i)).d,u=o.s,c=i.s;if(!s||!a)return!u||!c?NaN:u!==c?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-c:0;if(u!==c)return u;if(o.e!==i.e)return o.e>i.e^u<0?1:-1;for(n=s.length,r=a.length,e=0,t=n<r?n:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^u<0?1:-1;return n===r?0:n>r^u<0?1:-1};w.cosine=w.cos=function(){var i,e,t=this,n=t.constructor;return t.d?t.d[0]?(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+v,n.rounding=1,t=$i(n,ti(n,t)),n.precision=i,n.rounding=e,O(Qe==2||Qe==3?t.neg():t,i,e,!0)):new n(1):new n(NaN)};w.cubeRoot=w.cbrt=function(){var i,e,t,n,r,o,s,a,u,c,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(D=!1,o=l.s*de(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=ke(l.d),i=l.e,(o=(i-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=de(t,1/3),i=Pe((i+1)/3)-(i%3==(i<0?-1:2)),o==1/0?t="5e"+i:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+i),n=new m(t),n.s=l.s):n=new m(o.toString()),s=(i=m.precision)+3;;)if(a=n,u=a.times(a).times(a),c=u.plus(l),n=ne(c.plus(l).times(a),c.plus(u),s+2,1),ke(a.d).slice(0,s)===(t=ke(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(O(a,i+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(O(n,i+1,1),e=!n.times(n).times(n).eq(l));break}return D=!0,O(n,i,m.rounding,e)};w.decimalPlaces=w.dp=function(){var i,e=this.d,t=NaN;if(e){if(i=e.length-1,t=(i-Pe(this.e/v))*v,i=e[i],i)for(;i%10==0;i/=10)t--;t<0&&(t=0)}return t};w.dividedBy=w.div=function(i){return ne(this,new this.constructor(i))};w.dividedToIntegerBy=w.divToInt=function(i){var e=this,t=e.constructor;return O(ne(e,new t(i),0,1,1),t.precision,t.rounding)};w.equals=w.eq=function(i){return this.cmp(i)===0};w.floor=function(){return O(new this.constructor(this),this.e+1,3)};w.greaterThan=w.gt=function(i){return this.cmp(i)>0};w.greaterThanOrEqualTo=w.gte=function(i){var e=this.cmp(i);return e==1||e===0};w.hyperbolicCosine=w.cosh=function(){var i,e,t,n,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(i=Math.ceil(r/3),e=(1/_t(4,i)).toString()):(i=16,e="2.3283064365386962890625e-10"),o=bt(s,1,o.times(e),new s(1),!0);for(var u,c=i,l=new s(8);c--;)u=o.times(o),o=a.minus(u.times(l.minus(u.times(l))));return O(o,s.precision=t,s.rounding=n,!0)};w.hyperbolicSine=w.sinh=function(){var i,e,t,n,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,n=r.d.length,n<3)r=bt(o,2,r,r,!0);else{i=1.4*Math.sqrt(n),i=i>16?16:i|0,r=r.times(1/_t(5,i)),r=bt(o,2,r,r,!0);for(var s,a=new o(5),u=new o(16),c=new o(20);i--;)s=r.times(r),r=r.times(a.plus(s.times(u.times(s).plus(c))))}return o.precision=e,o.rounding=t,O(r,e,t,!0)};w.hyperbolicTangent=w.tanh=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+7,n.rounding=1,ne(t.sinh(),t.cosh(),n.precision=i,n.rounding=e)):new n(t.s)};w.inverseCosine=w.acos=function(){var i,e=this,t=e.constructor,n=e.abs().cmp(1),r=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?Fe(t,r,o):new t(0):new t(NaN):e.isZero()?Fe(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),i=Fe(t,r+4,o).times(.5),t.precision=r,t.rounding=o,i.minus(e))};w.inverseHyperbolicCosine=w.acosh=function(){var i,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(i=n.precision,e=n.rounding,n.precision=i+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,D=!1,t=t.times(t).minus(1).sqrt().plus(t),D=!0,n.precision=i,n.rounding=e,t.ln()):new n(t)};w.inverseHyperbolicSine=w.asinh=function(){var i,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,D=!1,t=t.times(t).plus(1).sqrt().plus(t),D=!0,n.precision=i,n.rounding=e,t.ln())};w.inverseHyperbolicTangent=w.atanh=function(){var i,e,t,n,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(i=o.precision,e=o.rounding,n=r.sd(),Math.max(n,i)<2*-r.e-1?O(new o(r),i,e,!0):(o.precision=t=n-r.e,r=ne(r.plus(1),new o(1).minus(r),t+i,1),o.precision=i+4,o.rounding=1,r=r.ln(),o.precision=i,o.rounding=e,r.times(.5))):new o(NaN)};w.inverseSine=w.asin=function(){var i,e,t,n,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(i=Fe(o,t+4,n).times(.5),i.s=r.s,i):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,r.times(2)))};w.inverseTangent=w.atan=function(){var i,e,t,n,r,o,s,a,u,c=this,l=c.constructor,m=l.precision,d=l.rounding;if(c.isFinite()){if(c.isZero())return new l(c);if(c.abs().eq(1)&&m+4<=on)return s=Fe(l,m+4,d).times(.25),s.s=c.s,s}else{if(!c.s)return new l(NaN);if(m+4<=on)return s=Fe(l,m+4,d).times(.5),s.s=c.s,s}for(l.precision=a=m+10,l.rounding=1,t=Math.min(28,a/v+2|0),i=t;i;--i)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(D=!1,e=Math.ceil(a/v),n=1,u=c.times(c),s=new l(c),r=c;i!==-1;)if(r=r.times(u),o=s.minus(r.div(n+=2)),r=r.times(u),s=o.plus(r.div(n+=2)),s.d[e]!==void 0)for(i=e;s.d[i]===o.d[i]&&i--;);return t&&(s=s.times(2<<t-1)),D=!0,O(s,l.precision=m,l.rounding=d,!0)};w.isFinite=function(){return!!this.d};w.isInteger=w.isInt=function(){return!!this.d&&Pe(this.e/v)>this.d.length-2};w.isNaN=function(){return!this.s};w.isNegative=w.isNeg=function(){return this.s<0};w.isPositive=w.isPos=function(){return this.s>0};w.isZero=function(){return!!this.d&&this.d[0]===0};w.lessThan=w.lt=function(i){return this.cmp(i)<0};w.lessThanOrEqualTo=w.lte=function(i){return this.cmp(i)<1};w.logarithm=w.log=function(i){var e,t,n,r,o,s,a,u,c=this,l=c.constructor,m=l.precision,d=l.rounding,p=5;if(i==null)i=new l(10),e=!0;else{if(i=new l(i),t=i.d,i.s<0||!t||!t[0]||i.eq(1))return new l(NaN);e=i.eq(10)}if(t=c.d,c.s<0||!t||!t[0]||c.eq(1))return new l(t&&!t[0]?-1/0:c.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(D=!1,a=m+p,s=et(c,a),n=e?Ft(l,a+10):et(i,a),u=ne(s,n,a,1),wt(u.d,r=m,d))do if(a+=10,s=et(c,a),n=e?Ft(l,a+10):et(i,a),u=ne(s,n,a,1),!o){+ke(u.d).slice(r+1,r+15)+1==1e14&&(u=O(u,m+1,0));break}while(wt(u.d,r+=10,d));return D=!0,O(u,m,d)};w.minus=w.sub=function(i){var e,t,n,r,o,s,a,u,c,l,m,d,p=this,y=p.constructor;if(i=new y(i),!p.d||!i.d)return!p.s||!i.s?i=new y(NaN):p.d?i.s=-i.s:i=new y(i.d||p.s!==i.s?p:NaN),i;if(p.s!=i.s)return i.s=-i.s,p.plus(i);if(c=p.d,d=i.d,a=y.precision,u=y.rounding,!c[0]||!d[0]){if(d[0])i.s=-i.s;else if(c[0])i=new y(p);else return new y(u===3?-0:0);return D?O(i,a,u):i}if(t=Pe(i.e/v),l=Pe(p.e/v),c=c.slice(),o=l-t,o){for(m=o<0,m?(e=c,o=-o,s=d.length):(e=d,t=l,s=c.length),n=Math.max(Math.ceil(a/v),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=c.length,s=d.length,m=n<s,m&&(s=n),n=0;n<s;n++)if(c[n]!=d[n]){m=c[n]<d[n];break}o=0}for(m&&(e=c,c=d,d=e,i.s=-i.s),s=c.length,n=d.length-s;n>0;--n)c[s++]=0;for(n=d.length;n>o;){if(c[--n]<d[n]){for(r=n;r&&c[--r]===0;)c[r]=ve-1;--c[r],c[n]+=ve}c[n]-=d[n]}for(;c[--s]===0;)c.pop();for(;c[0]===0;c.shift())--t;return c[0]?(i.d=c,i.e=Wt(c,t),D?O(i,a,u):i):new y(u===3?-0:0)};w.modulo=w.mod=function(i){var e,t=this,n=t.constructor;return i=new n(i),!t.d||!i.s||i.d&&!i.d[0]?new n(NaN):!i.d||t.d&&!t.d[0]?O(new n(t),n.precision,n.rounding):(D=!1,n.modulo==9?(e=ne(t,i.abs(),0,3,1),e.s*=i.s):e=ne(t,i,0,n.modulo,1),e=e.times(i),D=!0,t.minus(e))};w.naturalExponential=w.exp=function(){return sn(this)};w.naturalLogarithm=w.ln=function(){return et(this)};w.negated=w.neg=function(){var i=new this.constructor(this);return i.s=-i.s,O(i)};w.plus=w.add=function(i){var e,t,n,r,o,s,a,u,c,l,m=this,d=m.constructor;if(i=new d(i),!m.d||!i.d)return!m.s||!i.s?i=new d(NaN):m.d||(i=new d(i.d||m.s===i.s?m:NaN)),i;if(m.s!=i.s)return i.s=-i.s,m.minus(i);if(c=m.d,l=i.d,a=d.precision,u=d.rounding,!c[0]||!l[0])return l[0]||(i=new d(m)),D?O(i,a,u):i;if(o=Pe(m.e/v),n=Pe(i.e/v),c=c.slice(),r=o-n,r){for(r<0?(t=c,r=-r,s=l.length):(t=l,n=o,s=c.length),o=Math.ceil(a/v),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=c.length,r=l.length,s-r<0&&(r=s,t=l,l=c,c=t),e=0;r;)e=(c[--r]=c[r]+l[r]+e)/ve|0,c[r]%=ve;for(e&&(c.unshift(e),++n),s=c.length;c[--s]==0;)c.pop();return i.d=c,i.e=Wt(c,n),D?O(i,a,u):i};w.precision=w.sd=function(i){var e,t=this;if(i!==void 0&&i!==!!i&&i!==1&&i!==0)throw Error(tt+i);return t.d?(e=jn(t.d),i&&t.e+1>e&&(e=t.e+1)):e=NaN,e};w.round=function(){var i=this,e=i.constructor;return O(new e(i),i.e+1,e.rounding)};w.sine=w.sin=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+v,n.rounding=1,t=tr(n,ti(n,t)),n.precision=i,n.rounding=e,O(Qe>2?t.neg():t,i,e,!0)):new n(NaN)};w.squareRoot=w.sqrt=function(){var i,e,t,n,r,o,s=this,a=s.d,u=s.e,c=s.s,l=s.constructor;if(c!==1||!a||!a[0])return new l(!c||c<0&&(!a||a[0])?NaN:a?s:1/0);for(D=!1,c=Math.sqrt(+s),c==0||c==1/0?(e=ke(a),(e.length+u)%2==0&&(e+="0"),c=Math.sqrt(e),u=Pe((u+1)/2)-(u<0||u%2),c==1/0?e="5e"+u:(e=c.toExponential(),e=e.slice(0,e.indexOf("e")+1)+u),n=new l(e)):n=new l(c.toString()),t=(u=l.precision)+3;;)if(o=n,n=o.plus(ne(s,o,t+2,1)).times(.5),ke(o.d).slice(0,t)===(e=ke(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(O(o,u+1,0),o.times(o).eq(s))){n=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(O(n,u+1,1),i=!n.times(n).eq(s));break}return D=!0,O(n,u,l.rounding,i)};w.tangent=w.tan=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+10,n.rounding=1,t=t.sin(),t.s=1,t=ne(t,new n(1).minus(t.times(t)).sqrt(),i+10,0),n.precision=i,n.rounding=e,O(Qe==2||Qe==4?t.neg():t,i,e,!0)):new n(NaN)};w.times=w.mul=function(i){var e,t,n,r,o,s,a,u,c,l=this,m=l.constructor,d=l.d,p=(i=new m(i)).d;if(i.s*=l.s,!d||!d[0]||!p||!p[0])return new m(!i.s||d&&!d[0]&&!p||p&&!p[0]&&!d?NaN:!d||!p?i.s/0:i.s*0);for(t=Pe(l.e/v)+Pe(i.e/v),u=d.length,c=p.length,u<c&&(o=d,d=p,p=o,s=u,u=c,c=s),o=[],s=u+c,n=s;n--;)o.push(0);for(n=c;--n>=0;){for(e=0,r=u+n;r>n;)a=o[r]+p[n]*d[r-n-1]+e,o[r--]=a%ve|0,e=a/ve|0;o[r]=(o[r]+e)%ve|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),i.d=o,i.e=Wt(o,t),D?O(i,m.precision,m.rounding):i};w.toBinary=function(i,e){return un(this,2,i,e)};w.toDecimalPlaces=w.toDP=function(i,e){var t=this,n=t.constructor;return t=new n(t),i===void 0?t:(Ie(i,0,nt),e===void 0?e=n.rounding:Ie(e,0,8),O(t,i+t.e+1,e))};w.toExponential=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Ue(n,!0):(Ie(i,0,nt),e===void 0?e=r.rounding:Ie(e,0,8),n=O(new r(n),i+1,e),t=Ue(n,!0,i+1)),n.isNeg()&&!n.isZero()?"-"+t:t};w.toFixed=function(i,e){var t,n,r=this,o=r.constructor;return i===void 0?t=Ue(r):(Ie(i,0,nt),e===void 0?e=o.rounding:Ie(e,0,8),n=O(new o(r),i+r.e+1,e),t=Ue(n,!1,i+n.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};w.toFraction=function(i){var e,t,n,r,o,s,a,u,c,l,m,d,p=this,y=p.d,f=p.constructor;if(!y)return new f(p);if(c=t=new f(1),n=u=new f(0),e=new f(n),o=e.e=jn(y)-p.e-1,s=o%v,e.d[0]=de(10,s<0?v+s:s),i==null)i=o>0?e:c;else{if(a=new f(i),!a.isInt()||a.lt(c))throw Error(tt+a);i=a.gt(e)?o>0?e:c:a}for(D=!1,a=new f(ke(y)),l=f.precision,f.precision=o=y.length*v*2;m=ne(a,e,0,1,1),r=t.plus(m.times(n)),r.cmp(i)!=1;)t=n,n=r,r=c,c=u.plus(m.times(r)),u=r,r=e,e=a.minus(m.times(r)),a=r;return r=ne(i.minus(t),n,0,1,1),u=u.plus(r.times(c)),t=t.plus(r.times(n)),u.s=c.s=p.s,d=ne(c,n,o,1).minus(p).abs().cmp(ne(u,t,o,1).minus(p).abs())<1?[c,n]:[u,t],f.precision=l,D=!0,d};w.toHexadecimal=w.toHex=function(i,e){return un(this,16,i,e)};w.toNearest=function(i,e){var t=this,n=t.constructor;if(t=new n(t),i==null){if(!t.d)return t;i=new n(1),e=n.rounding}else{if(i=new n(i),e===void 0?e=n.rounding:Ie(e,0,8),!t.d)return i.s?t:i;if(!i.d)return i.s&&(i.s=t.s),i}return i.d[0]?(D=!1,t=ne(t,i,0,e,1).times(i),D=!0,O(t)):(i.s=t.s,t=i),t};w.toNumber=function(){return+this};w.toOctal=function(i,e){return un(this,8,i,e)};w.toPower=w.pow=function(i){var e,t,n,r,o,s,a=this,u=a.constructor,c=+(i=new u(i));if(!a.d||!i.d||!a.d[0]||!i.d[0])return new u(de(+a,c));if(a=new u(a),a.eq(1))return a;if(n=u.precision,o=u.rounding,i.eq(1))return O(a,n,o);if(e=Pe(i.e/v),e>=i.d.length-1&&(t=c<0?-c:c)<=ji)return r=Jn(u,a,t,n),i.s<0?new u(1).div(r):O(r,n,o);if(s=a.s,s<0){if(e<i.d.length-1)return new u(NaN);if((i.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=de(+a,c),e=t==0||!isFinite(t)?Pe(c*(Math.log("0."+ke(a.d))/Math.LN10+a.e+1)):new u(t+"").e,e>u.maxE+1||e<u.minE-1?new u(e>0?s/0:0):(D=!1,u.rounding=a.s=1,t=Math.min(12,(e+"").length),r=sn(i.times(et(a,n+t)),n),r.d&&(r=O(r,n+5,1),wt(r.d,n,o)&&(e=n+10,r=O(sn(i.times(et(a,e+t)),e),e+5,1),+ke(r.d).slice(n+1,n+15)+1==1e14&&(r=O(r,n+1,0)))),r.s=s,D=!0,u.rounding=o,O(r,n,o))};w.toPrecision=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Ue(n,n.e<=r.toExpNeg||n.e>=r.toExpPos):(Ie(i,1,nt),e===void 0?e=r.rounding:Ie(e,0,8),n=O(new r(n),i,e),t=Ue(n,i<=n.e||n.e<=r.toExpNeg,i)),n.isNeg()&&!n.isZero()?"-"+t:t};w.toSignificantDigits=w.toSD=function(i,e){var t=this,n=t.constructor;return i===void 0?(i=n.precision,e=n.rounding):(Ie(i,1,nt),e===void 0?e=n.rounding:Ie(e,0,8)),O(new n(t),i,e)};w.toString=function(){var i=this,e=i.constructor,t=Ue(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()&&!i.isZero()?"-"+t:t};w.truncated=w.trunc=function(){return O(new this.constructor(this),this.e+1,1)};w.valueOf=w.toJSON=function(){var i=this,e=i.constructor,t=Ue(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()?"-"+t:t};function ke(i){var e,t,n,r=i.length-1,o="",s=i[0];if(r>0){for(o+=s,e=1;e<r;e++)n=i[e]+"",t=v-n.length,t&&(o+=$e(t)),o+=n;s=i[e],n=s+"",t=v-n.length,t&&(o+=$e(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function Ie(i,e,t){if(i!==~~i||i<e||i>t)throw Error(tt+i)}function wt(i,e,t,n){var r,o,s,a;for(o=i[0];o>=10;o/=10)--e;return--e<0?(e+=v,r=0):(r=Math.ceil((e+1)/v),e%=v),o=de(10,v-e),a=i[r]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(i[r+1]/o/100|0)==de(10,e-2)-1||(a==o/2||a==0)&&(i[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(i[r+1]/o/1e3|0)==de(10,e-3)-1,s}function Ot(i,e,t){for(var n,r=[0],o,s=0,a=i.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=nn.indexOf(i.charAt(s++)),n=0;n<r.length;n++)r[n]>t-1&&(r[n+1]===void 0&&(r[n+1]=0),r[n+1]+=r[n]/t|0,r[n]%=t)}return r.reverse()}function $i(i,e){var t,n,r;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),r=(1/_t(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),i.precision+=t,e=bt(i,1,e.times(r),new i(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return i.precision-=t,e}var ne=function(){function i(n,r,o){var s,a=0,u=n.length;for(n=n.slice();u--;)s=n[u]*r+a,n[u]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,r,o,s){var a,u;if(o!=s)u=o>s?1:-1;else for(a=u=0;a<o;a++)if(n[a]!=r[a]){u=n[a]>r[a]?1:-1;break}return u}function t(n,r,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<r[o]?1:0,n[o]=a*s+n[o]-r[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,r,o,s,a,u){var c,l,m,d,p,y,f,b,k,T,P,I,W,B,E,K,z,h,F,fe,le=n.constructor,xe=n.s==r.s?1:-1,se=n.d,$=r.d;if(!se||!se[0]||!$||!$[0])return new le(!n.s||!r.s||(se?$&&se[0]==$[0]:!$)?NaN:se&&se[0]==0||!$?xe*0:xe/0);for(u?(p=1,l=n.e-r.e):(u=ve,p=v,l=Pe(n.e/p)-Pe(r.e/p)),F=$.length,z=se.length,k=new le(xe),T=k.d=[],m=0;$[m]==(se[m]||0);m++);if($[m]>(se[m]||0)&&l--,o==null?(B=o=le.precision,s=le.rounding):a?B=o+(n.e-r.e)+1:B=o,B<0)T.push(1),y=!0;else{if(B=B/p+2|0,m=0,F==1){for(d=0,$=$[0],B++;(m<z||d)&&B--;m++)E=d*u+(se[m]||0),T[m]=E/$|0,d=E%$|0;y=d||m<z}else{for(d=u/($[0]+1)|0,d>1&&($=i($,d,u),se=i(se,d,u),F=$.length,z=se.length),K=F,P=se.slice(0,F),I=P.length;I<F;)P[I++]=0;fe=$.slice(),fe.unshift(0),h=$[0],$[1]>=u/2&&++h;do d=0,c=e($,P,F,I),c<0?(W=P[0],F!=I&&(W=W*u+(P[1]||0)),d=W/h|0,d>1?(d>=u&&(d=u-1),f=i($,d,u),b=f.length,I=P.length,c=e(f,P,b,I),c==1&&(d--,t(f,F<b?fe:$,b,u))):(d==0&&(c=d=1),f=$.slice()),b=f.length,b<I&&f.unshift(0),t(P,f,I,u),c==-1&&(I=P.length,c=e($,P,F,I),c<1&&(d++,t(P,F<I?fe:$,I,u))),I=P.length):c===0&&(d++,P=[0]),T[m++]=d,c&&P[0]?P[I++]=se[K]||0:(P=[se[K]],I=1);while((K++<z||P[0]!==void 0)&&B--);y=P[0]!==void 0}T[0]||T.shift()}if(p==1)k.e=l,zn=y;else{for(m=1,d=T[0];d>=10;d/=10)m++;k.e=m+l*p-1,O(k,a?o+k.e+1:o,s,y)}return k}}();function O(i,e,t,n){var r,o,s,a,u,c,l,m,d,p=i.constructor;e:if(e!=null){if(m=i.d,!m)return i;for(r=1,a=m[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=v,s=e,l=m[d=0],u=l/de(10,r-s-1)%10|0;else if(d=Math.ceil((o+1)/v),a=m.length,d>=a)if(n){for(;a++<=d;)m.push(0);l=u=0,r=1,o%=v,s=o-v+1}else break e;else{for(l=a=m[d],r=1;a>=10;a/=10)r++;o%=v,s=o-v+r,u=s<0?0:l/de(10,r-s-1)%10|0}if(n=n||e<0||m[d+1]!==void 0||(s<0?l:l%de(10,r-s-1)),c=t<4?(u||n)&&(t==0||t==(i.s<0?3:2)):u>5||u==5&&(t==4||n||t==6&&(o>0?s>0?l/de(10,r-s):0:m[d-1])%10&1||t==(i.s<0?8:7)),e<1||!m[0])return m.length=0,c?(e-=i.e+1,m[0]=de(10,(v-e%v)%v),i.e=-e||0):m[0]=i.e=0,i;if(o==0?(m.length=d,a=1,d--):(m.length=d+1,a=de(10,v-o),m[d]=s>0?(l/de(10,r-s)%de(10,s)|0)*a:0),c)for(;;)if(d==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(i.e++,m[0]==ve&&(m[0]=1));break}else{if(m[d]+=a,m[d]!=ve)break;m[d--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return D&&(i.e>p.maxE?(i.d=null,i.e=NaN):i.e<p.minE&&(i.e=0,i.d=[0])),i}function Ue(i,e,t){if(!i.isFinite())return ei(i);var n,r=i.e,o=ke(i.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+$e(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(i.e<0?"e":"e+")+i.e):r<0?(o="0."+$e(-r-1)+o,t&&(n=t-s)>0&&(o+=$e(n))):r>=s?(o+=$e(r+1-s),t&&(n=t-r-1)>0&&(o=o+"."+$e(n))):((n=r+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(r+1===s&&(o+="."),o+=$e(n))),o}function Wt(i,e){var t=i[0];for(e*=v;t>=10;t/=10)e++;return e}function Ft(i,e,t){if(e>Ji)throw D=!0,t&&(i.precision=t),Error(Hn);return O(new i(Mt),e,1,!0)}function Fe(i,e,t){if(e>on)throw Error(Hn);return O(new i(Et),e,t,!0)}function jn(i){var e=i.length-1,t=e*v+1;if(e=i[e],e){for(;e%10==0;e/=10)t--;for(e=i[0];e>=10;e/=10)t++}return t}function $e(i){for(var e="";i--;)e+="0";return e}function Jn(i,e,t,n){var r,o=new i(1),s=Math.ceil(n/v+4);for(D=!1;;){if(t%2&&(o=o.times(e),Un(o.d,s)&&(r=!0)),t=Pe(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),Un(e.d,s)}return D=!0,o}function Gn(i){return i.d[i.d.length-1]&1}function $n(i,e,t){for(var n,r=new i(e[0]),o=0;++o<e.length;)if(n=new i(e[o]),n.s)r[t](n)&&(r=n);else{r=n;break}return r}function sn(i,e){var t,n,r,o,s,a,u,c=0,l=0,m=0,d=i.constructor,p=d.rounding,y=d.precision;if(!i.d||!i.d[0]||i.e>17)return new d(i.d?i.d[0]?i.s<0?0:1/0:1:i.s?i.s<0?0:i:0/0);for(e==null?(D=!1,u=y):u=e,a=new d(.03125);i.e>-2;)i=i.times(a),m+=5;for(n=Math.log(de(2,m))/Math.LN10*2+5|0,u+=n,t=o=s=new d(1),d.precision=u;;){if(o=O(o.times(i),u,1),t=t.times(++l),a=s.plus(ne(o,t,u,1)),ke(a.d).slice(0,u)===ke(s.d).slice(0,u)){for(r=m;r--;)s=O(s.times(s),u,1);if(e==null)if(c<3&&wt(s.d,u-n,p,c))d.precision=u+=10,t=o=a=new d(1),l=0,c++;else return O(s,d.precision=y,p,D=!0);else return d.precision=y,s}s=a}}function et(i,e){var t,n,r,o,s,a,u,c,l,m,d,p=1,y=10,f=i,b=f.d,k=f.constructor,T=k.rounding,P=k.precision;if(f.s<0||!b||!b[0]||!f.e&&b[0]==1&&b.length==1)return new k(b&&!b[0]?-1/0:f.s!=1?NaN:b?0:f);if(e==null?(D=!1,l=P):l=e,k.precision=l+=y,t=ke(b),n=t.charAt(0),Math.abs(o=f.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)f=f.times(i),t=ke(f.d),n=t.charAt(0),p++;o=f.e,n>1?(f=new k("0."+t),o++):f=new k(n+"."+t.slice(1))}else return c=Ft(k,l+2,P).times(o+""),f=et(new k(n+"."+t.slice(1)),l-y).plus(c),k.precision=P,e==null?O(f,P,T,D=!0):f;for(m=f,u=s=f=ne(f.minus(1),f.plus(1),l,1),d=O(f.times(f),l,1),r=3;;){if(s=O(s.times(d),l,1),c=u.plus(ne(s,new k(r),l,1)),ke(c.d).slice(0,l)===ke(u.d).slice(0,l))if(u=u.times(2),o!==0&&(u=u.plus(Ft(k,l+2,P).times(o+""))),u=ne(u,new k(p),l,1),e==null)if(wt(u.d,l-y,T,a))k.precision=l+=y,c=s=f=ne(m.minus(1),m.plus(1),l,1),d=O(f.times(f),l,1),r=a=1;else return O(u,k.precision=P,T,D=!0);else return k.precision=P,u;u=c,r+=2}}function ei(i){return String(i.s*i.s/0)}function an(i,e){var t,n,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(n,r),e){if(r-=n,i.e=t=t-n-1,i.d=[],n=(t+1)%v,t<0&&(n+=v),n<r){for(n&&i.d.push(+e.slice(0,n)),r-=v;n<r;)i.d.push(+e.slice(n,n+=v));e=e.slice(n),n=v-e.length}else n-=r;for(;n--;)e+="0";i.d.push(+e),D&&(i.e>i.constructor.maxE?(i.d=null,i.e=NaN):i.e<i.constructor.minE&&(i.e=0,i.d=[0]))}else i.e=0,i.d=[0];return i}function er(i,e){var t,n,r,o,s,a,u,c,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),Yn.test(e))return an(i,e)}else if(e==="Infinity"||e==="NaN")return+e||(i.s=NaN),i.e=NaN,i.d=null,i;if(Zi.test(e))t=16,e=e.toLowerCase();else if(Qi.test(e))t=2;else if(Yi.test(e))t=8;else throw Error(tt+e);for(o=e.search(/p/i),o>0?(u=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=i.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=Jn(n,new n(t),o,o*2)),c=Ot(e,t,ve),l=c.length-1,o=l;c[o]===0;--o)c.pop();return o<0?new n(i.s*0):(i.e=Wt(c,l),i.d=c,D=!1,s&&(i=ne(i,r,a*4)),u&&(i=i.times(Math.abs(u)<54?de(2,u):At.pow(2,u))),D=!0,i)}function tr(i,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:bt(i,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/_t(5,t)),e=bt(i,2,e,e);for(var r,o=new i(5),s=new i(16),a=new i(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function bt(i,e,t,n,r){var o,s,a,u,c=1,l=i.precision,m=Math.ceil(l/v);for(D=!1,u=t.times(t),a=new i(n);;){if(s=ne(a.times(u),new i(e++*e++),l,1),a=r?n.plus(s):n.minus(s),n=ne(s.times(u),new i(e++*e++),l,1),s=a.plus(n),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,c++}return D=!0,s.d.length=m+1,s}function _t(i,e){for(var t=i;--e;)t*=i;return t}function ti(i,e){var t,n=e.s<0,r=Fe(i,i.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return Qe=n?4:1,e;if(t=e.divToInt(r),t.isZero())Qe=n?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return Qe=Gn(t)?n?2:3:n?4:1,e;Qe=Gn(t)?n?1:4:n?3:2}return e.minus(r).abs()}function un(i,e,t,n){var r,o,s,a,u,c,l,m,d,p=i.constructor,y=t!==void 0;if(y?(Ie(t,1,nt),n===void 0?n=p.rounding:Ie(n,0,8)):(t=p.precision,n=p.rounding),!i.isFinite())l=ei(i);else{for(l=Ue(i),s=l.indexOf("."),y?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(l=l.replace(".",""),d=new p(1),d.e=l.length-s,d.d=Ot(Ue(d),10,r),d.e=d.d.length),m=Ot(l,10,r),o=u=m.length;m[--u]==0;)m.pop();if(!m[0])l=y?"0p+0":"0";else{if(s<0?o--:(i=new p(i),i.d=m,i.e=o,i=ne(i,d,t,n,0,r),m=i.d,o=i.e,c=zn),s=m[t],a=r/2,c=c||m[t+1]!==void 0,c=n<4?(s!==void 0||c)&&(n===0||n===(i.s<0?3:2)):s>a||s===a&&(n===4||c||n===6&&m[t-1]&1||n===(i.s<0?8:7)),m.length=t,c)for(;++m[--t]>r-1;)m[t]=0,t||(++o,m.unshift(1));for(u=m.length;!m[u-1];--u);for(s=0,l="";s<u;s++)l+=nn.charAt(m[s]);if(y){if(u>1)if(e==16||e==8){for(s=e==16?4:3,--u;u%s;u++)l+="0";for(m=Ot(l,r,e),u=m.length;!m[u-1];--u);for(s=1,l="1.";s<u;s++)l+=nn.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>u)for(o-=u;o--;)l+="0";else o<u&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return i.s<0?"-"+l:l}function Un(i,e){if(i.length>e)return i.length=e,!0}function nr(i){return new this(i).abs()}function ir(i){return new this(i).acos()}function rr(i){return new this(i).acosh()}function or(i,e){return new this(i).plus(e)}function sr(i){return new this(i).asin()}function ar(i){return new this(i).asinh()}function ur(i){return new this(i).atan()}function cr(i){return new this(i).atanh()}function lr(i,e){i=new this(i),e=new this(e);var t,n=this.precision,r=this.rounding,o=n+4;return!i.s||!e.s?t=new this(NaN):!i.d&&!e.d?(t=Fe(this,o,1).times(e.s>0?.25:.75),t.s=i.s):!e.d||i.isZero()?(t=e.s<0?Fe(this,n,r):new this(0),t.s=i.s):!i.d||e.isZero()?(t=Fe(this,o,1).times(.5),t.s=i.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(ne(i,e,o,1)),e=Fe(this,o,1),this.precision=n,this.rounding=r,t=i.s<0?t.minus(e):t.plus(e)):t=this.atan(ne(i,e,o,1)),t}function mr(i){return new this(i).cbrt()}function dr(i){return O(i=new this(i),i.e+1,2)}function pr(i,e,t){return new this(i).clamp(e,t)}function fr(i){if(!i||typeof i!="object")throw Error(vt+"Object expected");var e,t,n,r=i.defaults===!0,o=["precision",1,nt,"rounding",0,8,"toExpNeg",-ft,0,"toExpPos",0,ft,"maxE",0,ft,"minE",-ft,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=rn[t]),(n=i[t])!==void 0)if(Pe(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(tt+t+": "+n);if(t="crypto",r&&(this[t]=rn[t]),(n=i[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(Qn);else this[t]=!1;else throw Error(tt+t+": "+n);return this}function br(i){return new this(i).cos()}function yr(i){return new this(i).cosh()}function ni(i){var e,t,n;function r(o){var s,a,u,c=this;if(!(c instanceof r))return new r(o);if(c.constructor=r,Xn(o)){c.s=o.s,D?!o.d||o.e>r.maxE?(c.e=NaN,c.d=null):o.e<r.minE?(c.e=0,c.d=[0]):(c.e=o.e,c.d=o.d.slice()):(c.e=o.e,c.d=o.d?o.d.slice():o.d);return}if(u=typeof o,u==="number"){if(o===0){c.s=1/o<0?-1:1,c.e=0,c.d=[0];return}if(o<0?(o=-o,c.s=-1):c.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;D?s>r.maxE?(c.e=NaN,c.d=null):s<r.minE?(c.e=0,c.d=[0]):(c.e=s,c.d=[o]):(c.e=s,c.d=[o]);return}else if(o*0!==0){o||(c.s=NaN),c.e=NaN,c.d=null;return}return an(c,o.toString())}else if(u!=="string")throw Error(tt+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),c.s=-1):(a===43&&(o=o.slice(1)),c.s=1),Yn.test(o)?an(c,o):er(c,o)}if(r.prototype=w,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=fr,r.clone=ni,r.isDecimal=Xn,r.abs=nr,r.acos=ir,r.acosh=rr,r.add=or,r.asin=sr,r.asinh=ar,r.atan=ur,r.atanh=cr,r.atan2=lr,r.cbrt=mr,r.ceil=dr,r.clamp=pr,r.cos=br,r.cosh=yr,r.div=gr,r.exp=kr,r.floor=wr,r.hypot=Ar,r.ln=Pr,r.log=hr,r.log10=Br,r.log2=Tr,r.max=xr,r.min=Ir,r.mod=Sr,r.mul=Cr,r.pow=Kr,r.random=Nr,r.round=Rr,r.sign=Lr,r.sin=Or,r.sinh=Mr,r.sqrt=Er,r.sub=Fr,r.sum=vr,r.tan=Wr,r.tanh=_r,r.trunc=Dr,i===void 0&&(i={}),i&&i.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)i.hasOwnProperty(t=n[e++])||(i[t]=this[t]);return r.config(i),r}function gr(i,e){return new this(i).div(e)}function kr(i){return new this(i).exp()}function wr(i){return O(i=new this(i),i.e+1,3)}function Ar(){var i,e,t=new this(0);for(D=!1,i=0;i<arguments.length;)if(e=new this(arguments[i++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return D=!0,new this(1/0);t=e}return D=!0,t.sqrt()}function Xn(i){return i instanceof At||i&&i.toStringTag===Zn||!1}function Pr(i){return new this(i).ln()}function hr(i,e){return new this(i).log(e)}function Tr(i){return new this(i).log(2)}function Br(i){return new this(i).log(10)}function xr(){return $n(this,arguments,"lt")}function Ir(){return $n(this,arguments,"gt")}function Sr(i,e){return new this(i).mod(e)}function Cr(i,e){return new this(i).mul(e)}function Kr(i,e){return new this(i).pow(e)}function Nr(i){var e,t,n,r,o=0,s=new this(1),a=[];if(i===void 0?i=this.precision:Ie(i,1,nt),n=Math.ceil(i/v),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=n/4}else throw Error(Qn);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],i%=v,n&&i&&(r=de(10,v-i),a[o]=(n/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=v)a.shift();for(n=1,r=a[0];r>=10;r/=10)n++;n<v&&(t-=v-n)}return s.e=t,s.d=a,s}function Rr(i){return O(i=new this(i),i.e+1,this.rounding)}function Lr(i){return i=new this(i),i.d?i.d[0]?i.s:0*i.s:i.s||NaN}function Or(i){return new this(i).sin()}function Mr(i){return new this(i).sinh()}function Er(i){return new this(i).sqrt()}function Fr(i,e){return new this(i).sub(e)}function vr(){var i=0,e=arguments,t=new this(e[i]);for(D=!1;t.s&&++i<e.length;)t=t.plus(e[i]);return D=!0,O(t,this.precision,this.rounding)}function Wr(i){return new this(i).tan()}function _r(i){return new this(i).tanh()}function Dr(i){return O(i=new this(i),i.e+1,1)}w[Symbol.for("nodejs.util.inspect.custom")]=w.toString;w[Symbol.toStringTag]="Decimal";var At=w.constructor=ni(rn);Mt=new At(Mt);Et=new At(Et);var S=At;import{get as ii,set as Vr}from"lodash";var cn=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},ri={},qr={};function me(i){let e=ii(ri,i);if(!e){let t=ii(qr,i);e=new cn({name:i,logLevel:t}),Vr(ri,i,e)}return e}import{PublicKey as so}from"@solana/web3.js";import ao from"bn.js";import io from"big.js";import Xt from"bn.js";import Se from"bn.js";import{PublicKey as fn}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Gr}from"@solana/spl-token";import{PublicKey as re,SystemProgram as oi,SYSVAR_RENT_PUBKEY as Ur}from"@solana/web3.js";function A({pubkey:i,isSigner:e=!1,isWritable:t=!0}){return{pubkey:i,isWritable:t,isSigner:e}}var ys=[A({pubkey:Gr,isWritable:!1}),A({pubkey:oi.programId,isWritable:!1}),A({pubkey:Ur,isWritable:!1})];function ln({publicKey:i,transformSol:e}){let t=mn(i.toString());if(t instanceof re)return e&&t.equals(Pt)?Dt:t;if(e&&t.toString()===Pt.toBase58())return Dt;if(typeof t=="string"){if(t===re.default.toBase58())return re.default;try{return new re(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function mn(i){try{return new re(i)}catch{return i}}var Vt=new re("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),dn=new re("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),at=new re("SysvarRent111111111111111111111111111111111"),gs=new re("SysvarC1ock11111111111111111111111111111111"),yt=new re("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),ks=new re("Sysvar1nstructions1111111111111111111111111"),Xr=oi.programId,ws=new re("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),As=new re("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Ps=new re("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),hs=new re("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Ts=new re("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Bs=new re("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),xs=new re("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Is=new re("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Ss=new re("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Cs=new re("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Ks=new re("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Dt=new re("So11111111111111111111111111111111111111112"),Pt=re.default;function ht(i){return ln({publicKey:i,transformSol:!0})}import{PublicKey as zr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as si}from"@solana/spl-token";var pn={chainId:101,address:zr.default.toBase58(),programId:si.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},it={chainId:101,address:"So11111111111111111111111111111111111111112",programId:si.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var bn=class{constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:o=!1,isToken2022:s=!1}){if(e===Pt.toBase58()||e instanceof fn&&Pt.equals(e)){this.decimals=it.decimals,this.symbol=it.symbol,this.name=it.name,this.mint=new fn(it.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?fn.default:ln({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},We=bn;We.WSOL=new bn(ee(J({},it),{mint:it.address}));import Gt from"big.js";import Zr from"bn.js";import Yr from"decimal.js-light";import Hr from"toformat";var Qr=Hr,Tt=Qr;var qt=me("module/fraction"),yn=Tt(Gt),Bt=Tt(Yr),jr={[0]:Bt.ROUND_DOWN,[1]:Bt.ROUND_HALF_UP,[2]:Bt.ROUND_UP},Jr={[0]:Gt.roundDown,[1]:Gt.roundHalfUp,[2]:Gt.roundUp},j=class{constructor(e,t=new Zr(1)){this.numerator=ae(e),this.denominator=ae(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new j(this.denominator,this.numerator)}add(e){let t=e instanceof j?e:new j(ae(e));return this.denominator.eq(t.denominator)?new j(this.numerator.add(t.numerator),this.denominator):new j(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof j?e:new j(ae(e));return this.denominator.eq(t.denominator)?new j(this.numerator.sub(t.numerator),this.denominator):new j(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof j?e:new j(ae(e));return new j(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof j?e:new j(ae(e));return new j(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||qt.logWithError(`${e} is not an integer.`),e<=0&&qt.logWithError(`${e} is not positive.`),Bt.set({precision:e+1,rounding:jr[n]});let r=new Bt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||qt.logWithError(`${e} is not an integer.`),e<0&&qt.logWithError(`${e} is negative.`),yn.DP=e,yn.RM=Jr[n]||1,new yn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var eo=me("Raydium_price"),Oe=class extends j{constructor(t){let{baseToken:n,quoteToken:r,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=r,this.scalar=new j(gn(n.decimals),gn(r.decimals))}get raw(){return new j(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Oe({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&eo.logWithError("mul token not equals");let n=super.mul(t);return new Oe({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,r){return this.adjusted.toSignificant(t,n,r)}toFixed(t=this.quoteToken.decimals,n,r){return this.adjusted.toFixed(t,n,r)}};var kn=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},Ut=kn;Ut.SOL=new kn(pn);import to from"bn.js";var ai=new j(new to(100)),Ze=class extends j{toSignificant(e=5,t,n){return this.mul(ai).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(ai).toFixed(e,t,n)}};var ui=new Se(0),no=new Se(1),xa=new Se(2),Ia=new Se(3),Sa=new Se(5),wn=new Se(10),Ca=new Se(100),Ka=new Se(1e3),Na=new Se(1e4),ci=9007199254740991;function ae(i){let e=me("Raydium_parseBigNumberish");if(i instanceof Se)return i;if(typeof i=="string"){if(i.match(/^-?[0-9]+$/))return new Se(i);e.logWithError(`invalid BigNumberish string: ${i}`)}return typeof i=="number"?(i%1&&e.logWithError(`BigNumberish number underflow: ${i}`),(i>=ci||i<=-ci)&&e.logWithError(`BigNumberish number overflow: ${i}`),new Se(String(i))):typeof i=="bigint"?new Se(i.toString()):(e.error(`invalid BigNumberish value: ${i}`),new Se(0))}function gn(i){return wn.pow(ae(i))}var ro=me("Raydium_amount"),mi=Tt(io);function oo(i,e){let t="0",n="0";if(i.includes(".")){let r=i.split(".");r.length===2?([t,n]=r,n=n.padEnd(e,"0")):ro.logWithError(`invalid number string, num: ${i}`)}else t=i;return[t,n.slice(0,e)||n]}var be=class extends j{constructor(t,n,r=!0,o){let s=new Xt(0),a=wn.pow(new Xt(t.decimals));if(r)s=ae(n);else{let u=new Xt(0),c=new Xt(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,m]=oo(n.toString(),t.decimals);u=ae(l),c=ae(m)}u=u.mul(a),s=u.add(c)}super(s,a);this.logger=me(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new be(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new be(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,r=0){return super.toSignificant(t,n,r)}toFixed(t=this.token.decimals,n,r=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,r)}toExact(t={groupSeparator:""}){return mi.DP=this.token.decimals,new mi(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};function li(i){return typeof i=="object"&&i!==null&&![We,be,so,j,ao,Oe,Ze].some(e=>typeof e=="object"&&i instanceof e)}function Ne(i){return typeof i=="string"?mn(i):Array.isArray(i)?i.map(e=>Ne(e)):li(i)?Object.fromEntries(Object.entries(i).map(([e,t])=>[e,Ne(t)])):i}import{PublicKey as Uu,sendAndConfirmTransaction as Xu,Transaction as Hu,TransactionMessage as Zu,VersionedTransaction as Yu}from"@solana/web3.js";import $u from"axios";var oe={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut"};import{PublicKey as uo,ComputeBudgetProgram as ou,Transaction as au,TransactionMessage as cu,Keypair as lu,VersionedTransaction as du}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as bu}from"@solana/spl-token";var ku=me("Raydium_txUtil");function Ce(i,e){let[t,n]=uo.findProgramAddressSync(i,e);return{publicKey:t,nonce:n}}import{PublicKey as lo,AddressLookupTableAccount as di}from"@solana/web3.js";import{PublicKey as co}from"@solana/web3.js";import{MINT_SIZE as xu,TOKEN_PROGRAM_ID as Iu,getTransferFeeConfig as Su,unpackMint as Cu}from"@solana/spl-token";var An=me("Raydium_accountInfo_util");async function rt(i,e,t){let{batchRequest:n,commitment:r="confirmed",chunkCount:o=100}=J({batchRequest:!1},t),s=Pn(e,o),a=new Array(s.length).fill([]);if(n){let u=s.map(m=>{let d=i._buildArgs([m.map(p=>p.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:d}}),c=Pn(u,10);a=(await(await Promise.all(c.map(async m=>await i._rpcBatchRequest(m)))).flat()).map(m=>(m.error&&An.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.error.message}`),m.result.value.map(d=>{if(d){let{data:p,executable:y,lamports:f,owner:b,rentEpoch:k}=d;return p.length!==2&&p[1]!=="base64"&&An.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:y,lamports:f,owner:new co(b),rentEpoch:k}}return null})))}else try{a=await Promise.all(s.map(u=>i.getMultipleAccountsInfo(u,r)))}catch(u){u instanceof Error&&An.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.message}`)}return a.flat()}async function zt(i,e,t){let n=await rt(i,e.map(r=>r.pubkey),t);return e.map((r,o)=>ee(J({},r),{accountInfo:n[o]}))}var mo={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new di({key:new lo("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:di.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};function Pn(i,e=1,t=[]){let n=[...i];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as Q}from"@solana/web3.js";var cc=new Q("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),lc=new Q("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),mc=new Q("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),dc=new Q("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),pc=new Q("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),fc=new Q("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),bc=new Q("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),yc=new Q("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),pi=new Q("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),gc=new Q("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),kc=new Q("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),wc=new Q("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Ac=new Q("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Pc=new Q("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),hc=new Q("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Tc=new Q("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Bc=new Q("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),xc=new Q("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Ic=new Q("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),bo=new Q("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),yo=new Q("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),go=new Q("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2");var Sc={SERUM_MARKET:Q.default,OPENBOOK_MARKET:new Q("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:Q.default,FarmV3:new Q("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new Q("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new Q("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new Q("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new Q("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new Q("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),Router:new Q("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:bo,CREATE_CPMM_POOL_AUTH:yo,CREATE_CPMM_POOL_FEE_ACC:go,FEE_DESTINATION_ID:new Q("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR")};import{PublicKey as ko}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as wo}from"@solana/spl-token";function Ye(i,e,t){return Ce([i.toBuffer(),(t!=null?t:wo).toBuffer(),e.toBuffer()],new ko("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import _e from"bn.js";var xt=1e4;function ue(i,e,t,n){if(e===void 0)return{amount:i,fee:void 0,expirationTime:void 0};let r=ee(J({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,s=new _e(o.maximumFee.toString()),a=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===xt){let u=new _e(o.maximumFee.toString());return{amount:i.add(u),fee:u,expirationTime:a}}else{let u=Ht(i.mul(new _e(xt)),new _e(xt-o.transferFeeBasisPoints)),c=new _e(o.maximumFee.toString()),l=u.sub(i).gt(c)?i.add(c):u,m=Ht(l.mul(new _e(o.transferFeeBasisPoints)),new _e(xt)),d=m.gt(s)?s:m;return{amount:l,fee:d,expirationTime:a}}else{let u=Ht(i.mul(new _e(o.transferFeeBasisPoints)),new _e(xt)),c=u.gt(s)?s:u;return{amount:i,fee:c,expirationTime:a}}}function ot(i,e){return i===void 0?e:e===void 0?i:Math.min(i,e)}function Ht(i,e){let{div:t,mod:n}=i.divmod(e);return n.gt(new _e(0))?t.add(new _e(1)):t}import{PublicKey as el}from"@solana/web3.js";import{MintLayout as nl,TOKEN_PROGRAM_ID as rl}from"@solana/spl-token";import Me from"bn.js";var ce=new Me(0),Re=new Me(1),je=new Me(-1),Le=new Me(1).shln(64),Qt=new Me(1).shln(128),hn=Le.sub(Re),It=64,fi=Qt.subn(1),he=-443636,Te=-he,Xe=new Me("4295048016"),ze=new Me("79226673521066979257578248091"),Zt=new Me("4295048017"),Yt=new Me("79226673521066979257578248090"),bi=16,yi="59543866431248",gi="184467440737095516",ki="15793534762490258745",jt=new Me(10).pow(new Me(6));var yl=new Me("18446744073700000000");import U from"bn.js";function Jt(i){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,i,!1),new Uint8Array(e)}function Tn(i,e){let t=0;for(let n=i-1;n>=0&&!e.testn(n);n--)t++;return t}function Bn(i,e){let t=0;for(let n=0;n<i&&!e.testn(n);n++)t++;return t}function St(i,e){for(let t=0;t<i;t++)if(e.testn(t))return!1;return!0}function wi(i,e){return St(i,e)?null:Tn(i,e)}function Ai(i,e){return St(i,e)?null:Bn(i,e)}var hl=Buffer.from("amm_config","utf8"),Ao=Buffer.from("pool","utf8"),Po=Buffer.from("pool_vault","utf8"),ho=Buffer.from("pool_reward_vault","utf8"),Pi=Buffer.from("position","utf8"),To=Buffer.from("tick_array","utf8"),Bo=Buffer.from("operation","utf8"),xo=Buffer.from("pool_tick_array_bitmap_extension","utf8"),Io=Buffer.from("observation","utf8");function hi(i,e,t,n){return Ce([Ao,e.toBuffer(),t.toBuffer(),n.toBuffer()],i)}function xn(i,e,t){return Ce([Po,e.toBuffer(),t.toBuffer()],i)}function Ti(i,e,t){return Ce([ho,e.toBuffer(),t.toBuffer()],i)}function te(i,e,t){return Ce([To,e.toBuffer(),Jt(t)],i)}function ut(i,e,t,n){return Ce([Pi,e.toBuffer(),Jt(t),Jt(n)],i)}function De(i,e){return Ce([Pi,e.toBuffer()],i)}function $t(i){return Ce([Buffer.from("metadata","utf8"),yt.toBuffer(),i.toBuffer()],yt)}function en(i){return Ce([Bo],i)}function Ke(i,e){return Ce([xo,e.toBuffer()],i)}function Bi(i,e){return Ce([Io,e.toBuffer()],i)}import{PublicKey as Ve}from"@solana/web3.js";import ie from"bn.js";import Xo from"bn.js";import{PublicKey as Eo}from"@solana/web3.js";import Ci,{isBN as Ki}from"bn.js";import{bits as xl,BitStructure as Il,blob as So,Blob as Sl,cstr as Cl,f32 as Kl,f32be as Nl,f64 as Rl,f64be as Ll,greedy as Ol,Layout as Co,ns64 as Ml,ns64be as El,nu64 as Fl,nu64be as vl,offset as Wl,s16 as _l,s16be as Dl,s24 as Vl,s24be as ql,s32 as Ko,s32be as Gl,s40 as Ul,s40be as Xl,s48 as zl,s48be as Hl,s8 as Ql,seq as No,struct as Zl,Structure as Ro,u16 as Lo,u16be as Yl,u24 as jl,u24be as Jl,u32 as $l,u32be as em,u40 as tm,u40be as nm,u48 as im,u48be as rm,u8 as Oo,UInt as Mo,union as om,Union as sm,unionLayoutDiscriminator as am,utf8 as um}from"@solana/buffer-layout";var In=Co,xi=Ro;var Sn=Mo;var Ii=Oo,ct=Lo;var we=Ko;var Si=No;var Be=So;var gt=class extends In{constructor(t,n,r){super(t,r);this.blob=Be(t),this.signed=n}decode(t,n=0){let r=new Ci(this.blob.decode(t,n),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,n,r=0){return typeof t=="number"&&(t=new Ci(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,r)}};function X(i){return new Sn(1,i)}function kt(i){return new Sn(4,i)}function g(i){return new gt(8,!1,i)}function q(i){return new gt(16,!1,i)}function Ni(i){return new gt(8,!0,i)}function Ri(i){return new gt(16,!0,i)}var tn=class extends In{constructor(t,n,r,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=r}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,r){return this.layout.encode(this.encoder(t),n,r)}getSpan(t,n){return this.layout.getSpan(t,n)}};function M(i){return new tn(Be(32),e=>new Eo(e),e=>e.toBuffer(),i)}function Ee(i){return new tn(Ii(),Fo,vo,i)}function Fo(i){if(i===0)return!1;if(i===1)return!0;throw new Error("Invalid bool: "+i)}function vo(i){return i?1:0}var Cn=class extends xi{decode(e,t){return super.decode(e,t)}};function _(i,e,t){return new Cn(i,e,t)}function Y(i,e,t){let n,r=typeof e=="number"?e:Ki(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=Ki(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return Si(i,r,t)}var Kn=14,Je=class{static maxTickInTickarrayBitmap(e){return e*pe*lt}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);let o=n*r;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!H.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=r?t-H.tickCount(n):t+H.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*pe,u=s/a+512;s<0&&s%a!=0&&u--;let c=Math.abs(u);if(r){let l=e.shln(1024-c-1),m=wi(1024,l);if(m!==null){let d=(c-m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(c),m=Ai(1024,l);if(m!==null){let d=(c+m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:o-H.tickCount(n)}}}},Ct=class{static getBitmapOffset(e,t){if(!H.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=Je.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&r--,r}static getBitmap(e,t,n){let r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=Je.maxTickInTickarrayBitmap(e),n=-t;if(Te<=t)throw Error(`extensionTickBoundary check error: ${Te}, ${t}`);if(n<=he)throw Error(`extensionTickBoundary check error: ${n}, ${he}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:r}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:L.mergeTickArrayBitmap(r).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){let o=H.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,r);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){let{minValue:o,maxValue:s}=Je.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(r){let u=L.mergeTickArrayBitmap(e).shln(lt-1-a),c=St(512,u)?null:Tn(512,u);if(c!==null){let l=t-c*H.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let u=L.mergeTickArrayBitmap(e).shrn(a),c=St(512,u)?null:Bn(512,u);if(c!==null){let l=t+c*H.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s-H.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%Je.maxTickInTickarrayBitmap(t),r=Math.floor(n/H.tickCount(t));return e<0&&n!=0&&(r=lt-r),r}};var Wo=_([Be(8),X("bump"),ct("index"),M(""),kt("protocolFeeRate"),kt("tradeFeeRate"),ct("tickSpacing"),Y(g(),8,"")]),_o=_([kt("blockTimestamp"),Ni("tickCumulative"),Y(g(),4)]),Li=_([Be(8),Ee("initialized"),g("recentEpoch"),ct("observationIndex"),M("poolId"),Y(_o,100,"observations"),Y(g(),4)]),Do=_([X("rewardState"),g("openTime"),g("endTime"),g("lastUpdateTime"),q("emissionsPerSecondX64"),g("rewardTotalEmissioned"),g("rewardClaimed"),M("tokenMint"),M("tokenVault"),M("creator"),q("rewardGrowthGlobalX64")]),Nn=_([Be(8),X("bump"),M("ammConfig"),M("creator"),M("mintA"),M("mintB"),M("vaultA"),M("vaultB"),M("observationId"),X("mintDecimalsA"),X("mintDecimalsB"),ct("tickSpacing"),q("liquidity"),q("sqrtPriceX64"),we("tickCurrent"),kt(),q("feeGrowthGlobalX64A"),q("feeGrowthGlobalX64B"),g("protocolFeesTokenA"),g("protocolFeesTokenB"),q("swapInAmountTokenA"),q("swapOutAmountTokenB"),q("swapInAmountTokenB"),q("swapOutAmountTokenA"),X("status"),Y(X(),7,""),Y(Do,3,"rewardInfos"),Y(g(),16,"tickArrayBitmap"),g("totalFeesTokenA"),g("totalFeesClaimedTokenA"),g("totalFeesTokenB"),g("totalFeesClaimedTokenB"),g("fundFeesTokenA"),g("fundFeesTokenB"),g("startTime"),Y(g(),15*4-3,"padding")]),Vo=_([q("growthInsideLastX64"),g("rewardAmountOwed")]),Rn=_([Be(8),X("bump"),M("nftMint"),M("poolId"),we("tickLower"),we("tickUpper"),q("liquidity"),q("feeGrowthInsideLastX64A"),q("feeGrowthInsideLastX64B"),g("tokenFeesOwedA"),g("tokenFeesOwedB"),Y(Vo,3,"rewardInfos"),Y(g(),8,"")]),Km=_([Be(8),X("bump"),M("poolId"),we("tickLowerIndex"),we("tickUpperIndex"),q("liquidity"),q("feeGrowthInsideLastX64A"),q("feeGrowthInsideLastX64B"),g("tokenFeesOwedA"),g("tokenFeesOwedB"),Y(q(),3,"rewardGrowthInside"),Y(g(),8,"")]),qo=_([we("tick"),Ri("liquidityNet"),q("liquidityGross"),q("feeGrowthOutsideX64A"),q("feeGrowthOutsideX64B"),Y(q(),3,"rewardGrowthsOutsideX64"),Y(kt(),13,"")]),Kt=_([Be(8),M("poolId"),we("startTickIndex"),Y(qo,pe,"ticks"),X("initializedTickCount"),Y(X(),115,"")]),Go=_([Be(329),Y(M(),100,"whitelistMints")]),Oi=_([Be(8),M("poolId"),Y(Y(g(),8),Kn,"positiveTickArrayBitmap"),Y(Y(g(),8),Kn,"negativeTickArrayBitmap")]);var Uo=15,H=class{static async getTickArrays(e,t,n,r,o,s,a){let u=[],c=L.getTickArrayStartIndexByTick(r,o),l=L.getInitializedTickArrayInRange(s,a,o,c,Math.floor(Uo/2));for(let p=0;p<l.length;p++){let{publicKey:y}=te(t,n,l[p]);u.push(y)}let m=(await rt(e,u)).map(p=>p!==null?Kt.decode(p.data):null),d={};for(let p=0;p<u.length;p++){let y=m[p];y!==null&&(d[y.startTickIndex]=ee(J({},y),{address:u[p]}))}return d}static nextInitializedTick(e,t,n,r,o,s){let{initializedTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}=this.nextInitializedTickInOneArray(e,t,n,r,o,s);for(;a==null||a.liquidityGross.lten(0);){if(c=L.getNextTickArrayStartIndex(c,o,s),this.checkIsValidStartIndex(c,o))throw new Error("No enough initialized tickArray");let l=n[c];if(l===void 0)continue;let{nextTick:m,tickArrayAddress:d,tickArrayStartTickIndex:p}=this.firstInitializedTickInOneArray(e,t,l,s);[a,u,c]=[m,d,p]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}}static nextInitializedTickArray(e,t,n,r,o){let s=Math.floor(e/H.tickCount(t)),a=n?L.searchLowBitFromStart(r,o,s-1,1,t):L.searchHightBitFromStart(r,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let o;if(r){let a=pe-1;for(;a>=0;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a-1}}else{let a=0;for(;a<pe;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a+1}}let{publicKey:s}=te(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,o,s){let a=L.getTickArrayStartIndexByTick(r,o),u=Math.floor((r-a)/o),c=n[a];if(c==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let l;if(s)for(;u>=0;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){l=d;break}u=u-1}else for(u=u+1;u<pe;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){l=d;break}u=u+1}let{publicKey:m}=te(e,t,a);return{initializedTick:l,tickArrayAddress:m,tickArrayStartTickIndex:c.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(L.checkIsOutOfBoundary(e)){if(e>Te)return!1;let n=L.getTickArrayStartIndexByTick(he,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return pe*e}};var pe=60,lt=512,L=class{static getTickArrayAddressByTick(e,t,n,r){let o=L.getTickArrayStartIndexByTick(n,r),{publicKey:s}=te(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=L.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=pe)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=H.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*H.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*pe,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*pe,o=Math.floor(t/r)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*pe:e+t*pe}static mergeTickArrayBitmap(e){let t=new Xo(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,o){let s=Math.floor(r/(n*pe));return[...L.searchLowBitFromStart(e,t,s-1,o,n),...L.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return L.searchHightBitFromStart(e,t,0,lt,n)}static getAllInitializedTickArrayInfo(e,t,n,r,o){let s=[],a=L.getAllInitializedTickArrayStartIndex(n,r,o);for(let u of a){let{publicKey:c}=te(e,t,u);s.push({tickArrayStartIndex:u,tickArrayAddress:c})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>L.mergeTickArrayBitmap(c)),a=[];for(;n>=-7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n--,a.length===r)break}let u=H.tickCount(o);return a.map(c=>c*u)}static searchHightBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>L.mergeTickArrayBitmap(c)),a=[];for(;n<7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n++,a.length===r)break}let u=H.tickCount(o);return a.map(c=>c*u)}static checkIsOutOfBoundary(e){return e<he||e>Te}static nextInitTick(e,t,n,r,o){if(H.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(r)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<pe;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=pe-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<pe;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=V.getSqrtPriceX64FromTick(t),o=V.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new S(1).div(o),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new S(1).div(t),o=mt.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=V.getSqrtPriceX64FromTick(o),a=V.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new S(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=V.getSqrtPriceX64FromTick(t),o=V.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new S(1).div(o),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new S(1).div(t),o=mt.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=V.getSqrtPriceX64FromTick(o),a=V.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new S(1).div(a)}}};import He from"bn.js";var Nt=class{static getfeeGrowthInside(e,t,n){let r=new He(0),o=new He(0);e.tickCurrent>=t.tick?(r=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new He(0),a=new He(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let u=G.wrappingSubU128(G.wrappingSubU128(e.feeGrowthGlobalX64A,r),s),c=G.wrappingSubU128(G.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:u,feeGrowthInsideBX64:c}}static GetPositionFees(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=G.mulDivFloor(G.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Le),u=t.tokenFeesOwedA.add(a),c=G.mulDivFloor(G.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Le),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=G.mulDivFloor(G.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Le),u=t.tokenFeesOwedA.add(a),c=G.mulDivFloor(G.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Le),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,r){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=G.wrappingSubU128(u,c.growthInsideLastX64),m=G.mulDivFloor(l,t.liquidity,Le),d=c.rewardAmountOwed.add(m);o.push(d)}return o}static GetPositionRewards(e,t,n,r){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=G.wrappingSubU128(u,c.growthInsideLastX64),m=G.mulDivFloor(l,t.liquidity,Le),d=c.rewardAmountOwed.add(m);o.push(d)}return o}static getRewardGrowthInside(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new He(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new He(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(G.wrappingSubU128(G.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),u))}return o}static getRewardGrowthInsideV2(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new He(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new He(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(G.wrappingSubU128(G.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),u))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:r,add:o,epochInfo:s}){var b,k,T,P;let a=V.priceToSqrtPriceX64(new S(e.price),e.mintA.decimals,e.mintB.decimals),u=V.getSqrtPriceX64FromTick(t.tickLower),c=V.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+r:1-r,m=Z.getAmountsFromLiquidity(a,u,c,n,o),[d,p]=[ue(m.amountA,(b=e.mintA.extensions)==null?void 0:b.feeConfig,s,!0),ue(m.amountB,(k=e.mintB.extensions)==null?void 0:k.feeConfig,s,!0)],[y,f]=[ue(new He(new S(m.amountA.toString()).mul(l).toFixed(0)),(T=e.mintA.extensions)==null?void 0:T.feeConfig,s,!0),ue(new He(new S(m.amountB.toString()).mul(l).toFixed(0)),(P=e.mintB.extensions)==null?void 0:P.feeConfig,s,!0)];return{liquidity:n,amountA:d,amountB:p,amountSlippageA:y,amountSlippageB:f,expirationTime:ot(d.expirationTime,p.expirationTime)}}};import{TOKEN_2022_PROGRAM_ID as Mi}from"@solana/spl-token";var ye=class{static getOutputAmountAndRemainAccounts(e,t,n,r,o,s=!1){let a=n.toBase58()===e.mintA.address,u=[],{isExist:c,startIndex:l,nextAccountMeta:m}=this.getFirstInitializedTickArray(e,a);if(!c||l===void 0||!m)throw new Error("Invalid tick array");u.push(m);let{allTrade:d,amountCalculated:p,accounts:y,sqrtPriceX64:f,feeAmount:b}=dt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,a,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r,l,o,s);return u.push(...y),{allTrade:d,expectedAmountOut:p.mul(je),remainingAccounts:u,executionPrice:f,feeAmount:b}}static getInputAmountAndRemainAccounts(e,t,n,r,o){let s=n.toBase58()===e.mintB.address,a=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!u||c===void 0||!l)throw new Error("Invalid tick array");try{let f=this.preInitializedTickArrayStartIndex(e,s);if(f.isExist){let{publicKey:b}=te(e.programId,e.id,f.nextStartIndex);a.push(b)}}catch{}a.push(l);let{amountCalculated:m,accounts:d,sqrtPriceX64:p,feeAmount:y}=dt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r.mul(je),c,o);return a.push(...d),{expectedAmountIn:m,remainingAccounts:a,executionPrice:p,feeAmount:y}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:r}=ye.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?Ct.checkTickArrayIsInit(H.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):L.checkTickArrayIsInitialized(L.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=te(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,H.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=te(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/H.tickCount(e.tickSpacing)),r=t?L.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):L.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=H.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:r,tickIndex:o}=Je.nextInitializedTickArrayStartIndex(L.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(r)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=Ct.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<he||t>Te)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:r,rewardInfos:o}){var a,u,c;let s=[];for(let l=0;l<o.length;l++){let m=o[l],d=(c=(a=t.rewardDefaultInfos[l])==null?void 0:a.mint.programId)!=null?c:(u=await e.getAccountInfo(m.tokenMint))==null?void 0:u.owner;if(d===void 0)throw Error("get new reward mint info error");let p=ee(J({},m),{perSecond:G.x64ToDecimal(m.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new Ve(d)});if(p.tokenMint.equals(Ve.default))continue;if(n<=p.openTime.toNumber()||r.eq(ce)){s.push(p);continue}let y=new ie(Math.min(p.endTime.toNumber(),n)),f=y.sub(p.lastUpdateTime),b=G.mulDivFloor(f,p.emissionsPerSecondX64,r),k=p.rewardGrowthGlobalX64.add(b),T=G.mulDivFloor(f,p.emissionsPerSecondX64,Le),P=p.rewardTotalEmissioned.add(T);s.push(ee(J({},p),{rewardGrowthGlobalX64:k,rewardTotalEmissioned:P,lastUpdateTime:y}))}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:r}=this.tickRange(e);for(let o of t){let s=L.getTickArrayStartIndexByTick(o,e);if(s>=n||s<r)return!0}return!1}static tickRange(e){let t=Je.maxTickInTickarrayBitmap(e),n=-t;return t>Te&&(t=H.getArrayStartIndex(Te,e)+H.tickCount(e)),n<he&&(n=H.getArrayStartIndex(he,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!H.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/H.tickCount(t)*lt}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let r=await zt(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of r)s.accountInfo!==null&&(o[s.pubkey.toString()]=Oi.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let r={},o=[];for(let u of t){let c=L.getTickArrayStartIndexByTick(u.tickCurrent,u.tickSpacing),l=L.getInitializedTickArrayInRange(u.tickArrayBitmap,u.exBitmapInfo,u.tickSpacing,c,7);for(let m of l){let{publicKey:d}=te(u.programId,u.id,m);o.push({pubkey:d}),r[d.toString()]=u.id}}let s=await zt(e,o,{batchRequest:n}),a={};for(let u of s){if(!u.accountInfo)continue;let c=r[u.pubkey.toString()];if(!c)continue;a[c.toString()]===void 0&&(a[c.toString()]={});let l=Kt.decode(u.accountInfo.data);a[c.toString()][l.startTickIndex]=ee(J({},l),{address:u.pubkey})}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:r=!1,updateOwnerRewardAndFee:o=!0}){var a;let s=[];for(let u=0;u<e.length;u++){let c=e[u];c!==null&&(s.find(l=>l.equals(c.state.programId))||s.push(c.state.programId))}if(n){let u=n.tokenAccounts.map(d=>d.accountInfo.mint),c=[];for(let d of u)for(let p of s)c.push(De(p,d).publicKey);let l=await rt(t,c,{batchRequest:r}),m={};for(let d of l){if(d===null)continue;let p=Rn.decode(d.data),y=p.poolId.toString(),f=e.find(K=>K.state.id.toBase58()===y);if(f===void 0)continue;let b=f.state,k=L._getTickPriceLegacy({poolInfo:b,tick:p.tickLower,baseIn:!0}),T=L._getTickPriceLegacy({poolInfo:b,tick:p.tickUpper,baseIn:!0}),{amountA:P,amountB:I}=Z.getAmountsFromLiquidity(b.sqrtPriceX64,k.tickSqrtPriceX64,T.tickSqrtPriceX64,p.liquidity,!1),W=1/(1-Math.sqrt(Math.sqrt(k.price.div(T.price).toNumber())));f.positionAccount=[...(a=f.positionAccount)!=null?a:[],{poolId:p.poolId,nftMint:p.nftMint,priceLower:k.price,priceUpper:T.price,amountA:P,amountB:I,tickLower:p.tickLower,tickUpper:p.tickUpper,liquidity:p.liquidity,feeGrowthInsideLastX64A:p.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:p.feeGrowthInsideLastX64B,tokenFeesOwedA:p.tokenFeesOwedA,tokenFeesOwedB:p.tokenFeesOwedB,rewardInfos:p.rewardInfos.map(K=>ee(J({},K),{pendingReward:new ie(0)})),leverage:W,tokenFeeAmountA:new ie(0),tokenFeeAmountB:new ie(0)}];let B=await L.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickLower,f.state.tickSpacing),E=await L.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickUpper,f.state.tickSpacing);m[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickLower}`]=B,m[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickUpper}`]=E}if(o){let d=Object.values(m),p=await rt(t,d,{batchRequest:r}),y={};for(let f=0;f<d.length;f++){let b=p[f];if(b===null)continue;let k=d[f].toString();y[k]=Kt.decode(b.data)}for(let{state:f,positionAccount:b}of e)if(!!b)for(let k of b){let T=`${f.programId.toString()}-${f.id.toString()}-${k.tickLower}`,P=`${f.programId.toString()}-${f.id.toString()}-${k.tickUpper}`,I=y[m[T].toString()],W=y[m[P].toString()],B=I.ticks[L.getTickOffsetInArray(k.tickLower,f.tickSpacing)],E=W.ticks[L.getTickOffsetInArray(k.tickUpper,f.tickSpacing)],{tokenFeeAmountA:K,tokenFeeAmountB:z}=await Nt.GetPositionFees(f,k,B,E),h=await Nt.GetPositionRewards(f,k,B,E);k.tokenFeeAmountA=K.gte(new ie(0))?K:new ie(0),k.tokenFeeAmountB=z.gte(new ie(0))?z:new ie(0);for(let F=0;F<h.length;F++)k.rewardInfos[F].pendingReward=h[F].gte(new ie(0))?h[F]:new ie(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountIn:o,slippage:s,priceLimit:a=new S(0),catchLiquidityInsufficient:u=!1}){var fe;let c,l=n.toBase58()===e.mintA.address,[m,d]=l?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];a.equals(new S(0))?c=l?Xe.add(new ie(1)):ze.sub(new ie(1)):c=V.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let p=ue(o,m,r,!1),{allTrade:y,expectedAmountOut:f,remainingAccounts:b,executionPrice:k,feeAmount:T}=ye.getOutputAmountAndRemainAccounts(e,t,n,p.amount.sub((fe=p.fee)!=null?fe:ce),c,u),P=ue(f,d,r,!1),I=V.sqrtPriceX64ToPrice(k,e.mintA.decimals,e.mintB.decimals),W=l?I:new S(1).div(I),B=f.mul(new ie(Math.floor((1-s)*1e10))).div(new ie(1e10)),E=ue(B,d,r,!1),K=l?e.currentPrice:new S(1).div(e.currentPrice),z=new S(W).sub(K).abs(),h=K,F=new Ze(new S(z).mul(10**15).toFixed(0),new S(h).mul(10**15).toFixed(0));return{allTrade:y,realAmountIn:p,amountOut:P,minAmountOut:E,expirationTime:ot(p.expirationTime,P.expirationTime),currentPrice:e.currentPrice,executionPrice:W,priceImpact:F,fee:T,remainingAccounts:b,executionPriceX64:k}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:r,slippage:o,epochInfo:s,catchLiquidityInsufficient:a=!1}){let u=r.address===e.mintB.address,[c,l]=u?[e.mintA,e.mintB]:[e.mintB,e.mintA],[m,d]=[new We(ee(J({},c),{mint:c.address,isToken2022:c.programId===Mi.toBase58()})),new We(ee(J({},l),{mint:l.address,isToken2022:l.programId===Mi.toBase58()}))],{allTrade:p,realAmountIn:y,amountOut:f,minAmountOut:b,expirationTime:k,currentPrice:T,executionPrice:P,priceImpact:I,fee:W,remainingAccounts:B,executionPriceX64:E}=ye.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new Ve(c.address),amountIn:n,slippage:o,epochInfo:s,catchLiquidityInsufficient:a}),K=ee(J({},y),{amount:new be(m,y.amount),fee:y.fee===void 0?void 0:new be(m,y.fee)}),z=ee(J({},f),{amount:new be(d,f.amount),fee:f.fee===void 0?void 0:new be(d,f.fee)}),h=ee(J({},b),{amount:new be(d,b.amount),fee:b.fee===void 0?void 0:new be(d,b.fee)}),F=new Oe({baseToken:m,denominator:new ie(10).pow(new ie(20+m.decimals)),quoteToken:d,numerator:T.mul(new S(10**(20+d.decimals))).toFixed(0)}),fe=new Oe({baseToken:m,denominator:new ie(10).pow(new ie(20+m.decimals)),quoteToken:d,numerator:P.mul(new S(10**(20+d.decimals))).toFixed(0)}),le=new be(m,W);return{allTrade:p,realAmountIn:K,amountOut:z,minAmountOut:h,expirationTime:k,currentPrice:F,executionPrice:fe,priceImpact:I,fee:le,remainingAccounts:B,executionPriceX64:E}}static computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountOut:o,slippage:s,priceLimit:a=new S(0)}){var h;let u=n.toBase58()===e.mintA.address,c={[e.mintA.address]:e.mintA.extensions.feeConfig,[e.mintB.address]:e.mintB.extensions.feeConfig},l;a.equals(new S(0))?l=u?ze.sub(new ie(1)):Xe.add(new ie(1)):l=V.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let m=ue(o,c[n.toString()],r,!0),{expectedAmountIn:d,remainingAccounts:p,executionPrice:y,feeAmount:f}=ye.getInputAmountAndRemainAccounts(e,t,n,m.amount.sub((h=m.fee)!=null?h:ce),l),b=u?e.mintB.address:e.mintA.address,k=ue(d,c[b],r,!1),T=V.sqrtPriceX64ToPrice(y,e.mintA.decimals,e.mintB.decimals),P=u?T:new S(1).div(T),I=d.mul(new ie(Math.floor((1+s)*1e10))).div(new ie(1e10)),W=ue(I,c[b],r,!0),B=u?e.currentPrice:new S(1).div(e.currentPrice),E=new S(P).sub(B).abs(),K=B,z=new Ze(new S(E).mul(10**15).toFixed(0),new S(K).mul(10**15).toFixed(0));return{amountIn:k,maxAmountIn:W,realAmountOut:m,expirationTime:ot(k.expirationTime,m.expirationTime),currentPrice:e.currentPrice,executionPrice:P,priceImpact:z,fee:f,remainingAccounts:p}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:r}){var y,f,b;let o=e[t],s=L.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=L.getTickPrice({poolInfo:e,tick:r,baseIn:!0}).price.toNumber(),u=Math.max(s,o.priceMin),l=Math.min(a,o.priceMax)-u,m=a-s,d=o.priceMax-o.priceMin,p;return l<=0?p=0:m===l?p=d/l:d===l?p=l/m:p=l/d*(l/m),{feeApr:o.feeApr*p,rewardsApr:[((y=o.rewardApr[0])!=null?y:0)*p,((f=o.rewardApr[1])!=null?f:0)*p,((b=o.rewardApr[2])!=null?b:0)*p],apr:o.apr*p}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:r,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:u}){let c=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],m=r[ht(e.mintA.address).toString()],d=r[ht(e.mintB.address).toString()],p=e.mintA.decimals,y=e.mintB.decimals;if(!l||!m||!d)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let f=V.priceToSqrtPriceX64(new S(e.price),e.mintA.decimals,e.mintB.decimals),b=V.getSqrtPriceX64FromTick(s),k=V.getSqrtPriceX64FromTick(a),{amountSlippageA:T,amountSlippageB:P}=Z.getAmountsFromLiquidityWithSlippage(f,b,k,t,!1,!1,0),{amountSlippageA:I,amountSlippageB:W}=Z.getAmountsFromLiquidityWithSlippage(f,b,k,o,!1,!1,0),B=new S(T.toString()).div(new S(10).pow(p)).mul(m.value).add(new S(P.toString()).div(new S(10).pow(y)).mul(d.value)),E=new S(I.toString()).div(new S(10).pow(p)).mul(m.value).add(new S(W.toString()).div(new S(10).pow(y)).mul(d.value)),K=new S(1).div(B.add(E)),h=new S(l.volumeFee).mul(365).div(c).mul(K).mul(100).toNumber(),F=3600*24*365,fe=e.rewardDefaultInfos.map(le=>{var $,Dn;let xe=le.mint.decimals,se=r[le.mint.address];return u<(($=le.startTime)!=null?$:0)||u>((Dn=le.endTime)!=null?Dn:0)||!le.perSecond||!se||xe===void 0?0:new S(se.value).mul(new S(le.perSecond).mul(F)).div(new S(10).pow(xe)).mul(K).mul(100).toNumber()});return{feeApr:h,rewardsApr:fe,apr:h+fe.reduce((le,xe)=>le+xe,0)}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:r,amount:o,slippage:s,add:a,epochInfo:u,amountHasFee:c}){var k,T;let l=V.priceToSqrtPriceX64(new S(e.price),e.mintA.decimals,e.mintB.decimals),m=V.getSqrtPriceX64FromTick(n),d=V.getSqrtPriceX64FromTick(r),p=a?1-s:1+s,y=ue(o,(k=e[t?"mintA":"mintB"].extensions)==null?void 0:k.feeConfig,u,!c),f=new ie(new S(y.amount.sub((T=y.fee)!=null?T:ce).toString()).mul(p).toFixed(0)),b;if(l.lte(m))b=t?Z.getLiquidityFromTokenAmountA(m,d,f,!a):new ie(0);else if(l.lte(d)){let P=Z.getLiquidityFromTokenAmountA(l,d,f,!a),I=Z.getLiquidityFromTokenAmountB(m,l,f);b=t?P:I}else b=t?new ie(0):Z.getLiquidityFromTokenAmountB(m,d,f);return ye.getAmountsFromLiquidity({epochInfo:u,poolInfo:e,tickLower:n,tickUpper:r,liquidity:b,slippage:s,add:a})}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:r,liquidity:o,slippage:s,add:a}){var b,k,T,P;let u=V.getSqrtPriceX64FromTick(n),c=V.getSqrtPriceX64FromTick(r),l=a?1+s:1-s,m=Z.getAmountsFromLiquidity(V.priceToSqrtPriceX64(new S(t.price),t.mintA.decimals,t.mintB.decimals),u,c,o,a),[d,p]=[ue(m.amountA,(b=t.mintA.extensions)==null?void 0:b.feeConfig,e,!0),ue(m.amountB,(k=t.mintB.extensions)==null?void 0:k.feeConfig,e,!0)],[y,f]=[ue(m.amountA.muln(l),(T=t.mintA.extensions)==null?void 0:T.feeConfig,e,!0),ue(m.amountB.muln(l),(P=t.mintB.extensions)==null?void 0:P.feeConfig,e,!0)];return{liquidity:o,amountA:d,amountB:p,amountSlippageA:y,amountSlippageB:f,expirationTime:ot(d.expirationTime,p.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let r=t.filter(u=>!n[u.id]).map(u=>new Ve(u.id));(await rt(e,r)).forEach((u,c)=>{!u||(n[r[c].toBase58()]=Nn.decode(u.data))});let s=t.map(u=>Ke(new Ve(u.programId),new Ve(u.id)).publicKey),a=await ye.fetchExBitmaps({connection:e,exBitmapAddress:s,batchRequest:!1});return t.reduce((u,c)=>ee(J({},u),{[c.id]:ee(J({},n[c.id]),{id:new Ve(c.id),version:6,programId:new Ve(c.programId),mintA:c.mintA,mintB:c.mintB,ammConfig:ee(J({},c.config),{id:new Ve(c.config.id),fundOwner:""}),currentPrice:new S(c.price),exBitmapInfo:a[Ke(new Ve(c.programId),new Ve(c.id)).publicKey.toBase58()],startTime:n[c.id].startTime.toNumber()})}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};var G=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),o=r.div(n);return r.mod(n).eq(ce)||(o=o.add(Re)),o}static mulDivFloor(e,t,n){if(n.eq(ce))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(ce))throw new Error("division by 0");return e.mul(t).add(n.sub(Re)).div(n)}static x64ToDecimal(e,t){return new S(e.toString()).div(S.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new U(e.mul(S.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(Qt).sub(t).mod(Qt)}};function ge(i,e){return Ln(i.mul(e),64,256)}function zo(i,e,t){let n=i.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function Ln(i,e,t){let n=i.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var V=class{static sqrtPriceX64ToPrice(e,t,n){return G.x64ToDecimal(e).pow(2).mul(S.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return G.decimalToX64(e.mul(S.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(ce))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ce))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(ce))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ce))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(ce))return e;let o=t.shln(It);if(r){let s=o,a=o.add(n.mul(e));return a.gte(s)?G.mulDivCeil(s,e,a):G.mulDivRoundingUp(s,Re,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return G.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let o=n.shln(It);if(r)return e.add(o.div(t));{let s=G.mulDivRoundingUp(o,Re,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<he||e>Te)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new U("18445821805675395072"):new U("18446744073709551616");return(t&2)!=0&&(n=ge(n,new U("18444899583751176192"))),(t&4)!=0&&(n=ge(n,new U("18443055278223355904"))),(t&8)!=0&&(n=ge(n,new U("18439367220385607680"))),(t&16)!=0&&(n=ge(n,new U("18431993317065453568"))),(t&32)!=0&&(n=ge(n,new U("18417254355718170624"))),(t&64)!=0&&(n=ge(n,new U("18387811781193609216"))),(t&128)!=0&&(n=ge(n,new U("18329067761203558400"))),(t&256)!=0&&(n=ge(n,new U("18212142134806163456"))),(t&512)!=0&&(n=ge(n,new U("17980523815641700352"))),(t&1024)!=0&&(n=ge(n,new U("17526086738831433728"))),(t&2048)!=0&&(n=ge(n,new U("16651378430235570176"))),(t&4096)!=0&&(n=ge(n,new U("15030750278694412288"))),(t&8192)!=0&&(n=ge(n,new U("12247334978884435968"))),(t&16384)!=0&&(n=ge(n,new U("8131365268886854656"))),(t&32768)!=0&&(n=ge(n,new U("3584323654725218816"))),(t&65536)!=0&&(n=ge(n,new U("696457651848324352"))),(t&131072)!=0&&(n=ge(n,new U("26294789957507116"))),(t&262144)!=0&&(n=ge(n,new U("37481735321082"))),e>0&&(n=fi.div(n)),n}static getTickFromPrice(e,t,n){return V.getTickFromSqrtPriceX64(V.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(ze)||e.lt(Xe))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new U(t-64),r=zo(n,32,128),o=new U("8000000000000000","hex"),s=0,a=new U(0),u=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new U(0))&&s<bi;){u=u.mul(u);let y=u.shrn(127);u=u.shrn(63+y.toNumber()),a=a.add(o.mul(y)),o=o.shrn(1),s+=1}let c=a.shrn(32),m=r.add(c).mul(new U(yi)),d=Ln(m.sub(new U(gi)),64,128).toNumber(),p=Ln(m.add(new U(ki)),64,128).toNumber();return d==p?d:V.getSqrtPriceX64FromTick(p).lte(e)?p:d}},mt=class{static getTickWithPriceAndTickspacing(e,t,n,r){let s=V.getTickFromSqrtPriceX64(V.priceToSqrtPriceX64(e,n,r))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,r){let o=mt.getTickWithPriceAndTickspacing(e,t,n,r),s=V.getSqrtPriceX64FromTick(o);return V.sqrtPriceX64ToPrice(s,n,r)}},Z=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ce))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(It),s=t.sub(e);return r?G.mulDivRoundingUp(G.mulDivCeil(o,s,t),Re,e):G.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ce))throw new Error("sqrtPriceX64A must greater than 0");return r?G.mulDivCeil(n,t.sub(e),Le):G.mulDivFloor(n,t.sub(e),Le)}static getLiquidityFromTokenAmountA(e,t,n,r){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return r?G.mulDivRoundingUp(a,Re,hn):a.shrn(It)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),G.mulDivFloor(n,hn,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return Z.getLiquidityFromTokenAmountA(t,n,r,!1);if(e.lt(n)){let s=Z.getLiquidityFromTokenAmountA(e,n,r,!1),a=Z.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return Z.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:Z.getTokenAmountAFromLiquidity(t,n,r,o),amountB:new U(0)};if(e.lt(n)){let s=Z.getTokenAmountAFromLiquidity(e,n,r,o),a=Z.getTokenAmountBFromLiquidity(t,e,r,o);return{amountA:s,amountB:a}}else return{amountA:new U(0),amountB:Z.getTokenAmountBFromLiquidity(t,n,r,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,r,o,s,a){let{amountA:u,amountB:c}=Z.getAmountsFromLiquidity(e,t,n,r,s),l=o?1+a:1-a,m=new U(new S(u.toString()).mul(l).toFixed(0)),d=new U(new S(c.toString()).mul(l).toFixed(0));return{amountSlippageA:m,amountSlippageB:d}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:r,slippage:o,add:s,epochInfo:a,amountAddFee:u}){var T,P,I,W;let c=V.priceToSqrtPriceX64(new S(e.price),e.mintA.decimals,e.mintB.decimals),l=V.getSqrtPriceX64FromTick(t),m=V.getSqrtPriceX64FromTick(n),d=s?1+o:1-o,p=Z.getAmountsFromLiquidity(c,l,m,r,s),[y,f]=[ue(p.amountA,(T=e.mintA.extensions)==null?void 0:T.feeConfig,a,u),ue(p.amountB,(P=e.mintB.extensions)==null?void 0:P.feeConfig,a,u)],[b,k]=[ue(new U(new S(p.amountA.toString()).mul(d).toFixed(0)),(I=e.mintA.extensions)==null?void 0:I.feeConfig,a,u),ue(new U(new S(p.amountB.toString()).mul(d).toFixed(0)),(W=e.mintB.extensions)==null?void 0:W.feeConfig,a,u)];return{liquidity:r,amountA:y,amountB:f,amountSlippageA:b,amountSlippageB:k,expirationTime:ot(y.expirationTime,f.expirationTime)}}},dt=class{static swapCompute(e,t,n,r,o,s,a,u,c,l,m,d,p,y,f=!1){if(d.eq(ce))throw new Error("amountSpecified must not be 0");if(y||(y=s?Xe.add(Re):ze.sub(Re)),s){if(y.lt(Xe))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(y.gte(m))throw new Error("sqrtPriceX64 must smaller than current")}else{if(y.gt(ze))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(y.lte(m))throw new Error("sqrtPriceX64 must greater than current")}let b=d.gt(ce),k={amountSpecifiedRemaining:d,amountCalculated:ce,sqrtPriceX64:m,tick:c>p?Math.min(p+H.tickCount(l)-1,c):p,accounts:[],liquidity:u,feeAmount:new U(0)},T=p,P=n[p],I=0,W=!s&&P.startTickIndex===k.tick;for(;!k.amountSpecifiedRemaining.eq(ce)&&!k.sqrtPriceX64.eq(y);){I>10;let B={};B.sqrtPriceStartX64=k.sqrtPriceX64;let E=L.nextInitTick(P,k.tick,l,s,W),K=E||null,z=null;if(!(K!=null&&K.liquidityGross.gtn(0))){let F=ye.nextInitializedTickArrayStartIndex({tickCurrent:k.tick,tickSpacing:l,tickArrayBitmap:r,exBitmapInfo:o},T,s);if(!F.isExist){if(f)return{allTrade:!1,amountSpecifiedRemaining:k.amountSpecifiedRemaining,amountCalculated:k.amountCalculated,feeAmount:k.feeAmount,sqrtPriceX64:k.sqrtPriceX64,liquidity:k.liquidity,tickCurrent:k.tick,accounts:k.accounts};throw Error("swapCompute LiquidityInsufficient")}T=F.nextStartIndex;let{publicKey:fe}=te(e,t,T);z=fe,P=n[T];try{K=L.firstInitializedTick(P,s)}catch{throw Error("not found next tick info")}}B.tickNext=K.tick,B.initialized=K.liquidityGross.gtn(0),p!==T&&z&&(k.accounts.push(z),p=T),B.tickNext<he?B.tickNext=he:B.tickNext>Te&&(B.tickNext=Te),B.sqrtPriceNextX64=V.getSqrtPriceX64FromTick(B.tickNext);let h;if(s&&B.sqrtPriceNextX64.lt(y)||!s&&B.sqrtPriceNextX64.gt(y)?h=y:h=B.sqrtPriceNextX64,[k.sqrtPriceX64,B.amountIn,B.amountOut,B.feeAmount]=dt.swapStepCompute(k.sqrtPriceX64,h,k.liquidity,k.amountSpecifiedRemaining,a),k.feeAmount=k.feeAmount.add(B.feeAmount),b?(k.amountSpecifiedRemaining=k.amountSpecifiedRemaining.sub(B.amountIn.add(B.feeAmount)),k.amountCalculated=k.amountCalculated.sub(B.amountOut)):(k.amountSpecifiedRemaining=k.amountSpecifiedRemaining.add(B.amountOut),k.amountCalculated=k.amountCalculated.add(B.amountIn.add(B.feeAmount))),k.sqrtPriceX64.eq(B.sqrtPriceNextX64)){if(B.initialized){let F=K.liquidityNet;s&&(F=F.mul(je)),k.liquidity=Z.addDelta(k.liquidity,F)}W=B.tickNext!=k.tick&&!s&&P.startTickIndex===B.tickNext,k.tick=s?B.tickNext-1:B.tickNext}else if(k.sqrtPriceX64!=B.sqrtPriceStartX64){let F=V.getTickFromSqrtPriceX64(k.sqrtPriceX64);W=F!=k.tick&&!s&&P.startTickIndex===F,k.tick=F}++I}try{let{nextStartIndex:B,isExist:E}=H.nextInitializedTickArray(k.tick,l,s,r,o);E&&p!==B&&(k.accounts.push(te(e,t,B).publicKey),p=B)}catch{}return{allTrade:!0,amountSpecifiedRemaining:ce,amountCalculated:k.amountCalculated,feeAmount:k.feeAmount,sqrtPriceX64:k.sqrtPriceX64,liquidity:k.liquidity,tickCurrent:k.tick,accounts:k.accounts}}static swapStepCompute(e,t,n,r,o){let s={sqrtPriceX64Next:new U(0),amountIn:new U(0),amountOut:new U(0),feeAmount:new U(0)},a=e.gte(t),u=r.gte(ce);if(u){let l=G.mulDivFloor(r,jt.sub(new U(o.toString())),jt);s.amountIn=a?Z.getTokenAmountAFromLiquidity(t,e,n,!0):Z.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=V.getNextSqrtPriceX64FromInput(e,n,l,a)}else s.amountOut=a?Z.getTokenAmountBFromLiquidity(t,e,n,!1):Z.getTokenAmountAFromLiquidity(e,t,n,!1),r.mul(je).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=V.getNextSqrtPriceX64FromOutput(e,n,r.mul(je),a);let c=t.eq(s.sqrtPriceX64Next);return a?(c&&u||(s.amountIn=Z.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),c&&!u||(s.amountOut=Z.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=c&&u?s.amountIn:Z.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=c&&!u?s.amountOut:Z.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!u&&s.amountOut.gt(r.mul(je))&&(s.amountOut=r.mul(je)),u&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=r.sub(s.amountIn):s.feeAmount=G.mulDivCeil(s.amountIn,new U(o),jt.sub(new U(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};import{ASSOCIATED_TOKEN_PROGRAM_ID as Ei,TOKEN_2022_PROGRAM_ID as st,TOKEN_PROGRAM_ID as Ae}from"@solana/spl-token";import{Keypair as On,PublicKey as x,SystemProgram as Rt,TransactionInstruction as qe}from"@solana/web3.js";import Fi from"bn.js";Li.span;var vi=me("Raydium_Clmm"),Ge={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},Lt=class{static createPoolInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,y){let f=_([q("sqrtPriceX64"),g("startTime")]),b=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:Rt.programId,isSigner:!1,isWritable:!1},{pubkey:at,isSigner:!1,isWritable:!1}],k=Buffer.alloc(f.span);f.encode({sqrtPriceX64:p,startTime:y},k);let T=Buffer.from([...Ge.createPool,...k]);return new qe({keys:b,programId:e,data:T})}static async createPoolInstructions(e){let{programId:t,owner:n,mintA:r,mintB:o,ammConfigId:s,initialPriceX64:a,startTime:u}=e,[c,l]=[new x(r.address),new x(o.address)],{publicKey:m}=hi(t,s,c,l),{publicKey:d}=Bi(t,m),{publicKey:p}=xn(t,m,c),{publicKey:y}=xn(t,m,l),f=[this.createPoolInstruction(t,m,n,s,d,c,p,new x(r.programId||Ae),l,y,new x(o.programId||Ae),Ke(t,m).publicKey,a,u)];return{signers:[],instructions:f,instructionTypes:[oe.CreateAccount,oe.ClmmCreatePool],address:{poolId:m,observationId:d,mintAVault:p,mintBVault:y},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,y,f,b,k,T,P,I,W,B,E,K,z,h){let F=_([we("tickLowerIndex"),we("tickUpperIndex"),we("tickArrayLowerStartIndex"),we("tickArrayUpperStartIndex"),q("liquidity"),g("amountMaxA"),g("amountMaxB"),Ee("withMetadata"),X("optionBaseFlag"),Ee("baseFlag")]),fe=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],le=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:at,isSigner:!1,isWritable:!1},{pubkey:Rt.programId,isSigner:!1,isWritable:!1},{pubkey:Ae,isSigner:!1,isWritable:!1},{pubkey:Ei,isSigner:!1,isWritable:!1},{pubkey:yt,isSigner:!1,isWritable:!1},{pubkey:st,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:k,isSigner:!1,isWritable:!1},...fe],xe=Buffer.alloc(F.span);F.encode({tickLowerIndex:T,tickUpperIndex:P,tickArrayLowerStartIndex:I,tickArrayUpperStartIndex:W,liquidity:B,amountMaxA:E,amountMaxB:K,withMetadata:z==="create",baseFlag:!1,optionBaseFlag:0},xe);let se=Buffer.from([...Ge.openPosition,...xe]);return new qe({keys:le,programId:e,data:se})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[d,p]=[new x(e.programId),new x(e.id)],y;if(l)y=new x((await l(1))[0]);else{let K=On.generate();m.push(K),y=K.publicKey}let f=L.getTickArrayStartIndexByTick(r,e.config.tickSpacing),b=L.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:k}=te(d,p,f),{publicKey:T}=te(d,p,b),{publicKey:P}=Ye(n.wallet,y,Ae),{publicKey:I}=$t(y),{publicKey:W}=De(d,y),{publicKey:B}=ut(d,p,r,o),E=this.openPositionFromLiquidityInstruction(d,n.feePayer,p,n.wallet,y,P,I,B,k,T,W,n.tokenAccountA,n.tokenAccountB,new x(t.vault.A),new x(t.vault.B),new x(e.mintA.address),new x(e.mintB.address),r,o,f,b,s,a,u,c);return{signers:m,instructions:[E],instructionTypes:[oe.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:y,tickArrayLower:k,tickArrayUpper:T,positionNftAccount:P,metadataAccount:I,personalPosition:W,protocolPosition:B}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[d,p]=[new x(e.programId),new x(e.id)],y;if(l)y=new x((await l(1))[0]);else{let K=On.generate();m.push(K),y=K.publicKey}let f=L.getTickArrayStartIndexByTick(r,e.config.tickSpacing),b=L.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:k}=te(d,p,f),{publicKey:T}=te(d,p,b),{publicKey:P}=Ye(n.wallet,y,Ae),{publicKey:I}=$t(y),{publicKey:W}=De(d,y),{publicKey:B}=ut(d,p,r,o),E=this.openPositionFromBaseInstruction(d,n.feePayer,p,n.wallet,y,P,I,B,k,T,W,n.tokenAccountA,n.tokenAccountB,new x(t.vault.A),new x(t.vault.B),new x(e.mintA.address),new x(e.mintB.address),r,o,f,b,c,s,a,u,ye.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,b])?Ke(d,p).publicKey:void 0);return{address:{nftMint:y,tickArrayLower:k,tickArrayUpper:T,positionNftAccount:P,metadataAccount:I,personalPosition:W,protocolPosition:B},instructions:[E],signers:m,instructionTypes:[oe.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,y,f,b,k,T,P,I,W,B,E,K,z,h){let F=_([we("tickLowerIndex"),we("tickUpperIndex"),we("tickArrayLowerStartIndex"),we("tickArrayUpperStartIndex"),q("liquidity"),g("amountMaxA"),g("amountMaxB"),Ee("withMetadata"),X("optionBaseFlag"),Ee("baseFlag")]),fe=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],le=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:at,isSigner:!1,isWritable:!1},{pubkey:Rt.programId,isSigner:!1,isWritable:!1},{pubkey:Ae,isSigner:!1,isWritable:!1},{pubkey:Ei,isSigner:!1,isWritable:!1},{pubkey:yt,isSigner:!1,isWritable:!1},{pubkey:st,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:k,isSigner:!1,isWritable:!1},...fe],xe=Buffer.alloc(F.span);F.encode({tickLowerIndex:T,tickUpperIndex:P,tickArrayLowerStartIndex:I,tickArrayUpperStartIndex:W,liquidity:new Fi(0),amountMaxA:E==="MintA"?K:z,amountMaxB:E==="MintA"?z:K,withMetadata:B==="create",baseFlag:E==="MintA",optionBaseFlag:1},xe);let se=Buffer.from([...Ge.openPosition,...xe]);return new qe({keys:le,programId:e,data:se})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m,d=[];if(l)m=new x((await l(1))[0]);else{let K=On.generate();d.push(K),m=K.publicKey}let[p,y]=[new x(e.programId),new x(e.id)],f=L.getTickArrayStartIndexByTick(r,e.config.tickSpacing),b=L.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:k}=te(p,y,f),{publicKey:T}=te(p,y,b),{publicKey:P}=Ye(n.wallet,m,Ae),{publicKey:I}=$t(m),{publicKey:W}=De(p,m),{publicKey:B}=ut(p,y,r,o),E=this.openPositionFromLiquidityInstruction(p,n.wallet,y,n.wallet,m,P,I,B,k,T,W,n.tokenAccountA,n.tokenAccountB,new x(t.vault.A),new x(t.vault.B),new x(t.mintA.address),new x(t.mintB.address),r,o,f,b,s,a,u,c,ye.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,b])?Ke(p,y).publicKey:void 0);return{address:{nftMint:m,tickArrayLower:k,tickArrayUpper:T,positionNftAccount:P,metadataAccount:I,personalPosition:W,protocolPosition:B},instructions:[E],signers:d,instructionTypes:[oe.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,r,o){let s=_([]),a=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:Rt.programId,isSigner:!1,isWritable:!1},{pubkey:Ae,isSigner:!1,isWritable:!1}],u=Buffer.alloc(s.span);s.encode({},u);let c=Buffer.from([...Ge.closePosition,...u]);return new qe({keys:a,programId:e,data:c})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:r}){let o=new x(e.programId),{publicKey:s}=Ye(n.wallet,r.nftMint,Ae),{publicKey:a}=De(o,r.nftMint),u=[];return u.push(this.closePositionInstruction(o,n.wallet,r.nftMint,s,a)),{address:{positionNftAccount:s,personalPosition:a},signers:[],instructions:u,instructionTypes:[oe.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,y,f,b,k,T){let P=_([q("liquidity"),g("amountMaxA"),g("amountMaxB"),X("optionBaseFlag"),Ee("baseFlag")]),I=[...T?[{pubkey:T,isSigner:!1,isWritable:!0}]:[]],W=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:Ae,isSigner:!1,isWritable:!1},{pubkey:st,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...I],B=Buffer.alloc(P.span);P.encode({liquidity:f,amountMaxA:b,amountMaxB:k,optionBaseFlag:0,baseFlag:!1},B);let E=Buffer.from([...Ge.increaseLiquidity,...B]);return new qe({keys:W,programId:e,data:E})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMaxA:s,amountMaxB:a}){let[u,c]=[new x(e.programId),new x(e.id)],l=L.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=L.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=te(u,c,l),{publicKey:p}=te(u,c,m),{publicKey:y}=Ye(r.wallet,n.nftMint,Ae),{publicKey:f}=De(u,n.nftMint),{publicKey:b}=ut(u,c,n.tickLower,n.tickUpper),k=this.increasePositionFromLiquidityInstruction(u,r.wallet,y,f,c,b,d,p,r.tokenAccountA,r.tokenAccountB,new x(t.vault.A),new x(t.vault.B),new x(e.mintA.address),new x(e.mintB.address),o,s,a,ye.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?Ke(u,c).publicKey:void 0);return{address:{tickArrayLower:d,tickArrayUpper:p,positionNftAccount:y,personalPosition:f,protocolPosition:b},signers:[],instructions:[k],instructionTypes:[oe.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,base:o,baseAmount:s,otherAmountMax:a}){let[u,c]=[new x(e.programId),new x(e.id)],l=L.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=L.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=te(u,c,l),{publicKey:p}=te(u,c,m),{publicKey:y}=Ye(r.wallet,n.nftMint,Ae),{publicKey:f}=De(u,n.nftMint),{publicKey:b}=ut(u,c,n.tickLower,n.tickUpper);return{address:{tickArrayLower:d,tickArrayUpper:p,positionNftAccount:y,personalPosition:f,protocolPosition:b},instructions:[this.increasePositionFromBaseInstruction(u,r.wallet,y,f,c,b,d,p,r.tokenAccountA,r.tokenAccountB,new x(t.vault.A),new x(t.vault.B),new x(e.mintA.address),new x(e.mintB.address),o,s,a,ye.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?Ke(u,c).publicKey:void 0)],signers:[],instructionTypes:[oe.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,y,f,b,k,T){let P=_([q("liquidity"),g("amountMaxA"),g("amountMaxB"),X("optionBaseFlag"),Ee("baseFlag")]),I=[...T?[{pubkey:T,isSigner:!1,isWritable:!0}]:[]],W=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:Ae,isSigner:!1,isWritable:!1},{pubkey:st,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...I],B=Buffer.alloc(P.span);P.encode({liquidity:new Fi(0),amountMaxA:f==="MintA"?b:k,amountMaxB:f==="MintA"?k:b,baseFlag:f==="MintA",optionBaseFlag:1},B);let E=Buffer.from([...Ge.increaseLiquidity,...B]);return new qe({keys:W,programId:e,data:E})}static decreaseLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,y,f,b,k,T,P){let I=_([q("liquidity"),g("amountMinA"),g("amountMinB")]),W=[...P?[{pubkey:P,isSigner:!1,isWritable:!0}]:[],...f.map(z=>[{pubkey:z.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:z.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:z.rewardMint,isSigner:!1,isWritable:!1}]).flat()],B=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:Ae,isSigner:!1,isWritable:!1},{pubkey:st,isSigner:!1,isWritable:!1},{pubkey:Vt,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...W],E=Buffer.alloc(I.span);I.encode({liquidity:b,amountMinA:k,amountMinB:T},E);let K=Buffer.from([...Ge.decreaseLiquidity,...E]);return new qe({keys:B,programId:e,data:K})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMinA:s,amountMinB:a,programId:u}){let[c,l]=[new x(e.programId),new x(e.id)],m=L.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=L.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:p}=te(c,l,m),{publicKey:y}=te(c,l,d),{publicKey:f}=Ye(r.wallet,n.nftMint,u),{publicKey:b}=De(c,n.nftMint),{publicKey:k}=ut(c,l,n.tickLower,n.tickUpper),T=[];for(let I=0;I<e.rewardDefaultInfos.length;I++)T.push({poolRewardVault:new x(t.rewardInfos[I].vault),ownerRewardVault:r.rewardAccounts[I],rewardMint:new x(e.rewardDefaultInfos[I].mint.address)});let P=[];return P.push(this.decreaseLiquidityInstruction(c,r.wallet,f,b,l,k,p,y,r.tokenAccountA,r.tokenAccountB,new x(t.vault.A),new x(t.vault.B),new x(e.mintA.address),new x(e.mintB.address),T,o,s,a,ye.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,d])?Ke(c,l).publicKey:void 0)),{address:{tickArrayLower:p,tickArrayUpper:y,positionNftAccount:f,personalPosition:b,protocolPosition:k},signers:[],instructions:P,instructionTypes:[oe.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,y,f,b,k){let T=_([g("amount"),g("otherAmountThreshold"),q("sqrtPriceLimitX64"),Ee("isBaseInput")]),P=[...k?[{pubkey:k,isSigner:!1,isWritable:!0}]:[],...m.map(E=>({pubkey:E,isSigner:!1,isWritable:!0}))],I=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:Ae,isSigner:!1,isWritable:!1},{pubkey:st,isSigner:!1,isWritable:!1},{pubkey:Vt,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...P],W=Buffer.alloc(T.span);T.encode({amount:p,otherAmountThreshold:y,sqrtPriceLimitX64:f,isBaseInput:b},W);let B=Buffer.from([...Ge.swap,...W]);return new qe({keys:I,programId:e,data:B})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,inputMint:o,amountIn:s,amountOutMin:a,sqrtPriceLimitX64:u,remainingAccounts:c}){let[l,m]=[new x(e.programId),new x(e.id)],[d,p]=[new x(t.vault.A),new x(t.vault.B)],[y,f]=[new x(e.mintA.address),new x(e.mintB.address)],b=e.mintA.address===o.toString(),k=[this.swapInstruction(l,r.wallet,m,new x(e.config.id),b?r.tokenAccountA:r.tokenAccountB,b?r.tokenAccountB:r.tokenAccountA,b?d:p,b?p:d,b?y:f,b?f:y,c,n,s,a,u,!0,Ke(l,m).publicKey)];return{signers:[],instructions:k,instructionTypes:[oe.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static makeSwapBaseOutInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,outputMint:o,amountOut:s,amountInMax:a,sqrtPriceLimitX64:u,remainingAccounts:c}){let[l,m]=[new x(e.programId),new x(e.id)],[d,p]=[new x(t.vault.A),new x(t.vault.B)],[y,f]=[new x(e.mintA.address),new x(e.mintB.address)],b=e.mintA.address===o.toBase58(),k=[this.swapInstruction(l,r.wallet,m,new x(e.config.id),b?r.tokenAccountB:r.tokenAccountA,b?r.tokenAccountA:r.tokenAccountB,b?p:d,b?d:p,b?f:y,b?y:f,c,n,s,a,u,!1,Ke(l,m).publicKey)];return{signers:[],instructions:k,instructionTypes:[oe.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,r,o,s,a,u,c,l,m,d){let p=_([g("openTime"),g("endTime"),q("emissionsPerSecondX64")]),y=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:Rt.programId,isSigner:!1,isWritable:!1},{pubkey:at,isSigner:!1,isWritable:!1}],f=Buffer.alloc(p.span);p.encode({openTime:ae(l),endTime:ae(m),emissionsPerSecondX64:d},f);let b=Buffer.from([...Ge.initReward,...f]);return new qe({keys:y,programId:e,data:b})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new x(e.programId),new x(e.id)],a=Ti(o,s,r.mint).publicKey,u=en(o).publicKey,c=[this.initRewardInstruction(o,n.wallet,s,u,new x(e.config.id),n.tokenAccount,r.programId,r.mint,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:u},signers:[],instructions:c,instructionTypes:[oe.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,r,o,s,a,u,c,l,m,d){let p=_([X("rewardIndex"),q("emissionsPerSecondX64"),g("openTime"),g("endTime")]),y=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:Ae,isSigner:!1,isWritable:!1},{pubkey:st,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0}],f=Buffer.alloc(p.span);p.encode({rewardIndex:c,emissionsPerSecondX64:d,openTime:ae(l),endTime:ae(m)},f);let b=Buffer.from([...Ge.setRewardEmissions,...f]);return new qe({keys:y,programId:e,data:b})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new x(e.programId),new x(e.id)],a,u,c;for(let d=0;d<e.rewardDefaultInfos.length;d++)e.rewardDefaultInfos[d].mint.address===r.mint.toString()&&(a=d,u=new x(t.rewardInfos[d].vault),c=new x(t.rewardInfos[d].mint.address));(a===void 0||u===void 0)&&vi.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=en(o).publicKey,m=[this.setRewardInstruction(o,n.wallet,s,l,new x(e.config.id),n.tokenAccount,u,c,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{rewardVault:u,operationId:l},signers:[],instructions:m,instructionTypes:[oe.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,r,o,s,a){let u=_([X("rewardIndex")]),c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:Ae,isSigner:!1,isWritable:!1},{pubkey:st,isSigner:!1,isWritable:!1},{pubkey:Vt,isSigner:!1,isWritable:!1}],l=Buffer.alloc(u.span);u.encode({rewardIndex:a},l);let m=Buffer.from([...Ge.collectReward,...l]);return new qe({keys:c,programId:e,data:m})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:r}){let[o,s]=[new x(e.programId),new x(e.id)],a,u;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===r.toString()&&(a=l,u=new x(t.rewardInfos[l].vault));(a===void 0||u===void 0)&&vi.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let c=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,u,r,a)];return{address:{rewardVault:u},signers:[],instructions:c,instructionTypes:[oe.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}};import dp from"bn.js";import{AccountLayout as fp,TOKEN_PROGRAM_ID as bp}from"@solana/spl-token";import{TOKEN_PROGRAM_ID as _i,ASSOCIATED_TOKEN_PROGRAM_ID as ef}from"@solana/spl-token";import{PublicKey as nf,TransactionInstruction as Di,SystemProgram as rf,SYSVAR_RENT_PUBKEY as of}from"@solana/web3.js";var Mn=_([X("instruction"),g("amountIn"),g("minAmountOut")]),En=_([X("instruction"),g("maxAmountIn"),g("amountOut")]),Gp=_([X("instruction"),X("nonce")]),Ho=_([X("instruction"),X("nonce"),g("startTime")]),Up=_([g("status"),g("nonce"),g("maxOrder"),g("depth"),g("baseDecimal"),g("quoteDecimal"),g("state"),g("resetFlag"),g("minSize"),g("volMaxCutRatio"),g("amountWaveRatio"),g("baseLotSize"),g("quoteLotSize"),g("minPriceMultiplier"),g("maxPriceMultiplier"),g("systemDecimalValue"),g("minSeparateNumerator"),g("minSeparateDenominator"),g("tradeFeeNumerator"),g("tradeFeeDenominator"),g("pnlNumerator"),g("pnlDenominator"),g("swapFeeNumerator"),g("swapFeeDenominator"),g("baseNeedTakePnl"),g("quoteNeedTakePnl"),g("quoteTotalPnl"),g("baseTotalPnl"),g("poolOpenTime"),g("punishPcAmount"),g("punishCoinAmount"),g("orderbookToInitTime"),q("swapBaseInAmount"),q("swapQuoteOutAmount"),g("swapBase2QuoteFee"),q("swapQuoteInAmount"),q("swapBaseOutAmount"),g("swapQuote2BaseFee"),M("baseVault"),M("quoteVault"),M("baseMint"),M("quoteMint"),M("lpMint"),M("openOrders"),M("marketId"),M("marketProgramId"),M("targetOrders"),M("withdrawQueue"),M("lpVault"),M("owner"),g("lpReserve"),Y(g(),3,"padding")]),Xp=_([g("accountType"),g("status"),g("nonce"),g("maxOrder"),g("depth"),g("baseDecimal"),g("quoteDecimal"),g("state"),g("resetFlag"),g("minSize"),g("volMaxCutRatio"),g("amountWaveRatio"),g("baseLotSize"),g("quoteLotSize"),g("minPriceMultiplier"),g("maxPriceMultiplier"),g("systemDecimalsValue"),g("abortTradeFactor"),g("priceTickMultiplier"),g("priceTick"),g("minSeparateNumerator"),g("minSeparateDenominator"),g("tradeFeeNumerator"),g("tradeFeeDenominator"),g("pnlNumerator"),g("pnlDenominator"),g("swapFeeNumerator"),g("swapFeeDenominator"),g("baseNeedTakePnl"),g("quoteNeedTakePnl"),g("quoteTotalPnl"),g("baseTotalPnl"),g("poolOpenTime"),g("punishPcAmount"),g("punishCoinAmount"),g("orderbookToInitTime"),q("swapBaseInAmount"),q("swapQuoteOutAmount"),q("swapQuoteInAmount"),q("swapBaseOutAmount"),g("swapQuote2BaseFee"),g("swapBase2QuoteFee"),M("baseVault"),M("quoteVault"),M("baseMint"),M("quoteMint"),M("lpMint"),M("modelDataAccount"),M("openOrders"),M("marketId"),M("marketProgramId"),M("targetOrders"),M("owner"),Y(g(),64,"padding")]),Qo=_([X("instruction"),g("baseAmountIn"),g("quoteAmountIn"),g("fixedSide")]),Zo=_([X("instruction"),g("amountIn")]);var zp=_([g("fee")]);import{PublicKey as Yo}from"@solana/web3.js";var Fn=new Yo("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),jo=5e4,Jo=_([g("x"),g("y"),g("price")]),jp=_([g("accountType"),g("status"),g("multiplier"),g("validDataCount"),Y(Jo,jo,"DataElement")]);var Wi=me("Raydium_liquidity_instruction");function $o({poolKeys:i,userKeys:e,amountIn:t,minAmountOut:n},r){let o=Ne(i),s=Buffer.alloc(Mn.span);Mn.encode({instruction:9,amountIn:ae(t),minAmountOut:ae(n)},s);let a=[A({pubkey:_i,isWritable:!1}),A({pubkey:o.id}),A({pubkey:o.authority,isWritable:!1}),A({pubkey:o.openOrders})];return r===4&&a.push(A({pubkey:o.targetOrders})),a.push(A({pubkey:o.vault.A}),A({pubkey:o.vault.B})),r===5&&a.push(A({pubkey:Fn})),a.push(A({pubkey:o.marketProgramId,isWritable:!1}),A({pubkey:o.marketId}),A({pubkey:o.marketBids}),A({pubkey:o.marketAsks}),A({pubkey:o.marketEventQueue}),A({pubkey:o.marketBaseVault}),A({pubkey:o.marketQuoteVault}),A({pubkey:o.marketAuthority,isWritable:!1}),A({pubkey:e.tokenAccountIn}),A({pubkey:e.tokenAccountOut}),A({pubkey:e.owner,isWritable:!1})),new Di({programId:o.programId,keys:a,data:s})}function es({poolKeys:i,userKeys:e,maxAmountIn:t,amountOut:n},r){let o=Ne(i),s=Buffer.alloc(En.span);En.encode({instruction:11,maxAmountIn:ae(t),amountOut:ae(n)},s);let a=[A({pubkey:_i,isWritable:!1}),A({pubkey:o.id}),A({pubkey:o.authority,isWritable:!1}),A({pubkey:o.openOrders}),A({pubkey:o.targetOrders}),A({pubkey:o.vault.A}),A({pubkey:o.vault.B})];return r===5&&a.push(A({pubkey:Fn})),a.push(A({pubkey:o.marketProgramId,isWritable:!1}),A({pubkey:o.marketId}),A({pubkey:o.marketBids}),A({pubkey:o.marketAsks}),A({pubkey:o.marketEventQueue}),A({pubkey:o.marketBaseVault}),A({pubkey:o.marketQuoteVault}),A({pubkey:o.marketAuthority,isWritable:!1}),A({pubkey:e.tokenAccountIn}),A({pubkey:e.tokenAccountOut}),A({pubkey:e.owner,isWritable:!1,isSigner:!0})),new Di({programId:o.programId,keys:a,data:s})}function Vi(i){let{poolKeys:e,version:t,userKeys:n,amountIn:r,amountOut:o,fixedSide:s}=i;if(t===4||t===5){let a={poolKeys:e,userKeys:n};if(s==="in")return $o(ee(J({},a),{amountIn:r,minAmountOut:o}),t);if(s==="out")return es(ee(J({},a),{maxAmountIn:r,amountOut:o}),t);Wi.logWithError("invalid params","params",i)}throw Wi.logWithError("invalid version","poolKeys.version",t),new Error("invalid version")}var yf=_([Be(8),X("bump"),Ee("disableCreatePool"),ct("index"),g("tradeFeeRate"),g("protocolFeeRate"),g("fundFeeRate"),g("createPoolFee"),M("protocolOwner"),M("fundOwner"),Y(g(),16)]),gf=_([Be(8),M("configId"),M("poolCreator"),M("vaultA"),M("vaultB"),M("mintLp"),M("mintA"),M("mintB"),M("mintProgramA"),M("mintProgramB"),M("observationId"),X("bump"),X("status"),X("lpDecimals"),X("mintDecimalA"),X("mintDecimalB"),g("lpAmount"),g("protocolFeesMintA"),g("protocolFeesMintB"),g("fundFeesMintA"),g("fundFeesMintB"),g("openTime"),Y(g(),32)]);import{TransactionInstruction as ts}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Tf,TOKEN_2022_PROGRAM_ID as Bf,ASSOCIATED_TOKEN_PROGRAM_ID as xf}from"@solana/spl-token";var Cf=me("Raydium_cpmm"),ns={initialize:[175,175,109,31,13,152,155,237],deposit:[242,35,198,137,82,225,242,182],withdraw:[183,18,70,156,148,109,161,34],swapBaseInput:[143,190,90,218,196,30,51,222],swapBaseOutput:[55,217,98,86,163,74,180,173]};function qi(i,e,t,n,r,o,s,a,u,c,l,m,d,p,y,f){let b=_([g("amountIn"),g("amounOutMin")]),k=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!0}],T=Buffer.alloc(b.span);return b.encode({amountIn:y,amounOutMin:f},T),new ts({keys:k,programId:i,data:Buffer.from([...ns.swapBaseInput,...T])})}var Rf=Buffer.from("vault_and_lp_mint_auth_seed","utf8"),Lf=Buffer.from("amm_config","utf8"),Of=Buffer.from("pool","utf8"),Mf=Buffer.from("pool_lp_mint","utf8"),Ef=Buffer.from("pool_vault","utf8"),Ff=Buffer.from("observation","utf8");import jf from"bn.js";import is from"bn.js";var _f=new is(1e6);import rs from"bn.js";var Xf=new rs(0);import nb from"decimal.js-light";function Tb(i,e,t,n,r,o,s,a,u,c,l,m){let d=_([X("instruction"),g("amountIn"),g("amountOut")]),p=[{pubkey:_n.programId,isSigner:!1,isWritable:!1},{pubkey:vn,isSigner:!1,isWritable:!1},{pubkey:new C(t.programId),isSigner:!1,isWritable:!1},{pubkey:new C(t.id),isSigner:!1,isWritable:!0},{pubkey:new C(n.id),isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let f=Ne(t);p.push({pubkey:f.config.id,isSigner:!1,isWritable:!1},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.mintA.address.equals(u)?f.vault.A:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.mintA.address.equals(u)?f.vault.B:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0},...m.map(b=>({pubkey:b,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let f=Ne(t);p.push({pubkey:f.authority,isSigner:!1,isWritable:!1},{pubkey:f.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:new C("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:f.openOrders,isSigner:!1,isWritable:!0},{pubkey:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.marketId,isSigner:!1,isWritable:!0},{pubkey:f.marketBids,isSigner:!1,isWritable:!0},{pubkey:f.marketAsks,isSigner:!1,isWritable:!0},{pubkey:f.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0})}else{let f=Ne(t);p.push({pubkey:f.authority,isSigner:!1,isWritable:!1},{pubkey:f.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:f.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:f.openOrders,isSigner:!1,isWritable:!0},{pubkey:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.marketId,isSigner:!1,isWritable:!0},{pubkey:f.marketBids,isSigner:!1,isWritable:!0},{pubkey:f.marketAsks,isSigner:!1,isWritable:!0},{pubkey:f.marketEventQueue,isSigner:!1,isWritable:!0},...f.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:f.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:f.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0}])}let y=Buffer.alloc(d.span);return d.encode({instruction:4,amountIn:c,amountOut:l},y),new Wn({keys:p,programId:i,data:y})}function Bb(i,e,t,n,r,o,s,a,u,c){let l=_([X("instruction")]),m=[{pubkey:_n.programId,isSigner:!1,isWritable:!1},{pubkey:vn,isSigner:!1,isWritable:!1},{pubkey:new C(String(n.programId)),isSigner:!1,isWritable:!1},{pubkey:new C(String(n.id)),isSigner:!1,isWritable:!0},{pubkey:new C(String(t.id)),isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let p=Ne(n);m.push({pubkey:p.config.id,isSigner:!1,isWritable:!1},{pubkey:p.id,isSigner:!1,isWritable:!0},{pubkey:p.mintA.address.equals(u)?p.vault.A:p.vault.B,isSigner:!1,isWritable:!0},{pubkey:p.mintA.address.equals(u)?p.vault.B:p.vault.A,isSigner:!1,isWritable:!0},{pubkey:p.id,isSigner:!1,isWritable:!0},...c.map(y=>({pubkey:y,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let p=Ne(n);m.push({pubkey:p.authority,isSigner:!1,isWritable:!1},{pubkey:p.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:p.id,isSigner:!1,isWritable:!0},{pubkey:new C("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:p.openOrders,isSigner:!1,isWritable:!0},{pubkey:p.vault.A,isSigner:!1,isWritable:!0},{pubkey:p.vault.B,isSigner:!1,isWritable:!0},{pubkey:p.marketId,isSigner:!1,isWritable:!0},{pubkey:p.marketBids,isSigner:!1,isWritable:!0},{pubkey:p.marketAsks,isSigner:!1,isWritable:!0},{pubkey:p.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:p.id,isSigner:!1,isWritable:!0},{pubkey:p.id,isSigner:!1,isWritable:!0})}else{let p=Ne(n);m.push({pubkey:p.authority,isSigner:!1,isWritable:!1},{pubkey:p.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:p.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:p.openOrders,isSigner:!1,isWritable:!0},{pubkey:p.vault.A,isSigner:!1,isWritable:!0},{pubkey:p.vault.B,isSigner:!1,isWritable:!0},{pubkey:p.marketId,isSigner:!1,isWritable:!0},{pubkey:p.marketBids,isSigner:!1,isWritable:!0},{pubkey:p.marketAsks,isSigner:!1,isWritable:!0},{pubkey:p.marketEventQueue,isSigner:!1,isWritable:!0},...p.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:p.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:p.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:p.id,isSigner:!1,isWritable:!0},{pubkey:p.id,isSigner:!1,isWritable:!0}])}let d=Buffer.alloc(l.span);return l.encode({instruction:5},d),new Wn({keys:m,programId:i,data:d})}function as(i,e,t,n,r,o,s,a,u,c,l,m,d,p,y){var B;let f=[],b=[A({pubkey:vn,isWritable:!1}),A({pubkey:os,isWritable:!1}),A({pubkey:ss,isWritable:!1}),A({pubkey:_n.programId,isWritable:!1}),A({pubkey:e,isSigner:!0})];b.push(A({pubkey:t})),b.push(A({pubkey:r}));let k=[u,c],T=[l,m],P=[o,s,a];for(let E=0;E<k.length;E++){let K=k[E],z=P[E]===K.mintA.address;if(b.push(A({pubkey:new C(K.programId),isWritable:!1})),E===k.length-1?b.push(A({pubkey:r})):b.push(A({pubkey:n})),b.push(A({pubkey:new C(P[E])})),b.push(A({pubkey:new C(P[E+1])})),K.version===6){let h=T[E];b.push(A({pubkey:new C(h.config.id)})),b.push(A({pubkey:new C(h.id)})),b.push(A({pubkey:new C(z?h.vault.A:h.vault.B)})),b.push(A({pubkey:new C(z?h.vault.B:h.vault.A)})),b.push(A({pubkey:new C(K.observationId)})),b.push(A({pubkey:dn})),b.push(A({pubkey:Ke(new C(K.programId),new C(K.id)).publicKey})),f.push(us(K.sqrtPriceX64.toString(),z));for(let F of(B=y[E])!=null?B:[])b.push(A({pubkey:new C(F)}))}else if(K.version===5){let h=T[E];b.push(A({pubkey:new C(h.id)})),b.push(A({pubkey:new C(h.authority),isWritable:!1})),b.push(A({pubkey:new C(h.marketProgramId)})),b.push(A({pubkey:new C(h.marketAuthority)})),b.push(A({pubkey:pi,isWritable:!1})),b.push(A({pubkey:new C(h.openOrders)})),b.push(A({pubkey:new C(h.vault.A)})),b.push(A({pubkey:new C(h.vault.B)})),b.push(A({pubkey:new C(h.id)})),b.push(A({pubkey:new C(h.id)})),b.push(A({pubkey:new C(h.id)})),b.push(A({pubkey:new C(h.id)})),b.push(A({pubkey:new C(h.id)})),b.push(A({pubkey:new C(h.id)})),b.push(A({pubkey:new C(h.marketId)})),b.push(A({pubkey:new C(h.marketBids)})),b.push(A({pubkey:new C(h.marketAsks)})),b.push(A({pubkey:new C(h.marketEventQueue)})),b.push(A({pubkey:new C(h.marketBaseVault)})),b.push(A({pubkey:new C(h.marketQuoteVault)}))}else if(K.version===4){let h=T[E],F=K.status!==1;b.push(A({pubkey:new C(h.id)})),b.push(A({pubkey:new C(h.authority),isWritable:!1})),b.push(A({pubkey:new C(F?h.id:h.marketProgramId)})),b.push(A({pubkey:new C(F?h.id:h.marketAuthority)})),b.push(A({pubkey:new C(F?h.id:h.openOrders)})),b.push(A({pubkey:new C(h.vault.A)})),b.push(A({pubkey:new C(h.vault.B)})),b.push(A({pubkey:new C(F?h.id:h.marketId)})),b.push(A({pubkey:new C(F?h.id:h.marketBids)})),b.push(A({pubkey:new C(F?h.id:h.marketAsks)})),b.push(A({pubkey:new C(F?h.id:h.marketEventQueue)})),b.push(A({pubkey:new C(F?h.id:h.marketBaseVault)})),b.push(A({pubkey:new C(F?h.id:h.marketQuoteVault)}))}else if(K.version===7){let h=T[E];b.push(A({pubkey:new C(h.authority)})),b.push(A({pubkey:new C(h.config.id)})),b.push(A({pubkey:new C(h.id)})),b.push(A({pubkey:new C(z?h.vault.A:h.vault.B)})),b.push(A({pubkey:new C(z?h.vault.B:h.vault.A)})),b.push(A({pubkey:new C(K.observationId)}))}else throw Error("pool type error")}let I=_([X("insId"),g("amountIn"),g("amountOut"),Y(q(),f.length,"clmmPriceLimit")]),W=Buffer.alloc(I.span);return I.encode({insId:0,amountIn:d,amountOut:p,clmmPriceLimit:f},W),new Wn({keys:b,programId:i,data:W})}function us(i,e){if(i)if(e){let t=new pt(i).div(new pt(25));return t.gt(Zt)?t:Zt}else{let t=new pt(i).mul(new pt(25));return t.lt(Yt)?t:Yt}else return e?Zt:Yt}function xb({routeProgram:i,ownerInfo:e,inputMint:t,swapInfo:n}){var r,o,s,a,u,c,l;if(n.routeType==="amm")if(n.poolInfo[0].version===6){let m=n.poolKey[0],d=Ne(m),p=t.equals(d.mintA.address)?Xe.add(Re):ze.sub(Re);return Lt.makeSwapBaseInInstructions({poolInfo:m,poolKeys:m,observationId:n.poolInfo[0].observationId,ownerInfo:{wallet:e.wallet,tokenAccountA:d.mintA.address.equals(t)?e.sourceToken:e.destinationToken,tokenAccountB:d.mintA.address.equals(t)?e.destinationToken:e.sourceToken},inputMint:t,amountIn:n.amountIn.amount.raw,amountOutMin:n.minAmountOut.amount.raw.sub((o=(r=n.minAmountOut.fee)==null?void 0:r.raw)!=null?o:new pt(0)),sqrtPriceLimitX64:p,remainingAccounts:(s=n.remainingAccounts[0])!=null?s:[]})}else if(n.poolInfo[0].version===7){let m=n.poolInfo[0],d=t.toString()===n.poolInfo[0].mintA.address;return{signers:[],instructions:[qi(m.programId,e.wallet,m.authority,m.configId,m.id,e.sourceToken,e.destinationToken,d?m.vaultA:m.vaultB,d?m.vaultB:m.vaultA,d?m.mintProgramA:m.mintProgramB,d?m.mintProgramB:m.mintProgramA,new C(m[d?"mintA":"mintB"].address),new C(m[d?"mintB":"mintA"].address),m.observationId,n.amountIn.amount.raw,n.minAmountOut.amount.raw)],lookupTableAddress:[],instructionTypes:[d?oe.CpmmSwapBaseIn:oe.CpmmSwapBaseOut],address:{}}}else{let m=n.poolKey[0];return{signers:[],instructions:[Vi({poolKeys:m,version:n.poolInfo[0].pooltype.includes("StablePool")?5:4,userKeys:{tokenAccountIn:e.sourceToken,tokenAccountOut:e.destinationToken,owner:e.wallet},amountIn:n.amountIn.amount.raw,amountOut:n.minAmountOut.amount.raw.sub((u=(a=n.minAmountOut.fee)==null?void 0:a.raw)!=null?u:new pt(0)),fixedSide:"in"})],lookupTableAddress:m.lookupTableAccount?[m.lookupTableAccount]:[],instructionTypes:[n.poolInfo[0].pooltype.includes("StablePool")?oe.AmmV5SwapBaseIn:oe.AmmV4SwapBaseIn],address:{}}}else if(n.routeType==="route"){let m=n.poolInfo[0],d=n.poolInfo[1],p=n.poolKey[0],y=n.poolKey[1];if(e.routeToken===void 0)throw Error("owner route token account check error");return{signers:[],instructions:[as(i,e.wallet,e.sourceToken,e.routeToken,e.destinationToken,t.toString(),n.middleToken.mint.toString(),n.outputMint.toString(),m,d,p,y,n.amountIn.amount.raw,n.minAmountOut.amount.raw.sub((l=(c=n.minAmountOut.fee)==null?void 0:c.raw)!=null?l:new pt(0)),n.remainingAccounts)],instructionTypes:[oe.RouteSwap],lookupTableAddress:[p.lookupTableAccount,y.lookupTableAccount].filter(f=>f!==void 0),address:{}}}else throw Error("route type error")}export{xb as makeSwapInstruction,Tb as route1Instruction,Bb as route2Instruction,as as routeInstruction};
//# sourceMappingURL=instrument.mjs.map