var Pi=Object.defineProperty,xi=Object.defineProperties;var Bi=Object.getOwnPropertyDescriptors;var xn=Object.getOwnPropertySymbols;var Ii=Object.prototype.hasOwnProperty,Si=Object.prototype.propertyIsEnumerable;var Bn=(i,e,t)=>e in i?Pi(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,j=(i,e)=>{for(var t in e||(e={}))Ii.call(e,t)&&Bn(i,t,e[t]);if(xn)for(var t of xn(e))Si.call(e,t)&&Bn(i,t,e[t]);return i},ee=(i,e)=>xi(i,Bi(e));import{get as In,set as Ni}from"lodash";var Xt=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Sn={},Ci={};function Ae(i){let e=In(Sn,i);if(!e){let t=In(Ci,i);e=new Xt({name:i,logLevel:t}),Ni(Sn,i,e)}return e}import{PublicKey as fa}from"@solana/web3.js";import ga from"bn.js";import Or from"big.js";import vt from"bn.js";import xe from"bn.js";var ut=9e15,je=1e9,zt="0123456789abcdef",Nt="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Ct="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",Ht={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-ut,maxE:ut,crypto:!1},Ln,Ge,K=!0,Lt="[DecimalError] ",Ze=Lt+"Invalid argument: ",Rn=Lt+"Precision limit exceeded",En=Lt+"crypto unavailable",Mn="[object Decimal]",be=Math.floor,oe=Math.pow,Ki=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Li=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,Ri=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Fn=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Le=1e7,S=7,Ei=9007199254740991,Mi=Nt.length-1,Zt=Ct.length-1,h={toStringTag:Mn};h.absoluteValue=h.abs=function(){var i=new this.constructor(this);return i.s<0&&(i.s=1),I(i)};h.ceil=function(){return I(new this.constructor(this),this.e+1,2)};h.clampedTo=h.clamp=function(i,e){var t,n=this,r=n.constructor;if(i=new r(i),e=new r(e),!i.s||!e.s)return new r(NaN);if(i.gt(e))throw Error(Ze+e);return t=n.cmp(i),t<0?i:n.cmp(e)>0?e:new r(n)};h.comparedTo=h.cmp=function(i){var e,t,n,r,o=this,s=o.d,a=(i=new o.constructor(i)).d,u=o.s,c=i.s;if(!s||!a)return!u||!c?NaN:u!==c?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-c:0;if(u!==c)return u;if(o.e!==i.e)return o.e>i.e^u<0?1:-1;for(n=s.length,r=a.length,e=0,t=n<r?n:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^u<0?1:-1;return n===r?0:n>r^u<0?1:-1};h.cosine=h.cos=function(){var i,e,t=this,n=t.constructor;return t.d?t.d[0]?(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+S,n.rounding=1,t=Fi(n,qn(n,t)),n.precision=i,n.rounding=e,I(Ge==2||Ge==3?t.neg():t,i,e,!0)):new n(1):new n(NaN)};h.cubeRoot=h.cbrt=function(){var i,e,t,n,r,o,s,a,u,c,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(K=!1,o=l.s*oe(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=me(l.d),i=l.e,(o=(i-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=oe(t,1/3),i=be((i+1)/3)-(i%3==(i<0?-1:2)),o==1/0?t="5e"+i:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+i),n=new m(t),n.s=l.s):n=new m(o.toString()),s=(i=m.precision)+3;;)if(a=n,u=a.times(a).times(a),c=u.plus(l),n=Z(c.plus(l).times(a),c.plus(u),s+2,1),me(a.d).slice(0,s)===(t=me(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(I(a,i+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(I(n,i+1,1),e=!n.times(n).times(n).eq(l));break}return K=!0,I(n,i,m.rounding,e)};h.decimalPlaces=h.dp=function(){var i,e=this.d,t=NaN;if(e){if(i=e.length-1,t=(i-be(this.e/S))*S,i=e[i],i)for(;i%10==0;i/=10)t--;t<0&&(t=0)}return t};h.dividedBy=h.div=function(i){return Z(this,new this.constructor(i))};h.dividedToIntegerBy=h.divToInt=function(i){var e=this,t=e.constructor;return I(Z(e,new t(i),0,1,1),t.precision,t.rounding)};h.equals=h.eq=function(i){return this.cmp(i)===0};h.floor=function(){return I(new this.constructor(this),this.e+1,3)};h.greaterThan=h.gt=function(i){return this.cmp(i)>0};h.greaterThanOrEqualTo=h.gte=function(i){var e=this.cmp(i);return e==1||e===0};h.hyperbolicCosine=h.cosh=function(){var i,e,t,n,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(i=Math.ceil(r/3),e=(1/Et(4,i)).toString()):(i=16,e="2.3283064365386962890625e-10"),o=ct(s,1,o.times(e),new s(1),!0);for(var u,c=i,l=new s(8);c--;)u=o.times(o),o=a.minus(u.times(l.minus(u.times(l))));return I(o,s.precision=t,s.rounding=n,!0)};h.hyperbolicSine=h.sinh=function(){var i,e,t,n,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,n=r.d.length,n<3)r=ct(o,2,r,r,!0);else{i=1.4*Math.sqrt(n),i=i>16?16:i|0,r=r.times(1/Et(5,i)),r=ct(o,2,r,r,!0);for(var s,a=new o(5),u=new o(16),c=new o(20);i--;)s=r.times(r),r=r.times(a.plus(s.times(u.times(s).plus(c))))}return o.precision=e,o.rounding=t,I(r,e,t,!0)};h.hyperbolicTangent=h.tanh=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+7,n.rounding=1,Z(t.sinh(),t.cosh(),n.precision=i,n.rounding=e)):new n(t.s)};h.inverseCosine=h.acos=function(){var i,e=this,t=e.constructor,n=e.abs().cmp(1),r=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?Ke(t,r,o):new t(0):new t(NaN):e.isZero()?Ke(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),i=Ke(t,r+4,o).times(.5),t.precision=r,t.rounding=o,i.minus(e))};h.inverseHyperbolicCosine=h.acosh=function(){var i,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(i=n.precision,e=n.rounding,n.precision=i+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,K=!1,t=t.times(t).minus(1).sqrt().plus(t),K=!0,n.precision=i,n.rounding=e,t.ln()):new n(t)};h.inverseHyperbolicSine=h.asinh=function(){var i,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,K=!1,t=t.times(t).plus(1).sqrt().plus(t),K=!0,n.precision=i,n.rounding=e,t.ln())};h.inverseHyperbolicTangent=h.atanh=function(){var i,e,t,n,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(i=o.precision,e=o.rounding,n=r.sd(),Math.max(n,i)<2*-r.e-1?I(new o(r),i,e,!0):(o.precision=t=n-r.e,r=Z(r.plus(1),new o(1).minus(r),t+i,1),o.precision=i+4,o.rounding=1,r=r.ln(),o.precision=i,o.rounding=e,r.times(.5))):new o(NaN)};h.inverseSine=h.asin=function(){var i,e,t,n,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(i=Ke(o,t+4,n).times(.5),i.s=r.s,i):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,r.times(2)))};h.inverseTangent=h.atan=function(){var i,e,t,n,r,o,s,a,u,c=this,l=c.constructor,m=l.precision,d=l.rounding;if(c.isFinite()){if(c.isZero())return new l(c);if(c.abs().eq(1)&&m+4<=Zt)return s=Ke(l,m+4,d).times(.25),s.s=c.s,s}else{if(!c.s)return new l(NaN);if(m+4<=Zt)return s=Ke(l,m+4,d).times(.5),s.s=c.s,s}for(l.precision=a=m+10,l.rounding=1,t=Math.min(28,a/S+2|0),i=t;i;--i)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(K=!1,e=Math.ceil(a/S),n=1,u=c.times(c),s=new l(c),r=c;i!==-1;)if(r=r.times(u),o=s.minus(r.div(n+=2)),r=r.times(u),s=o.plus(r.div(n+=2)),s.d[e]!==void 0)for(i=e;s.d[i]===o.d[i]&&i--;);return t&&(s=s.times(2<<t-1)),K=!0,I(s,l.precision=m,l.rounding=d,!0)};h.isFinite=function(){return!!this.d};h.isInteger=h.isInt=function(){return!!this.d&&be(this.e/S)>this.d.length-2};h.isNaN=function(){return!this.s};h.isNegative=h.isNeg=function(){return this.s<0};h.isPositive=h.isPos=function(){return this.s>0};h.isZero=function(){return!!this.d&&this.d[0]===0};h.lessThan=h.lt=function(i){return this.cmp(i)<0};h.lessThanOrEqualTo=h.lte=function(i){return this.cmp(i)<1};h.logarithm=h.log=function(i){var e,t,n,r,o,s,a,u,c=this,l=c.constructor,m=l.precision,d=l.rounding,f=5;if(i==null)i=new l(10),e=!0;else{if(i=new l(i),t=i.d,i.s<0||!t||!t[0]||i.eq(1))return new l(NaN);e=i.eq(10)}if(t=c.d,c.s<0||!t||!t[0]||c.eq(1))return new l(t&&!t[0]?-1/0:c.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(K=!1,a=m+f,s=He(c,a),n=e?Kt(l,a+10):He(i,a),u=Z(s,n,a,1),ft(u.d,r=m,d))do if(a+=10,s=He(c,a),n=e?Kt(l,a+10):He(i,a),u=Z(s,n,a,1),!o){+me(u.d).slice(r+1,r+15)+1==1e14&&(u=I(u,m+1,0));break}while(ft(u.d,r+=10,d));return K=!0,I(u,m,d)};h.minus=h.sub=function(i){var e,t,n,r,o,s,a,u,c,l,m,d,f=this,g=f.constructor;if(i=new g(i),!f.d||!i.d)return!f.s||!i.s?i=new g(NaN):f.d?i.s=-i.s:i=new g(i.d||f.s!==i.s?f:NaN),i;if(f.s!=i.s)return i.s=-i.s,f.plus(i);if(c=f.d,d=i.d,a=g.precision,u=g.rounding,!c[0]||!d[0]){if(d[0])i.s=-i.s;else if(c[0])i=new g(f);else return new g(u===3?-0:0);return K?I(i,a,u):i}if(t=be(i.e/S),l=be(f.e/S),c=c.slice(),o=l-t,o){for(m=o<0,m?(e=c,o=-o,s=d.length):(e=d,t=l,s=c.length),n=Math.max(Math.ceil(a/S),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=c.length,s=d.length,m=n<s,m&&(s=n),n=0;n<s;n++)if(c[n]!=d[n]){m=c[n]<d[n];break}o=0}for(m&&(e=c,c=d,d=e,i.s=-i.s),s=c.length,n=d.length-s;n>0;--n)c[s++]=0;for(n=d.length;n>o;){if(c[--n]<d[n]){for(r=n;r&&c[--r]===0;)c[r]=Le-1;--c[r],c[n]+=Le}c[n]-=d[n]}for(;c[--s]===0;)c.pop();for(;c[0]===0;c.shift())--t;return c[0]?(i.d=c,i.e=Rt(c,t),K?I(i,a,u):i):new g(u===3?-0:0)};h.modulo=h.mod=function(i){var e,t=this,n=t.constructor;return i=new n(i),!t.d||!i.s||i.d&&!i.d[0]?new n(NaN):!i.d||t.d&&!t.d[0]?I(new n(t),n.precision,n.rounding):(K=!1,n.modulo==9?(e=Z(t,i.abs(),0,3,1),e.s*=i.s):e=Z(t,i,0,n.modulo,1),e=e.times(i),K=!0,t.minus(e))};h.naturalExponential=h.exp=function(){return jt(this)};h.naturalLogarithm=h.ln=function(){return He(this)};h.negated=h.neg=function(){var i=new this.constructor(this);return i.s=-i.s,I(i)};h.plus=h.add=function(i){var e,t,n,r,o,s,a,u,c,l,m=this,d=m.constructor;if(i=new d(i),!m.d||!i.d)return!m.s||!i.s?i=new d(NaN):m.d||(i=new d(i.d||m.s===i.s?m:NaN)),i;if(m.s!=i.s)return i.s=-i.s,m.minus(i);if(c=m.d,l=i.d,a=d.precision,u=d.rounding,!c[0]||!l[0])return l[0]||(i=new d(m)),K?I(i,a,u):i;if(o=be(m.e/S),n=be(i.e/S),c=c.slice(),r=o-n,r){for(r<0?(t=c,r=-r,s=l.length):(t=l,n=o,s=c.length),o=Math.ceil(a/S),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=c.length,r=l.length,s-r<0&&(r=s,t=l,l=c,c=t),e=0;r;)e=(c[--r]=c[r]+l[r]+e)/Le|0,c[r]%=Le;for(e&&(c.unshift(e),++n),s=c.length;c[--s]==0;)c.pop();return i.d=c,i.e=Rt(c,n),K?I(i,a,u):i};h.precision=h.sd=function(i){var e,t=this;if(i!==void 0&&i!==!!i&&i!==1&&i!==0)throw Error(Ze+i);return t.d?(e=On(t.d),i&&t.e+1>e&&(e=t.e+1)):e=NaN,e};h.round=function(){var i=this,e=i.constructor;return I(new e(i),i.e+1,e.rounding)};h.sine=h.sin=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+S,n.rounding=1,t=_i(n,qn(n,t)),n.precision=i,n.rounding=e,I(Ge>2?t.neg():t,i,e,!0)):new n(NaN)};h.squareRoot=h.sqrt=function(){var i,e,t,n,r,o,s=this,a=s.d,u=s.e,c=s.s,l=s.constructor;if(c!==1||!a||!a[0])return new l(!c||c<0&&(!a||a[0])?NaN:a?s:1/0);for(K=!1,c=Math.sqrt(+s),c==0||c==1/0?(e=me(a),(e.length+u)%2==0&&(e+="0"),c=Math.sqrt(e),u=be((u+1)/2)-(u<0||u%2),c==1/0?e="5e"+u:(e=c.toExponential(),e=e.slice(0,e.indexOf("e")+1)+u),n=new l(e)):n=new l(c.toString()),t=(u=l.precision)+3;;)if(o=n,n=o.plus(Z(s,o,t+2,1)).times(.5),me(o.d).slice(0,t)===(e=me(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(I(o,u+1,0),o.times(o).eq(s))){n=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(I(n,u+1,1),i=!n.times(n).eq(s));break}return K=!0,I(n,u,l.rounding,i)};h.tangent=h.tan=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+10,n.rounding=1,t=t.sin(),t.s=1,t=Z(t,new n(1).minus(t.times(t)).sqrt(),i+10,0),n.precision=i,n.rounding=e,I(Ge==2||Ge==4?t.neg():t,i,e,!0)):new n(NaN)};h.times=h.mul=function(i){var e,t,n,r,o,s,a,u,c,l=this,m=l.constructor,d=l.d,f=(i=new m(i)).d;if(i.s*=l.s,!d||!d[0]||!f||!f[0])return new m(!i.s||d&&!d[0]&&!f||f&&!f[0]&&!d?NaN:!d||!f?i.s/0:i.s*0);for(t=be(l.e/S)+be(i.e/S),u=d.length,c=f.length,u<c&&(o=d,d=f,f=o,s=u,u=c,c=s),o=[],s=u+c,n=s;n--;)o.push(0);for(n=c;--n>=0;){for(e=0,r=u+n;r>n;)a=o[r]+f[n]*d[r-n-1]+e,o[r--]=a%Le|0,e=a/Le|0;o[r]=(o[r]+e)%Le|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),i.d=o,i.e=Rt(o,t),K?I(i,m.precision,m.rounding):i};h.toBinary=function(i,e){return Qt(this,2,i,e)};h.toDecimalPlaces=h.toDP=function(i,e){var t=this,n=t.constructor;return t=new n(t),i===void 0?t:(Pe(i,0,je),e===void 0?e=n.rounding:Pe(e,0,8),I(t,i+t.e+1,e))};h.toExponential=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=_e(n,!0):(Pe(i,0,je),e===void 0?e=r.rounding:Pe(e,0,8),n=I(new r(n),i+1,e),t=_e(n,!0,i+1)),n.isNeg()&&!n.isZero()?"-"+t:t};h.toFixed=function(i,e){var t,n,r=this,o=r.constructor;return i===void 0?t=_e(r):(Pe(i,0,je),e===void 0?e=o.rounding:Pe(e,0,8),n=I(new o(r),i+r.e+1,e),t=_e(n,!1,i+n.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};h.toFraction=function(i){var e,t,n,r,o,s,a,u,c,l,m,d,f=this,g=f.d,p=f.constructor;if(!g)return new p(f);if(c=t=new p(1),n=u=new p(0),e=new p(n),o=e.e=On(g)-f.e-1,s=o%S,e.d[0]=oe(10,s<0?S+s:s),i==null)i=o>0?e:c;else{if(a=new p(i),!a.isInt()||a.lt(c))throw Error(Ze+a);i=a.gt(e)?o>0?e:c:a}for(K=!1,a=new p(me(g)),l=p.precision,p.precision=o=g.length*S*2;m=Z(a,e,0,1,1),r=t.plus(m.times(n)),r.cmp(i)!=1;)t=n,n=r,r=c,c=u.plus(m.times(r)),u=r,r=e,e=a.minus(m.times(r)),a=r;return r=Z(i.minus(t),n,0,1,1),u=u.plus(r.times(c)),t=t.plus(r.times(n)),u.s=c.s=f.s,d=Z(c,n,o,1).minus(f).abs().cmp(Z(u,t,o,1).minus(f).abs())<1?[c,n]:[u,t],p.precision=l,K=!0,d};h.toHexadecimal=h.toHex=function(i,e){return Qt(this,16,i,e)};h.toNearest=function(i,e){var t=this,n=t.constructor;if(t=new n(t),i==null){if(!t.d)return t;i=new n(1),e=n.rounding}else{if(i=new n(i),e===void 0?e=n.rounding:Pe(e,0,8),!t.d)return i.s?t:i;if(!i.d)return i.s&&(i.s=t.s),i}return i.d[0]?(K=!1,t=Z(t,i,0,e,1).times(i),K=!0,I(t)):(i.s=t.s,t=i),t};h.toNumber=function(){return+this};h.toOctal=function(i,e){return Qt(this,8,i,e)};h.toPower=h.pow=function(i){var e,t,n,r,o,s,a=this,u=a.constructor,c=+(i=new u(i));if(!a.d||!i.d||!a.d[0]||!i.d[0])return new u(oe(+a,c));if(a=new u(a),a.eq(1))return a;if(n=u.precision,o=u.rounding,i.eq(1))return I(a,n,o);if(e=be(i.e/S),e>=i.d.length-1&&(t=c<0?-c:c)<=Ei)return r=_n(u,a,t,n),i.s<0?new u(1).div(r):I(r,n,o);if(s=a.s,s<0){if(e<i.d.length-1)return new u(NaN);if((i.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=oe(+a,c),e=t==0||!isFinite(t)?be(c*(Math.log("0."+me(a.d))/Math.LN10+a.e+1)):new u(t+"").e,e>u.maxE+1||e<u.minE-1?new u(e>0?s/0:0):(K=!1,u.rounding=a.s=1,t=Math.min(12,(e+"").length),r=jt(i.times(He(a,n+t)),n),r.d&&(r=I(r,n+5,1),ft(r.d,n,o)&&(e=n+10,r=I(jt(i.times(He(a,e+t)),e),e+5,1),+me(r.d).slice(n+1,n+15)+1==1e14&&(r=I(r,n+1,0)))),r.s=s,K=!0,u.rounding=o,I(r,n,o))};h.toPrecision=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=_e(n,n.e<=r.toExpNeg||n.e>=r.toExpPos):(Pe(i,1,je),e===void 0?e=r.rounding:Pe(e,0,8),n=I(new r(n),i,e),t=_e(n,i<=n.e||n.e<=r.toExpNeg,i)),n.isNeg()&&!n.isZero()?"-"+t:t};h.toSignificantDigits=h.toSD=function(i,e){var t=this,n=t.constructor;return i===void 0?(i=n.precision,e=n.rounding):(Pe(i,1,je),e===void 0?e=n.rounding:Pe(e,0,8)),I(new n(t),i,e)};h.toString=function(){var i=this,e=i.constructor,t=_e(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()&&!i.isZero()?"-"+t:t};h.truncated=h.trunc=function(){return I(new this.constructor(this),this.e+1,1)};h.valueOf=h.toJSON=function(){var i=this,e=i.constructor,t=_e(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()?"-"+t:t};function me(i){var e,t,n,r=i.length-1,o="",s=i[0];if(r>0){for(o+=s,e=1;e<r;e++)n=i[e]+"",t=S-n.length,t&&(o+=ze(t)),o+=n;s=i[e],n=s+"",t=S-n.length,t&&(o+=ze(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function Pe(i,e,t){if(i!==~~i||i<e||i>t)throw Error(Ze+i)}function ft(i,e,t,n){var r,o,s,a;for(o=i[0];o>=10;o/=10)--e;return--e<0?(e+=S,r=0):(r=Math.ceil((e+1)/S),e%=S),o=oe(10,S-e),a=i[r]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(i[r+1]/o/100|0)==oe(10,e-2)-1||(a==o/2||a==0)&&(i[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(i[r+1]/o/1e3|0)==oe(10,e-3)-1,s}function St(i,e,t){for(var n,r=[0],o,s=0,a=i.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=zt.indexOf(i.charAt(s++)),n=0;n<r.length;n++)r[n]>t-1&&(r[n+1]===void 0&&(r[n+1]=0),r[n+1]+=r[n]/t|0,r[n]%=t)}return r.reverse()}function Fi(i,e){var t,n,r;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),r=(1/Et(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),i.precision+=t,e=ct(i,1,e.times(r),new i(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return i.precision-=t,e}var Z=function(){function i(n,r,o){var s,a=0,u=n.length;for(n=n.slice();u--;)s=n[u]*r+a,n[u]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,r,o,s){var a,u;if(o!=s)u=o>s?1:-1;else for(a=u=0;a<o;a++)if(n[a]!=r[a]){u=n[a]>r[a]?1:-1;break}return u}function t(n,r,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<r[o]?1:0,n[o]=a*s+n[o]-r[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,r,o,s,a,u){var c,l,m,d,f,g,p,y,b,k,w,P,C,A,E,L,X,H,O,ce,re=n.constructor,Te=n.s==r.s?1:-1,$=n.d,U=r.d;if(!$||!$[0]||!U||!U[0])return new re(!n.s||!r.s||($?U&&$[0]==U[0]:!U)?NaN:$&&$[0]==0||!U?Te*0:Te/0);for(u?(f=1,l=n.e-r.e):(u=Le,f=S,l=be(n.e/f)-be(r.e/f)),O=U.length,X=$.length,b=new re(Te),k=b.d=[],m=0;U[m]==($[m]||0);m++);if(U[m]>($[m]||0)&&l--,o==null?(A=o=re.precision,s=re.rounding):a?A=o+(n.e-r.e)+1:A=o,A<0)k.push(1),g=!0;else{if(A=A/f+2|0,m=0,O==1){for(d=0,U=U[0],A++;(m<X||d)&&A--;m++)E=d*u+($[m]||0),k[m]=E/U|0,d=E%U|0;g=d||m<X}else{for(d=u/(U[0]+1)|0,d>1&&(U=i(U,d,u),$=i($,d,u),O=U.length,X=$.length),L=O,w=$.slice(0,O),P=w.length;P<O;)w[P++]=0;ce=U.slice(),ce.unshift(0),H=U[0],U[1]>=u/2&&++H;do d=0,c=e(U,w,O,P),c<0?(C=w[0],O!=P&&(C=C*u+(w[1]||0)),d=C/H|0,d>1?(d>=u&&(d=u-1),p=i(U,d,u),y=p.length,P=w.length,c=e(p,w,y,P),c==1&&(d--,t(p,O<y?ce:U,y,u))):(d==0&&(c=d=1),p=U.slice()),y=p.length,y<P&&p.unshift(0),t(w,p,P,u),c==-1&&(P=w.length,c=e(U,w,O,P),c<1&&(d++,t(w,O<P?ce:U,P,u))),P=w.length):c===0&&(d++,w=[0]),k[m++]=d,c&&w[0]?w[P++]=$[L]||0:(w=[$[L]],P=1);while((L++<X||w[0]!==void 0)&&A--);g=w[0]!==void 0}k[0]||k.shift()}if(f==1)b.e=l,Ln=g;else{for(m=1,d=k[0];d>=10;d/=10)m++;b.e=m+l*f-1,I(b,a?o+b.e+1:o,s,g)}return b}}();function I(i,e,t,n){var r,o,s,a,u,c,l,m,d,f=i.constructor;e:if(e!=null){if(m=i.d,!m)return i;for(r=1,a=m[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=S,s=e,l=m[d=0],u=l/oe(10,r-s-1)%10|0;else if(d=Math.ceil((o+1)/S),a=m.length,d>=a)if(n){for(;a++<=d;)m.push(0);l=u=0,r=1,o%=S,s=o-S+1}else break e;else{for(l=a=m[d],r=1;a>=10;a/=10)r++;o%=S,s=o-S+r,u=s<0?0:l/oe(10,r-s-1)%10|0}if(n=n||e<0||m[d+1]!==void 0||(s<0?l:l%oe(10,r-s-1)),c=t<4?(u||n)&&(t==0||t==(i.s<0?3:2)):u>5||u==5&&(t==4||n||t==6&&(o>0?s>0?l/oe(10,r-s):0:m[d-1])%10&1||t==(i.s<0?8:7)),e<1||!m[0])return m.length=0,c?(e-=i.e+1,m[0]=oe(10,(S-e%S)%S),i.e=-e||0):m[0]=i.e=0,i;if(o==0?(m.length=d,a=1,d--):(m.length=d+1,a=oe(10,S-o),m[d]=s>0?(l/oe(10,r-s)%oe(10,s)|0)*a:0),c)for(;;)if(d==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(i.e++,m[0]==Le&&(m[0]=1));break}else{if(m[d]+=a,m[d]!=Le)break;m[d--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return K&&(i.e>f.maxE?(i.d=null,i.e=NaN):i.e<f.minE&&(i.e=0,i.d=[0])),i}function _e(i,e,t){if(!i.isFinite())return vn(i);var n,r=i.e,o=me(i.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+ze(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(i.e<0?"e":"e+")+i.e):r<0?(o="0."+ze(-r-1)+o,t&&(n=t-s)>0&&(o+=ze(n))):r>=s?(o+=ze(r+1-s),t&&(n=t-r-1)>0&&(o=o+"."+ze(n))):((n=r+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(r+1===s&&(o+="."),o+=ze(n))),o}function Rt(i,e){var t=i[0];for(e*=S;t>=10;t/=10)e++;return e}function Kt(i,e,t){if(e>Mi)throw K=!0,t&&(i.precision=t),Error(Rn);return I(new i(Nt),e,1,!0)}function Ke(i,e,t){if(e>Zt)throw Error(Rn);return I(new i(Ct),e,t,!0)}function On(i){var e=i.length-1,t=e*S+1;if(e=i[e],e){for(;e%10==0;e/=10)t--;for(e=i[0];e>=10;e/=10)t++}return t}function ze(i){for(var e="";i--;)e+="0";return e}function _n(i,e,t,n){var r,o=new i(1),s=Math.ceil(n/S+4);for(K=!1;;){if(t%2&&(o=o.times(e),Cn(o.d,s)&&(r=!0)),t=be(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),Cn(e.d,s)}return K=!0,o}function Nn(i){return i.d[i.d.length-1]&1}function Dn(i,e,t){for(var n,r=new i(e[0]),o=0;++o<e.length;)if(n=new i(e[o]),n.s)r[t](n)&&(r=n);else{r=n;break}return r}function jt(i,e){var t,n,r,o,s,a,u,c=0,l=0,m=0,d=i.constructor,f=d.rounding,g=d.precision;if(!i.d||!i.d[0]||i.e>17)return new d(i.d?i.d[0]?i.s<0?0:1/0:1:i.s?i.s<0?0:i:0/0);for(e==null?(K=!1,u=g):u=e,a=new d(.03125);i.e>-2;)i=i.times(a),m+=5;for(n=Math.log(oe(2,m))/Math.LN10*2+5|0,u+=n,t=o=s=new d(1),d.precision=u;;){if(o=I(o.times(i),u,1),t=t.times(++l),a=s.plus(Z(o,t,u,1)),me(a.d).slice(0,u)===me(s.d).slice(0,u)){for(r=m;r--;)s=I(s.times(s),u,1);if(e==null)if(c<3&&ft(s.d,u-n,f,c))d.precision=u+=10,t=o=a=new d(1),l=0,c++;else return I(s,d.precision=g,f,K=!0);else return d.precision=g,s}s=a}}function He(i,e){var t,n,r,o,s,a,u,c,l,m,d,f=1,g=10,p=i,y=p.d,b=p.constructor,k=b.rounding,w=b.precision;if(p.s<0||!y||!y[0]||!p.e&&y[0]==1&&y.length==1)return new b(y&&!y[0]?-1/0:p.s!=1?NaN:y?0:p);if(e==null?(K=!1,l=w):l=e,b.precision=l+=g,t=me(y),n=t.charAt(0),Math.abs(o=p.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)p=p.times(i),t=me(p.d),n=t.charAt(0),f++;o=p.e,n>1?(p=new b("0."+t),o++):p=new b(n+"."+t.slice(1))}else return c=Kt(b,l+2,w).times(o+""),p=He(new b(n+"."+t.slice(1)),l-g).plus(c),b.precision=w,e==null?I(p,w,k,K=!0):p;for(m=p,u=s=p=Z(p.minus(1),p.plus(1),l,1),d=I(p.times(p),l,1),r=3;;){if(s=I(s.times(d),l,1),c=u.plus(Z(s,new b(r),l,1)),me(c.d).slice(0,l)===me(u.d).slice(0,l))if(u=u.times(2),o!==0&&(u=u.plus(Kt(b,l+2,w).times(o+""))),u=Z(u,new b(f),l,1),e==null)if(ft(u.d,l-g,k,a))b.precision=l+=g,c=s=p=Z(m.minus(1),m.plus(1),l,1),d=I(p.times(p),l,1),r=a=1;else return I(u,b.precision=w,k,K=!0);else return b.precision=w,u;u=c,r+=2}}function vn(i){return String(i.s*i.s/0)}function Yt(i,e){var t,n,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(n,r),e){if(r-=n,i.e=t=t-n-1,i.d=[],n=(t+1)%S,t<0&&(n+=S),n<r){for(n&&i.d.push(+e.slice(0,n)),r-=S;n<r;)i.d.push(+e.slice(n,n+=S));e=e.slice(n),n=S-e.length}else n-=r;for(;n--;)e+="0";i.d.push(+e),K&&(i.e>i.constructor.maxE?(i.d=null,i.e=NaN):i.e<i.constructor.minE&&(i.e=0,i.d=[0]))}else i.e=0,i.d=[0];return i}function Oi(i,e){var t,n,r,o,s,a,u,c,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),Fn.test(e))return Yt(i,e)}else if(e==="Infinity"||e==="NaN")return+e||(i.s=NaN),i.e=NaN,i.d=null,i;if(Li.test(e))t=16,e=e.toLowerCase();else if(Ki.test(e))t=2;else if(Ri.test(e))t=8;else throw Error(Ze+e);for(o=e.search(/p/i),o>0?(u=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=i.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=_n(n,new n(t),o,o*2)),c=St(e,t,Le),l=c.length-1,o=l;c[o]===0;--o)c.pop();return o<0?new n(i.s*0):(i.e=Rt(c,l),i.d=c,K=!1,s&&(i=Z(i,r,a*4)),u&&(i=i.times(Math.abs(u)<54?oe(2,u):pt.pow(2,u))),K=!0,i)}function _i(i,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:ct(i,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/Et(5,t)),e=ct(i,2,e,e);for(var r,o=new i(5),s=new i(16),a=new i(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function ct(i,e,t,n,r){var o,s,a,u,c=1,l=i.precision,m=Math.ceil(l/S);for(K=!1,u=t.times(t),a=new i(n);;){if(s=Z(a.times(u),new i(e++*e++),l,1),a=r?n.plus(s):n.minus(s),n=Z(s.times(u),new i(e++*e++),l,1),s=a.plus(n),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,c++}return K=!0,s.d.length=m+1,s}function Et(i,e){for(var t=i;--e;)t*=i;return t}function qn(i,e){var t,n=e.s<0,r=Ke(i,i.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return Ge=n?4:1,e;if(t=e.divToInt(r),t.isZero())Ge=n?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return Ge=Nn(t)?n?2:3:n?4:1,e;Ge=Nn(t)?n?1:4:n?3:2}return e.minus(r).abs()}function Qt(i,e,t,n){var r,o,s,a,u,c,l,m,d,f=i.constructor,g=t!==void 0;if(g?(Pe(t,1,je),n===void 0?n=f.rounding:Pe(n,0,8)):(t=f.precision,n=f.rounding),!i.isFinite())l=vn(i);else{for(l=_e(i),s=l.indexOf("."),g?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(l=l.replace(".",""),d=new f(1),d.e=l.length-s,d.d=St(_e(d),10,r),d.e=d.d.length),m=St(l,10,r),o=u=m.length;m[--u]==0;)m.pop();if(!m[0])l=g?"0p+0":"0";else{if(s<0?o--:(i=new f(i),i.d=m,i.e=o,i=Z(i,d,t,n,0,r),m=i.d,o=i.e,c=Ln),s=m[t],a=r/2,c=c||m[t+1]!==void 0,c=n<4?(s!==void 0||c)&&(n===0||n===(i.s<0?3:2)):s>a||s===a&&(n===4||c||n===6&&m[t-1]&1||n===(i.s<0?8:7)),m.length=t,c)for(;++m[--t]>r-1;)m[t]=0,t||(++o,m.unshift(1));for(u=m.length;!m[u-1];--u);for(s=0,l="";s<u;s++)l+=zt.charAt(m[s]);if(g){if(u>1)if(e==16||e==8){for(s=e==16?4:3,--u;u%s;u++)l+="0";for(m=St(l,r,e),u=m.length;!m[u-1];--u);for(s=1,l="1.";s<u;s++)l+=zt.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>u)for(o-=u;o--;)l+="0";else o<u&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return i.s<0?"-"+l:l}function Cn(i,e){if(i.length>e)return i.length=e,!0}function Di(i){return new this(i).abs()}function vi(i){return new this(i).acos()}function qi(i){return new this(i).acosh()}function Wi(i,e){return new this(i).plus(e)}function Gi(i){return new this(i).asin()}function Vi(i){return new this(i).asinh()}function Ui(i){return new this(i).atan()}function Xi(i){return new this(i).atanh()}function zi(i,e){i=new this(i),e=new this(e);var t,n=this.precision,r=this.rounding,o=n+4;return!i.s||!e.s?t=new this(NaN):!i.d&&!e.d?(t=Ke(this,o,1).times(e.s>0?.25:.75),t.s=i.s):!e.d||i.isZero()?(t=e.s<0?Ke(this,n,r):new this(0),t.s=i.s):!i.d||e.isZero()?(t=Ke(this,o,1).times(.5),t.s=i.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(Z(i,e,o,1)),e=Ke(this,o,1),this.precision=n,this.rounding=r,t=i.s<0?t.minus(e):t.plus(e)):t=this.atan(Z(i,e,o,1)),t}function Hi(i){return new this(i).cbrt()}function Zi(i){return I(i=new this(i),i.e+1,2)}function ji(i,e,t){return new this(i).clamp(e,t)}function Yi(i){if(!i||typeof i!="object")throw Error(Lt+"Object expected");var e,t,n,r=i.defaults===!0,o=["precision",1,je,"rounding",0,8,"toExpNeg",-ut,0,"toExpPos",0,ut,"maxE",0,ut,"minE",-ut,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=Ht[t]),(n=i[t])!==void 0)if(be(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(Ze+t+": "+n);if(t="crypto",r&&(this[t]=Ht[t]),(n=i[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(En);else this[t]=!1;else throw Error(Ze+t+": "+n);return this}function Qi(i){return new this(i).cos()}function Ji(i){return new this(i).cosh()}function Wn(i){var e,t,n;function r(o){var s,a,u,c=this;if(!(c instanceof r))return new r(o);if(c.constructor=r,Kn(o)){c.s=o.s,K?!o.d||o.e>r.maxE?(c.e=NaN,c.d=null):o.e<r.minE?(c.e=0,c.d=[0]):(c.e=o.e,c.d=o.d.slice()):(c.e=o.e,c.d=o.d?o.d.slice():o.d);return}if(u=typeof o,u==="number"){if(o===0){c.s=1/o<0?-1:1,c.e=0,c.d=[0];return}if(o<0?(o=-o,c.s=-1):c.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;K?s>r.maxE?(c.e=NaN,c.d=null):s<r.minE?(c.e=0,c.d=[0]):(c.e=s,c.d=[o]):(c.e=s,c.d=[o]);return}else if(o*0!==0){o||(c.s=NaN),c.e=NaN,c.d=null;return}return Yt(c,o.toString())}else if(u!=="string")throw Error(Ze+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),c.s=-1):(a===43&&(o=o.slice(1)),c.s=1),Fn.test(o)?Yt(c,o):Oi(c,o)}if(r.prototype=h,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=Yi,r.clone=Wn,r.isDecimal=Kn,r.abs=Di,r.acos=vi,r.acosh=qi,r.add=Wi,r.asin=Gi,r.asinh=Vi,r.atan=Ui,r.atanh=Xi,r.atan2=zi,r.cbrt=Hi,r.ceil=Zi,r.clamp=ji,r.cos=Qi,r.cosh=Ji,r.div=$i,r.exp=er,r.floor=tr,r.hypot=nr,r.ln=ir,r.log=rr,r.log10=sr,r.log2=or,r.max=ar,r.min=ur,r.mod=cr,r.mul=lr,r.pow=mr,r.random=dr,r.round=fr,r.sign=pr,r.sin=gr,r.sinh=br,r.sqrt=yr,r.sub=hr,r.sum=wr,r.tan=Ar,r.tanh=kr,r.trunc=Tr,i===void 0&&(i={}),i&&i.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)i.hasOwnProperty(t=n[e++])||(i[t]=this[t]);return r.config(i),r}function $i(i,e){return new this(i).div(e)}function er(i){return new this(i).exp()}function tr(i){return I(i=new this(i),i.e+1,3)}function nr(){var i,e,t=new this(0);for(K=!1,i=0;i<arguments.length;)if(e=new this(arguments[i++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return K=!0,new this(1/0);t=e}return K=!0,t.sqrt()}function Kn(i){return i instanceof pt||i&&i.toStringTag===Mn||!1}function ir(i){return new this(i).ln()}function rr(i,e){return new this(i).log(e)}function or(i){return new this(i).log(2)}function sr(i){return new this(i).log(10)}function ar(){return Dn(this,arguments,"lt")}function ur(){return Dn(this,arguments,"gt")}function cr(i,e){return new this(i).mod(e)}function lr(i,e){return new this(i).mul(e)}function mr(i,e){return new this(i).pow(e)}function dr(i){var e,t,n,r,o=0,s=new this(1),a=[];if(i===void 0?i=this.precision:Pe(i,1,je),n=Math.ceil(i/S),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=n/4}else throw Error(En);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],i%=S,n&&i&&(r=oe(10,S-i),a[o]=(n/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=S)a.shift();for(n=1,r=a[0];r>=10;r/=10)n++;n<S&&(t-=S-n)}return s.e=t,s.d=a,s}function fr(i){return I(i=new this(i),i.e+1,this.rounding)}function pr(i){return i=new this(i),i.d?i.d[0]?i.s:0*i.s:i.s||NaN}function gr(i){return new this(i).sin()}function br(i){return new this(i).sinh()}function yr(i){return new this(i).sqrt()}function hr(i,e){return new this(i).sub(e)}function wr(){var i=0,e=arguments,t=new this(e[i]);for(K=!1;t.s&&++i<e.length;)t=t.plus(e[i]);return K=!0,I(t,this.precision,this.rounding)}function Ar(i){return new this(i).tan()}function kr(i){return new this(i).tanh()}function Tr(i){return I(i=new this(i),i.e+1,1)}h[Symbol.for("nodejs.util.inspect.custom")]=h.toString;h[Symbol.toStringTag]="Decimal";var pt=h.constructor=Wn(Ht);Nt=new pt(Nt);Ct=new pt(Ct);var x=pt;import{PublicKey as tn}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Pr}from"@solana/spl-token";import{PublicKey as J,SystemProgram as Gn,SYSVAR_RENT_PUBKEY as xr}from"@solana/web3.js";function Jt({pubkey:i,isSigner:e=!1,isWritable:t=!0}){return{pubkey:i,isWritable:t,isSigner:e}}var So=[Jt({pubkey:Pr,isWritable:!1}),Jt({pubkey:Gn.programId,isWritable:!1}),Jt({pubkey:xr,isWritable:!1})];function en({publicKey:i,transformSol:e}){let t=Vn(i.toString());if(t instanceof J)return e&&t.equals(gt)?$t:t;if(e&&t.toString()===gt.toBase58())return $t;if(typeof t=="string"){if(t===J.default.toBase58())return J.default;try{return new J(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Vn(i){try{return new J(i)}catch{return i}}var Mt=new J("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),No=new J("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),bt=new J("SysvarRent111111111111111111111111111111111"),Co=new J("SysvarC1ock11111111111111111111111111111111"),lt=new J("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Ko=new J("Sysvar1nstructions1111111111111111111111111"),Lo=Gn.programId,Ro=new J("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Eo=new J("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Mo=new J("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Fo=new J("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Oo=new J("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),_o=new J("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Do=new J("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),vo=new J("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),qo=new J("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Wo=new J("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Go=new J("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),$t=new J("So11111111111111111111111111111111111111112"),gt=J.default;function Ft(i){return en({publicKey:i,transformSol:!0})}import{PublicKey as Br}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Un}from"@solana/spl-token";var Xn={chainId:101,address:Br.default.toBase58(),programId:Un.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},tt={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Un.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var nn=class{constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:o=!1,isToken2022:s=!1}){if(e===gt.toBase58()||e instanceof tn&&gt.equals(e)){this.decimals=tt.decimals,this.symbol=tt.symbol,this.name=tt.name,this.mint=new tn(tt.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?tn.default:en({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Ve=nn;Ve.WSOL=new nn(ee(j({},tt),{mint:tt.address}));import _t from"big.js";import Nr from"bn.js";import Cr from"decimal.js-light";import Ir from"toformat";var Sr=Ir,yt=Sr;var Ot=Ae("module/fraction"),rn=yt(_t),ht=yt(Cr),Kr={[0]:ht.ROUND_DOWN,[1]:ht.ROUND_HALF_UP,[2]:ht.ROUND_UP},Lr={[0]:_t.roundDown,[1]:_t.roundHalfUp,[2]:_t.roundUp},V=class{constructor(e,t=new Nr(1)){this.numerator=de(e),this.denominator=de(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new V(this.denominator,this.numerator)}add(e){let t=e instanceof V?e:new V(de(e));return this.denominator.eq(t.denominator)?new V(this.numerator.add(t.numerator),this.denominator):new V(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof V?e:new V(de(e));return this.denominator.eq(t.denominator)?new V(this.numerator.sub(t.numerator),this.denominator):new V(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof V?e:new V(de(e));return new V(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof V?e:new V(de(e));return new V(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||Ot.logWithError(`${e} is not an integer.`),e<=0&&Ot.logWithError(`${e} is not positive.`),ht.set({precision:e+1,rounding:Kr[n]});let r=new ht(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||Ot.logWithError(`${e} is not an integer.`),e<0&&Ot.logWithError(`${e} is negative.`),rn.DP=e,rn.RM=Lr[n]||1,new rn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Er=Ae("Raydium_price"),Re=class extends V{constructor(t){let{baseToken:n,quoteToken:r,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=r,this.scalar=new V(on(n.decimals),on(r.decimals))}get raw(){return new V(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Re({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&Er.logWithError("mul token not equals");let n=super.mul(t);return new Re({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,r){return this.adjusted.toSignificant(t,n,r)}toFixed(t=this.quoteToken.decimals,n,r){return this.adjusted.toFixed(t,n,r)}};var sn=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},Dt=sn;Dt.SOL=new sn(Xn);import Mr from"bn.js";var zn=new V(new Mr(100)),Ye=class extends V{toSignificant(e=5,t,n){return this.mul(zn).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(zn).toFixed(e,t,n)}};var Fr=new xe(0),Ds=new xe(1),vs=new xe(2),qs=new xe(3),Ws=new xe(5),an=new xe(10),Gs=new xe(100),Vs=new xe(1e3),Us=new xe(1e4),Hn=9007199254740991;function de(i){let e=Ae("Raydium_parseBigNumberish");if(i instanceof xe)return i;if(typeof i=="string"){if(i.match(/^-?[0-9]+$/))return new xe(i);e.logWithError(`invalid BigNumberish string: ${i}`)}return typeof i=="number"?(i%1&&e.logWithError(`BigNumberish number underflow: ${i}`),(i>=Hn||i<=-Hn)&&e.logWithError(`BigNumberish number overflow: ${i}`),new xe(String(i))):typeof i=="bigint"?new xe(i.toString()):(e.error(`invalid BigNumberish value: ${i}`),new xe(0))}function on(i){return an.pow(de(i))}var _r=Ae("Raydium_amount"),Zn=yt(Or);function Dr(i,e){let t="0",n="0";if(i.includes(".")){let r=i.split(".");r.length===2?([t,n]=r,n=n.padEnd(e,"0")):_r.logWithError(`invalid number string, num: ${i}`)}else t=i;return[t,n.slice(0,e)||n]}var ye=class extends V{constructor(t,n,r=!0,o){let s=new vt(0),a=an.pow(new vt(t.decimals));if(r)s=de(n);else{let u=new vt(0),c=new vt(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,m]=Dr(n.toString(),t.decimals);u=de(l),c=de(m)}u=u.mul(a),s=u.add(c)}super(s,a);this.logger=Ae(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new ye(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new ye(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,r=0){return super.toSignificant(t,n,r)}toFixed(t=this.token.decimals,n,r=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,r)}toExact(t={groupSeparator:""}){return Zn.DP=this.token.decimals,new Zn(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};import{PublicKey as cu,sendAndConfirmTransaction as lu,Transaction as du,TransactionMessage as pu,VersionedTransaction as gu}from"@solana/web3.js";import hu from"axios";var he={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut"};import{PublicKey as vr,ComputeBudgetProgram as Ta,Transaction as xa,TransactionMessage as Ia,Keypair as Sa,VersionedTransaction as Ca}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Ra}from"@solana/spl-token";var Fa=Ae("Raydium_txUtil");function Be(i,e){let[t,n]=vr.findProgramAddressSync(i,e);return{publicKey:t,nonce:n}}import{PublicKey as Wr,AddressLookupTableAccount as jn}from"@solana/web3.js";import{PublicKey as qr}from"@solana/web3.js";import{MINT_SIZE as Ga,TOKEN_PROGRAM_ID as Va,getTransferFeeConfig as Ua,unpackMint as Xa}from"@solana/spl-token";var un=Ae("Raydium_accountInfo_util");async function Qe(i,e,t){let{batchRequest:n,commitment:r="confirmed",chunkCount:o=100}=j({batchRequest:!1},t),s=cn(e,o),a=new Array(s.length).fill([]);if(n){let u=s.map(m=>{let d=i._buildArgs([m.map(f=>f.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:d}}),c=cn(u,10);a=(await(await Promise.all(c.map(async m=>await i._rpcBatchRequest(m)))).flat()).map(m=>(m.error&&un.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.error.message}`),m.result.value.map(d=>{if(d){let{data:f,executable:g,lamports:p,owner:y,rentEpoch:b}=d;return f.length!==2&&f[1]!=="base64"&&un.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(f[0],"base64"),executable:g,lamports:p,owner:new qr(y),rentEpoch:b}}return null})))}else try{a=await Promise.all(s.map(u=>i.getMultipleAccountsInfo(u,r)))}catch(u){u instanceof Error&&un.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.message}`)}return a.flat()}async function ln(i,e,t){let n=await Qe(i,e.map(r=>r.pubkey),t);return e.map((r,o)=>ee(j({},r),{accountInfo:n[o]}))}var Gr={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new jn({key:new Wr("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:jn.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};function cn(i,e=1,t=[]){let n=[...i];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as q}from"@solana/web3.js";var Nu=new q("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Cu=new q("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Ku=new q("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Lu=new q("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Ru=new q("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Eu=new q("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Mu=new q("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Fu=new q("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Ou=new q("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),_u=new q("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Du=new q("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),vu=new q("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),qu=new q("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Wu=new q("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Gu=new q("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Vu=new q("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Uu=new q("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Xu=new q("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),zu=new q("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Vr=new q("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),Ur=new q("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),Xr=new q("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2");var Hu={SERUM_MARKET:q.default,OPENBOOK_MARKET:new q("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:q.default,FarmV3:new q("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new q("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new q("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new q("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new q("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new q("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),Router:new q("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:Vr,CREATE_CPMM_POOL_AUTH:Ur,CREATE_CPMM_POOL_FEE_ACC:Xr,FEE_DESTINATION_ID:new q("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR")};import{PublicKey as zr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Hr}from"@solana/spl-token";function Je(i,e,t){return Be([i.toBuffer(),(t!=null?t:Hr).toBuffer(),e.toBuffer()],new zr("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import Ee from"bn.js";var wt=1e4;function te(i,e,t,n){if(e===void 0)return{amount:i,fee:void 0,expirationTime:void 0};let r=ee(j({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,s=new Ee(o.maximumFee.toString()),a=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===wt){let u=new Ee(o.maximumFee.toString());return{amount:i.add(u),fee:u,expirationTime:a}}else{let u=mn(i.mul(new Ee(wt)),new Ee(wt-o.transferFeeBasisPoints)),c=new Ee(o.maximumFee.toString()),l=u.sub(i).gt(c)?i.add(c):u,m=mn(l.mul(new Ee(o.transferFeeBasisPoints)),new Ee(wt)),d=m.gt(s)?s:m;return{amount:l,fee:d,expirationTime:a}}else{let u=mn(i.mul(new Ee(o.transferFeeBasisPoints)),new Ee(wt)),c=u.gt(s)?s:u;return{amount:i,fee:c,expirationTime:a}}}function $e(i,e){return i===void 0?e:e===void 0?i:Math.min(i,e)}function mn(i,e){let{div:t,mod:n}=i.divmod(e);return n.gt(new Ee(0))?t.add(new Ee(1)):t}import{PublicKey as no}from"@solana/web3.js";import $n,{isBN as ei}from"bn.js";import{bits as wc,BitStructure as Ac,blob as Zr,Blob as kc,cstr as Tc,f32 as Pc,f32be as xc,f64 as Bc,f64be as Ic,greedy as Sc,Layout as jr,ns64 as Nc,ns64be as Cc,nu64 as Kc,nu64be as Lc,offset as Rc,s16 as Ec,s16be as Mc,s24 as Fc,s24be as Oc,s32 as Yr,s32be as _c,s40 as Dc,s40be as vc,s48 as qc,s48be as Wc,s8 as Gc,seq as Qr,struct as Vc,Structure as Jr,u16 as $r,u16be as Uc,u24 as Xc,u24be as zc,u32 as Hc,u32be as Zc,u40 as jc,u40be as Yc,u48 as Qc,u48be as Jc,u8 as eo,UInt as to,union as $c,Union as el,unionLayoutDiscriminator as tl,utf8 as nl}from"@solana/buffer-layout";var dn=jr,Yn=Jr;var fn=to;var Qn=eo,At=$r;var fe=Yr;var Jn=Qr;var Se=Zr;var mt=class extends dn{constructor(t,n,r){super(t,r);this.blob=Se(t),this.signed=n}decode(t,n=0){let r=new $n(this.blob.decode(t,n),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,n,r=0){return typeof t=="number"&&(t=new $n(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,r)}};function se(i){return new fn(1,i)}function dt(i){return new fn(4,i)}function N(i){return new mt(8,!1,i)}function W(i){return new mt(16,!1,i)}function ti(i){return new mt(8,!0,i)}function ni(i){return new mt(16,!0,i)}var qt=class extends dn{constructor(t,n,r,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=r}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,r){return this.layout.encode(this.encoder(t),n,r)}getSpan(t,n){return this.layout.getSpan(t,n)}};function ae(i){return new qt(Se(32),e=>new no(e),e=>e.toBuffer(),i)}function De(i){return new qt(Qn(),io,ro,i)}function io(i){if(i===0)return!1;if(i===1)return!0;throw new Error("Invalid bool: "+i)}function ro(i){return i?1:0}var pn=class extends Yn{decode(e,t){return super.decode(e,t)}};function Y(i,e,t){return new pn(i,e,t)}function ne(i,e,t){let n,r=typeof e=="number"?e:ei(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=ei(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return Jn(i,r,t)}import{ASSOCIATED_TOKEN_PROGRAM_ID as wi,TOKEN_2022_PROGRAM_ID as et,TOKEN_PROGRAM_ID as ge}from"@solana/spl-token";import{Keypair as Tn,PublicKey as T,SystemProgram as It,TransactionInstruction as Fe}from"@solana/web3.js";import Ai from"bn.js";import go from"bn.js";function Wt(i){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,i,!1),new Uint8Array(e)}function gn(i,e){let t=0;for(let n=i-1;n>=0&&!e.testn(n);n--)t++;return t}function bn(i,e){let t=0;for(let n=0;n<i&&!e.testn(n);n++)t++;return t}function kt(i,e){for(let t=0;t<i;t++)if(e.testn(t))return!1;return!0}function ii(i,e){return kt(i,e)?null:gn(i,e)}function ri(i,e){return kt(i,e)?null:bn(i,e)}var wl=Buffer.from("amm_config","utf8"),oo=Buffer.from("pool","utf8"),so=Buffer.from("pool_vault","utf8"),ao=Buffer.from("pool_reward_vault","utf8"),oi=Buffer.from("position","utf8"),uo=Buffer.from("tick_array","utf8"),co=Buffer.from("operation","utf8"),lo=Buffer.from("pool_tick_array_bitmap_extension","utf8"),mo=Buffer.from("observation","utf8");function si(i,e,t,n){return Be([oo,e.toBuffer(),t.toBuffer(),n.toBuffer()],i)}function yn(i,e,t){return Be([so,e.toBuffer(),t.toBuffer()],i)}function ai(i,e,t){return Be([ao,e.toBuffer(),t.toBuffer()],i)}function z(i,e,t){return Be([uo,e.toBuffer(),Wt(t)],i)}function nt(i,e,t,n){return Be([oi,e.toBuffer(),Wt(t),Wt(n)],i)}function ve(i,e){return Be([oi,e.toBuffer()],i)}function Gt(i){return Be([Buffer.from("metadata","utf8"),lt.toBuffer(),i.toBuffer()],lt)}function hn(i){return Be([co],i)}function Ne(i,e){return Be([lo,e.toBuffer()],i)}function ui(i,e){return Be([mo,e.toBuffer()],i)}import Ce from"bn.js";var ie=new Ce(0),qe=new Ce(1),Ue=new Ce(-1),Ie=new Ce(1).shln(64),Vt=new Ce(1).shln(128),wn=Ie.sub(qe),Tt=64,ci=Vt.subn(1),we=-443636,ke=-we,it=new Ce("4295048016"),rt=new Ce("79226673521066979257578248091"),Tl=new Ce("4295048017"),Pl=new Ce("79226673521066979257578248090"),li=16,mi="59543866431248",di="184467440737095516",fi="15793534762490258745",Ut=new Ce(10).pow(new Ce(6));var xl=new Ce("18446744073700000000");var fo=15,v=class{static async getTickArrays(e,t,n,r,o,s,a){let u=[],c=B.getTickArrayStartIndexByTick(r,o),l=B.getInitializedTickArrayInRange(s,a,o,c,Math.floor(fo/2));for(let f=0;f<l.length;f++){let{publicKey:g}=z(t,n,l[f]);u.push(g)}let m=(await Qe(e,u)).map(f=>f!==null?Pt.decode(f.data):null),d={};for(let f=0;f<u.length;f++){let g=m[f];g!==null&&(d[g.startTickIndex]=ee(j({},g),{address:u[f]}))}return d}static nextInitializedTick(e,t,n,r,o,s){let{initializedTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}=this.nextInitializedTickInOneArray(e,t,n,r,o,s);for(;a==null||a.liquidityGross.lten(0);){if(c=B.getNextTickArrayStartIndex(c,o,s),this.checkIsValidStartIndex(c,o))throw new Error("No enough initialized tickArray");let l=n[c];if(l===void 0)continue;let{nextTick:m,tickArrayAddress:d,tickArrayStartTickIndex:f}=this.firstInitializedTickInOneArray(e,t,l,s);[a,u,c]=[m,d,f]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}}static nextInitializedTickArray(e,t,n,r,o){let s=Math.floor(e/v.tickCount(t)),a=n?B.searchLowBitFromStart(r,o,s-1,1,t):B.searchHightBitFromStart(r,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let o;if(r){let a=ue-1;for(;a>=0;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a-1}}else{let a=0;for(;a<ue;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a+1}}let{publicKey:s}=z(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,o,s){let a=B.getTickArrayStartIndexByTick(r,o),u=Math.floor((r-a)/o),c=n[a];if(c==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let l;if(s)for(;u>=0;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){l=d;break}u=u-1}else for(u=u+1;u<ue;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){l=d;break}u=u+1}let{publicKey:m}=z(e,t,a);return{initializedTick:l,tickArrayAddress:m,tickArrayStartTickIndex:c.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(B.checkIsOutOfBoundary(e)){if(e>ke)return!1;let n=B.getTickArrayStartIndexByTick(we,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return ue*e}};import F from"bn.js";import{PublicKey as Me}from"@solana/web3.js";import Q from"bn.js";var An=14,Xe=class{static maxTickInTickarrayBitmap(e){return e*ue*ot}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);let o=n*r;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!v.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=r?t-v.tickCount(n):t+v.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*ue,u=s/a+512;s<0&&s%a!=0&&u--;let c=Math.abs(u);if(r){let l=e.shln(1024-c-1),m=ii(1024,l);if(m!==null){let d=(c-m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(c),m=ri(1024,l);if(m!==null){let d=(c+m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:o-v.tickCount(n)}}}},xt=class{static getBitmapOffset(e,t){if(!v.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=Xe.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&r--,r}static getBitmap(e,t,n){let r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=Xe.maxTickInTickarrayBitmap(e),n=-t;if(ke<=t)throw Error(`extensionTickBoundary check error: ${ke}, ${t}`);if(n<=we)throw Error(`extensionTickBoundary check error: ${n}, ${we}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:r}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:B.mergeTickArrayBitmap(r).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){let o=v.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,r);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){let{minValue:o,maxValue:s}=Xe.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(r){let u=B.mergeTickArrayBitmap(e).shln(ot-1-a),c=kt(512,u)?null:gn(512,u);if(c!==null){let l=t-c*v.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let u=B.mergeTickArrayBitmap(e).shrn(a),c=kt(512,u)?null:bn(512,u);if(c!==null){let l=t+c*v.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s-v.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%Xe.maxTickInTickarrayBitmap(t),r=Math.floor(n/v.tickCount(t));return e<0&&n!=0&&(r=ot-r),r}};import We from"bn.js";var Bt=class{static getfeeGrowthInside(e,t,n){let r=new We(0),o=new We(0);e.tickCurrent>=t.tick?(r=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new We(0),a=new We(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let u=M.wrappingSubU128(M.wrappingSubU128(e.feeGrowthGlobalX64A,r),s),c=M.wrappingSubU128(M.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:u,feeGrowthInsideBX64:c}}static GetPositionFees(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=M.mulDivFloor(M.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Ie),u=t.tokenFeesOwedA.add(a),c=M.mulDivFloor(M.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Ie),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=M.mulDivFloor(M.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Ie),u=t.tokenFeesOwedA.add(a),c=M.mulDivFloor(M.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Ie),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,r){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=M.wrappingSubU128(u,c.growthInsideLastX64),m=M.mulDivFloor(l,t.liquidity,Ie),d=c.rewardAmountOwed.add(m);o.push(d)}return o}static GetPositionRewards(e,t,n,r){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=M.wrappingSubU128(u,c.growthInsideLastX64),m=M.mulDivFloor(l,t.liquidity,Ie),d=c.rewardAmountOwed.add(m);o.push(d)}return o}static getRewardGrowthInside(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new We(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new We(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(M.wrappingSubU128(M.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),u))}return o}static getRewardGrowthInsideV2(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new We(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new We(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(M.wrappingSubU128(M.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),u))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:r,add:o,epochInfo:s}){var y,b,k,w;let a=R.priceToSqrtPriceX64(new x(e.price),e.mintA.decimals,e.mintB.decimals),u=R.getSqrtPriceX64FromTick(t.tickLower),c=R.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+r:1-r,m=G.getAmountsFromLiquidity(a,u,c,n,o),[d,f]=[te(m.amountA,(y=e.mintA.extensions)==null?void 0:y.feeConfig,s,!0),te(m.amountB,(b=e.mintB.extensions)==null?void 0:b.feeConfig,s,!0)],[g,p]=[te(new We(new x(m.amountA.toString()).mul(l).toFixed(0)),(k=e.mintA.extensions)==null?void 0:k.feeConfig,s,!0),te(new We(new x(m.amountB.toString()).mul(l).toFixed(0)),(w=e.mintB.extensions)==null?void 0:w.feeConfig,s,!0)];return{liquidity:n,amountA:d,amountB:f,amountSlippageA:g,amountSlippageB:p,expirationTime:$e(d.expirationTime,f.expirationTime)}}};import{TOKEN_2022_PROGRAM_ID as pi}from"@solana/spl-token";var pe=class{static getOutputAmountAndRemainAccounts(e,t,n,r,o,s=!1){let a=n.toBase58()===e.mintA.address,u=[],{isExist:c,startIndex:l,nextAccountMeta:m}=this.getFirstInitializedTickArray(e,a);if(!c||l===void 0||!m)throw new Error("Invalid tick array");u.push(m);let{allTrade:d,amountCalculated:f,accounts:g,sqrtPriceX64:p,feeAmount:y}=st.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,a,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r,l,o,s);return u.push(...g),{allTrade:d,expectedAmountOut:f.mul(Ue),remainingAccounts:u,executionPrice:p,feeAmount:y}}static getInputAmountAndRemainAccounts(e,t,n,r,o){let s=n.toBase58()===e.mintB.address,a=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!u||c===void 0||!l)throw new Error("Invalid tick array");try{let p=this.preInitializedTickArrayStartIndex(e,s);if(p.isExist){let{publicKey:y}=z(e.programId,e.id,p.nextStartIndex);a.push(y)}}catch{}a.push(l);let{amountCalculated:m,accounts:d,sqrtPriceX64:f,feeAmount:g}=st.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r.mul(Ue),c,o);return a.push(...d),{expectedAmountIn:m,remainingAccounts:a,executionPrice:f,feeAmount:g}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:r}=pe.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?xt.checkTickArrayIsInit(v.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):B.checkTickArrayIsInitialized(B.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=z(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,v.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=z(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/v.tickCount(e.tickSpacing)),r=t?B.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):B.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=v.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:r,tickIndex:o}=Xe.nextInitializedTickArrayStartIndex(B.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(r)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=xt.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<we||t>ke)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:r,rewardInfos:o}){var a,u,c;let s=[];for(let l=0;l<o.length;l++){let m=o[l],d=(c=(a=t.rewardDefaultInfos[l])==null?void 0:a.mint.programId)!=null?c:(u=await e.getAccountInfo(m.tokenMint))==null?void 0:u.owner;if(d===void 0)throw Error("get new reward mint info error");let f=ee(j({},m),{perSecond:M.x64ToDecimal(m.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new Me(d)});if(f.tokenMint.equals(Me.default))continue;if(n<=f.openTime.toNumber()||r.eq(ie)){s.push(f);continue}let g=new Q(Math.min(f.endTime.toNumber(),n)),p=g.sub(f.lastUpdateTime),y=M.mulDivFloor(p,f.emissionsPerSecondX64,r),b=f.rewardGrowthGlobalX64.add(y),k=M.mulDivFloor(p,f.emissionsPerSecondX64,Ie),w=f.rewardTotalEmissioned.add(k);s.push(ee(j({},f),{rewardGrowthGlobalX64:b,rewardTotalEmissioned:w,lastUpdateTime:g}))}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:r}=this.tickRange(e);for(let o of t){let s=B.getTickArrayStartIndexByTick(o,e);if(s>=n||s<r)return!0}return!1}static tickRange(e){let t=Xe.maxTickInTickarrayBitmap(e),n=-t;return t>ke&&(t=v.getArrayStartIndex(ke,e)+v.tickCount(e)),n<we&&(n=v.getArrayStartIndex(we,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!v.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/v.tickCount(t)*ot}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let r=await ln(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of r)s.accountInfo!==null&&(o[s.pubkey.toString()]=yi.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let r={},o=[];for(let u of t){let c=B.getTickArrayStartIndexByTick(u.tickCurrent,u.tickSpacing),l=B.getInitializedTickArrayInRange(u.tickArrayBitmap,u.exBitmapInfo,u.tickSpacing,c,7);for(let m of l){let{publicKey:d}=z(u.programId,u.id,m);o.push({pubkey:d}),r[d.toString()]=u.id}}let s=await ln(e,o,{batchRequest:n}),a={};for(let u of s){if(!u.accountInfo)continue;let c=r[u.pubkey.toString()];if(!c)continue;a[c.toString()]===void 0&&(a[c.toString()]={});let l=Pt.decode(u.accountInfo.data);a[c.toString()][l.startTickIndex]=ee(j({},l),{address:u.pubkey})}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:r=!1,updateOwnerRewardAndFee:o=!0}){var a;let s=[];for(let u=0;u<e.length;u++){let c=e[u];c!==null&&(s.find(l=>l.equals(c.state.programId))||s.push(c.state.programId))}if(n){let u=n.tokenAccounts.map(d=>d.accountInfo.mint),c=[];for(let d of u)for(let f of s)c.push(ve(f,d).publicKey);let l=await Qe(t,c,{batchRequest:r}),m={};for(let d of l){if(d===null)continue;let f=bi.decode(d.data),g=f.poolId.toString(),p=e.find(L=>L.state.id.toBase58()===g);if(p===void 0)continue;let y=p.state,b=B._getTickPriceLegacy({poolInfo:y,tick:f.tickLower,baseIn:!0}),k=B._getTickPriceLegacy({poolInfo:y,tick:f.tickUpper,baseIn:!0}),{amountA:w,amountB:P}=G.getAmountsFromLiquidity(y.sqrtPriceX64,b.tickSqrtPriceX64,k.tickSqrtPriceX64,f.liquidity,!1),C=1/(1-Math.sqrt(Math.sqrt(b.price.div(k.price).toNumber())));p.positionAccount=[...(a=p.positionAccount)!=null?a:[],{poolId:f.poolId,nftMint:f.nftMint,priceLower:b.price,priceUpper:k.price,amountA:w,amountB:P,tickLower:f.tickLower,tickUpper:f.tickUpper,liquidity:f.liquidity,feeGrowthInsideLastX64A:f.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:f.feeGrowthInsideLastX64B,tokenFeesOwedA:f.tokenFeesOwedA,tokenFeesOwedB:f.tokenFeesOwedB,rewardInfos:f.rewardInfos.map(L=>ee(j({},L),{pendingReward:new Q(0)})),leverage:C,tokenFeeAmountA:new Q(0),tokenFeeAmountB:new Q(0)}];let A=await B.getTickArrayAddressByTick(p.state.programId,f.poolId,f.tickLower,p.state.tickSpacing),E=await B.getTickArrayAddressByTick(p.state.programId,f.poolId,f.tickUpper,p.state.tickSpacing);m[`${p.state.programId.toString()}-${f.poolId.toString()}-${f.tickLower}`]=A,m[`${p.state.programId.toString()}-${f.poolId.toString()}-${f.tickUpper}`]=E}if(o){let d=Object.values(m),f=await Qe(t,d,{batchRequest:r}),g={};for(let p=0;p<d.length;p++){let y=f[p];if(y===null)continue;let b=d[p].toString();g[b]=Pt.decode(y.data)}for(let{state:p,positionAccount:y}of e)if(!!y)for(let b of y){let k=`${p.programId.toString()}-${p.id.toString()}-${b.tickLower}`,w=`${p.programId.toString()}-${p.id.toString()}-${b.tickUpper}`,P=g[m[k].toString()],C=g[m[w].toString()],A=P.ticks[B.getTickOffsetInArray(b.tickLower,p.tickSpacing)],E=C.ticks[B.getTickOffsetInArray(b.tickUpper,p.tickSpacing)],{tokenFeeAmountA:L,tokenFeeAmountB:X}=await Bt.GetPositionFees(p,b,A,E),H=await Bt.GetPositionRewards(p,b,A,E);b.tokenFeeAmountA=L.gte(new Q(0))?L:new Q(0),b.tokenFeeAmountB=X.gte(new Q(0))?X:new Q(0);for(let O=0;O<H.length;O++)b.rewardInfos[O].pendingReward=H[O].gte(new Q(0))?H[O]:new Q(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountIn:o,slippage:s,priceLimit:a=new x(0),catchLiquidityInsufficient:u=!1}){var ce;let c,l=n.toBase58()===e.mintA.address,[m,d]=l?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];a.equals(new x(0))?c=l?it.add(new Q(1)):rt.sub(new Q(1)):c=R.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let f=te(o,m,r,!1),{allTrade:g,expectedAmountOut:p,remainingAccounts:y,executionPrice:b,feeAmount:k}=pe.getOutputAmountAndRemainAccounts(e,t,n,f.amount.sub((ce=f.fee)!=null?ce:ie),c,u),w=te(p,d,r,!1),P=R.sqrtPriceX64ToPrice(b,e.mintA.decimals,e.mintB.decimals),C=l?P:new x(1).div(P),A=p.mul(new Q(Math.floor((1-s)*1e10))).div(new Q(1e10)),E=te(A,d,r,!1),L=l?e.currentPrice:new x(1).div(e.currentPrice),X=new x(C).sub(L).abs(),H=L,O=new Ye(new x(X).mul(10**15).toFixed(0),new x(H).mul(10**15).toFixed(0));return{allTrade:g,realAmountIn:f,amountOut:w,minAmountOut:E,expirationTime:$e(f.expirationTime,w.expirationTime),currentPrice:e.currentPrice,executionPrice:C,priceImpact:O,fee:k,remainingAccounts:y,executionPriceX64:b}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:r,slippage:o,epochInfo:s,catchLiquidityInsufficient:a=!1}){let u=r.address===e.mintB.address,[c,l]=u?[e.mintA,e.mintB]:[e.mintB,e.mintA],[m,d]=[new Ve(ee(j({},c),{mint:c.address,isToken2022:c.programId===pi.toBase58()})),new Ve(ee(j({},l),{mint:l.address,isToken2022:l.programId===pi.toBase58()}))],{allTrade:f,realAmountIn:g,amountOut:p,minAmountOut:y,expirationTime:b,currentPrice:k,executionPrice:w,priceImpact:P,fee:C,remainingAccounts:A,executionPriceX64:E}=pe.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new Me(c.address),amountIn:n,slippage:o,epochInfo:s,catchLiquidityInsufficient:a}),L=ee(j({},g),{amount:new ye(m,g.amount),fee:g.fee===void 0?void 0:new ye(m,g.fee)}),X=ee(j({},p),{amount:new ye(d,p.amount),fee:p.fee===void 0?void 0:new ye(d,p.fee)}),H=ee(j({},y),{amount:new ye(d,y.amount),fee:y.fee===void 0?void 0:new ye(d,y.fee)}),O=new Re({baseToken:m,denominator:new Q(10).pow(new Q(20+m.decimals)),quoteToken:d,numerator:k.mul(new x(10**(20+d.decimals))).toFixed(0)}),ce=new Re({baseToken:m,denominator:new Q(10).pow(new Q(20+m.decimals)),quoteToken:d,numerator:w.mul(new x(10**(20+d.decimals))).toFixed(0)}),re=new ye(m,C);return{allTrade:f,realAmountIn:L,amountOut:X,minAmountOut:H,expirationTime:b,currentPrice:O,executionPrice:ce,priceImpact:P,fee:re,remainingAccounts:A,executionPriceX64:E}}static computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountOut:o,slippage:s,priceLimit:a=new x(0)}){var H;let u=n.toBase58()===e.mintA.address,c={[e.mintA.address]:e.mintA.extensions.feeConfig,[e.mintB.address]:e.mintB.extensions.feeConfig},l;a.equals(new x(0))?l=u?rt.sub(new Q(1)):it.add(new Q(1)):l=R.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let m=te(o,c[n.toString()],r,!0),{expectedAmountIn:d,remainingAccounts:f,executionPrice:g,feeAmount:p}=pe.getInputAmountAndRemainAccounts(e,t,n,m.amount.sub((H=m.fee)!=null?H:ie),l),y=u?e.mintB.address:e.mintA.address,b=te(d,c[y],r,!1),k=R.sqrtPriceX64ToPrice(g,e.mintA.decimals,e.mintB.decimals),w=u?k:new x(1).div(k),P=d.mul(new Q(Math.floor((1+s)*1e10))).div(new Q(1e10)),C=te(P,c[y],r,!0),A=u?e.currentPrice:new x(1).div(e.currentPrice),E=new x(w).sub(A).abs(),L=A,X=new Ye(new x(E).mul(10**15).toFixed(0),new x(L).mul(10**15).toFixed(0));return{amountIn:b,maxAmountIn:C,realAmountOut:m,expirationTime:$e(b.expirationTime,m.expirationTime),currentPrice:e.currentPrice,executionPrice:w,priceImpact:X,fee:p,remainingAccounts:f}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:r}){var g,p,y;let o=e[t],s=B.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=B.getTickPrice({poolInfo:e,tick:r,baseIn:!0}).price.toNumber(),u=Math.max(s,o.priceMin),l=Math.min(a,o.priceMax)-u,m=a-s,d=o.priceMax-o.priceMin,f;return l<=0?f=0:m===l?f=d/l:d===l?f=l/m:f=l/d*(l/m),{feeApr:o.feeApr*f,rewardsApr:[((g=o.rewardApr[0])!=null?g:0)*f,((p=o.rewardApr[1])!=null?p:0)*f,((y=o.rewardApr[2])!=null?y:0)*f],apr:o.apr*f}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:r,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:u}){let c=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],m=r[Ft(e.mintA.address).toString()],d=r[Ft(e.mintB.address).toString()],f=e.mintA.decimals,g=e.mintB.decimals;if(!l||!m||!d)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let p=R.priceToSqrtPriceX64(new x(e.price),e.mintA.decimals,e.mintB.decimals),y=R.getSqrtPriceX64FromTick(s),b=R.getSqrtPriceX64FromTick(a),{amountSlippageA:k,amountSlippageB:w}=G.getAmountsFromLiquidityWithSlippage(p,y,b,t,!1,!1,0),{amountSlippageA:P,amountSlippageB:C}=G.getAmountsFromLiquidityWithSlippage(p,y,b,o,!1,!1,0),A=new x(k.toString()).div(new x(10).pow(f)).mul(m.value).add(new x(w.toString()).div(new x(10).pow(g)).mul(d.value)),E=new x(P.toString()).div(new x(10).pow(f)).mul(m.value).add(new x(C.toString()).div(new x(10).pow(g)).mul(d.value)),L=new x(1).div(A.add(E)),H=new x(l.volumeFee).mul(365).div(c).mul(L).mul(100).toNumber(),O=3600*24*365,ce=e.rewardDefaultInfos.map(re=>{var U,Pn;let Te=re.mint.decimals,$=r[re.mint.address];return u<((U=re.startTime)!=null?U:0)||u>((Pn=re.endTime)!=null?Pn:0)||!re.perSecond||!$||Te===void 0?0:new x($.value).mul(new x(re.perSecond).mul(O)).div(new x(10).pow(Te)).mul(L).mul(100).toNumber()});return{feeApr:H,rewardsApr:ce,apr:H+ce.reduce((re,Te)=>re+Te,0)}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:r,amount:o,slippage:s,add:a,epochInfo:u,amountHasFee:c}){var b,k;let l=R.priceToSqrtPriceX64(new x(e.price),e.mintA.decimals,e.mintB.decimals),m=R.getSqrtPriceX64FromTick(n),d=R.getSqrtPriceX64FromTick(r),f=a?1-s:1+s,g=te(o,(b=e[t?"mintA":"mintB"].extensions)==null?void 0:b.feeConfig,u,!c),p=new Q(new x(g.amount.sub((k=g.fee)!=null?k:ie).toString()).mul(f).toFixed(0)),y;if(l.lte(m))y=t?G.getLiquidityFromTokenAmountA(m,d,p,!a):new Q(0);else if(l.lte(d)){let w=G.getLiquidityFromTokenAmountA(l,d,p,!a),P=G.getLiquidityFromTokenAmountB(m,l,p);y=t?w:P}else y=t?new Q(0):G.getLiquidityFromTokenAmountB(m,d,p);return pe.getAmountsFromLiquidity({epochInfo:u,poolInfo:e,tickLower:n,tickUpper:r,liquidity:y,slippage:s,add:a})}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:r,liquidity:o,slippage:s,add:a}){var y,b,k,w;let u=R.getSqrtPriceX64FromTick(n),c=R.getSqrtPriceX64FromTick(r),l=a?1+s:1-s,m=G.getAmountsFromLiquidity(R.priceToSqrtPriceX64(new x(t.price),t.mintA.decimals,t.mintB.decimals),u,c,o,a),[d,f]=[te(m.amountA,(y=t.mintA.extensions)==null?void 0:y.feeConfig,e,!0),te(m.amountB,(b=t.mintB.extensions)==null?void 0:b.feeConfig,e,!0)],[g,p]=[te(m.amountA.muln(l),(k=t.mintA.extensions)==null?void 0:k.feeConfig,e,!0),te(m.amountB.muln(l),(w=t.mintB.extensions)==null?void 0:w.feeConfig,e,!0)];return{liquidity:o,amountA:d,amountB:f,amountSlippageA:g,amountSlippageB:p,expirationTime:$e(d.expirationTime,f.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let r=t.filter(u=>!n[u.id]).map(u=>new Me(u.id));(await Qe(e,r)).forEach((u,c)=>{!u||(n[r[c].toBase58()]=gi.decode(u.data))});let s=t.map(u=>Ne(new Me(u.programId),new Me(u.id)).publicKey),a=await pe.fetchExBitmaps({connection:e,exBitmapAddress:s,batchRequest:!1});return t.reduce((u,c)=>ee(j({},u),{[c.id]:ee(j({},n[c.id]),{id:new Me(c.id),version:6,programId:new Me(c.programId),mintA:c.mintA,mintB:c.mintB,ammConfig:ee(j({},c.config),{id:new Me(c.config.id),fundOwner:""}),currentPrice:new x(c.price),exBitmapInfo:a[Ne(new Me(c.programId),new Me(c.id)).publicKey.toBase58()],startTime:n[c.id].startTime.toNumber()})}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};var M=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),o=r.div(n);return r.mod(n).eq(ie)||(o=o.add(qe)),o}static mulDivFloor(e,t,n){if(n.eq(ie))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(ie))throw new Error("division by 0");return e.mul(t).add(n.sub(qe)).div(n)}static x64ToDecimal(e,t){return new x(e.toString()).div(x.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new F(e.mul(x.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(Vt).sub(t).mod(Vt)}};function le(i,e){return kn(i.mul(e),64,256)}function po(i,e,t){let n=i.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function kn(i,e,t){let n=i.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var R=class{static sqrtPriceX64ToPrice(e,t,n){return M.x64ToDecimal(e).pow(2).mul(x.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return M.decimalToX64(e.mul(x.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(ie))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ie))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(ie))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ie))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(ie))return e;let o=t.shln(Tt);if(r){let s=o,a=o.add(n.mul(e));return a.gte(s)?M.mulDivCeil(s,e,a):M.mulDivRoundingUp(s,qe,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return M.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let o=n.shln(Tt);if(r)return e.add(o.div(t));{let s=M.mulDivRoundingUp(o,qe,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<we||e>ke)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new F("18445821805675395072"):new F("18446744073709551616");return(t&2)!=0&&(n=le(n,new F("18444899583751176192"))),(t&4)!=0&&(n=le(n,new F("18443055278223355904"))),(t&8)!=0&&(n=le(n,new F("18439367220385607680"))),(t&16)!=0&&(n=le(n,new F("18431993317065453568"))),(t&32)!=0&&(n=le(n,new F("18417254355718170624"))),(t&64)!=0&&(n=le(n,new F("18387811781193609216"))),(t&128)!=0&&(n=le(n,new F("18329067761203558400"))),(t&256)!=0&&(n=le(n,new F("18212142134806163456"))),(t&512)!=0&&(n=le(n,new F("17980523815641700352"))),(t&1024)!=0&&(n=le(n,new F("17526086738831433728"))),(t&2048)!=0&&(n=le(n,new F("16651378430235570176"))),(t&4096)!=0&&(n=le(n,new F("15030750278694412288"))),(t&8192)!=0&&(n=le(n,new F("12247334978884435968"))),(t&16384)!=0&&(n=le(n,new F("8131365268886854656"))),(t&32768)!=0&&(n=le(n,new F("3584323654725218816"))),(t&65536)!=0&&(n=le(n,new F("696457651848324352"))),(t&131072)!=0&&(n=le(n,new F("26294789957507116"))),(t&262144)!=0&&(n=le(n,new F("37481735321082"))),e>0&&(n=ci.div(n)),n}static getTickFromPrice(e,t,n){return R.getTickFromSqrtPriceX64(R.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(rt)||e.lt(it))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new F(t-64),r=po(n,32,128),o=new F("8000000000000000","hex"),s=0,a=new F(0),u=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new F(0))&&s<li;){u=u.mul(u);let g=u.shrn(127);u=u.shrn(63+g.toNumber()),a=a.add(o.mul(g)),o=o.shrn(1),s+=1}let c=a.shrn(32),m=r.add(c).mul(new F(mi)),d=kn(m.sub(new F(di)),64,128).toNumber(),f=kn(m.add(new F(fi)),64,128).toNumber();return d==f?d:R.getSqrtPriceX64FromTick(f).lte(e)?f:d}},at=class{static getTickWithPriceAndTickspacing(e,t,n,r){let s=R.getTickFromSqrtPriceX64(R.priceToSqrtPriceX64(e,n,r))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,r){let o=at.getTickWithPriceAndTickspacing(e,t,n,r),s=R.getSqrtPriceX64FromTick(o);return R.sqrtPriceX64ToPrice(s,n,r)}},G=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ie))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(Tt),s=t.sub(e);return r?M.mulDivRoundingUp(M.mulDivCeil(o,s,t),qe,e):M.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ie))throw new Error("sqrtPriceX64A must greater than 0");return r?M.mulDivCeil(n,t.sub(e),Ie):M.mulDivFloor(n,t.sub(e),Ie)}static getLiquidityFromTokenAmountA(e,t,n,r){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return r?M.mulDivRoundingUp(a,qe,wn):a.shrn(Tt)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),M.mulDivFloor(n,wn,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return G.getLiquidityFromTokenAmountA(t,n,r,!1);if(e.lt(n)){let s=G.getLiquidityFromTokenAmountA(e,n,r,!1),a=G.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return G.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:G.getTokenAmountAFromLiquidity(t,n,r,o),amountB:new F(0)};if(e.lt(n)){let s=G.getTokenAmountAFromLiquidity(e,n,r,o),a=G.getTokenAmountBFromLiquidity(t,e,r,o);return{amountA:s,amountB:a}}else return{amountA:new F(0),amountB:G.getTokenAmountBFromLiquidity(t,n,r,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,r,o,s,a){let{amountA:u,amountB:c}=G.getAmountsFromLiquidity(e,t,n,r,s),l=o?1+a:1-a,m=new F(new x(u.toString()).mul(l).toFixed(0)),d=new F(new x(c.toString()).mul(l).toFixed(0));return{amountSlippageA:m,amountSlippageB:d}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:r,slippage:o,add:s,epochInfo:a,amountAddFee:u}){var k,w,P,C;let c=R.priceToSqrtPriceX64(new x(e.price),e.mintA.decimals,e.mintB.decimals),l=R.getSqrtPriceX64FromTick(t),m=R.getSqrtPriceX64FromTick(n),d=s?1+o:1-o,f=G.getAmountsFromLiquidity(c,l,m,r,s),[g,p]=[te(f.amountA,(k=e.mintA.extensions)==null?void 0:k.feeConfig,a,u),te(f.amountB,(w=e.mintB.extensions)==null?void 0:w.feeConfig,a,u)],[y,b]=[te(new F(new x(f.amountA.toString()).mul(d).toFixed(0)),(P=e.mintA.extensions)==null?void 0:P.feeConfig,a,u),te(new F(new x(f.amountB.toString()).mul(d).toFixed(0)),(C=e.mintB.extensions)==null?void 0:C.feeConfig,a,u)];return{liquidity:r,amountA:g,amountB:p,amountSlippageA:y,amountSlippageB:b,expirationTime:$e(g.expirationTime,p.expirationTime)}}},st=class{static swapCompute(e,t,n,r,o,s,a,u,c,l,m,d,f,g,p=!1){if(d.eq(ie))throw new Error("amountSpecified must not be 0");if(g||(g=s?it.add(qe):rt.sub(qe)),s){if(g.lt(it))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(g.gte(m))throw new Error("sqrtPriceX64 must smaller than current")}else{if(g.gt(rt))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(g.lte(m))throw new Error("sqrtPriceX64 must greater than current")}let y=d.gt(ie),b={amountSpecifiedRemaining:d,amountCalculated:ie,sqrtPriceX64:m,tick:c>f?Math.min(f+v.tickCount(l)-1,c):f,accounts:[],liquidity:u,feeAmount:new F(0)},k=f,w=n[f],P=0,C=!s&&w.startTickIndex===b.tick;for(;!b.amountSpecifiedRemaining.eq(ie)&&!b.sqrtPriceX64.eq(g);){P>10;let A={};A.sqrtPriceStartX64=b.sqrtPriceX64;let E=B.nextInitTick(w,b.tick,l,s,C),L=E||null,X=null;if(!(L!=null&&L.liquidityGross.gtn(0))){let O=pe.nextInitializedTickArrayStartIndex({tickCurrent:b.tick,tickSpacing:l,tickArrayBitmap:r,exBitmapInfo:o},k,s);if(!O.isExist){if(p)return{allTrade:!1,amountSpecifiedRemaining:b.amountSpecifiedRemaining,amountCalculated:b.amountCalculated,feeAmount:b.feeAmount,sqrtPriceX64:b.sqrtPriceX64,liquidity:b.liquidity,tickCurrent:b.tick,accounts:b.accounts};throw Error("swapCompute LiquidityInsufficient")}k=O.nextStartIndex;let{publicKey:ce}=z(e,t,k);X=ce,w=n[k];try{L=B.firstInitializedTick(w,s)}catch{throw Error("not found next tick info")}}A.tickNext=L.tick,A.initialized=L.liquidityGross.gtn(0),f!==k&&X&&(b.accounts.push(X),f=k),A.tickNext<we?A.tickNext=we:A.tickNext>ke&&(A.tickNext=ke),A.sqrtPriceNextX64=R.getSqrtPriceX64FromTick(A.tickNext);let H;if(s&&A.sqrtPriceNextX64.lt(g)||!s&&A.sqrtPriceNextX64.gt(g)?H=g:H=A.sqrtPriceNextX64,[b.sqrtPriceX64,A.amountIn,A.amountOut,A.feeAmount]=st.swapStepCompute(b.sqrtPriceX64,H,b.liquidity,b.amountSpecifiedRemaining,a),b.feeAmount=b.feeAmount.add(A.feeAmount),y?(b.amountSpecifiedRemaining=b.amountSpecifiedRemaining.sub(A.amountIn.add(A.feeAmount)),b.amountCalculated=b.amountCalculated.sub(A.amountOut)):(b.amountSpecifiedRemaining=b.amountSpecifiedRemaining.add(A.amountOut),b.amountCalculated=b.amountCalculated.add(A.amountIn.add(A.feeAmount))),b.sqrtPriceX64.eq(A.sqrtPriceNextX64)){if(A.initialized){let O=L.liquidityNet;s&&(O=O.mul(Ue)),b.liquidity=G.addDelta(b.liquidity,O)}C=A.tickNext!=b.tick&&!s&&w.startTickIndex===A.tickNext,b.tick=s?A.tickNext-1:A.tickNext}else if(b.sqrtPriceX64!=A.sqrtPriceStartX64){let O=R.getTickFromSqrtPriceX64(b.sqrtPriceX64);C=O!=b.tick&&!s&&w.startTickIndex===O,b.tick=O}++P}try{let{nextStartIndex:A,isExist:E}=v.nextInitializedTickArray(b.tick,l,s,r,o);E&&f!==A&&(b.accounts.push(z(e,t,A).publicKey),f=A)}catch{}return{allTrade:!0,amountSpecifiedRemaining:ie,amountCalculated:b.amountCalculated,feeAmount:b.feeAmount,sqrtPriceX64:b.sqrtPriceX64,liquidity:b.liquidity,tickCurrent:b.tick,accounts:b.accounts}}static swapStepCompute(e,t,n,r,o){let s={sqrtPriceX64Next:new F(0),amountIn:new F(0),amountOut:new F(0),feeAmount:new F(0)},a=e.gte(t),u=r.gte(ie);if(u){let l=M.mulDivFloor(r,Ut.sub(new F(o.toString())),Ut);s.amountIn=a?G.getTokenAmountAFromLiquidity(t,e,n,!0):G.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=R.getNextSqrtPriceX64FromInput(e,n,l,a)}else s.amountOut=a?G.getTokenAmountBFromLiquidity(t,e,n,!1):G.getTokenAmountAFromLiquidity(e,t,n,!1),r.mul(Ue).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=R.getNextSqrtPriceX64FromOutput(e,n,r.mul(Ue),a);let c=t.eq(s.sqrtPriceX64Next);return a?(c&&u||(s.amountIn=G.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),c&&!u||(s.amountOut=G.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=c&&u?s.amountIn:G.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=c&&!u?s.amountOut:G.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!u&&s.amountOut.gt(r.mul(Ue))&&(s.amountOut=r.mul(Ue)),u&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=r.sub(s.amountIn):s.feeAmount=M.mulDivCeil(s.amountIn,new F(o),Ut.sub(new F(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};var ue=60,ot=512,B=class{static getTickArrayAddressByTick(e,t,n,r){let o=B.getTickArrayStartIndexByTick(n,r),{publicKey:s}=z(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=B.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=ue)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=v.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*v.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*ue,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*ue,o=Math.floor(t/r)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*ue:e+t*ue}static mergeTickArrayBitmap(e){let t=new go(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,o){let s=Math.floor(r/(n*ue));return[...B.searchLowBitFromStart(e,t,s-1,o,n),...B.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return B.searchHightBitFromStart(e,t,0,ot,n)}static getAllInitializedTickArrayInfo(e,t,n,r,o){let s=[],a=B.getAllInitializedTickArrayStartIndex(n,r,o);for(let u of a){let{publicKey:c}=z(e,t,u);s.push({tickArrayStartIndex:u,tickArrayAddress:c})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>B.mergeTickArrayBitmap(c)),a=[];for(;n>=-7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n--,a.length===r)break}let u=v.tickCount(o);return a.map(c=>c*u)}static searchHightBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>B.mergeTickArrayBitmap(c)),a=[];for(;n<7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n++,a.length===r)break}let u=v.tickCount(o);return a.map(c=>c*u)}static checkIsOutOfBoundary(e){return e<we||e>ke}static nextInitTick(e,t,n,r,o){if(v.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(r)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<ue;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=ue-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<ue;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=R.getSqrtPriceX64FromTick(t),o=R.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new x(1).div(o),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new x(1).div(t),o=at.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=R.getSqrtPriceX64FromTick(o),a=R.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new x(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=R.getSqrtPriceX64FromTick(t),o=R.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new x(1).div(o),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new x(1).div(t),o=at.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=R.getSqrtPriceX64FromTick(o),a=R.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new x(1).div(a)}}};var Rm=Y([Se(8),se("bump"),At("index"),ae(""),dt("protocolFeeRate"),dt("tradeFeeRate"),At("tickSpacing"),ne(N(),8,"")]),bo=Y([dt("blockTimestamp"),ti("tickCumulative"),ne(N(),4)]),hi=Y([Se(8),De("initialized"),N("recentEpoch"),At("observationIndex"),ae("poolId"),ne(bo,100,"observations"),ne(N(),4)]),yo=Y([se("rewardState"),N("openTime"),N("endTime"),N("lastUpdateTime"),W("emissionsPerSecondX64"),N("rewardTotalEmissioned"),N("rewardClaimed"),ae("tokenMint"),ae("tokenVault"),ae("creator"),W("rewardGrowthGlobalX64")]),gi=Y([Se(8),se("bump"),ae("ammConfig"),ae("creator"),ae("mintA"),ae("mintB"),ae("vaultA"),ae("vaultB"),ae("observationId"),se("mintDecimalsA"),se("mintDecimalsB"),At("tickSpacing"),W("liquidity"),W("sqrtPriceX64"),fe("tickCurrent"),dt(),W("feeGrowthGlobalX64A"),W("feeGrowthGlobalX64B"),N("protocolFeesTokenA"),N("protocolFeesTokenB"),W("swapInAmountTokenA"),W("swapOutAmountTokenB"),W("swapInAmountTokenB"),W("swapOutAmountTokenA"),se("status"),ne(se(),7,""),ne(yo,3,"rewardInfos"),ne(N(),16,"tickArrayBitmap"),N("totalFeesTokenA"),N("totalFeesClaimedTokenA"),N("totalFeesTokenB"),N("totalFeesClaimedTokenB"),N("fundFeesTokenA"),N("fundFeesTokenB"),N("startTime"),ne(N(),15*4-3,"padding")]),ho=Y([W("growthInsideLastX64"),N("rewardAmountOwed")]),bi=Y([Se(8),se("bump"),ae("nftMint"),ae("poolId"),fe("tickLower"),fe("tickUpper"),W("liquidity"),W("feeGrowthInsideLastX64A"),W("feeGrowthInsideLastX64B"),N("tokenFeesOwedA"),N("tokenFeesOwedB"),ne(ho,3,"rewardInfos"),ne(N(),8,"")]),Em=Y([Se(8),se("bump"),ae("poolId"),fe("tickLowerIndex"),fe("tickUpperIndex"),W("liquidity"),W("feeGrowthInsideLastX64A"),W("feeGrowthInsideLastX64B"),N("tokenFeesOwedA"),N("tokenFeesOwedB"),ne(W(),3,"rewardGrowthInside"),ne(N(),8,"")]),wo=Y([fe("tick"),ni("liquidityNet"),W("liquidityGross"),W("feeGrowthOutsideX64A"),W("feeGrowthOutsideX64B"),ne(W(),3,"rewardGrowthsOutsideX64"),ne(dt(),13,"")]),Pt=Y([Se(8),ae("poolId"),fe("startTickIndex"),ne(wo,ue,"ticks"),se("initializedTickCount"),ne(se(),115,"")]),Mm=Y([Se(329),ne(ae(),100,"whitelistMints")]),yi=Y([Se(8),ae("poolId"),ne(ne(N(),8),An,"positiveTickArrayBitmap"),ne(ne(N(),8),An,"negativeTickArrayBitmap")]);hi.span;var ki=Ae("Raydium_Clmm"),Oe={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},Ti=class{static createPoolInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,g){let p=Y([W("sqrtPriceX64"),N("startTime")]),y=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:It.programId,isSigner:!1,isWritable:!1},{pubkey:bt,isSigner:!1,isWritable:!1}],b=Buffer.alloc(p.span);p.encode({sqrtPriceX64:f,startTime:g},b);let k=Buffer.from([...Oe.createPool,...b]);return new Fe({keys:y,programId:e,data:k})}static async createPoolInstructions(e){let{programId:t,owner:n,mintA:r,mintB:o,ammConfigId:s,initialPriceX64:a,startTime:u}=e,[c,l]=[new T(r.address),new T(o.address)],{publicKey:m}=si(t,s,c,l),{publicKey:d}=ui(t,m),{publicKey:f}=yn(t,m,c),{publicKey:g}=yn(t,m,l),p=[this.createPoolInstruction(t,m,n,s,d,c,f,new T(r.programId||ge),l,g,new T(o.programId||ge),Ne(t,m).publicKey,a,u)];return{signers:[],instructions:p,instructionTypes:[he.CreateAccount,he.ClmmCreatePool],address:{poolId:m,observationId:d,mintAVault:f,mintBVault:g},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,g,p,y,b,k,w,P,C,A,E,L,X,H){let O=Y([fe("tickLowerIndex"),fe("tickUpperIndex"),fe("tickArrayLowerStartIndex"),fe("tickArrayUpperStartIndex"),W("liquidity"),N("amountMaxA"),N("amountMaxB"),De("withMetadata"),se("optionBaseFlag"),De("baseFlag")]),ce=[...H?[{pubkey:H,isSigner:!1,isWritable:!0}]:[]],re=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:bt,isSigner:!1,isWritable:!1},{pubkey:It.programId,isSigner:!1,isWritable:!1},{pubkey:ge,isSigner:!1,isWritable:!1},{pubkey:wi,isSigner:!1,isWritable:!1},{pubkey:lt,isSigner:!1,isWritable:!1},{pubkey:et,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...ce],Te=Buffer.alloc(O.span);O.encode({tickLowerIndex:k,tickUpperIndex:w,tickArrayLowerStartIndex:P,tickArrayUpperStartIndex:C,liquidity:A,amountMaxA:E,amountMaxB:L,withMetadata:X==="create",baseFlag:!1,optionBaseFlag:0},Te);let $=Buffer.from([...Oe.openPosition,...Te]);return new Fe({keys:re,programId:e,data:$})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[d,f]=[new T(e.programId),new T(e.id)],g;if(l)g=new T((await l(1))[0]);else{let L=Tn.generate();m.push(L),g=L.publicKey}let p=B.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=B.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:b}=z(d,f,p),{publicKey:k}=z(d,f,y),{publicKey:w}=Je(n.wallet,g,ge),{publicKey:P}=Gt(g),{publicKey:C}=ve(d,g),{publicKey:A}=nt(d,f,r,o),E=this.openPositionFromLiquidityInstruction(d,n.feePayer,f,n.wallet,g,w,P,A,b,k,C,n.tokenAccountA,n.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),r,o,p,y,s,a,u,c);return{signers:m,instructions:[E],instructionTypes:[he.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:g,tickArrayLower:b,tickArrayUpper:k,positionNftAccount:w,metadataAccount:P,personalPosition:C,protocolPosition:A}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[d,f]=[new T(e.programId),new T(e.id)],g;if(l)g=new T((await l(1))[0]);else{let L=Tn.generate();m.push(L),g=L.publicKey}let p=B.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=B.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:b}=z(d,f,p),{publicKey:k}=z(d,f,y),{publicKey:w}=Je(n.wallet,g,ge),{publicKey:P}=Gt(g),{publicKey:C}=ve(d,g),{publicKey:A}=nt(d,f,r,o),E=this.openPositionFromBaseInstruction(d,n.feePayer,f,n.wallet,g,w,P,A,b,k,C,n.tokenAccountA,n.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),r,o,p,y,c,s,a,u,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[p,y])?Ne(d,f).publicKey:void 0);return{address:{nftMint:g,tickArrayLower:b,tickArrayUpper:k,positionNftAccount:w,metadataAccount:P,personalPosition:C,protocolPosition:A},instructions:[E],signers:m,instructionTypes:[he.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,g,p,y,b,k,w,P,C,A,E,L,X,H){let O=Y([fe("tickLowerIndex"),fe("tickUpperIndex"),fe("tickArrayLowerStartIndex"),fe("tickArrayUpperStartIndex"),W("liquidity"),N("amountMaxA"),N("amountMaxB"),De("withMetadata"),se("optionBaseFlag"),De("baseFlag")]),ce=[...H?[{pubkey:H,isSigner:!1,isWritable:!0}]:[]],re=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:bt,isSigner:!1,isWritable:!1},{pubkey:It.programId,isSigner:!1,isWritable:!1},{pubkey:ge,isSigner:!1,isWritable:!1},{pubkey:wi,isSigner:!1,isWritable:!1},{pubkey:lt,isSigner:!1,isWritable:!1},{pubkey:et,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...ce],Te=Buffer.alloc(O.span);O.encode({tickLowerIndex:k,tickUpperIndex:w,tickArrayLowerStartIndex:P,tickArrayUpperStartIndex:C,liquidity:new Ai(0),amountMaxA:E==="MintA"?L:X,amountMaxB:E==="MintA"?X:L,withMetadata:A==="create",baseFlag:E==="MintA",optionBaseFlag:1},Te);let $=Buffer.from([...Oe.openPosition,...Te]);return new Fe({keys:re,programId:e,data:$})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m,d=[];if(l)m=new T((await l(1))[0]);else{let L=Tn.generate();d.push(L),m=L.publicKey}let[f,g]=[new T(e.programId),new T(e.id)],p=B.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=B.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:b}=z(f,g,p),{publicKey:k}=z(f,g,y),{publicKey:w}=Je(n.wallet,m,ge),{publicKey:P}=Gt(m),{publicKey:C}=ve(f,m),{publicKey:A}=nt(f,g,r,o),E=this.openPositionFromLiquidityInstruction(f,n.wallet,g,n.wallet,m,w,P,A,b,k,C,n.tokenAccountA,n.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(t.mintA.address),new T(t.mintB.address),r,o,p,y,s,a,u,c,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[p,y])?Ne(f,g).publicKey:void 0);return{address:{nftMint:m,tickArrayLower:b,tickArrayUpper:k,positionNftAccount:w,metadataAccount:P,personalPosition:C,protocolPosition:A},instructions:[E],signers:d,instructionTypes:[he.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,r,o){let s=Y([]),a=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:It.programId,isSigner:!1,isWritable:!1},{pubkey:ge,isSigner:!1,isWritable:!1}],u=Buffer.alloc(s.span);s.encode({},u);let c=Buffer.from([...Oe.closePosition,...u]);return new Fe({keys:a,programId:e,data:c})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:r}){let o=new T(e.programId),{publicKey:s}=Je(n.wallet,r.nftMint,ge),{publicKey:a}=ve(o,r.nftMint),u=[];return u.push(this.closePositionInstruction(o,n.wallet,r.nftMint,s,a)),{address:{positionNftAccount:s,personalPosition:a},signers:[],instructions:u,instructionTypes:[he.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,g,p,y,b,k){let w=Y([W("liquidity"),N("amountMaxA"),N("amountMaxB"),se("optionBaseFlag"),De("baseFlag")]),P=[...k?[{pubkey:k,isSigner:!1,isWritable:!0}]:[]],C=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:ge,isSigner:!1,isWritable:!1},{pubkey:et,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...P],A=Buffer.alloc(w.span);w.encode({liquidity:p,amountMaxA:y,amountMaxB:b,optionBaseFlag:0,baseFlag:!1},A);let E=Buffer.from([...Oe.increaseLiquidity,...A]);return new Fe({keys:C,programId:e,data:E})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMaxA:s,amountMaxB:a}){let[u,c]=[new T(e.programId),new T(e.id)],l=B.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=B.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=z(u,c,l),{publicKey:f}=z(u,c,m),{publicKey:g}=Je(r.wallet,n.nftMint,ge),{publicKey:p}=ve(u,n.nftMint),{publicKey:y}=nt(u,c,n.tickLower,n.tickUpper),b=this.increasePositionFromLiquidityInstruction(u,r.wallet,g,p,c,y,d,f,r.tokenAccountA,r.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),o,s,a,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?Ne(u,c).publicKey:void 0);return{address:{tickArrayLower:d,tickArrayUpper:f,positionNftAccount:g,personalPosition:p,protocolPosition:y},signers:[],instructions:[b],instructionTypes:[he.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,base:o,baseAmount:s,otherAmountMax:a}){let[u,c]=[new T(e.programId),new T(e.id)],l=B.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=B.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=z(u,c,l),{publicKey:f}=z(u,c,m),{publicKey:g}=Je(r.wallet,n.nftMint,ge),{publicKey:p}=ve(u,n.nftMint),{publicKey:y}=nt(u,c,n.tickLower,n.tickUpper);return{address:{tickArrayLower:d,tickArrayUpper:f,positionNftAccount:g,personalPosition:p,protocolPosition:y},instructions:[this.increasePositionFromBaseInstruction(u,r.wallet,g,p,c,y,d,f,r.tokenAccountA,r.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),o,s,a,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?Ne(u,c).publicKey:void 0)],signers:[],instructionTypes:[he.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,g,p,y,b,k){let w=Y([W("liquidity"),N("amountMaxA"),N("amountMaxB"),se("optionBaseFlag"),De("baseFlag")]),P=[...k?[{pubkey:k,isSigner:!1,isWritable:!0}]:[]],C=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:ge,isSigner:!1,isWritable:!1},{pubkey:et,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...P],A=Buffer.alloc(w.span);w.encode({liquidity:new Ai(0),amountMaxA:p==="MintA"?y:b,amountMaxB:p==="MintA"?b:y,baseFlag:p==="MintA",optionBaseFlag:1},A);let E=Buffer.from([...Oe.increaseLiquidity,...A]);return new Fe({keys:C,programId:e,data:E})}static decreaseLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,g,p,y,b,k,w){let P=Y([W("liquidity"),N("amountMinA"),N("amountMinB")]),C=[...w?[{pubkey:w,isSigner:!1,isWritable:!0}]:[],...p.map(X=>[{pubkey:X.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:X.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:X.rewardMint,isSigner:!1,isWritable:!1}]).flat()],A=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:ge,isSigner:!1,isWritable:!1},{pubkey:et,isSigner:!1,isWritable:!1},{pubkey:Mt,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...C],E=Buffer.alloc(P.span);P.encode({liquidity:y,amountMinA:b,amountMinB:k},E);let L=Buffer.from([...Oe.decreaseLiquidity,...E]);return new Fe({keys:A,programId:e,data:L})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMinA:s,amountMinB:a,programId:u}){let[c,l]=[new T(e.programId),new T(e.id)],m=B.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=B.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:f}=z(c,l,m),{publicKey:g}=z(c,l,d),{publicKey:p}=Je(r.wallet,n.nftMint,u),{publicKey:y}=ve(c,n.nftMint),{publicKey:b}=nt(c,l,n.tickLower,n.tickUpper),k=[];for(let P=0;P<e.rewardDefaultInfos.length;P++)k.push({poolRewardVault:new T(t.rewardInfos[P].vault),ownerRewardVault:r.rewardAccounts[P],rewardMint:new T(e.rewardDefaultInfos[P].mint.address)});let w=[];return w.push(this.decreaseLiquidityInstruction(c,r.wallet,p,y,l,b,f,g,r.tokenAccountA,r.tokenAccountB,new T(t.vault.A),new T(t.vault.B),new T(e.mintA.address),new T(e.mintB.address),k,o,s,a,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,d])?Ne(c,l).publicKey:void 0)),{address:{tickArrayLower:f,tickArrayUpper:g,positionNftAccount:p,personalPosition:y,protocolPosition:b},signers:[],instructions:w,instructionTypes:[he.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,g,p,y,b){let k=Y([N("amount"),N("otherAmountThreshold"),W("sqrtPriceLimitX64"),De("isBaseInput")]),w=[...b?[{pubkey:b,isSigner:!1,isWritable:!0}]:[],...m.map(E=>({pubkey:E,isSigner:!1,isWritable:!0}))],P=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:ge,isSigner:!1,isWritable:!1},{pubkey:et,isSigner:!1,isWritable:!1},{pubkey:Mt,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...w],C=Buffer.alloc(k.span);k.encode({amount:f,otherAmountThreshold:g,sqrtPriceLimitX64:p,isBaseInput:y},C);let A=Buffer.from([...Oe.swap,...C]);return new Fe({keys:P,programId:e,data:A})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,inputMint:o,amountIn:s,amountOutMin:a,sqrtPriceLimitX64:u,remainingAccounts:c}){let[l,m]=[new T(e.programId),new T(e.id)],[d,f]=[new T(t.vault.A),new T(t.vault.B)],[g,p]=[new T(e.mintA.address),new T(e.mintB.address)],y=e.mintA.address===o.toString(),b=[this.swapInstruction(l,r.wallet,m,new T(e.config.id),y?r.tokenAccountA:r.tokenAccountB,y?r.tokenAccountB:r.tokenAccountA,y?d:f,y?f:d,y?g:p,y?p:g,c,n,s,a,u,!0,Ne(l,m).publicKey)];return{signers:[],instructions:b,instructionTypes:[he.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static makeSwapBaseOutInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,outputMint:o,amountOut:s,amountInMax:a,sqrtPriceLimitX64:u,remainingAccounts:c}){let[l,m]=[new T(e.programId),new T(e.id)],[d,f]=[new T(t.vault.A),new T(t.vault.B)],[g,p]=[new T(e.mintA.address),new T(e.mintB.address)],y=e.mintA.address===o.toBase58(),b=[this.swapInstruction(l,r.wallet,m,new T(e.config.id),y?r.tokenAccountB:r.tokenAccountA,y?r.tokenAccountA:r.tokenAccountB,y?f:d,y?d:f,y?p:g,y?g:p,c,n,s,a,u,!1,Ne(l,m).publicKey)];return{signers:[],instructions:b,instructionTypes:[he.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,r,o,s,a,u,c,l,m,d){let f=Y([N("openTime"),N("endTime"),W("emissionsPerSecondX64")]),g=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:It.programId,isSigner:!1,isWritable:!1},{pubkey:bt,isSigner:!1,isWritable:!1}],p=Buffer.alloc(f.span);f.encode({openTime:de(l),endTime:de(m),emissionsPerSecondX64:d},p);let y=Buffer.from([...Oe.initReward,...p]);return new Fe({keys:g,programId:e,data:y})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new T(e.programId),new T(e.id)],a=ai(o,s,r.mint).publicKey,u=hn(o).publicKey,c=[this.initRewardInstruction(o,n.wallet,s,u,new T(e.config.id),n.tokenAccount,r.programId,r.mint,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:u},signers:[],instructions:c,instructionTypes:[he.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,r,o,s,a,u,c,l,m,d){let f=Y([se("rewardIndex"),W("emissionsPerSecondX64"),N("openTime"),N("endTime")]),g=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:ge,isSigner:!1,isWritable:!1},{pubkey:et,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0}],p=Buffer.alloc(f.span);f.encode({rewardIndex:c,emissionsPerSecondX64:d,openTime:de(l),endTime:de(m)},p);let y=Buffer.from([...Oe.setRewardEmissions,...p]);return new Fe({keys:g,programId:e,data:y})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new T(e.programId),new T(e.id)],a,u,c;for(let d=0;d<e.rewardDefaultInfos.length;d++)e.rewardDefaultInfos[d].mint.address===r.mint.toString()&&(a=d,u=new T(t.rewardInfos[d].vault),c=new T(t.rewardInfos[d].mint.address));(a===void 0||u===void 0)&&ki.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=hn(o).publicKey,m=[this.setRewardInstruction(o,n.wallet,s,l,new T(e.config.id),n.tokenAccount,u,c,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{rewardVault:u,operationId:l},signers:[],instructions:m,instructionTypes:[he.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,r,o,s,a){let u=Y([se("rewardIndex")]),c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:ge,isSigner:!1,isWritable:!1},{pubkey:et,isSigner:!1,isWritable:!1},{pubkey:Mt,isSigner:!1,isWritable:!1}],l=Buffer.alloc(u.span);u.encode({rewardIndex:a},l);let m=Buffer.from([...Oe.collectReward,...l]);return new Fe({keys:c,programId:e,data:m})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:r}){let[o,s]=[new T(e.programId),new T(e.id)],a,u;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===r.toString()&&(a=l,u=new T(t.rewardInfos[l].vault));(a===void 0||u===void 0)&&ki.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let c=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,u,r,a)];return{address:{rewardVault:u},signers:[],instructions:c,instructionTypes:[he.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}};export{Ti as ClmmInstrument};
//# sourceMappingURL=instrument.mjs.map