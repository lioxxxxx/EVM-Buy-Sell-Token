var cr=Object.defineProperty,ur=Object.defineProperties;var lr=Object.getOwnPropertyDescriptors;var Ut=Object.getOwnPropertySymbols;var Jn=Object.prototype.hasOwnProperty,$n=Object.prototype.propertyIsEnumerable;var Qn=(i,e,t)=>e in i?cr(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,C=(i,e)=>{for(var t in e||(e={}))Jn.call(e,t)&&Qn(i,t,e[t]);if(Ut)for(var t of Ut(e))$n.call(e,t)&&Qn(i,t,e[t]);return i},G=(i,e)=>ur(i,lr(e));var gt=(i,e)=>{var t={};for(var n in i)Jn.call(i,n)&&e.indexOf(n)<0&&(t[n]=i[n]);if(i!=null&&Ut)for(var n of Ut(i))e.indexOf(n)<0&&$n.call(i,n)&&(t[n]=i[n]);return t};import{PublicKey as v}from"@solana/web3.js";var bt=9e15,it=1e9,gn="0123456789abcdef",zt="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Ht="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",bn={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-bt,maxE:bt,crypto:!1},ii,Ye,_=!0,jt="[DecimalError] ",nt=jt+"Invalid argument: ",ri=jt+"Precision limit exceeded",oi=jt+"crypto unavailable",si="[object Decimal]",ke=Math.floor,de=Math.pow,mr=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,dr=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,fr=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,ai=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Fe=1e7,E=7,pr=9007199254740991,gr=zt.length-1,yn=Ht.length-1,P={toStringTag:si};P.absoluteValue=P.abs=function(){var i=new this.constructor(this);return i.s<0&&(i.s=1),K(i)};P.ceil=function(){return K(new this.constructor(this),this.e+1,2)};P.clampedTo=P.clamp=function(i,e){var t,n=this,r=n.constructor;if(i=new r(i),e=new r(e),!i.s||!e.s)return new r(NaN);if(i.gt(e))throw Error(nt+e);return t=n.cmp(i),t<0?i:n.cmp(e)>0?e:new r(n)};P.comparedTo=P.cmp=function(i){var e,t,n,r,o=this,s=o.d,a=(i=new o.constructor(i)).d,c=o.s,u=i.s;if(!s||!a)return!c||!u?NaN:c!==u?c:s===a?0:!s^c<0?1:-1;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(o.e!==i.e)return o.e>i.e^c<0?1:-1;for(n=s.length,r=a.length,e=0,t=n<r?n:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^c<0?1:-1;return n===r?0:n>r^c<0?1:-1};P.cosine=P.cos=function(){var i,e,t=this,n=t.constructor;return t.d?t.d[0]?(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+E,n.rounding=1,t=br(n,di(n,t)),n.precision=i,n.rounding=e,K(Ye==2||Ye==3?t.neg():t,i,e,!0)):new n(1):new n(NaN)};P.cubeRoot=P.cbrt=function(){var i,e,t,n,r,o,s,a,c,u,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(_=!1,o=l.s*de(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=ye(l.d),i=l.e,(o=(i-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=de(t,1/3),i=ke((i+1)/3)-(i%3==(i<0?-1:2)),o==1/0?t="5e"+i:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+i),n=new m(t),n.s=l.s):n=new m(o.toString()),s=(i=m.precision)+3;;)if(a=n,c=a.times(a).times(a),u=c.plus(l),n=$(u.plus(l).times(a),u.plus(c),s+2,1),ye(a.d).slice(0,s)===(t=ye(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(K(a,i+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(K(n,i+1,1),e=!n.times(n).times(n).eq(l));break}return _=!0,K(n,i,m.rounding,e)};P.decimalPlaces=P.dp=function(){var i,e=this.d,t=NaN;if(e){if(i=e.length-1,t=(i-ke(this.e/E))*E,i=e[i],i)for(;i%10==0;i/=10)t--;t<0&&(t=0)}return t};P.dividedBy=P.div=function(i){return $(this,new this.constructor(i))};P.dividedToIntegerBy=P.divToInt=function(i){var e=this,t=e.constructor;return K($(e,new t(i),0,1,1),t.precision,t.rounding)};P.equals=P.eq=function(i){return this.cmp(i)===0};P.floor=function(){return K(new this.constructor(this),this.e+1,3)};P.greaterThan=P.gt=function(i){return this.cmp(i)>0};P.greaterThanOrEqualTo=P.gte=function(i){var e=this.cmp(i);return e==1||e===0};P.hyperbolicCosine=P.cosh=function(){var i,e,t,n,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(i=Math.ceil(r/3),e=(1/Qt(4,i)).toString()):(i=16,e="2.3283064365386962890625e-10"),o=yt(s,1,o.times(e),new s(1),!0);for(var c,u=i,l=new s(8);u--;)c=o.times(o),o=a.minus(c.times(l.minus(c.times(l))));return K(o,s.precision=t,s.rounding=n,!0)};P.hyperbolicSine=P.sinh=function(){var i,e,t,n,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,n=r.d.length,n<3)r=yt(o,2,r,r,!0);else{i=1.4*Math.sqrt(n),i=i>16?16:i|0,r=r.times(1/Qt(5,i)),r=yt(o,2,r,r,!0);for(var s,a=new o(5),c=new o(16),u=new o(20);i--;)s=r.times(r),r=r.times(a.plus(s.times(c.times(s).plus(u))))}return o.precision=e,o.rounding=t,K(r,e,t,!0)};P.hyperbolicTangent=P.tanh=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+7,n.rounding=1,$(t.sinh(),t.cosh(),n.precision=i,n.rounding=e)):new n(t.s)};P.inverseCosine=P.acos=function(){var i,e=this,t=e.constructor,n=e.abs().cmp(1),r=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?Oe(t,r,o):new t(0):new t(NaN):e.isZero()?Oe(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),i=Oe(t,r+4,o).times(.5),t.precision=r,t.rounding=o,i.minus(e))};P.inverseHyperbolicCosine=P.acosh=function(){var i,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(i=n.precision,e=n.rounding,n.precision=i+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,_=!1,t=t.times(t).minus(1).sqrt().plus(t),_=!0,n.precision=i,n.rounding=e,t.ln()):new n(t)};P.inverseHyperbolicSine=P.asinh=function(){var i,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,_=!1,t=t.times(t).plus(1).sqrt().plus(t),_=!0,n.precision=i,n.rounding=e,t.ln())};P.inverseHyperbolicTangent=P.atanh=function(){var i,e,t,n,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(i=o.precision,e=o.rounding,n=r.sd(),Math.max(n,i)<2*-r.e-1?K(new o(r),i,e,!0):(o.precision=t=n-r.e,r=$(r.plus(1),new o(1).minus(r),t+i,1),o.precision=i+4,o.rounding=1,r=r.ln(),o.precision=i,o.rounding=e,r.times(.5))):new o(NaN)};P.inverseSine=P.asin=function(){var i,e,t,n,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(i=Oe(o,t+4,n).times(.5),i.s=r.s,i):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,r.times(2)))};P.inverseTangent=P.atan=function(){var i,e,t,n,r,o,s,a,c,u=this,l=u.constructor,m=l.precision,d=l.rounding;if(u.isFinite()){if(u.isZero())return new l(u);if(u.abs().eq(1)&&m+4<=yn)return s=Oe(l,m+4,d).times(.25),s.s=u.s,s}else{if(!u.s)return new l(NaN);if(m+4<=yn)return s=Oe(l,m+4,d).times(.5),s.s=u.s,s}for(l.precision=a=m+10,l.rounding=1,t=Math.min(28,a/E+2|0),i=t;i;--i)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(_=!1,e=Math.ceil(a/E),n=1,c=u.times(u),s=new l(u),r=u;i!==-1;)if(r=r.times(c),o=s.minus(r.div(n+=2)),r=r.times(c),s=o.plus(r.div(n+=2)),s.d[e]!==void 0)for(i=e;s.d[i]===o.d[i]&&i--;);return t&&(s=s.times(2<<t-1)),_=!0,K(s,l.precision=m,l.rounding=d,!0)};P.isFinite=function(){return!!this.d};P.isInteger=P.isInt=function(){return!!this.d&&ke(this.e/E)>this.d.length-2};P.isNaN=function(){return!this.s};P.isNegative=P.isNeg=function(){return this.s<0};P.isPositive=P.isPos=function(){return this.s>0};P.isZero=function(){return!!this.d&&this.d[0]===0};P.lessThan=P.lt=function(i){return this.cmp(i)<0};P.lessThanOrEqualTo=P.lte=function(i){return this.cmp(i)<1};P.logarithm=P.log=function(i){var e,t,n,r,o,s,a,c,u=this,l=u.constructor,m=l.precision,d=l.rounding,f=5;if(i==null)i=new l(10),e=!0;else{if(i=new l(i),t=i.d,i.s<0||!t||!t[0]||i.eq(1))return new l(NaN);e=i.eq(10)}if(t=u.d,u.s<0||!t||!t[0]||u.eq(1))return new l(t&&!t[0]?-1/0:u.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(_=!1,a=m+f,s=tt(u,a),n=e?Zt(l,a+10):tt(i,a),c=$(s,n,a,1),Pt(c.d,r=m,d))do if(a+=10,s=tt(u,a),n=e?Zt(l,a+10):tt(i,a),c=$(s,n,a,1),!o){+ye(c.d).slice(r+1,r+15)+1==1e14&&(c=K(c,m+1,0));break}while(Pt(c.d,r+=10,d));return _=!0,K(c,m,d)};P.minus=P.sub=function(i){var e,t,n,r,o,s,a,c,u,l,m,d,f=this,g=f.constructor;if(i=new g(i),!f.d||!i.d)return!f.s||!i.s?i=new g(NaN):f.d?i.s=-i.s:i=new g(i.d||f.s!==i.s?f:NaN),i;if(f.s!=i.s)return i.s=-i.s,f.plus(i);if(u=f.d,d=i.d,a=g.precision,c=g.rounding,!u[0]||!d[0]){if(d[0])i.s=-i.s;else if(u[0])i=new g(f);else return new g(c===3?-0:0);return _?K(i,a,c):i}if(t=ke(i.e/E),l=ke(f.e/E),u=u.slice(),o=l-t,o){for(m=o<0,m?(e=u,o=-o,s=d.length):(e=d,t=l,s=u.length),n=Math.max(Math.ceil(a/E),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=u.length,s=d.length,m=n<s,m&&(s=n),n=0;n<s;n++)if(u[n]!=d[n]){m=u[n]<d[n];break}o=0}for(m&&(e=u,u=d,d=e,i.s=-i.s),s=u.length,n=d.length-s;n>0;--n)u[s++]=0;for(n=d.length;n>o;){if(u[--n]<d[n]){for(r=n;r&&u[--r]===0;)u[r]=Fe-1;--u[r],u[n]+=Fe}u[n]-=d[n]}for(;u[--s]===0;)u.pop();for(;u[0]===0;u.shift())--t;return u[0]?(i.d=u,i.e=Yt(u,t),_?K(i,a,c):i):new g(c===3?-0:0)};P.modulo=P.mod=function(i){var e,t=this,n=t.constructor;return i=new n(i),!t.d||!i.s||i.d&&!i.d[0]?new n(NaN):!i.d||t.d&&!t.d[0]?K(new n(t),n.precision,n.rounding):(_=!1,n.modulo==9?(e=$(t,i.abs(),0,3,1),e.s*=i.s):e=$(t,i,0,n.modulo,1),e=e.times(i),_=!0,t.minus(e))};P.naturalExponential=P.exp=function(){return wn(this)};P.naturalLogarithm=P.ln=function(){return tt(this)};P.negated=P.neg=function(){var i=new this.constructor(this);return i.s=-i.s,K(i)};P.plus=P.add=function(i){var e,t,n,r,o,s,a,c,u,l,m=this,d=m.constructor;if(i=new d(i),!m.d||!i.d)return!m.s||!i.s?i=new d(NaN):m.d||(i=new d(i.d||m.s===i.s?m:NaN)),i;if(m.s!=i.s)return i.s=-i.s,m.minus(i);if(u=m.d,l=i.d,a=d.precision,c=d.rounding,!u[0]||!l[0])return l[0]||(i=new d(m)),_?K(i,a,c):i;if(o=ke(m.e/E),n=ke(i.e/E),u=u.slice(),r=o-n,r){for(r<0?(t=u,r=-r,s=l.length):(t=l,n=o,s=u.length),o=Math.ceil(a/E),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=u.length,r=l.length,s-r<0&&(r=s,t=l,l=u,u=t),e=0;r;)e=(u[--r]=u[r]+l[r]+e)/Fe|0,u[r]%=Fe;for(e&&(u.unshift(e),++n),s=u.length;u[--s]==0;)u.pop();return i.d=u,i.e=Yt(u,n),_?K(i,a,c):i};P.precision=P.sd=function(i){var e,t=this;if(i!==void 0&&i!==!!i&&i!==1&&i!==0)throw Error(nt+i);return t.d?(e=ci(t.d),i&&t.e+1>e&&(e=t.e+1)):e=NaN,e};P.round=function(){var i=this,e=i.constructor;return K(new e(i),i.e+1,e.rounding)};P.sine=P.sin=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+E,n.rounding=1,t=wr(n,di(n,t)),n.precision=i,n.rounding=e,K(Ye>2?t.neg():t,i,e,!0)):new n(NaN)};P.squareRoot=P.sqrt=function(){var i,e,t,n,r,o,s=this,a=s.d,c=s.e,u=s.s,l=s.constructor;if(u!==1||!a||!a[0])return new l(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(_=!1,u=Math.sqrt(+s),u==0||u==1/0?(e=ye(a),(e.length+c)%2==0&&(e+="0"),u=Math.sqrt(e),c=ke((c+1)/2)-(c<0||c%2),u==1/0?e="5e"+c:(e=u.toExponential(),e=e.slice(0,e.indexOf("e")+1)+c),n=new l(e)):n=new l(u.toString()),t=(c=l.precision)+3;;)if(o=n,n=o.plus($(s,o,t+2,1)).times(.5),ye(o.d).slice(0,t)===(e=ye(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(K(o,c+1,0),o.times(o).eq(s))){n=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(K(n,c+1,1),i=!n.times(n).eq(s));break}return _=!0,K(n,c,l.rounding,i)};P.tangent=P.tan=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+10,n.rounding=1,t=t.sin(),t.s=1,t=$(t,new n(1).minus(t.times(t)).sqrt(),i+10,0),n.precision=i,n.rounding=e,K(Ye==2||Ye==4?t.neg():t,i,e,!0)):new n(NaN)};P.times=P.mul=function(i){var e,t,n,r,o,s,a,c,u,l=this,m=l.constructor,d=l.d,f=(i=new m(i)).d;if(i.s*=l.s,!d||!d[0]||!f||!f[0])return new m(!i.s||d&&!d[0]&&!f||f&&!f[0]&&!d?NaN:!d||!f?i.s/0:i.s*0);for(t=ke(l.e/E)+ke(i.e/E),c=d.length,u=f.length,c<u&&(o=d,d=f,f=o,s=c,c=u,u=s),o=[],s=c+u,n=s;n--;)o.push(0);for(n=u;--n>=0;){for(e=0,r=c+n;r>n;)a=o[r]+f[n]*d[r-n-1]+e,o[r--]=a%Fe|0,e=a/Fe|0;o[r]=(o[r]+e)%Fe|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),i.d=o,i.e=Yt(o,t),_?K(i,m.precision,m.rounding):i};P.toBinary=function(i,e){return An(this,2,i,e)};P.toDecimalPlaces=P.toDP=function(i,e){var t=this,n=t.constructor;return t=new n(t),i===void 0?t:(Ie(i,0,it),e===void 0?e=n.rounding:Ie(e,0,8),K(t,i+t.e+1,e))};P.toExponential=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Ve(n,!0):(Ie(i,0,it),e===void 0?e=r.rounding:Ie(e,0,8),n=K(new r(n),i+1,e),t=Ve(n,!0,i+1)),n.isNeg()&&!n.isZero()?"-"+t:t};P.toFixed=function(i,e){var t,n,r=this,o=r.constructor;return i===void 0?t=Ve(r):(Ie(i,0,it),e===void 0?e=o.rounding:Ie(e,0,8),n=K(new o(r),i+r.e+1,e),t=Ve(n,!1,i+n.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};P.toFraction=function(i){var e,t,n,r,o,s,a,c,u,l,m,d,f=this,g=f.d,p=f.constructor;if(!g)return new p(f);if(u=t=new p(1),n=c=new p(0),e=new p(n),o=e.e=ci(g)-f.e-1,s=o%E,e.d[0]=de(10,s<0?E+s:s),i==null)i=o>0?e:u;else{if(a=new p(i),!a.isInt()||a.lt(u))throw Error(nt+a);i=a.gt(e)?o>0?e:u:a}for(_=!1,a=new p(ye(g)),l=p.precision,p.precision=o=g.length*E*2;m=$(a,e,0,1,1),r=t.plus(m.times(n)),r.cmp(i)!=1;)t=n,n=r,r=u,u=c.plus(m.times(r)),c=r,r=e,e=a.minus(m.times(r)),a=r;return r=$(i.minus(t),n,0,1,1),c=c.plus(r.times(u)),t=t.plus(r.times(n)),c.s=u.s=f.s,d=$(u,n,o,1).minus(f).abs().cmp($(c,t,o,1).minus(f).abs())<1?[u,n]:[c,t],p.precision=l,_=!0,d};P.toHexadecimal=P.toHex=function(i,e){return An(this,16,i,e)};P.toNearest=function(i,e){var t=this,n=t.constructor;if(t=new n(t),i==null){if(!t.d)return t;i=new n(1),e=n.rounding}else{if(i=new n(i),e===void 0?e=n.rounding:Ie(e,0,8),!t.d)return i.s?t:i;if(!i.d)return i.s&&(i.s=t.s),i}return i.d[0]?(_=!1,t=$(t,i,0,e,1).times(i),_=!0,K(t)):(i.s=t.s,t=i),t};P.toNumber=function(){return+this};P.toOctal=function(i,e){return An(this,8,i,e)};P.toPower=P.pow=function(i){var e,t,n,r,o,s,a=this,c=a.constructor,u=+(i=new c(i));if(!a.d||!i.d||!a.d[0]||!i.d[0])return new c(de(+a,u));if(a=new c(a),a.eq(1))return a;if(n=c.precision,o=c.rounding,i.eq(1))return K(a,n,o);if(e=ke(i.e/E),e>=i.d.length-1&&(t=u<0?-u:u)<=pr)return r=ui(c,a,t,n),i.s<0?new c(1).div(r):K(r,n,o);if(s=a.s,s<0){if(e<i.d.length-1)return new c(NaN);if((i.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=de(+a,u),e=t==0||!isFinite(t)?ke(u*(Math.log("0."+ye(a.d))/Math.LN10+a.e+1)):new c(t+"").e,e>c.maxE+1||e<c.minE-1?new c(e>0?s/0:0):(_=!1,c.rounding=a.s=1,t=Math.min(12,(e+"").length),r=wn(i.times(tt(a,n+t)),n),r.d&&(r=K(r,n+5,1),Pt(r.d,n,o)&&(e=n+10,r=K(wn(i.times(tt(a,e+t)),e),e+5,1),+ye(r.d).slice(n+1,n+15)+1==1e14&&(r=K(r,n+1,0)))),r.s=s,_=!0,c.rounding=o,K(r,n,o))};P.toPrecision=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Ve(n,n.e<=r.toExpNeg||n.e>=r.toExpPos):(Ie(i,1,it),e===void 0?e=r.rounding:Ie(e,0,8),n=K(new r(n),i,e),t=Ve(n,i<=n.e||n.e<=r.toExpNeg,i)),n.isNeg()&&!n.isZero()?"-"+t:t};P.toSignificantDigits=P.toSD=function(i,e){var t=this,n=t.constructor;return i===void 0?(i=n.precision,e=n.rounding):(Ie(i,1,it),e===void 0?e=n.rounding:Ie(e,0,8)),K(new n(t),i,e)};P.toString=function(){var i=this,e=i.constructor,t=Ve(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()&&!i.isZero()?"-"+t:t};P.truncated=P.trunc=function(){return K(new this.constructor(this),this.e+1,1)};P.valueOf=P.toJSON=function(){var i=this,e=i.constructor,t=Ve(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()?"-"+t:t};function ye(i){var e,t,n,r=i.length-1,o="",s=i[0];if(r>0){for(o+=s,e=1;e<r;e++)n=i[e]+"",t=E-n.length,t&&(o+=et(t)),o+=n;s=i[e],n=s+"",t=E-n.length,t&&(o+=et(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function Ie(i,e,t){if(i!==~~i||i<e||i>t)throw Error(nt+i)}function Pt(i,e,t,n){var r,o,s,a;for(o=i[0];o>=10;o/=10)--e;return--e<0?(e+=E,r=0):(r=Math.ceil((e+1)/E),e%=E),o=de(10,E-e),a=i[r]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(i[r+1]/o/100|0)==de(10,e-2)-1||(a==o/2||a==0)&&(i[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(i[r+1]/o/1e3|0)==de(10,e-3)-1,s}function Xt(i,e,t){for(var n,r=[0],o,s=0,a=i.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=gn.indexOf(i.charAt(s++)),n=0;n<r.length;n++)r[n]>t-1&&(r[n+1]===void 0&&(r[n+1]=0),r[n+1]+=r[n]/t|0,r[n]%=t)}return r.reverse()}function br(i,e){var t,n,r;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),r=(1/Qt(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),i.precision+=t,e=yt(i,1,e.times(r),new i(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return i.precision-=t,e}var $=function(){function i(n,r,o){var s,a=0,c=n.length;for(n=n.slice();c--;)s=n[c]*r+a,n[c]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,r,o,s){var a,c;if(o!=s)c=o>s?1:-1;else for(a=c=0;a<o;a++)if(n[a]!=r[a]){c=n[a]>r[a]?1:-1;break}return c}function t(n,r,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<r[o]?1:0,n[o]=a*s+n[o]-r[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,r,o,s,a,c){var u,l,m,d,f,g,p,y,b,h,w,A,k,T,x,B,M,L,R,Z,ee=n.constructor,ce=n.s==r.s?1:-1,te=n.d,Y=r.d;if(!te||!te[0]||!Y||!Y[0])return new ee(!n.s||!r.s||(te?Y&&te[0]==Y[0]:!Y)?NaN:te&&te[0]==0||!Y?ce*0:ce/0);for(c?(f=1,l=n.e-r.e):(c=Fe,f=E,l=ke(n.e/f)-ke(r.e/f)),R=Y.length,M=te.length,b=new ee(ce),h=b.d=[],m=0;Y[m]==(te[m]||0);m++);if(Y[m]>(te[m]||0)&&l--,o==null?(T=o=ee.precision,s=ee.rounding):a?T=o+(n.e-r.e)+1:T=o,T<0)h.push(1),g=!0;else{if(T=T/f+2|0,m=0,R==1){for(d=0,Y=Y[0],T++;(m<M||d)&&T--;m++)x=d*c+(te[m]||0),h[m]=x/Y|0,d=x%Y|0;g=d||m<M}else{for(d=c/(Y[0]+1)|0,d>1&&(Y=i(Y,d,c),te=i(te,d,c),R=Y.length,M=te.length),B=R,w=te.slice(0,R),A=w.length;A<R;)w[A++]=0;Z=Y.slice(),Z.unshift(0),L=Y[0],Y[1]>=c/2&&++L;do d=0,u=e(Y,w,R,A),u<0?(k=w[0],R!=A&&(k=k*c+(w[1]||0)),d=k/L|0,d>1?(d>=c&&(d=c-1),p=i(Y,d,c),y=p.length,A=w.length,u=e(p,w,y,A),u==1&&(d--,t(p,R<y?Z:Y,y,c))):(d==0&&(u=d=1),p=Y.slice()),y=p.length,y<A&&p.unshift(0),t(w,p,A,c),u==-1&&(A=w.length,u=e(Y,w,R,A),u<1&&(d++,t(w,R<A?Z:Y,A,c))),A=w.length):u===0&&(d++,w=[0]),h[m++]=d,u&&w[0]?w[A++]=te[B]||0:(w=[te[B]],A=1);while((B++<M||w[0]!==void 0)&&T--);g=w[0]!==void 0}h[0]||h.shift()}if(f==1)b.e=l,ii=g;else{for(m=1,d=h[0];d>=10;d/=10)m++;b.e=m+l*f-1,K(b,a?o+b.e+1:o,s,g)}return b}}();function K(i,e,t,n){var r,o,s,a,c,u,l,m,d,f=i.constructor;e:if(e!=null){if(m=i.d,!m)return i;for(r=1,a=m[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=E,s=e,l=m[d=0],c=l/de(10,r-s-1)%10|0;else if(d=Math.ceil((o+1)/E),a=m.length,d>=a)if(n){for(;a++<=d;)m.push(0);l=c=0,r=1,o%=E,s=o-E+1}else break e;else{for(l=a=m[d],r=1;a>=10;a/=10)r++;o%=E,s=o-E+r,c=s<0?0:l/de(10,r-s-1)%10|0}if(n=n||e<0||m[d+1]!==void 0||(s<0?l:l%de(10,r-s-1)),u=t<4?(c||n)&&(t==0||t==(i.s<0?3:2)):c>5||c==5&&(t==4||n||t==6&&(o>0?s>0?l/de(10,r-s):0:m[d-1])%10&1||t==(i.s<0?8:7)),e<1||!m[0])return m.length=0,u?(e-=i.e+1,m[0]=de(10,(E-e%E)%E),i.e=-e||0):m[0]=i.e=0,i;if(o==0?(m.length=d,a=1,d--):(m.length=d+1,a=de(10,E-o),m[d]=s>0?(l/de(10,r-s)%de(10,s)|0)*a:0),u)for(;;)if(d==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(i.e++,m[0]==Fe&&(m[0]=1));break}else{if(m[d]+=a,m[d]!=Fe)break;m[d--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return _&&(i.e>f.maxE?(i.d=null,i.e=NaN):i.e<f.minE&&(i.e=0,i.d=[0])),i}function Ve(i,e,t){if(!i.isFinite())return mi(i);var n,r=i.e,o=ye(i.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+et(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(i.e<0?"e":"e+")+i.e):r<0?(o="0."+et(-r-1)+o,t&&(n=t-s)>0&&(o+=et(n))):r>=s?(o+=et(r+1-s),t&&(n=t-r-1)>0&&(o=o+"."+et(n))):((n=r+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(r+1===s&&(o+="."),o+=et(n))),o}function Yt(i,e){var t=i[0];for(e*=E;t>=10;t/=10)e++;return e}function Zt(i,e,t){if(e>gr)throw _=!0,t&&(i.precision=t),Error(ri);return K(new i(zt),e,1,!0)}function Oe(i,e,t){if(e>yn)throw Error(ri);return K(new i(Ht),e,t,!0)}function ci(i){var e=i.length-1,t=e*E+1;if(e=i[e],e){for(;e%10==0;e/=10)t--;for(e=i[0];e>=10;e/=10)t++}return t}function et(i){for(var e="";i--;)e+="0";return e}function ui(i,e,t,n){var r,o=new i(1),s=Math.ceil(n/E+4);for(_=!1;;){if(t%2&&(o=o.times(e),ti(o.d,s)&&(r=!0)),t=ke(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),ti(e.d,s)}return _=!0,o}function ei(i){return i.d[i.d.length-1]&1}function li(i,e,t){for(var n,r=new i(e[0]),o=0;++o<e.length;)if(n=new i(e[o]),n.s)r[t](n)&&(r=n);else{r=n;break}return r}function wn(i,e){var t,n,r,o,s,a,c,u=0,l=0,m=0,d=i.constructor,f=d.rounding,g=d.precision;if(!i.d||!i.d[0]||i.e>17)return new d(i.d?i.d[0]?i.s<0?0:1/0:1:i.s?i.s<0?0:i:0/0);for(e==null?(_=!1,c=g):c=e,a=new d(.03125);i.e>-2;)i=i.times(a),m+=5;for(n=Math.log(de(2,m))/Math.LN10*2+5|0,c+=n,t=o=s=new d(1),d.precision=c;;){if(o=K(o.times(i),c,1),t=t.times(++l),a=s.plus($(o,t,c,1)),ye(a.d).slice(0,c)===ye(s.d).slice(0,c)){for(r=m;r--;)s=K(s.times(s),c,1);if(e==null)if(u<3&&Pt(s.d,c-n,f,u))d.precision=c+=10,t=o=a=new d(1),l=0,u++;else return K(s,d.precision=g,f,_=!0);else return d.precision=g,s}s=a}}function tt(i,e){var t,n,r,o,s,a,c,u,l,m,d,f=1,g=10,p=i,y=p.d,b=p.constructor,h=b.rounding,w=b.precision;if(p.s<0||!y||!y[0]||!p.e&&y[0]==1&&y.length==1)return new b(y&&!y[0]?-1/0:p.s!=1?NaN:y?0:p);if(e==null?(_=!1,l=w):l=e,b.precision=l+=g,t=ye(y),n=t.charAt(0),Math.abs(o=p.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)p=p.times(i),t=ye(p.d),n=t.charAt(0),f++;o=p.e,n>1?(p=new b("0."+t),o++):p=new b(n+"."+t.slice(1))}else return u=Zt(b,l+2,w).times(o+""),p=tt(new b(n+"."+t.slice(1)),l-g).plus(u),b.precision=w,e==null?K(p,w,h,_=!0):p;for(m=p,c=s=p=$(p.minus(1),p.plus(1),l,1),d=K(p.times(p),l,1),r=3;;){if(s=K(s.times(d),l,1),u=c.plus($(s,new b(r),l,1)),ye(u.d).slice(0,l)===ye(c.d).slice(0,l))if(c=c.times(2),o!==0&&(c=c.plus(Zt(b,l+2,w).times(o+""))),c=$(c,new b(f),l,1),e==null)if(Pt(c.d,l-g,h,a))b.precision=l+=g,u=s=p=$(m.minus(1),m.plus(1),l,1),d=K(p.times(p),l,1),r=a=1;else return K(c,b.precision=w,h,_=!0);else return b.precision=w,c;c=u,r+=2}}function mi(i){return String(i.s*i.s/0)}function hn(i,e){var t,n,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(n,r),e){if(r-=n,i.e=t=t-n-1,i.d=[],n=(t+1)%E,t<0&&(n+=E),n<r){for(n&&i.d.push(+e.slice(0,n)),r-=E;n<r;)i.d.push(+e.slice(n,n+=E));e=e.slice(n),n=E-e.length}else n-=r;for(;n--;)e+="0";i.d.push(+e),_&&(i.e>i.constructor.maxE?(i.d=null,i.e=NaN):i.e<i.constructor.minE&&(i.e=0,i.d=[0]))}else i.e=0,i.d=[0];return i}function yr(i,e){var t,n,r,o,s,a,c,u,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),ai.test(e))return hn(i,e)}else if(e==="Infinity"||e==="NaN")return+e||(i.s=NaN),i.e=NaN,i.d=null,i;if(dr.test(e))t=16,e=e.toLowerCase();else if(mr.test(e))t=2;else if(fr.test(e))t=8;else throw Error(nt+e);for(o=e.search(/p/i),o>0?(c=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=i.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=ui(n,new n(t),o,o*2)),u=Xt(e,t,Fe),l=u.length-1,o=l;u[o]===0;--o)u.pop();return o<0?new n(i.s*0):(i.e=Yt(u,l),i.d=u,_=!1,s&&(i=$(i,r,a*4)),c&&(i=i.times(Math.abs(c)<54?de(2,c):kt.pow(2,c))),_=!0,i)}function wr(i,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:yt(i,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/Qt(5,t)),e=yt(i,2,e,e);for(var r,o=new i(5),s=new i(16),a=new i(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function yt(i,e,t,n,r){var o,s,a,c,u=1,l=i.precision,m=Math.ceil(l/E);for(_=!1,c=t.times(t),a=new i(n);;){if(s=$(a.times(c),new i(e++*e++),l,1),a=r?n.plus(s):n.minus(s),n=$(s.times(c),new i(e++*e++),l,1),s=a.plus(n),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,u++}return _=!0,s.d.length=m+1,s}function Qt(i,e){for(var t=i;--e;)t*=i;return t}function di(i,e){var t,n=e.s<0,r=Oe(i,i.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return Ye=n?4:1,e;if(t=e.divToInt(r),t.isZero())Ye=n?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return Ye=ei(t)?n?2:3:n?4:1,e;Ye=ei(t)?n?1:4:n?3:2}return e.minus(r).abs()}function An(i,e,t,n){var r,o,s,a,c,u,l,m,d,f=i.constructor,g=t!==void 0;if(g?(Ie(t,1,it),n===void 0?n=f.rounding:Ie(n,0,8)):(t=f.precision,n=f.rounding),!i.isFinite())l=mi(i);else{for(l=Ve(i),s=l.indexOf("."),g?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(l=l.replace(".",""),d=new f(1),d.e=l.length-s,d.d=Xt(Ve(d),10,r),d.e=d.d.length),m=Xt(l,10,r),o=c=m.length;m[--c]==0;)m.pop();if(!m[0])l=g?"0p+0":"0";else{if(s<0?o--:(i=new f(i),i.d=m,i.e=o,i=$(i,d,t,n,0,r),m=i.d,o=i.e,u=ii),s=m[t],a=r/2,u=u||m[t+1]!==void 0,u=n<4?(s!==void 0||u)&&(n===0||n===(i.s<0?3:2)):s>a||s===a&&(n===4||u||n===6&&m[t-1]&1||n===(i.s<0?8:7)),m.length=t,u)for(;++m[--t]>r-1;)m[t]=0,t||(++o,m.unshift(1));for(c=m.length;!m[c-1];--c);for(s=0,l="";s<c;s++)l+=gn.charAt(m[s]);if(g){if(c>1)if(e==16||e==8){for(s=e==16?4:3,--c;c%s;c++)l+="0";for(m=Xt(l,r,e),c=m.length;!m[c-1];--c);for(s=1,l="1.";s<c;s++)l+=gn.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>c)for(o-=c;o--;)l+="0";else o<c&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return i.s<0?"-"+l:l}function ti(i,e){if(i.length>e)return i.length=e,!0}function hr(i){return new this(i).abs()}function Ar(i){return new this(i).acos()}function Tr(i){return new this(i).acosh()}function Pr(i,e){return new this(i).plus(e)}function kr(i){return new this(i).asin()}function xr(i){return new this(i).asinh()}function Br(i){return new this(i).atan()}function Ir(i){return new this(i).atanh()}function Sr(i,e){i=new this(i),e=new this(e);var t,n=this.precision,r=this.rounding,o=n+4;return!i.s||!e.s?t=new this(NaN):!i.d&&!e.d?(t=Oe(this,o,1).times(e.s>0?.25:.75),t.s=i.s):!e.d||i.isZero()?(t=e.s<0?Oe(this,n,r):new this(0),t.s=i.s):!i.d||e.isZero()?(t=Oe(this,o,1).times(.5),t.s=i.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan($(i,e,o,1)),e=Oe(this,o,1),this.precision=n,this.rounding=r,t=i.s<0?t.minus(e):t.plus(e)):t=this.atan($(i,e,o,1)),t}function Cr(i){return new this(i).cbrt()}function Nr(i){return K(i=new this(i),i.e+1,2)}function Kr(i,e,t){return new this(i).clamp(e,t)}function Rr(i){if(!i||typeof i!="object")throw Error(jt+"Object expected");var e,t,n,r=i.defaults===!0,o=["precision",1,it,"rounding",0,8,"toExpNeg",-bt,0,"toExpPos",0,bt,"maxE",0,bt,"minE",-bt,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=bn[t]),(n=i[t])!==void 0)if(ke(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(nt+t+": "+n);if(t="crypto",r&&(this[t]=bn[t]),(n=i[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(oi);else this[t]=!1;else throw Error(nt+t+": "+n);return this}function Lr(i){return new this(i).cos()}function Mr(i){return new this(i).cosh()}function fi(i){var e,t,n;function r(o){var s,a,c,u=this;if(!(u instanceof r))return new r(o);if(u.constructor=r,ni(o)){u.s=o.s,_?!o.d||o.e>r.maxE?(u.e=NaN,u.d=null):o.e<r.minE?(u.e=0,u.d=[0]):(u.e=o.e,u.d=o.d.slice()):(u.e=o.e,u.d=o.d?o.d.slice():o.d);return}if(c=typeof o,c==="number"){if(o===0){u.s=1/o<0?-1:1,u.e=0,u.d=[0];return}if(o<0?(o=-o,u.s=-1):u.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;_?s>r.maxE?(u.e=NaN,u.d=null):s<r.minE?(u.e=0,u.d=[0]):(u.e=s,u.d=[o]):(u.e=s,u.d=[o]);return}else if(o*0!==0){o||(u.s=NaN),u.e=NaN,u.d=null;return}return hn(u,o.toString())}else if(c!=="string")throw Error(nt+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),u.s=-1):(a===43&&(o=o.slice(1)),u.s=1),ai.test(o)?hn(u,o):yr(u,o)}if(r.prototype=P,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=Rr,r.clone=fi,r.isDecimal=ni,r.abs=hr,r.acos=Ar,r.acosh=Tr,r.add=Pr,r.asin=kr,r.asinh=xr,r.atan=Br,r.atanh=Ir,r.atan2=Sr,r.cbrt=Cr,r.ceil=Nr,r.clamp=Kr,r.cos=Lr,r.cosh=Mr,r.div=Er,r.exp=Or,r.floor=Fr,r.hypot=Dr,r.ln=_r,r.log=vr,r.log10=Wr,r.log2=qr,r.max=Vr,r.min=Gr,r.mod=Ur,r.mul=Xr,r.pow=zr,r.random=Hr,r.round=Zr,r.sign=jr,r.sin=Yr,r.sinh=Qr,r.sqrt=Jr,r.sub=$r,r.sum=eo,r.tan=to,r.tanh=no,r.trunc=io,i===void 0&&(i={}),i&&i.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)i.hasOwnProperty(t=n[e++])||(i[t]=this[t]);return r.config(i),r}function Er(i,e){return new this(i).div(e)}function Or(i){return new this(i).exp()}function Fr(i){return K(i=new this(i),i.e+1,3)}function Dr(){var i,e,t=new this(0);for(_=!1,i=0;i<arguments.length;)if(e=new this(arguments[i++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return _=!0,new this(1/0);t=e}return _=!0,t.sqrt()}function ni(i){return i instanceof kt||i&&i.toStringTag===si||!1}function _r(i){return new this(i).ln()}function vr(i,e){return new this(i).log(e)}function qr(i){return new this(i).log(2)}function Wr(i){return new this(i).log(10)}function Vr(){return li(this,arguments,"lt")}function Gr(){return li(this,arguments,"gt")}function Ur(i,e){return new this(i).mod(e)}function Xr(i,e){return new this(i).mul(e)}function zr(i,e){return new this(i).pow(e)}function Hr(i){var e,t,n,r,o=0,s=new this(1),a=[];if(i===void 0?i=this.precision:Ie(i,1,it),n=Math.ceil(i/E),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=n/4}else throw Error(oi);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],i%=E,n&&i&&(r=de(10,E-i),a[o]=(n/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=E)a.shift();for(n=1,r=a[0];r>=10;r/=10)n++;n<E&&(t-=E-n)}return s.e=t,s.d=a,s}function Zr(i){return K(i=new this(i),i.e+1,this.rounding)}function jr(i){return i=new this(i),i.d?i.d[0]?i.s:0*i.s:i.s||NaN}function Yr(i){return new this(i).sin()}function Qr(i){return new this(i).sinh()}function Jr(i){return new this(i).sqrt()}function $r(i,e){return new this(i).sub(e)}function eo(){var i=0,e=arguments,t=new this(e[i]);for(_=!1;t.s&&++i<e.length;)t=t.plus(e[i]);return _=!0,K(t,this.precision,this.rounding)}function to(i){return new this(i).tan()}function no(i){return new this(i).tanh()}function io(i){return K(i=new this(i),i.e+1,1)}P[Symbol.for("nodejs.util.inspect.custom")]=P.toString;P[Symbol.toStringTag]="Decimal";var kt=P.constructor=fi(bn);zt=new kt(zt);Ht=new kt(Ht);var S=kt;import{get as pi,set as ro}from"lodash";var Tn=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},gi={},oo={};function we(i){let e=pi(gi,i);if(!e){let t=pi(oo,i);e=new Tn({name:i,logLevel:t}),ro(gi,i,e)}return e}import{PublicKey as ic}from"@solana/web3.js";import oc from"bn.js";import Ao from"big.js";import nn from"bn.js";import Se from"bn.js";import{PublicKey as Bn}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as so}from"@solana/spl-token";import{PublicKey as re,SystemProgram as bi,SYSVAR_RENT_PUBKEY as ao}from"@solana/web3.js";function Pn({pubkey:i,isSigner:e=!1,isWritable:t=!0}){return{pubkey:i,isWritable:t,isSigner:e}}var ys=[Pn({pubkey:so,isWritable:!1}),Pn({pubkey:bi.programId,isWritable:!1}),Pn({pubkey:ao,isWritable:!1})];function kn({publicKey:i,transformSol:e}){let t=yi(i.toString());if(t instanceof re)return e&&t.equals(xt)?Q:t;if(e&&t.toString()===xt.toBase58())return Q;if(typeof t=="string"){if(t===re.default.toBase58())return re.default;try{return new re(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function yi(i){try{return new re(i)}catch{return i}}var Jt=new re("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),ws=new re("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Bt=new re("SysvarRent111111111111111111111111111111111"),hs=new re("SysvarC1ock11111111111111111111111111111111"),wt=new re("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),As=new re("Sysvar1nstructions1111111111111111111111111"),Ts=bi.programId,Ps=new re("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),ks=new re("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),xs=new re("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Bs=new re("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Is=new re("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Ss=new re("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Cs=new re("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Ns=new re("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Ks=new re("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Rs=new re("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Ls=new re("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Q=new re("So11111111111111111111111111111111111111112"),xt=re.default;function ut(i){return kn({publicKey:i,transformSol:!0})}import{PublicKey as co}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as wi}from"@solana/spl-token";var xn={chainId:101,address:co.default.toBase58(),programId:wi.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},rt={chainId:101,address:"So11111111111111111111111111111111111111112",programId:wi.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var In=class{constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:o=!1,isToken2022:s=!1}){if(e===xt.toBase58()||e instanceof Bn&&xt.equals(e)){this.decimals=rt.decimals,this.symbol=rt.symbol,this.name=rt.name,this.mint=new Bn(rt.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?Bn.default:kn({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Ge=In;Ge.WSOL=new In(G(C({},rt),{mint:rt.address}));import en from"big.js";import mo from"bn.js";import fo from"decimal.js-light";import uo from"toformat";var lo=uo,It=lo;var $t=we("module/fraction"),Sn=It(en),St=It(fo),po={[0]:St.ROUND_DOWN,[1]:St.ROUND_HALF_UP,[2]:St.ROUND_UP},go={[0]:en.roundDown,[1]:en.roundHalfUp,[2]:en.roundUp},j=class{constructor(e,t=new mo(1)){this.numerator=he(e),this.denominator=he(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new j(this.denominator,this.numerator)}add(e){let t=e instanceof j?e:new j(he(e));return this.denominator.eq(t.denominator)?new j(this.numerator.add(t.numerator),this.denominator):new j(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof j?e:new j(he(e));return this.denominator.eq(t.denominator)?new j(this.numerator.sub(t.numerator),this.denominator):new j(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof j?e:new j(he(e));return new j(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof j?e:new j(he(e));return new j(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||$t.logWithError(`${e} is not an integer.`),e<=0&&$t.logWithError(`${e} is not positive.`),St.set({precision:e+1,rounding:po[n]});let r=new St(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||$t.logWithError(`${e} is not an integer.`),e<0&&$t.logWithError(`${e} is negative.`),Sn.DP=e,Sn.RM=go[n]||1,new Sn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var yo=we("Raydium_price"),De=class extends j{constructor(t){let{baseToken:n,quoteToken:r,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=r,this.scalar=new j(Cn(n.decimals),Cn(r.decimals))}get raw(){return new j(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new De({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&yo.logWithError("mul token not equals");let n=super.mul(t);return new De({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,r){return this.adjusted.toSignificant(t,n,r)}toFixed(t=this.quoteToken.decimals,n,r){return this.adjusted.toFixed(t,n,r)}};var Nn=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},tn=Nn;tn.SOL=new Nn(xn);import wo from"bn.js";var hi=new j(new wo(100)),ot=class extends j{toSignificant(e=5,t,n){return this.mul(hi).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(hi).toFixed(e,t,n)}};var ho=new Se(0),Ca=new Se(1),Na=new Se(2),Ka=new Se(3),Ra=new Se(5),Kn=new Se(10),La=new Se(100),Ma=new Se(1e3),Ea=new Se(1e4),Ai=9007199254740991;function he(i){let e=we("Raydium_parseBigNumberish");if(i instanceof Se)return i;if(typeof i=="string"){if(i.match(/^-?[0-9]+$/))return new Se(i);e.logWithError(`invalid BigNumberish string: ${i}`)}return typeof i=="number"?(i%1&&e.logWithError(`BigNumberish number underflow: ${i}`),(i>=Ai||i<=-Ai)&&e.logWithError(`BigNumberish number overflow: ${i}`),new Se(String(i))):typeof i=="bigint"?new Se(i.toString()):(e.error(`invalid BigNumberish value: ${i}`),new Se(0))}function Cn(i){return Kn.pow(he(i))}var To=we("Raydium_amount"),Ti=It(Ao);function Po(i,e){let t="0",n="0";if(i.includes(".")){let r=i.split(".");r.length===2?([t,n]=r,n=n.padEnd(e,"0")):To.logWithError(`invalid number string, num: ${i}`)}else t=i;return[t,n.slice(0,e)||n]}var Ae=class extends j{constructor(t,n,r=!0,o){let s=new nn(0),a=Kn.pow(new nn(t.decimals));if(r)s=he(n);else{let c=new nn(0),u=new nn(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,m]=Po(n.toString(),t.decimals);c=he(l),u=he(m)}c=c.mul(a),s=c.add(u)}super(s,a);this.logger=we(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new Ae(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new Ae(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,r=0){return super.toSignificant(t,n,r)}toFixed(t=this.token.decimals,n,r=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,r)}toExact(t={groupSeparator:""}){return Ti.DP=this.token.decimals,new Ti(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};import{PublicKey as Kt,sendAndConfirmTransaction as En,Transaction as Rt,TransactionMessage as Lt,VersionedTransaction as Mt}from"@solana/web3.js";import Mo from"axios";var ue={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut"};import{PublicKey as ko,ComputeBudgetProgram as Pi,Transaction as xi,TransactionMessage as xo,Keypair as Bi,VersionedTransaction as Ii}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Bo}from"@solana/spl-token";var ki=we("Raydium_txUtil"),Si=1644;function rn(i){let e=[],t=[];return i.microLamports&&(e.push(Pi.setComputeUnitPrice({microLamports:i.microLamports})),t.push(ue.SetComputeUnitPrice)),i.units&&(e.push(Pi.setComputeUnitLimit({units:i.units})),t.push(ue.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function ht(i,e){var n,r;let t=e!=null?e:"confirmed";try{return((r=await((n=i.getLatestBlockhash)==null?void 0:n.call(i,{commitment:t})))==null?void 0:r.blockhash)||(await i.getRecentBlockhash(t)).blockhash}catch{return(await i.getRecentBlockhash(t)).blockhash}}function Io(i,e){i.length<1&&ki.logWithError(`no instructions provided: ${i.toString()}`),e.length<1&&ki.logWithError(`no signers provided:, ${e.toString()}`);let t=new xi;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...i);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<Si}catch{return!1}}function Ne(i,e){let[t,n]=ko.findProgramAddressSync(i,e);return{publicKey:t,nonce:n}}function Ct({instructions:i,payer:e,signers:t}){return Io(i,[e,...t])}function Nt({instructions:i,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=Bi.generate().publicKey.toString()}){let o=new xo({payerKey:e,recentBlockhash:n,instructions:i}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new Ii(o).serialize()).toString("base64").length<Si}catch{return!1}}var So=i=>Buffer.isBuffer(i)?i:i instanceof Uint8Array?Buffer.from(i.buffer,i.byteOffset,i.byteLength):Buffer.from(i);function lt(i){let e=[];return i.forEach(t=>{t instanceof xi&&(t.recentBlockhash||(t.recentBlockhash=Bo.toBase58()),t.feePayer||(t.feePayer=Bi.generate().publicKey));let n=t.serialize({requireAllSignatures:!1,verifySignatures:!1});t instanceof Ii&&(n=So(n));let r=n.toString("base64");e.push(r)}),console.log("simulate tx string:",e),e}import{PublicKey as Ki,AddressLookupTableAccount as on}from"@solana/web3.js";import{PublicKey as Ci}from"@solana/web3.js";import{MINT_SIZE as Co,TOKEN_PROGRAM_ID as No,getTransferFeeConfig as Ko,unpackMint as Ro}from"@solana/spl-token";var Rn=we("Raydium_accountInfo_util");async function Qe(i,e,t){let{batchRequest:n,commitment:r="confirmed",chunkCount:o=100}=C({batchRequest:!1},t),s=Ln(e,o),a=new Array(s.length).fill([]);if(n){let c=s.map(m=>{let d=i._buildArgs([m.map(f=>f.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:d}}),u=Ln(c,10);a=(await(await Promise.all(u.map(async m=>await i._rpcBatchRequest(m)))).flat()).map(m=>(m.error&&Rn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.error.message}`),m.result.value.map(d=>{if(d){let{data:f,executable:g,lamports:p,owner:y,rentEpoch:b}=d;return f.length!==2&&f[1]!=="base64"&&Rn.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(f[0],"base64"),executable:g,lamports:p,owner:new Ci(y),rentEpoch:b}}return null})))}else try{a=await Promise.all(s.map(c=>i.getMultipleAccountsInfo(c,r)))}catch(c){c instanceof Error&&Rn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return a.flat()}async function st(i,e,t){let n=await Qe(i,e.map(r=>r.pubkey),t);return e.map((r,o)=>G(C({},r),{accountInfo:n[o]}))}async function Ni({connection:i,mints:e,config:t}){var o,s,a;if(e.length===0)return{};let n=await st(i,e.map(c=>({pubkey:ut(c)})),t),r={};for(let c of n){if(!c.accountInfo||c.accountInfo.data.length<Co){console.log("invalid mint account",c.pubkey.toBase58());continue}let u=Ro(c.pubkey,c.accountInfo,(o=c.accountInfo)==null?void 0:o.owner);r[c.pubkey.toString()]=G(C({},u),{programId:((s=c.accountInfo)==null?void 0:s.owner)||No,feeConfig:(a=Ko(u))!=null?a:void 0})}return r[Ci.default.toBase58()]=r[Q.toBase58()],r}async function Mn({connection:i,address:e}){let t=await Qe(i,[...new Set(e.map(r=>r.toString()))].map(r=>new Ki(r))),n={};for(let r=0;r<e.length;r++){let o=t[r],s=e[r];if(!o)continue;let a=new on({key:s,state:on.deserialize(o.data)});n[s.toString()]=a,sn[s.toString()]=a}return n}var sn={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new on({key:new Ki("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:on.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};var an=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.api=e.api}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await Mo.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=rn(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:r=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...r),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==Kt.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(C({},t||{})):this.build(t)}build(e){var n;let t=new Rt;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((n=this.owner)==null?void 0:n.signer)&&!this.signers.some(r=>r.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async r=>{var u;let{recentBlockHash:o,skipPreflight:s=!0,sendAndConfirm:a}=r||{},c=o!=null?o:await ht(this.connection,this.blockhashCommitment);if(t.recentBlockhash=c,this.signers.length&&t.sign(...this.signers),lt([t]),(u=this.owner)!=null&&u.isKeyPair)return{txId:a?await En(this.connection,t,this.signers.find(m=>m.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:s}),signedTx:t};if(this.signAllTransactions){let l=await this.signAllTransactions([t]);return{txId:await this.connection.sendRawTransaction(l[0].serialize(),{skipPreflight:s}),signedTx:l[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var u;let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:r}=this.build(n),o=t.filter(l=>l.transaction.instructions.length>0),s=[r,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],c=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(l=>{l.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async l=>{var y;let{sequentially:m,onTxUpdate:d,recentBlockHash:f,skipPreflight:g=!0}=l||{},p=f!=null?f:await ht(this.connection,this.blockhashCommitment);if((y=this.owner)!=null&&y.isKeyPair){if(m){let b=[];for(let h of s){let w=await En(this.connection,h,this.signers.find(A=>A.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:g});b.push(w)}return{txIds:b,signedTxs:s}}return{txIds:await await Promise.all(s.map(async b=>(b.recentBlockhash=p,await this.connection.sendRawTransaction(b.serialize(),{skipPreflight:g})))),signedTxs:s}}if(this.signAllTransactions){let b=s.map((w,A)=>(w.recentBlockhash=p,a[A].length&&w.sign(...a[A]),w));lt(b);let h=await this.signAllTransactions(b);if(m){let w=0,A=[],k=async()=>{if(!h[w])return;let T=await this.connection.sendRawTransaction(h[w].serialize(),{skipPreflight:g});A.push({txId:T,status:"sent",signedTx:h[w]}),d==null||d([...A]),w++,this.connection.onSignature(T,x=>{let B=A.findIndex(M=>M.txId===T);B>-1&&(A[B].status=x.err?"error":"success"),d==null||d([...A]),x.err||k()},"processed"),this.connection.getSignatureStatus(T)};return await k(),{txIds:A.map(T=>T.txId),signedTxs:h}}else{let w=[];for(let A=0;A<h.length;A+=1){let k=await this.connection.sendRawTransaction(h[A].serialize(),{skipPreflight:g});w.push(k)}return{txIds:w,signedTxs:h}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){var p;let g=e||{},{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:r,recentBlockhash:o}=g,s=gt(g,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),a=C(C({},this.cluster==="devnet"?{}:sn),t),c=Array.from(new Set([...n,...this.lookupTableAddress])),u=[];for(let y of c)a[y]===void 0&&u.push(new Kt(y));let l=await Mn({connection:this.connection,address:u});for(let[y,b]of Object.entries(l))a[y]=b;let m=r?Kt.default.toBase58():o!=null?o:await ht(this.connection,this.blockhashCommitment),d=new Lt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(a));((p=this.owner)==null?void 0:p.signer)&&!this.signers.some(y=>y.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let f=new Mt(d);return f.sign(this.signers),{builder:this,transaction:f,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async y=>{var w;let{skipPreflight:b=!0,sendAndConfirm:h}=y||{};if(lt([f]),(w=this.owner)!=null&&w.isKeyPair){let A=await this.connection.sendTransaction(f,{skipPreflight:b});if(h){let{lastValidBlockHeight:k,blockhash:T}=await this.connection.getLatestBlockhash({commitment:this.blockhashCommitment});await this.connection.confirmTransaction({blockhash:T,lastValidBlockHeight:k,signature:A},"confirmed")}return{txId:A,signedTx:f}}if(this.signAllTransactions){let A=await this.signAllTransactions([f]);return{txId:await this.connection.sendTransaction(A[0],{skipPreflight:b}),signedTx:A[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildV0MultiTx(e){var u;let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:r}=await this.buildV0(n),o=t.filter(l=>l.builder.instructions.length>0),s=[r,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],c=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(l=>{l.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(l,m)=>{l.sign(a[m])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:n,execute:async l=>{var p;let{sequentially:m,onTxUpdate:d,recentBlockHash:f,skipPreflight:g=!0}=l||{};if(f&&s.forEach(y=>y.message.recentBlockhash=f),lt(s),(p=this.owner)!=null&&p.isKeyPair){if(m){let y=[];for(let b of s){let h=await this.connection.sendTransaction(b,{skipPreflight:g}),{lastValidBlockHeight:w,blockhash:A}=await this.connection.getLatestBlockhash({commitment:this.blockhashCommitment});await this.connection.confirmTransaction({blockhash:A,lastValidBlockHeight:w,signature:h},"confirmed"),y.push(h)}return{txIds:y,signedTxs:s}}return{txIds:await Promise.all(s.map(async y=>await this.connection.sendTransaction(y,{skipPreflight:g}))),signedTxs:s}}if(this.signAllTransactions){let y=await this.signAllTransactions(s);if(m){let b=0,h=[],w=async()=>{if(!y[b])return;let A=await this.connection.sendTransaction(y[b],{skipPreflight:g});h.push({txId:A,status:"sent",signedTx:y[b]}),d==null||d([...h]),b++,this.connection.onSignature(A,k=>{let T=h.findIndex(x=>x.txId===A);T>-1&&(h[T].status=k.err?"error":"success"),d==null||d([...h]),k.err||w()},"processed"),this.connection.getSignatureStatus(A)};return w(),{txIds:[],signedTxs:y}}else{let b=[];for(let h=0;h<y.length;h+=1){let w=await this.connection.sendTransaction(y[h],{skipPreflight:g});b.push(w)}return{txIds:b,signedTxs:y}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(e){var l;let u=e||{},{computeBudgetConfig:t}=u,n=gt(u,["computeBudgetConfig"]),r=t?rn(t):{instructions:[],instructionTypes:[]},o=this.signers.reduce((m,d)=>G(C({},m),{[d.publicKey.toBase58()]:d}),{}),s=[],a=[],c=[];if(this.allInstructions.forEach(m=>{let d=[...c,m],f=t?[...r.instructions,...d]:d,p=[...new Set(d.map(y=>y.keys.filter(b=>b.isSigner).map(b=>b.pubkey.toString())).flat()).values()].map(y=>new Kt(y));if(c.length<12&&Ct({instructions:f,payer:this.feePayer,signers:p})||Ct({instructions:d,payer:this.feePayer,signers:p}))c.push(m);else{if(c.length===0)throw Error("item ins too big");Ct({instructions:t?[...r.instructions,...c]:[...c],payer:this.feePayer,signers:p})?s.push(new Rt().add(...r.instructions,...c)):s.push(new Rt().add(...c)),a.push(Array.from(new Set(c.map(y=>y.keys.filter(b=>b.isSigner).map(b=>b.pubkey.toString())).flat())).map(y=>o[y]).filter(y=>y!==void 0)),c=[m]}}),c.length>0){let d=[...new Set(c.map(f=>f.keys.filter(g=>g.isSigner).map(g=>g.pubkey.toString())).flat()).values()].map(f=>o[f]).filter(f=>f!==void 0);Ct({instructions:t?[...r.instructions,...c]:[...c],payer:this.feePayer,signers:d.map(f=>f.publicKey)})?s.push(new Rt().add(...r.instructions,...c)):s.push(new Rt().add(...c)),a.push(d)}return s.forEach(m=>m.feePayer=this.feePayer),(l=this.owner)!=null&&l.signer&&a.forEach(m=>{m.some(d=>d.publicKey.equals(this.owner.publicKey))||m.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:this.instructionTypes,execute:async m=>{var b;let{sequentially:d,onTxUpdate:f,recentBlockHash:g,skipPreflight:p=!0}=m||{},y=g!=null?g:await ht(this.connection,this.blockhashCommitment);if(s.forEach(async(h,w)=>{h.recentBlockhash=y,a[w].length&&h.sign(...a[w])}),lt(s),(b=this.owner)!=null&&b.isKeyPair){if(d){let h=[];for(let w of s){let A=await En(this.connection,w,this.signers.find(k=>k.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:p});h.push(A)}return{txIds:h,signedTxs:s}}return{txIds:await Promise.all(s.map(async h=>await this.connection.sendRawTransaction(h.serialize(),{skipPreflight:p}))),signedTxs:s}}if(this.signAllTransactions){let h=await this.signAllTransactions(s);if(d){let w=0,A=[],k=async()=>{if(!h[w])return;let T=await this.connection.sendRawTransaction(h[w].serialize(),{skipPreflight:p});A.push({txId:T,status:"sent",signedTx:h[w]}),f==null||f([...A]),w++,this.connection.onSignature(T,x=>{let B=A.findIndex(M=>M.txId===T);B>-1&&(A[B].status=x.err?"error":"success"),f==null||f([...A]),x.err||k()},"processed"),this.connection.getSignatureStatus(T)};return await k(),{txIds:A.map(T=>T.txId),signedTxs:h}}else{let w=[];for(let A=0;A<h.length;A+=1){let k=await this.connection.sendRawTransaction(h[A].serialize(),{skipPreflight:p});w.push(k)}return{txIds:w,signedTxs:h}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuildV0(e){var b;let y=e||{},{computeBudgetConfig:t,lookupTableCache:n={},lookupTableAddress:r=[]}=y,o=gt(y,["computeBudgetConfig","lookupTableCache","lookupTableAddress"]),s=C(C({},this.cluster==="devnet"?{}:sn),n),a=Array.from(new Set([...this.lookupTableAddress,...r])),c=[];for(let h of a)s[h]===void 0&&c.push(new Kt(h));let u=await Mn({connection:this.connection,address:c});for(let[h,w]of Object.entries(u))s[h]=w;let l=t?rn(t):{instructions:[],instructionTypes:[]},m=await ht(this.connection,this.blockhashCommitment),d=this.signers.reduce((h,w)=>G(C({},h),{[w.publicKey.toBase58()]:w}),{}),f=[],g=[],p=[];if(this.allInstructions.forEach(h=>{let w=[...p,h],A=t?[...l.instructions,...w]:w;if(p.length<12&&Nt({instructions:A,payer:this.feePayer,lookupTableAddressAccount:s})||Nt({instructions:w,payer:this.feePayer,lookupTableAddressAccount:s}))p.push(h);else{if(p.length===0)throw Error("item ins too big");let k={};for(let T of[...new Set(a)])s[T]!==void 0&&(k[T]=s[T]);if(t&&Nt({instructions:[...l.instructions,...p],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:m})){let T=new Lt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...l.instructions,...p]}).compileToV0Message(Object.values(s));f.push(new Mt(T))}else{let T=new Lt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...p]}).compileToV0Message(Object.values(s));f.push(new Mt(T))}g.push(Array.from(new Set(p.map(T=>T.keys.filter(x=>x.isSigner).map(x=>x.pubkey.toString())).flat())).map(T=>d[T]).filter(T=>T!==void 0)),p=[h]}}),p.length>0){let w=[...new Set(p.map(A=>A.keys.filter(k=>k.isSigner).map(k=>k.pubkey.toString())).flat()).values()].map(A=>d[A]).filter(A=>A!==void 0);if(t&&Nt({instructions:[...l.instructions,...p],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:m})){let A=new Lt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...l.instructions,...p]}).compileToV0Message(Object.values(s));f.push(new Mt(A))}else{let A=new Lt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...p]}).compileToV0Message(Object.values(s));f.push(new Mt(A))}g.push(w)}return(b=this.owner)!=null&&b.signer&&g.forEach(h=>{h.some(w=>w.publicKey.equals(this.owner.publicKey))||h.push(this.owner.signer)}),{builder:this,transactions:f,buildProps:e,signers:g,instructionTypes:this.instructionTypes,execute:async h=>{var x;let{sequentially:w,onTxUpdate:A,recentBlockHash:k,skipPreflight:T=!0}=h||{};if(f.map(async(B,M)=>{g[M].length&&B.sign(g[M]),k&&(B.message.recentBlockhash=k)}),lt(f),(x=this.owner)!=null&&x.isKeyPair){if(w){let B=[];for(let M of f){let L=await this.connection.sendTransaction(M,{skipPreflight:T}),{lastValidBlockHeight:R,blockhash:Z}=await this.connection.getLatestBlockhash({commitment:this.blockhashCommitment});await this.connection.confirmTransaction({blockhash:Z,lastValidBlockHeight:R,signature:L},"confirmed"),B.push(L)}return{txIds:B,signedTxs:f}}return{txIds:await Promise.all(f.map(async B=>await this.connection.sendTransaction(B,{skipPreflight:T}))),signedTxs:f}}if(this.signAllTransactions){let B=await this.signAllTransactions(f);if(w){let M=0,L=[],R=async()=>{if(!B[M])return;let Z=await this.connection.sendTransaction(B[M],{skipPreflight:T});L.push({txId:Z,status:"sent",signedTx:B[M]}),A==null||A([...L]),M++,this.connection.onSignature(Z,ee=>{let ce=L.findIndex(te=>te.txId===Z);ce>-1&&(L[ce].status=ee.err?"error":"success"),A==null||A([...L]),ee.err||R()},"processed"),this.connection.getSignatureStatus(Z)};return R(),{txIds:[],signedTxs:B}}else{let M=[];for(let L=0;L<B.length;L+=1){let R=await this.connection.sendTransaction(B[L],{skipPreflight:T});M.push(R)}return{txIds:M,signedTxs:B}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}};function Ln(i,e=1,t=[]){let n=[...i];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as X}from"@solana/web3.js";var Hc=new X("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Zc=new X("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),jc=new X("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Yc=new X("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Qc=new X("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Jc=new X("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),$c=new X("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),eu=new X("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),tu=new X("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),nu=new X("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),iu=new X("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),ru=new X("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),ou=new X("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),su=new X("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),au=new X("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),cu=new X("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),uu=new X("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),lu=new X("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),mu=new X("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Eo=new X("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),Oo=new X("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),Fo=new X("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2");var du={SERUM_MARKET:X.default,OPENBOOK_MARKET:new X("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:X.default,FarmV3:new X("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new X("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new X("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new X("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new X("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new X("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),Router:new X("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:Eo,CREATE_CPMM_POOL_AUTH:Oo,CREATE_CPMM_POOL_FEE_ACC:Fo,FEE_DESTINATION_ID:new X("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR")};import{PublicKey as Do}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as _o}from"@solana/spl-token";function Ue(i,e,t){return Ne([i.toBuffer(),(t!=null?t:_o).toBuffer(),e.toBuffer()],new Do("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import _e from"bn.js";var Et=1e4;function oe(i,e,t,n){if(e===void 0)return{amount:i,fee:void 0,expirationTime:void 0};let r=G(C({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,s=new _e(o.maximumFee.toString()),a=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===Et){let c=new _e(o.maximumFee.toString());return{amount:i.add(c),fee:c,expirationTime:a}}else{let c=On(i.mul(new _e(Et)),new _e(Et-o.transferFeeBasisPoints)),u=new _e(o.maximumFee.toString()),l=c.sub(i).gt(u)?i.add(u):c,m=On(l.mul(new _e(o.transferFeeBasisPoints)),new _e(Et)),d=m.gt(s)?s:m;return{amount:l,fee:d,expirationTime:a}}else{let c=On(i.mul(new _e(o.transferFeeBasisPoints)),new _e(Et)),u=c.gt(s)?s:c;return{amount:i,fee:u,expirationTime:a}}}function at(i,e){return i===void 0?e:e===void 0?i:Math.min(i,e)}function On(i,e){let{div:t,mod:n}=i.divmod(e);return n.gt(new _e(0))?t.add(new _e(1)):t}import{PublicKey as vu}from"@solana/web3.js";import{MintLayout as Wu,TOKEN_PROGRAM_ID as Gu}from"@solana/spl-token";var Fn=r=>{var o=r,{address:i,programId:e,decimals:t}=o,n=gt(o,["address","programId","decimals"]);return C({chainId:101,address:ut(i).toBase58(),programId:e,logoURI:"",symbol:"",name:"",decimals:t,tags:[],extensions:n.extensions||{}},n)},Dn=i=>i?G(C({},i),{transferFeeConfigAuthority:i.transferFeeConfigAuthority.toBase58(),withdrawWithheldAuthority:i.withdrawWithheldAuthority.toBase58(),withheldAmount:i.withheldAmount.toString(),olderTransferFee:G(C({},i.olderTransferFee),{epoch:i.olderTransferFee.epoch.toString(),maximumFee:i.olderTransferFee.maximumFee.toString()}),newerTransferFee:G(C({},i.newerTransferFee),{epoch:i.newerTransferFee.epoch.toString(),maximumFee:i.newerTransferFee.maximumFee.toString()})}):void 0;var _n=(...i)=>i.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),Ot=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=we(t)}createTxBuilder(e){return this.scope.checkOwner(),new an({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(_n(e))}logInfo(...e){this.logger.info(_n(e))}logAndCreateError(...e){let t=_n(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import Re from"bn.js";var se=new Re(0),Xe=new Re(1),Je=new Re(-1),Ke=new Re(1).shln(64),cn=new Re(1).shln(128),vn=Ke.sub(Xe),Ft=64,Ri=cn.subn(1),xe=-443636,Be=-xe,ze=new Re("4295048016"),He=new Re("79226673521066979257578248091"),el=new Re("4295048017"),tl=new Re("79226673521066979257578248090"),Li=16,Mi="59543866431248",Ei="184467440737095516",Oi="15793534762490258745",un=new Re(10).pow(new Re(6));var Fi={tvl:0,volumeQuote:0,mintAmountA:0,mintAmountB:0,rewardDefaultInfos:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0,day:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},week:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},month:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},pooltype:[]},nl=new Re("18446744073700000000");import V from"bn.js";function ln(i){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,i,!1),new Uint8Array(e)}function qn(i,e){let t=0;for(let n=i-1;n>=0&&!e.testn(n);n--)t++;return t}function Wn(i,e){let t=0;for(let n=0;n<i&&!e.testn(n);n++)t++;return t}function Dt(i,e){for(let t=0;t<i;t++)if(e.testn(t))return!1;return!0}function Di(i,e){return Dt(i,e)?null:qn(i,e)}function _i(i,e){return Dt(i,e)?null:Wn(i,e)}var cl=Buffer.from("amm_config","utf8"),vo=Buffer.from("pool","utf8"),qo=Buffer.from("pool_vault","utf8"),Wo=Buffer.from("pool_reward_vault","utf8"),vi=Buffer.from("position","utf8"),Vo=Buffer.from("tick_array","utf8"),Go=Buffer.from("operation","utf8"),Uo=Buffer.from("pool_tick_array_bitmap_extension","utf8"),Xo=Buffer.from("observation","utf8");function qi(i,e,t,n){return Ne([vo,e.toBuffer(),t.toBuffer(),n.toBuffer()],i)}function Vn(i,e,t){return Ne([qo,e.toBuffer(),t.toBuffer()],i)}function Wi(i,e,t){return Ne([Wo,e.toBuffer(),t.toBuffer()],i)}function J(i,e,t){return Ne([Vo,e.toBuffer(),ln(t)],i)}function mt(i,e,t,n){return Ne([vi,e.toBuffer(),ln(t),ln(n)],i)}function Le(i,e){return Ne([vi,e.toBuffer()],i)}function mn(i){return Ne([Buffer.from("metadata","utf8"),wt.toBuffer(),i.toBuffer()],wt)}function _t(i){return Ne([Go],i)}function Me(i,e){return Ne([Uo,e.toBuffer()],i)}function Vi(i,e){return Ne([Xo,e.toBuffer()],i)}import{PublicKey as ve}from"@solana/web3.js";import ie from"bn.js";import cs from"bn.js";import{PublicKey as es}from"@solana/web3.js";import zi,{isBN as Hi}from"bn.js";import{bits as ml,BitStructure as dl,blob as zo,Blob as fl,cstr as pl,f32 as gl,f32be as bl,f64 as yl,f64be as wl,greedy as hl,Layout as Ho,ns64 as Al,ns64be as Tl,nu64 as Pl,nu64be as kl,offset as xl,s16 as Bl,s16be as Il,s24 as Sl,s24be as Cl,s32 as Zo,s32be as Nl,s40 as Kl,s40be as Rl,s48 as Ll,s48be as Ml,s8 as El,seq as jo,struct as Ol,Structure as Yo,u16 as Qo,u16be as Fl,u24 as Dl,u24be as _l,u32 as vl,u32be as ql,u40 as Wl,u40be as Vl,u48 as Gl,u48be as Ul,u8 as Jo,UInt as $o,union as Xl,Union as zl,unionLayoutDiscriminator as Hl,utf8 as Zl}from"@solana/buffer-layout";var Gn=Ho,Gi=Yo;var Un=$o;var Ui=Jo,vt=Qo;var Te=Zo;var Xi=jo;var Ee=zo;var At=class extends Gn{constructor(t,n,r){super(t,r);this.blob=Ee(t),this.signed=n}decode(t,n=0){let r=new zi(this.blob.decode(t,n),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,n,r=0){return typeof t=="number"&&(t=new zi(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,r)}};function fe(i){return new Un(1,i)}function Tt(i){return new Un(4,i)}function F(i){return new At(8,!1,i)}function z(i){return new At(16,!1,i)}function Zi(i){return new At(8,!0,i)}function ji(i){return new At(16,!0,i)}var dn=class extends Gn{constructor(t,n,r,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=r}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,r){return this.layout.encode(this.encoder(t),n,r)}getSpan(t,n){return this.layout.getSpan(t,n)}};function pe(i){return new dn(Ee(32),e=>new es(e),e=>e.toBuffer(),i)}function Ze(i){return new dn(Ui(),ts,ns,i)}function ts(i){if(i===0)return!1;if(i===1)return!0;throw new Error("Invalid bool: "+i)}function ns(i){return i?1:0}var Xn=class extends Gi{decode(e,t){return super.decode(e,t)}};function ne(i,e,t){return new Xn(i,e,t)}function ae(i,e,t){let n,r=typeof e=="number"?e:Hi(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=Hi(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return Xi(i,r,t)}var zn=14,$e=class{static maxTickInTickarrayBitmap(e){return e*ge*dt}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);let o=n*r;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!U.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=r?t-U.tickCount(n):t+U.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*ge,c=s/a+512;s<0&&s%a!=0&&c--;let u=Math.abs(c);if(r){let l=e.shln(1024-u-1),m=Di(1024,l);if(m!==null){let d=(u-m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(u),m=_i(1024,l);if(m!==null){let d=(u+m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:o-U.tickCount(n)}}}},qt=class{static getBitmapOffset(e,t){if(!U.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=$e.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&r--,r}static getBitmap(e,t,n){let r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=$e.maxTickInTickarrayBitmap(e),n=-t;if(Be<=t)throw Error(`extensionTickBoundary check error: ${Be}, ${t}`);if(n<=xe)throw Error(`extensionTickBoundary check error: ${n}, ${xe}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:r}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:N.mergeTickArrayBitmap(r).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){let o=U.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,r);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){let{minValue:o,maxValue:s}=$e.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(r){let c=N.mergeTickArrayBitmap(e).shln(dt-1-a),u=Dt(512,c)?null:qn(512,c);if(u!==null){let l=t-u*U.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let c=N.mergeTickArrayBitmap(e).shrn(a),u=Dt(512,c)?null:Wn(512,c);if(u!==null){let l=t+u*U.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s-U.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%$e.maxTickInTickarrayBitmap(t),r=Math.floor(n/U.tickCount(t));return e<0&&n!=0&&(r=dt-r),r}};var Yi=ne([Ee(8),fe("bump"),vt("index"),pe(""),Tt("protocolFeeRate"),Tt("tradeFeeRate"),vt("tickSpacing"),ae(F(),8,"")]),is=ne([Tt("blockTimestamp"),Zi("tickCumulative"),ae(F(),4)]),Qi=ne([Ee(8),Ze("initialized"),F("recentEpoch"),vt("observationIndex"),pe("poolId"),ae(is,100,"observations"),ae(F(),4)]),rs=ne([fe("rewardState"),F("openTime"),F("endTime"),F("lastUpdateTime"),z("emissionsPerSecondX64"),F("rewardTotalEmissioned"),F("rewardClaimed"),pe("tokenMint"),pe("tokenVault"),pe("creator"),z("rewardGrowthGlobalX64")]),fn=ne([Ee(8),fe("bump"),pe("ammConfig"),pe("creator"),pe("mintA"),pe("mintB"),pe("vaultA"),pe("vaultB"),pe("observationId"),fe("mintDecimalsA"),fe("mintDecimalsB"),vt("tickSpacing"),z("liquidity"),z("sqrtPriceX64"),Te("tickCurrent"),Tt(),z("feeGrowthGlobalX64A"),z("feeGrowthGlobalX64B"),F("protocolFeesTokenA"),F("protocolFeesTokenB"),z("swapInAmountTokenA"),z("swapOutAmountTokenB"),z("swapInAmountTokenB"),z("swapOutAmountTokenA"),fe("status"),ae(fe(),7,""),ae(rs,3,"rewardInfos"),ae(F(),16,"tickArrayBitmap"),F("totalFeesTokenA"),F("totalFeesClaimedTokenA"),F("totalFeesTokenB"),F("totalFeesClaimedTokenB"),F("fundFeesTokenA"),F("fundFeesTokenB"),F("startTime"),ae(F(),15*4-3,"padding")]),os=ne([z("growthInsideLastX64"),F("rewardAmountOwed")]),pn=ne([Ee(8),fe("bump"),pe("nftMint"),pe("poolId"),Te("tickLower"),Te("tickUpper"),z("liquidity"),z("feeGrowthInsideLastX64A"),z("feeGrowthInsideLastX64B"),F("tokenFeesOwedA"),F("tokenFeesOwedB"),ae(os,3,"rewardInfos"),ae(F(),8,"")]),gm=ne([Ee(8),fe("bump"),pe("poolId"),Te("tickLowerIndex"),Te("tickUpperIndex"),z("liquidity"),z("feeGrowthInsideLastX64A"),z("feeGrowthInsideLastX64B"),F("tokenFeesOwedA"),F("tokenFeesOwedB"),ae(z(),3,"rewardGrowthInside"),ae(F(),8,"")]),ss=ne([Te("tick"),ji("liquidityNet"),z("liquidityGross"),z("feeGrowthOutsideX64A"),z("feeGrowthOutsideX64B"),ae(z(),3,"rewardGrowthsOutsideX64"),ae(Tt(),13,"")]),Wt=ne([Ee(8),pe("poolId"),Te("startTickIndex"),ae(ss,ge,"ticks"),fe("initializedTickCount"),ae(fe(),115,"")]),Ji=ne([Ee(329),ae(pe(),100,"whitelistMints")]),$i=ne([Ee(8),pe("poolId"),ae(ae(F(),8),zn,"positiveTickArrayBitmap"),ae(ae(F(),8),zn,"negativeTickArrayBitmap")]);var as=15,U=class{static async getTickArrays(e,t,n,r,o,s,a){let c=[],u=N.getTickArrayStartIndexByTick(r,o),l=N.getInitializedTickArrayInRange(s,a,o,u,Math.floor(as/2));for(let f=0;f<l.length;f++){let{publicKey:g}=J(t,n,l[f]);c.push(g)}let m=(await Qe(e,c)).map(f=>f!==null?Wt.decode(f.data):null),d={};for(let f=0;f<c.length;f++){let g=m[f];g!==null&&(d[g.startTickIndex]=G(C({},g),{address:c[f]}))}return d}static nextInitializedTick(e,t,n,r,o,s){let{initializedTick:a,tickArrayAddress:c,tickArrayStartTickIndex:u}=this.nextInitializedTickInOneArray(e,t,n,r,o,s);for(;a==null||a.liquidityGross.lten(0);){if(u=N.getNextTickArrayStartIndex(u,o,s),this.checkIsValidStartIndex(u,o))throw new Error("No enough initialized tickArray");let l=n[u];if(l===void 0)continue;let{nextTick:m,tickArrayAddress:d,tickArrayStartTickIndex:f}=this.firstInitializedTickInOneArray(e,t,l,s);[a,c,u]=[m,d,f]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:c,tickArrayStartTickIndex:u}}static nextInitializedTickArray(e,t,n,r,o){let s=Math.floor(e/U.tickCount(t)),a=n?N.searchLowBitFromStart(r,o,s-1,1,t):N.searchHightBitFromStart(r,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let o;if(r){let a=ge-1;for(;a>=0;){let c=n.ticks[a];if(c.liquidityGross.gtn(0)){o=c;break}a=a-1}}else{let a=0;for(;a<ge;){let c=n.ticks[a];if(c.liquidityGross.gtn(0)){o=c;break}a=a+1}}let{publicKey:s}=J(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,o,s){let a=N.getTickArrayStartIndexByTick(r,o),c=Math.floor((r-a)/o),u=n[a];if(u==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let l;if(s)for(;c>=0;){let d=u.ticks[c];if(d.liquidityGross.gtn(0)){l=d;break}c=c-1}else for(c=c+1;c<ge;){let d=u.ticks[c];if(d.liquidityGross.gtn(0)){l=d;break}c=c+1}let{publicKey:m}=J(e,t,a);return{initializedTick:l,tickArrayAddress:m,tickArrayStartTickIndex:u.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(N.checkIsOutOfBoundary(e)){if(e>Be)return!1;let n=N.getTickArrayStartIndexByTick(xe,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return ge*e}};var ge=60,dt=512,N=class{static getTickArrayAddressByTick(e,t,n,r){let o=N.getTickArrayStartIndexByTick(n,r),{publicKey:s}=J(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=N.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=ge)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=U.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*U.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*ge,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*ge,o=Math.floor(t/r)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*ge:e+t*ge}static mergeTickArrayBitmap(e){let t=new cs(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,o){let s=Math.floor(r/(n*ge));return[...N.searchLowBitFromStart(e,t,s-1,o,n),...N.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return N.searchHightBitFromStart(e,t,0,dt,n)}static getAllInitializedTickArrayInfo(e,t,n,r,o){let s=[],a=N.getAllInitializedTickArrayStartIndex(n,r,o);for(let c of a){let{publicKey:u}=J(e,t,c);s.push({tickArrayStartIndex:c,tickArrayAddress:u})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(u=>N.mergeTickArrayBitmap(u)),a=[];for(;n>=-7680;){let u=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[u].testn(l)&&a.push(n),n--,a.length===r)break}let c=U.tickCount(o);return a.map(u=>u*c)}static searchHightBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(u=>N.mergeTickArrayBitmap(u)),a=[];for(;n<7680;){let u=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[u].testn(l)&&a.push(n),n++,a.length===r)break}let c=U.tickCount(o);return a.map(u=>u*c)}static checkIsOutOfBoundary(e){return e<xe||e>Be}static nextInitTick(e,t,n,r,o){if(U.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(r)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<ge;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=ge-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<ge;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=O.getSqrtPriceX64FromTick(t),o=O.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new S(1).div(o),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new S(1).div(t),o=ft.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=O.getSqrtPriceX64FromTick(o),a=O.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new S(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=O.getSqrtPriceX64FromTick(t),o=O.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new S(1).div(o),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new S(1).div(t),o=ft.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=O.getSqrtPriceX64FromTick(o),a=O.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new S(1).div(a)}}};import je from"bn.js";var Vt=class{static getfeeGrowthInside(e,t,n){let r=new je(0),o=new je(0);e.tickCurrent>=t.tick?(r=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new je(0),a=new je(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let c=D.wrappingSubU128(D.wrappingSubU128(e.feeGrowthGlobalX64A,r),s),u=D.wrappingSubU128(D.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:c,feeGrowthInsideBX64:u}}static GetPositionFees(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=D.mulDivFloor(D.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Ke),c=t.tokenFeesOwedA.add(a),u=D.mulDivFloor(D.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Ke),l=t.tokenFeesOwedB.add(u);return{tokenFeeAmountA:c,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=D.mulDivFloor(D.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Ke),c=t.tokenFeesOwedA.add(a),u=D.mulDivFloor(D.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Ke),l=t.tokenFeesOwedB.add(u);return{tokenFeeAmountA:c,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,r){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let c=s[a],u=t.rewardInfos[a],l=D.wrappingSubU128(c,u.growthInsideLastX64),m=D.mulDivFloor(l,t.liquidity,Ke),d=u.rewardAmountOwed.add(m);o.push(d)}return o}static GetPositionRewards(e,t,n,r){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let c=s[a],u=t.rewardInfos[a],l=D.wrappingSubU128(c,u.growthInsideLastX64),m=D.mulDivFloor(l,t.liquidity,Ke),d=u.rewardAmountOwed.add(m);o.push(d)}return o}static getRewardGrowthInside(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new je(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let c=new je(0);n.liquidityGross.eqn(0)||(e<n.tick?c=n.rewardGrowthsOutsideX64[s]:c=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(D.wrappingSubU128(D.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),c))}return o}static getRewardGrowthInsideV2(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new je(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let c=new je(0);n.liquidityGross.eqn(0)||(e<n.tick?c=n.rewardGrowthsOutsideX64[s]:c=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(D.wrappingSubU128(D.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),c))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:r,add:o,epochInfo:s}){var y,b,h,w;let a=O.priceToSqrtPriceX64(new S(e.price),e.mintA.decimals,e.mintB.decimals),c=O.getSqrtPriceX64FromTick(t.tickLower),u=O.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+r:1-r,m=H.getAmountsFromLiquidity(a,c,u,n,o),[d,f]=[oe(m.amountA,(y=e.mintA.extensions)==null?void 0:y.feeConfig,s,!0),oe(m.amountB,(b=e.mintB.extensions)==null?void 0:b.feeConfig,s,!0)],[g,p]=[oe(new je(new S(m.amountA.toString()).mul(l).toFixed(0)),(h=e.mintA.extensions)==null?void 0:h.feeConfig,s,!0),oe(new je(new S(m.amountB.toString()).mul(l).toFixed(0)),(w=e.mintB.extensions)==null?void 0:w.feeConfig,s,!0)];return{liquidity:n,amountA:d,amountB:f,amountSlippageA:g,amountSlippageB:p,expirationTime:at(d.expirationTime,f.expirationTime)}}};import{TOKEN_2022_PROGRAM_ID as er}from"@solana/spl-token";var le=class{static getOutputAmountAndRemainAccounts(e,t,n,r,o,s=!1){let a=n.toBase58()===e.mintA.address,c=[],{isExist:u,startIndex:l,nextAccountMeta:m}=this.getFirstInitializedTickArray(e,a);if(!u||l===void 0||!m)throw new Error("Invalid tick array");c.push(m);let{allTrade:d,amountCalculated:f,accounts:g,sqrtPriceX64:p,feeAmount:y}=pt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,a,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r,l,o,s);return c.push(...g),{allTrade:d,expectedAmountOut:f.mul(Je),remainingAccounts:c,executionPrice:p,feeAmount:y}}static getInputAmountAndRemainAccounts(e,t,n,r,o){let s=n.toBase58()===e.mintB.address,a=[],{isExist:c,startIndex:u,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!c||u===void 0||!l)throw new Error("Invalid tick array");try{let p=this.preInitializedTickArrayStartIndex(e,s);if(p.isExist){let{publicKey:y}=J(e.programId,e.id,p.nextStartIndex);a.push(y)}}catch{}a.push(l);let{amountCalculated:m,accounts:d,sqrtPriceX64:f,feeAmount:g}=pt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r.mul(Je),u,o);return a.push(...d),{expectedAmountIn:m,remainingAccounts:a,executionPrice:f,feeAmount:g}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:r}=le.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?qt.checkTickArrayIsInit(U.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):N.checkTickArrayIsInitialized(N.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=J(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,U.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=J(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/U.tickCount(e.tickSpacing)),r=t?N.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):N.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=U.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:r,tickIndex:o}=$e.nextInitializedTickArrayStartIndex(N.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(r)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=qt.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<xe||t>Be)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:r,rewardInfos:o}){var a,c,u;let s=[];for(let l=0;l<o.length;l++){let m=o[l],d=(u=(a=t.rewardDefaultInfos[l])==null?void 0:a.mint.programId)!=null?u:(c=await e.getAccountInfo(m.tokenMint))==null?void 0:c.owner;if(d===void 0)throw Error("get new reward mint info error");let f=G(C({},m),{perSecond:D.x64ToDecimal(m.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new ve(d)});if(f.tokenMint.equals(ve.default))continue;if(n<=f.openTime.toNumber()||r.eq(se)){s.push(f);continue}let g=new ie(Math.min(f.endTime.toNumber(),n)),p=g.sub(f.lastUpdateTime),y=D.mulDivFloor(p,f.emissionsPerSecondX64,r),b=f.rewardGrowthGlobalX64.add(y),h=D.mulDivFloor(p,f.emissionsPerSecondX64,Ke),w=f.rewardTotalEmissioned.add(h);s.push(G(C({},f),{rewardGrowthGlobalX64:b,rewardTotalEmissioned:w,lastUpdateTime:g}))}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:r}=this.tickRange(e);for(let o of t){let s=N.getTickArrayStartIndexByTick(o,e);if(s>=n||s<r)return!0}return!1}static tickRange(e){let t=$e.maxTickInTickarrayBitmap(e),n=-t;return t>Be&&(t=U.getArrayStartIndex(Be,e)+U.tickCount(e)),n<xe&&(n=U.getArrayStartIndex(xe,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!U.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/U.tickCount(t)*dt}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let r=await st(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of r)s.accountInfo!==null&&(o[s.pubkey.toString()]=$i.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let r={},o=[];for(let c of t){let u=N.getTickArrayStartIndexByTick(c.tickCurrent,c.tickSpacing),l=N.getInitializedTickArrayInRange(c.tickArrayBitmap,c.exBitmapInfo,c.tickSpacing,u,7);for(let m of l){let{publicKey:d}=J(c.programId,c.id,m);o.push({pubkey:d}),r[d.toString()]=c.id}}let s=await st(e,o,{batchRequest:n}),a={};for(let c of s){if(!c.accountInfo)continue;let u=r[c.pubkey.toString()];if(!u)continue;a[u.toString()]===void 0&&(a[u.toString()]={});let l=Wt.decode(c.accountInfo.data);a[u.toString()][l.startTickIndex]=G(C({},l),{address:c.pubkey})}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:r=!1,updateOwnerRewardAndFee:o=!0}){var a;let s=[];for(let c=0;c<e.length;c++){let u=e[c];u!==null&&(s.find(l=>l.equals(u.state.programId))||s.push(u.state.programId))}if(n){let c=n.tokenAccounts.map(d=>d.accountInfo.mint),u=[];for(let d of c)for(let f of s)u.push(Le(f,d).publicKey);let l=await Qe(t,u,{batchRequest:r}),m={};for(let d of l){if(d===null)continue;let f=pn.decode(d.data),g=f.poolId.toString(),p=e.find(B=>B.state.id.toBase58()===g);if(p===void 0)continue;let y=p.state,b=N._getTickPriceLegacy({poolInfo:y,tick:f.tickLower,baseIn:!0}),h=N._getTickPriceLegacy({poolInfo:y,tick:f.tickUpper,baseIn:!0}),{amountA:w,amountB:A}=H.getAmountsFromLiquidity(y.sqrtPriceX64,b.tickSqrtPriceX64,h.tickSqrtPriceX64,f.liquidity,!1),k=1/(1-Math.sqrt(Math.sqrt(b.price.div(h.price).toNumber())));p.positionAccount=[...(a=p.positionAccount)!=null?a:[],{poolId:f.poolId,nftMint:f.nftMint,priceLower:b.price,priceUpper:h.price,amountA:w,amountB:A,tickLower:f.tickLower,tickUpper:f.tickUpper,liquidity:f.liquidity,feeGrowthInsideLastX64A:f.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:f.feeGrowthInsideLastX64B,tokenFeesOwedA:f.tokenFeesOwedA,tokenFeesOwedB:f.tokenFeesOwedB,rewardInfos:f.rewardInfos.map(B=>G(C({},B),{pendingReward:new ie(0)})),leverage:k,tokenFeeAmountA:new ie(0),tokenFeeAmountB:new ie(0)}];let T=await N.getTickArrayAddressByTick(p.state.programId,f.poolId,f.tickLower,p.state.tickSpacing),x=await N.getTickArrayAddressByTick(p.state.programId,f.poolId,f.tickUpper,p.state.tickSpacing);m[`${p.state.programId.toString()}-${f.poolId.toString()}-${f.tickLower}`]=T,m[`${p.state.programId.toString()}-${f.poolId.toString()}-${f.tickUpper}`]=x}if(o){let d=Object.values(m),f=await Qe(t,d,{batchRequest:r}),g={};for(let p=0;p<d.length;p++){let y=f[p];if(y===null)continue;let b=d[p].toString();g[b]=Wt.decode(y.data)}for(let{state:p,positionAccount:y}of e)if(!!y)for(let b of y){let h=`${p.programId.toString()}-${p.id.toString()}-${b.tickLower}`,w=`${p.programId.toString()}-${p.id.toString()}-${b.tickUpper}`,A=g[m[h].toString()],k=g[m[w].toString()],T=A.ticks[N.getTickOffsetInArray(b.tickLower,p.tickSpacing)],x=k.ticks[N.getTickOffsetInArray(b.tickUpper,p.tickSpacing)],{tokenFeeAmountA:B,tokenFeeAmountB:M}=await Vt.GetPositionFees(p,b,T,x),L=await Vt.GetPositionRewards(p,b,T,x);b.tokenFeeAmountA=B.gte(new ie(0))?B:new ie(0),b.tokenFeeAmountB=M.gte(new ie(0))?M:new ie(0);for(let R=0;R<L.length;R++)b.rewardInfos[R].pendingReward=L[R].gte(new ie(0))?L[R]:new ie(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountIn:o,slippage:s,priceLimit:a=new S(0),catchLiquidityInsufficient:c=!1}){var Z;let u,l=n.toBase58()===e.mintA.address,[m,d]=l?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];a.equals(new S(0))?u=l?ze.add(new ie(1)):He.sub(new ie(1)):u=O.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let f=oe(o,m,r,!1),{allTrade:g,expectedAmountOut:p,remainingAccounts:y,executionPrice:b,feeAmount:h}=le.getOutputAmountAndRemainAccounts(e,t,n,f.amount.sub((Z=f.fee)!=null?Z:se),u,c),w=oe(p,d,r,!1),A=O.sqrtPriceX64ToPrice(b,e.mintA.decimals,e.mintB.decimals),k=l?A:new S(1).div(A),T=p.mul(new ie(Math.floor((1-s)*1e10))).div(new ie(1e10)),x=oe(T,d,r,!1),B=l?e.currentPrice:new S(1).div(e.currentPrice),M=new S(k).sub(B).abs(),L=B,R=new ot(new S(M).mul(10**15).toFixed(0),new S(L).mul(10**15).toFixed(0));return{allTrade:g,realAmountIn:f,amountOut:w,minAmountOut:x,expirationTime:at(f.expirationTime,w.expirationTime),currentPrice:e.currentPrice,executionPrice:k,priceImpact:R,fee:h,remainingAccounts:y,executionPriceX64:b}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:r,slippage:o,epochInfo:s,catchLiquidityInsufficient:a=!1}){let c=r.address===e.mintB.address,[u,l]=c?[e.mintA,e.mintB]:[e.mintB,e.mintA],[m,d]=[new Ge(G(C({},u),{mint:u.address,isToken2022:u.programId===er.toBase58()})),new Ge(G(C({},l),{mint:l.address,isToken2022:l.programId===er.toBase58()}))],{allTrade:f,realAmountIn:g,amountOut:p,minAmountOut:y,expirationTime:b,currentPrice:h,executionPrice:w,priceImpact:A,fee:k,remainingAccounts:T,executionPriceX64:x}=le.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new ve(u.address),amountIn:n,slippage:o,epochInfo:s,catchLiquidityInsufficient:a}),B=G(C({},g),{amount:new Ae(m,g.amount),fee:g.fee===void 0?void 0:new Ae(m,g.fee)}),M=G(C({},p),{amount:new Ae(d,p.amount),fee:p.fee===void 0?void 0:new Ae(d,p.fee)}),L=G(C({},y),{amount:new Ae(d,y.amount),fee:y.fee===void 0?void 0:new Ae(d,y.fee)}),R=new De({baseToken:m,denominator:new ie(10).pow(new ie(20+m.decimals)),quoteToken:d,numerator:h.mul(new S(10**(20+d.decimals))).toFixed(0)}),Z=new De({baseToken:m,denominator:new ie(10).pow(new ie(20+m.decimals)),quoteToken:d,numerator:w.mul(new S(10**(20+d.decimals))).toFixed(0)}),ee=new Ae(m,k);return{allTrade:f,realAmountIn:B,amountOut:M,minAmountOut:L,expirationTime:b,currentPrice:R,executionPrice:Z,priceImpact:A,fee:ee,remainingAccounts:T,executionPriceX64:x}}static computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountOut:o,slippage:s,priceLimit:a=new S(0)}){var L;let c=n.toBase58()===e.mintA.address,u={[e.mintA.address]:e.mintA.extensions.feeConfig,[e.mintB.address]:e.mintB.extensions.feeConfig},l;a.equals(new S(0))?l=c?He.sub(new ie(1)):ze.add(new ie(1)):l=O.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let m=oe(o,u[n.toString()],r,!0),{expectedAmountIn:d,remainingAccounts:f,executionPrice:g,feeAmount:p}=le.getInputAmountAndRemainAccounts(e,t,n,m.amount.sub((L=m.fee)!=null?L:se),l),y=c?e.mintB.address:e.mintA.address,b=oe(d,u[y],r,!1),h=O.sqrtPriceX64ToPrice(g,e.mintA.decimals,e.mintB.decimals),w=c?h:new S(1).div(h),A=d.mul(new ie(Math.floor((1+s)*1e10))).div(new ie(1e10)),k=oe(A,u[y],r,!0),T=c?e.currentPrice:new S(1).div(e.currentPrice),x=new S(w).sub(T).abs(),B=T,M=new ot(new S(x).mul(10**15).toFixed(0),new S(B).mul(10**15).toFixed(0));return{amountIn:b,maxAmountIn:k,realAmountOut:m,expirationTime:at(b.expirationTime,m.expirationTime),currentPrice:e.currentPrice,executionPrice:w,priceImpact:M,fee:p,remainingAccounts:f}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:r}){var g,p,y;let o=e[t],s=N.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=N.getTickPrice({poolInfo:e,tick:r,baseIn:!0}).price.toNumber(),c=Math.max(s,o.priceMin),l=Math.min(a,o.priceMax)-c,m=a-s,d=o.priceMax-o.priceMin,f;return l<=0?f=0:m===l?f=d/l:d===l?f=l/m:f=l/d*(l/m),{feeApr:o.feeApr*f,rewardsApr:[((g=o.rewardApr[0])!=null?g:0)*f,((p=o.rewardApr[1])!=null?p:0)*f,((y=o.rewardApr[2])!=null?y:0)*f],apr:o.apr*f}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:r,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:c}){let u=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],m=r[ut(e.mintA.address).toString()],d=r[ut(e.mintB.address).toString()],f=e.mintA.decimals,g=e.mintB.decimals;if(!l||!m||!d)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let p=O.priceToSqrtPriceX64(new S(e.price),e.mintA.decimals,e.mintB.decimals),y=O.getSqrtPriceX64FromTick(s),b=O.getSqrtPriceX64FromTick(a),{amountSlippageA:h,amountSlippageB:w}=H.getAmountsFromLiquidityWithSlippage(p,y,b,t,!1,!1,0),{amountSlippageA:A,amountSlippageB:k}=H.getAmountsFromLiquidityWithSlippage(p,y,b,o,!1,!1,0),T=new S(h.toString()).div(new S(10).pow(f)).mul(m.value).add(new S(w.toString()).div(new S(10).pow(g)).mul(d.value)),x=new S(A.toString()).div(new S(10).pow(f)).mul(m.value).add(new S(k.toString()).div(new S(10).pow(g)).mul(d.value)),B=new S(1).div(T.add(x)),L=new S(l.volumeFee).mul(365).div(u).mul(B).mul(100).toNumber(),R=3600*24*365,Z=e.rewardDefaultInfos.map(ee=>{var Y,Yn;let ce=ee.mint.decimals,te=r[ee.mint.address];return c<((Y=ee.startTime)!=null?Y:0)||c>((Yn=ee.endTime)!=null?Yn:0)||!ee.perSecond||!te||ce===void 0?0:new S(te.value).mul(new S(ee.perSecond).mul(R)).div(new S(10).pow(ce)).mul(B).mul(100).toNumber()});return{feeApr:L,rewardsApr:Z,apr:L+Z.reduce((ee,ce)=>ee+ce,0)}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:r,amount:o,slippage:s,add:a,epochInfo:c,amountHasFee:u}){var b,h;let l=O.priceToSqrtPriceX64(new S(e.price),e.mintA.decimals,e.mintB.decimals),m=O.getSqrtPriceX64FromTick(n),d=O.getSqrtPriceX64FromTick(r),f=a?1-s:1+s,g=oe(o,(b=e[t?"mintA":"mintB"].extensions)==null?void 0:b.feeConfig,c,!u),p=new ie(new S(g.amount.sub((h=g.fee)!=null?h:se).toString()).mul(f).toFixed(0)),y;if(l.lte(m))y=t?H.getLiquidityFromTokenAmountA(m,d,p,!a):new ie(0);else if(l.lte(d)){let w=H.getLiquidityFromTokenAmountA(l,d,p,!a),A=H.getLiquidityFromTokenAmountB(m,l,p);y=t?w:A}else y=t?new ie(0):H.getLiquidityFromTokenAmountB(m,d,p);return le.getAmountsFromLiquidity({epochInfo:c,poolInfo:e,tickLower:n,tickUpper:r,liquidity:y,slippage:s,add:a})}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:r,liquidity:o,slippage:s,add:a}){var y,b,h,w;let c=O.getSqrtPriceX64FromTick(n),u=O.getSqrtPriceX64FromTick(r),l=a?1+s:1-s,m=H.getAmountsFromLiquidity(O.priceToSqrtPriceX64(new S(t.price),t.mintA.decimals,t.mintB.decimals),c,u,o,a),[d,f]=[oe(m.amountA,(y=t.mintA.extensions)==null?void 0:y.feeConfig,e,!0),oe(m.amountB,(b=t.mintB.extensions)==null?void 0:b.feeConfig,e,!0)],[g,p]=[oe(m.amountA.muln(l),(h=t.mintA.extensions)==null?void 0:h.feeConfig,e,!0),oe(m.amountB.muln(l),(w=t.mintB.extensions)==null?void 0:w.feeConfig,e,!0)];return{liquidity:o,amountA:d,amountB:f,amountSlippageA:g,amountSlippageB:p,expirationTime:at(d.expirationTime,f.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let r=t.filter(c=>!n[c.id]).map(c=>new ve(c.id));(await Qe(e,r)).forEach((c,u)=>{!c||(n[r[u].toBase58()]=fn.decode(c.data))});let s=t.map(c=>Me(new ve(c.programId),new ve(c.id)).publicKey),a=await le.fetchExBitmaps({connection:e,exBitmapAddress:s,batchRequest:!1});return t.reduce((c,u)=>G(C({},c),{[u.id]:G(C({},n[u.id]),{id:new ve(u.id),version:6,programId:new ve(u.programId),mintA:u.mintA,mintB:u.mintB,ammConfig:G(C({},u.config),{id:new ve(u.config.id),fundOwner:""}),currentPrice:new S(u.price),exBitmapInfo:a[Me(new ve(u.programId),new ve(u.id)).publicKey.toBase58()],startTime:n[u.id].startTime.toNumber()})}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};var Hn={volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[]};function tr(i){return G(C({},i),{type:"Concentrated",programId:i.programId.toString(),id:i.id.toString(),rewardDefaultInfos:[],rewardDefaultPoolInfos:"Clmm",price:i.currentPrice.toNumber(),mintAmountA:0,mintAmountB:0,feeRate:i.ammConfig.tradeFeeRate,openTime:i.startTime.toString(),tvl:0,day:Hn,week:Hn,month:Hn,pooltype:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0,config:G(C({},i.ammConfig),{id:i.ammConfig.id.toString(),defaultRange:0,defaultRangePoint:[]})})}var D=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),o=r.div(n);return r.mod(n).eq(se)||(o=o.add(Xe)),o}static mulDivFloor(e,t,n){if(n.eq(se))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(se))throw new Error("division by 0");return e.mul(t).add(n.sub(Xe)).div(n)}static x64ToDecimal(e,t){return new S(e.toString()).div(S.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new V(e.mul(S.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(cn).sub(t).mod(cn)}};function be(i,e){return Zn(i.mul(e),64,256)}function us(i,e,t){let n=i.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function Zn(i,e,t){let n=i.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var O=class{static sqrtPriceX64ToPrice(e,t,n){return D.x64ToDecimal(e).pow(2).mul(S.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return D.decimalToX64(e.mul(S.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(se))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(se))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(se))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(se))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(se))return e;let o=t.shln(Ft);if(r){let s=o,a=o.add(n.mul(e));return a.gte(s)?D.mulDivCeil(s,e,a):D.mulDivRoundingUp(s,Xe,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return D.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let o=n.shln(Ft);if(r)return e.add(o.div(t));{let s=D.mulDivRoundingUp(o,Xe,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<xe||e>Be)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new V("18445821805675395072"):new V("18446744073709551616");return(t&2)!=0&&(n=be(n,new V("18444899583751176192"))),(t&4)!=0&&(n=be(n,new V("18443055278223355904"))),(t&8)!=0&&(n=be(n,new V("18439367220385607680"))),(t&16)!=0&&(n=be(n,new V("18431993317065453568"))),(t&32)!=0&&(n=be(n,new V("18417254355718170624"))),(t&64)!=0&&(n=be(n,new V("18387811781193609216"))),(t&128)!=0&&(n=be(n,new V("18329067761203558400"))),(t&256)!=0&&(n=be(n,new V("18212142134806163456"))),(t&512)!=0&&(n=be(n,new V("17980523815641700352"))),(t&1024)!=0&&(n=be(n,new V("17526086738831433728"))),(t&2048)!=0&&(n=be(n,new V("16651378430235570176"))),(t&4096)!=0&&(n=be(n,new V("15030750278694412288"))),(t&8192)!=0&&(n=be(n,new V("12247334978884435968"))),(t&16384)!=0&&(n=be(n,new V("8131365268886854656"))),(t&32768)!=0&&(n=be(n,new V("3584323654725218816"))),(t&65536)!=0&&(n=be(n,new V("696457651848324352"))),(t&131072)!=0&&(n=be(n,new V("26294789957507116"))),(t&262144)!=0&&(n=be(n,new V("37481735321082"))),e>0&&(n=Ri.div(n)),n}static getTickFromPrice(e,t,n){return O.getTickFromSqrtPriceX64(O.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(He)||e.lt(ze))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new V(t-64),r=us(n,32,128),o=new V("8000000000000000","hex"),s=0,a=new V(0),c=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new V(0))&&s<Li;){c=c.mul(c);let g=c.shrn(127);c=c.shrn(63+g.toNumber()),a=a.add(o.mul(g)),o=o.shrn(1),s+=1}let u=a.shrn(32),m=r.add(u).mul(new V(Mi)),d=Zn(m.sub(new V(Ei)),64,128).toNumber(),f=Zn(m.add(new V(Oi)),64,128).toNumber();return d==f?d:O.getSqrtPriceX64FromTick(f).lte(e)?f:d}},ft=class{static getTickWithPriceAndTickspacing(e,t,n,r){let s=O.getTickFromSqrtPriceX64(O.priceToSqrtPriceX64(e,n,r))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,r){let o=ft.getTickWithPriceAndTickspacing(e,t,n,r),s=O.getSqrtPriceX64FromTick(o);return O.sqrtPriceX64ToPrice(s,n,r)}},H=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(se))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(Ft),s=t.sub(e);return r?D.mulDivRoundingUp(D.mulDivCeil(o,s,t),Xe,e):D.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(se))throw new Error("sqrtPriceX64A must greater than 0");return r?D.mulDivCeil(n,t.sub(e),Ke):D.mulDivFloor(n,t.sub(e),Ke)}static getLiquidityFromTokenAmountA(e,t,n,r){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return r?D.mulDivRoundingUp(a,Xe,vn):a.shrn(Ft)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),D.mulDivFloor(n,vn,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return H.getLiquidityFromTokenAmountA(t,n,r,!1);if(e.lt(n)){let s=H.getLiquidityFromTokenAmountA(e,n,r,!1),a=H.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return H.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:H.getTokenAmountAFromLiquidity(t,n,r,o),amountB:new V(0)};if(e.lt(n)){let s=H.getTokenAmountAFromLiquidity(e,n,r,o),a=H.getTokenAmountBFromLiquidity(t,e,r,o);return{amountA:s,amountB:a}}else return{amountA:new V(0),amountB:H.getTokenAmountBFromLiquidity(t,n,r,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,r,o,s,a){let{amountA:c,amountB:u}=H.getAmountsFromLiquidity(e,t,n,r,s),l=o?1+a:1-a,m=new V(new S(c.toString()).mul(l).toFixed(0)),d=new V(new S(u.toString()).mul(l).toFixed(0));return{amountSlippageA:m,amountSlippageB:d}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:r,slippage:o,add:s,epochInfo:a,amountAddFee:c}){var h,w,A,k;let u=O.priceToSqrtPriceX64(new S(e.price),e.mintA.decimals,e.mintB.decimals),l=O.getSqrtPriceX64FromTick(t),m=O.getSqrtPriceX64FromTick(n),d=s?1+o:1-o,f=H.getAmountsFromLiquidity(u,l,m,r,s),[g,p]=[oe(f.amountA,(h=e.mintA.extensions)==null?void 0:h.feeConfig,a,c),oe(f.amountB,(w=e.mintB.extensions)==null?void 0:w.feeConfig,a,c)],[y,b]=[oe(new V(new S(f.amountA.toString()).mul(d).toFixed(0)),(A=e.mintA.extensions)==null?void 0:A.feeConfig,a,c),oe(new V(new S(f.amountB.toString()).mul(d).toFixed(0)),(k=e.mintB.extensions)==null?void 0:k.feeConfig,a,c)];return{liquidity:r,amountA:g,amountB:p,amountSlippageA:y,amountSlippageB:b,expirationTime:at(g.expirationTime,p.expirationTime)}}},pt=class{static swapCompute(e,t,n,r,o,s,a,c,u,l,m,d,f,g,p=!1){if(d.eq(se))throw new Error("amountSpecified must not be 0");if(g||(g=s?ze.add(Xe):He.sub(Xe)),s){if(g.lt(ze))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(g.gte(m))throw new Error("sqrtPriceX64 must smaller than current")}else{if(g.gt(He))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(g.lte(m))throw new Error("sqrtPriceX64 must greater than current")}let y=d.gt(se),b={amountSpecifiedRemaining:d,amountCalculated:se,sqrtPriceX64:m,tick:u>f?Math.min(f+U.tickCount(l)-1,u):f,accounts:[],liquidity:c,feeAmount:new V(0)},h=f,w=n[f],A=0,k=!s&&w.startTickIndex===b.tick;for(;!b.amountSpecifiedRemaining.eq(se)&&!b.sqrtPriceX64.eq(g);){A>10;let T={};T.sqrtPriceStartX64=b.sqrtPriceX64;let x=N.nextInitTick(w,b.tick,l,s,k),B=x||null,M=null;if(!(B!=null&&B.liquidityGross.gtn(0))){let R=le.nextInitializedTickArrayStartIndex({tickCurrent:b.tick,tickSpacing:l,tickArrayBitmap:r,exBitmapInfo:o},h,s);if(!R.isExist){if(p)return{allTrade:!1,amountSpecifiedRemaining:b.amountSpecifiedRemaining,amountCalculated:b.amountCalculated,feeAmount:b.feeAmount,sqrtPriceX64:b.sqrtPriceX64,liquidity:b.liquidity,tickCurrent:b.tick,accounts:b.accounts};throw Error("swapCompute LiquidityInsufficient")}h=R.nextStartIndex;let{publicKey:Z}=J(e,t,h);M=Z,w=n[h];try{B=N.firstInitializedTick(w,s)}catch{throw Error("not found next tick info")}}T.tickNext=B.tick,T.initialized=B.liquidityGross.gtn(0),f!==h&&M&&(b.accounts.push(M),f=h),T.tickNext<xe?T.tickNext=xe:T.tickNext>Be&&(T.tickNext=Be),T.sqrtPriceNextX64=O.getSqrtPriceX64FromTick(T.tickNext);let L;if(s&&T.sqrtPriceNextX64.lt(g)||!s&&T.sqrtPriceNextX64.gt(g)?L=g:L=T.sqrtPriceNextX64,[b.sqrtPriceX64,T.amountIn,T.amountOut,T.feeAmount]=pt.swapStepCompute(b.sqrtPriceX64,L,b.liquidity,b.amountSpecifiedRemaining,a),b.feeAmount=b.feeAmount.add(T.feeAmount),y?(b.amountSpecifiedRemaining=b.amountSpecifiedRemaining.sub(T.amountIn.add(T.feeAmount)),b.amountCalculated=b.amountCalculated.sub(T.amountOut)):(b.amountSpecifiedRemaining=b.amountSpecifiedRemaining.add(T.amountOut),b.amountCalculated=b.amountCalculated.add(T.amountIn.add(T.feeAmount))),b.sqrtPriceX64.eq(T.sqrtPriceNextX64)){if(T.initialized){let R=B.liquidityNet;s&&(R=R.mul(Je)),b.liquidity=H.addDelta(b.liquidity,R)}k=T.tickNext!=b.tick&&!s&&w.startTickIndex===T.tickNext,b.tick=s?T.tickNext-1:T.tickNext}else if(b.sqrtPriceX64!=T.sqrtPriceStartX64){let R=O.getTickFromSqrtPriceX64(b.sqrtPriceX64);k=R!=b.tick&&!s&&w.startTickIndex===R,b.tick=R}++A}try{let{nextStartIndex:T,isExist:x}=U.nextInitializedTickArray(b.tick,l,s,r,o);x&&f!==T&&(b.accounts.push(J(e,t,T).publicKey),f=T)}catch{}return{allTrade:!0,amountSpecifiedRemaining:se,amountCalculated:b.amountCalculated,feeAmount:b.feeAmount,sqrtPriceX64:b.sqrtPriceX64,liquidity:b.liquidity,tickCurrent:b.tick,accounts:b.accounts}}static swapStepCompute(e,t,n,r,o){let s={sqrtPriceX64Next:new V(0),amountIn:new V(0),amountOut:new V(0),feeAmount:new V(0)},a=e.gte(t),c=r.gte(se);if(c){let l=D.mulDivFloor(r,un.sub(new V(o.toString())),un);s.amountIn=a?H.getTokenAmountAFromLiquidity(t,e,n,!0):H.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=O.getNextSqrtPriceX64FromInput(e,n,l,a)}else s.amountOut=a?H.getTokenAmountBFromLiquidity(t,e,n,!1):H.getTokenAmountAFromLiquidity(e,t,n,!1),r.mul(Je).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=O.getNextSqrtPriceX64FromOutput(e,n,r.mul(Je),a);let u=t.eq(s.sqrtPriceX64Next);return a?(u&&c||(s.amountIn=H.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),u&&!c||(s.amountOut=H.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=u&&c?s.amountIn:H.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=u&&!c?s.amountOut:H.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!c&&s.amountOut.gt(r.mul(Je))&&(s.amountOut=r.mul(Je)),c&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=r.sub(s.amountIn):s.feeAmount=D.mulDivCeil(s.amountIn,new V(o),un.sub(new V(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};import{ASSOCIATED_TOKEN_PROGRAM_ID as nr,TOKEN_2022_PROGRAM_ID as ct,TOKEN_PROGRAM_ID as Pe}from"@solana/spl-token";import{Keypair as jn,PublicKey as I,SystemProgram as Gt,TransactionInstruction as qe}from"@solana/web3.js";import ir from"bn.js";Qi.span;var rr=we("Raydium_Clmm"),We={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},me=class{static createPoolInstruction(e,t,n,r,o,s,a,c,u,l,m,d,f,g){let p=ne([z("sqrtPriceX64"),F("startTime")]),y=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:Gt.programId,isSigner:!1,isWritable:!1},{pubkey:Bt,isSigner:!1,isWritable:!1}],b=Buffer.alloc(p.span);p.encode({sqrtPriceX64:f,startTime:g},b);let h=Buffer.from([...We.createPool,...b]);return new qe({keys:y,programId:e,data:h})}static async createPoolInstructions(e){let{programId:t,owner:n,mintA:r,mintB:o,ammConfigId:s,initialPriceX64:a,startTime:c}=e,[u,l]=[new I(r.address),new I(o.address)],{publicKey:m}=qi(t,s,u,l),{publicKey:d}=Vi(t,m),{publicKey:f}=Vn(t,m,u),{publicKey:g}=Vn(t,m,l),p=[this.createPoolInstruction(t,m,n,s,d,u,f,new I(r.programId||Pe),l,g,new I(o.programId||Pe),Me(t,m).publicKey,a,c)];return{signers:[],instructions:p,instructionTypes:[ue.CreateAccount,ue.ClmmCreatePool],address:{poolId:m,observationId:d,mintAVault:f,mintBVault:g},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,r,o,s,a,c,u,l,m,d,f,g,p,y,b,h,w,A,k,T,x,B,M,L){let R=ne([Te("tickLowerIndex"),Te("tickUpperIndex"),Te("tickArrayLowerStartIndex"),Te("tickArrayUpperStartIndex"),z("liquidity"),F("amountMaxA"),F("amountMaxB"),Ze("withMetadata"),fe("optionBaseFlag"),Ze("baseFlag")]),Z=[...L?[{pubkey:L,isSigner:!1,isWritable:!0}]:[]],ee=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:Bt,isSigner:!1,isWritable:!1},{pubkey:Gt.programId,isSigner:!1,isWritable:!1},{pubkey:Pe,isSigner:!1,isWritable:!1},{pubkey:nr,isSigner:!1,isWritable:!1},{pubkey:wt,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...Z],ce=Buffer.alloc(R.span);R.encode({tickLowerIndex:h,tickUpperIndex:w,tickArrayLowerStartIndex:A,tickArrayUpperStartIndex:k,liquidity:T,amountMaxA:x,amountMaxB:B,withMetadata:M==="create",baseFlag:!1,optionBaseFlag:0},ce);let te=Buffer.from([...We.openPosition,...ce]);return new qe({keys:ee,programId:e,data:te})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:c,withMetadata:u,getEphemeralSigners:l}){let m=[],[d,f]=[new I(e.programId),new I(e.id)],g;if(l)g=new I((await l(1))[0]);else{let B=jn.generate();m.push(B),g=B.publicKey}let p=N.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=N.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:b}=J(d,f,p),{publicKey:h}=J(d,f,y),{publicKey:w}=Ue(n.wallet,g,Pe),{publicKey:A}=mn(g),{publicKey:k}=Le(d,g),{publicKey:T}=mt(d,f,r,o),x=this.openPositionFromLiquidityInstruction(d,n.feePayer,f,n.wallet,g,w,A,T,b,h,k,n.tokenAccountA,n.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),r,o,p,y,s,a,c,u);return{signers:m,instructions:[x],instructionTypes:[ue.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:g,tickArrayLower:b,tickArrayUpper:h,positionNftAccount:w,metadataAccount:A,personalPosition:k,protocolPosition:T}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:c,withMetadata:u,getEphemeralSigners:l}){let m=[],[d,f]=[new I(e.programId),new I(e.id)],g;if(l)g=new I((await l(1))[0]);else{let B=jn.generate();m.push(B),g=B.publicKey}let p=N.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=N.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:b}=J(d,f,p),{publicKey:h}=J(d,f,y),{publicKey:w}=Ue(n.wallet,g,Pe),{publicKey:A}=mn(g),{publicKey:k}=Le(d,g),{publicKey:T}=mt(d,f,r,o),x=this.openPositionFromBaseInstruction(d,n.feePayer,f,n.wallet,g,w,A,T,b,h,k,n.tokenAccountA,n.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),r,o,p,y,u,s,a,c,le.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[p,y])?Me(d,f).publicKey:void 0);return{address:{nftMint:g,tickArrayLower:b,tickArrayUpper:h,positionNftAccount:w,metadataAccount:A,personalPosition:k,protocolPosition:T},instructions:[x],signers:m,instructionTypes:[ue.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,r,o,s,a,c,u,l,m,d,f,g,p,y,b,h,w,A,k,T,x,B,M,L){let R=ne([Te("tickLowerIndex"),Te("tickUpperIndex"),Te("tickArrayLowerStartIndex"),Te("tickArrayUpperStartIndex"),z("liquidity"),F("amountMaxA"),F("amountMaxB"),Ze("withMetadata"),fe("optionBaseFlag"),Ze("baseFlag")]),Z=[...L?[{pubkey:L,isSigner:!1,isWritable:!0}]:[]],ee=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:Bt,isSigner:!1,isWritable:!1},{pubkey:Gt.programId,isSigner:!1,isWritable:!1},{pubkey:Pe,isSigner:!1,isWritable:!1},{pubkey:nr,isSigner:!1,isWritable:!1},{pubkey:wt,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...Z],ce=Buffer.alloc(R.span);R.encode({tickLowerIndex:h,tickUpperIndex:w,tickArrayLowerStartIndex:A,tickArrayUpperStartIndex:k,liquidity:new ir(0),amountMaxA:x==="MintA"?B:M,amountMaxB:x==="MintA"?M:B,withMetadata:T==="create",baseFlag:x==="MintA",optionBaseFlag:1},ce);let te=Buffer.from([...We.openPosition,...ce]);return new qe({keys:ee,programId:e,data:te})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:c,withMetadata:u,getEphemeralSigners:l}){let m,d=[];if(l)m=new I((await l(1))[0]);else{let B=jn.generate();d.push(B),m=B.publicKey}let[f,g]=[new I(e.programId),new I(e.id)],p=N.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=N.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:b}=J(f,g,p),{publicKey:h}=J(f,g,y),{publicKey:w}=Ue(n.wallet,m,Pe),{publicKey:A}=mn(m),{publicKey:k}=Le(f,m),{publicKey:T}=mt(f,g,r,o),x=this.openPositionFromLiquidityInstruction(f,n.wallet,g,n.wallet,m,w,A,T,b,h,k,n.tokenAccountA,n.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(t.mintA.address),new I(t.mintB.address),r,o,p,y,s,a,c,u,le.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[p,y])?Me(f,g).publicKey:void 0);return{address:{nftMint:m,tickArrayLower:b,tickArrayUpper:h,positionNftAccount:w,metadataAccount:A,personalPosition:k,protocolPosition:T},instructions:[x],signers:d,instructionTypes:[ue.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,r,o){let s=ne([]),a=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:Gt.programId,isSigner:!1,isWritable:!1},{pubkey:Pe,isSigner:!1,isWritable:!1}],c=Buffer.alloc(s.span);s.encode({},c);let u=Buffer.from([...We.closePosition,...c]);return new qe({keys:a,programId:e,data:u})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:r}){let o=new I(e.programId),{publicKey:s}=Ue(n.wallet,r.nftMint,Pe),{publicKey:a}=Le(o,r.nftMint),c=[];return c.push(this.closePositionInstruction(o,n.wallet,r.nftMint,s,a)),{address:{positionNftAccount:s,personalPosition:a},signers:[],instructions:c,instructionTypes:[ue.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,r,o,s,a,c,u,l,m,d,f,g,p,y,b,h){let w=ne([z("liquidity"),F("amountMaxA"),F("amountMaxB"),fe("optionBaseFlag"),Ze("baseFlag")]),A=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],k=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:Pe,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...A],T=Buffer.alloc(w.span);w.encode({liquidity:p,amountMaxA:y,amountMaxB:b,optionBaseFlag:0,baseFlag:!1},T);let x=Buffer.from([...We.increaseLiquidity,...T]);return new qe({keys:k,programId:e,data:x})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMaxA:s,amountMaxB:a}){let[c,u]=[new I(e.programId),new I(e.id)],l=N.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=N.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=J(c,u,l),{publicKey:f}=J(c,u,m),{publicKey:g}=Ue(r.wallet,n.nftMint,Pe),{publicKey:p}=Le(c,n.nftMint),{publicKey:y}=mt(c,u,n.tickLower,n.tickUpper),b=this.increasePositionFromLiquidityInstruction(c,r.wallet,g,p,u,y,d,f,r.tokenAccountA,r.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),o,s,a,le.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?Me(c,u).publicKey:void 0);return{address:{tickArrayLower:d,tickArrayUpper:f,positionNftAccount:g,personalPosition:p,protocolPosition:y},signers:[],instructions:[b],instructionTypes:[ue.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,base:o,baseAmount:s,otherAmountMax:a}){let[c,u]=[new I(e.programId),new I(e.id)],l=N.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=N.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=J(c,u,l),{publicKey:f}=J(c,u,m),{publicKey:g}=Ue(r.wallet,n.nftMint,Pe),{publicKey:p}=Le(c,n.nftMint),{publicKey:y}=mt(c,u,n.tickLower,n.tickUpper);return{address:{tickArrayLower:d,tickArrayUpper:f,positionNftAccount:g,personalPosition:p,protocolPosition:y},instructions:[this.increasePositionFromBaseInstruction(c,r.wallet,g,p,u,y,d,f,r.tokenAccountA,r.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),o,s,a,le.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?Me(c,u).publicKey:void 0)],signers:[],instructionTypes:[ue.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,r,o,s,a,c,u,l,m,d,f,g,p,y,b,h){let w=ne([z("liquidity"),F("amountMaxA"),F("amountMaxB"),fe("optionBaseFlag"),Ze("baseFlag")]),A=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],k=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:Pe,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...A],T=Buffer.alloc(w.span);w.encode({liquidity:new ir(0),amountMaxA:p==="MintA"?y:b,amountMaxB:p==="MintA"?b:y,baseFlag:p==="MintA",optionBaseFlag:1},T);let x=Buffer.from([...We.increaseLiquidity,...T]);return new qe({keys:k,programId:e,data:x})}static decreaseLiquidityInstruction(e,t,n,r,o,s,a,c,u,l,m,d,f,g,p,y,b,h,w){let A=ne([z("liquidity"),F("amountMinA"),F("amountMinB")]),k=[...w?[{pubkey:w,isSigner:!1,isWritable:!0}]:[],...p.map(M=>[{pubkey:M.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:M.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:M.rewardMint,isSigner:!1,isWritable:!1}]).flat()],T=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:Pe,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:Jt,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...k],x=Buffer.alloc(A.span);A.encode({liquidity:y,amountMinA:b,amountMinB:h},x);let B=Buffer.from([...We.decreaseLiquidity,...x]);return new qe({keys:T,programId:e,data:B})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMinA:s,amountMinB:a,programId:c}){let[u,l]=[new I(e.programId),new I(e.id)],m=N.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=N.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:f}=J(u,l,m),{publicKey:g}=J(u,l,d),{publicKey:p}=Ue(r.wallet,n.nftMint,c),{publicKey:y}=Le(u,n.nftMint),{publicKey:b}=mt(u,l,n.tickLower,n.tickUpper),h=[];for(let A=0;A<e.rewardDefaultInfos.length;A++)h.push({poolRewardVault:new I(t.rewardInfos[A].vault),ownerRewardVault:r.rewardAccounts[A],rewardMint:new I(e.rewardDefaultInfos[A].mint.address)});let w=[];return w.push(this.decreaseLiquidityInstruction(u,r.wallet,p,y,l,b,f,g,r.tokenAccountA,r.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),h,o,s,a,le.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,d])?Me(u,l).publicKey:void 0)),{address:{tickArrayLower:f,tickArrayUpper:g,positionNftAccount:p,personalPosition:y,protocolPosition:b},signers:[],instructions:w,instructionTypes:[ue.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,r,o,s,a,c,u,l,m,d,f,g,p,y,b){let h=ne([F("amount"),F("otherAmountThreshold"),z("sqrtPriceLimitX64"),Ze("isBaseInput")]),w=[...b?[{pubkey:b,isSigner:!1,isWritable:!0}]:[],...m.map(x=>({pubkey:x,isSigner:!1,isWritable:!0}))],A=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:Pe,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:Jt,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...w],k=Buffer.alloc(h.span);h.encode({amount:f,otherAmountThreshold:g,sqrtPriceLimitX64:p,isBaseInput:y},k);let T=Buffer.from([...We.swap,...k]);return new qe({keys:A,programId:e,data:T})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,inputMint:o,amountIn:s,amountOutMin:a,sqrtPriceLimitX64:c,remainingAccounts:u}){let[l,m]=[new I(e.programId),new I(e.id)],[d,f]=[new I(t.vault.A),new I(t.vault.B)],[g,p]=[new I(e.mintA.address),new I(e.mintB.address)],y=e.mintA.address===o.toString(),b=[this.swapInstruction(l,r.wallet,m,new I(e.config.id),y?r.tokenAccountA:r.tokenAccountB,y?r.tokenAccountB:r.tokenAccountA,y?d:f,y?f:d,y?g:p,y?p:g,u,n,s,a,c,!0,Me(l,m).publicKey)];return{signers:[],instructions:b,instructionTypes:[ue.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static makeSwapBaseOutInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,outputMint:o,amountOut:s,amountInMax:a,sqrtPriceLimitX64:c,remainingAccounts:u}){let[l,m]=[new I(e.programId),new I(e.id)],[d,f]=[new I(t.vault.A),new I(t.vault.B)],[g,p]=[new I(e.mintA.address),new I(e.mintB.address)],y=e.mintA.address===o.toBase58(),b=[this.swapInstruction(l,r.wallet,m,new I(e.config.id),y?r.tokenAccountB:r.tokenAccountA,y?r.tokenAccountA:r.tokenAccountB,y?f:d,y?d:f,y?p:g,y?g:p,u,n,s,a,c,!1,Me(l,m).publicKey)];return{signers:[],instructions:b,instructionTypes:[ue.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,r,o,s,a,c,u,l,m,d){let f=ne([F("openTime"),F("endTime"),z("emissionsPerSecondX64")]),g=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:Gt.programId,isSigner:!1,isWritable:!1},{pubkey:Bt,isSigner:!1,isWritable:!1}],p=Buffer.alloc(f.span);f.encode({openTime:he(l),endTime:he(m),emissionsPerSecondX64:d},p);let y=Buffer.from([...We.initReward,...p]);return new qe({keys:g,programId:e,data:y})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new I(e.programId),new I(e.id)],a=Wi(o,s,r.mint).publicKey,c=_t(o).publicKey,u=[this.initRewardInstruction(o,n.wallet,s,c,new I(e.config.id),n.tokenAccount,r.programId,r.mint,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:c},signers:[],instructions:u,instructionTypes:[ue.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,r,o,s,a,c,u,l,m,d){let f=ne([fe("rewardIndex"),z("emissionsPerSecondX64"),F("openTime"),F("endTime")]),g=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:Pe,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0}],p=Buffer.alloc(f.span);f.encode({rewardIndex:u,emissionsPerSecondX64:d,openTime:he(l),endTime:he(m)},p);let y=Buffer.from([...We.setRewardEmissions,...p]);return new qe({keys:g,programId:e,data:y})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new I(e.programId),new I(e.id)],a,c,u;for(let d=0;d<e.rewardDefaultInfos.length;d++)e.rewardDefaultInfos[d].mint.address===r.mint.toString()&&(a=d,c=new I(t.rewardInfos[d].vault),u=new I(t.rewardInfos[d].mint.address));(a===void 0||c===void 0)&&rr.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=_t(o).publicKey,m=[this.setRewardInstruction(o,n.wallet,s,l,new I(e.config.id),n.tokenAccount,c,u,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{rewardVault:c,operationId:l},signers:[],instructions:m,instructionTypes:[ue.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,r,o,s,a){let c=ne([fe("rewardIndex")]),u=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:Pe,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:Jt,isSigner:!1,isWritable:!1}],l=Buffer.alloc(c.span);c.encode({rewardIndex:a},l);let m=Buffer.from([...We.collectReward,...l]);return new qe({keys:u,programId:e,data:m})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:r}){let[o,s]=[new I(e.programId),new I(e.id)],a,c;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===r.toString()&&(a=l,c=new I(t.rewardInfos[l].vault));(a===void 0||c===void 0)&&rr.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let u=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,c,r,a)];return{address:{rewardVault:c},signers:[],instructions:u,instructionTypes:[ue.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}};import Ce from"bn.js";import{AccountLayout as or,TOKEN_PROGRAM_ID as sr}from"@solana/spl-token";var ar=class extends Ot{constructor(e){super(e)}async getClmmPoolKeys(e){return(await this.scope.api.fetchPoolKeysById({idList:[e]}))[0]}async createPool(e){var w;let{programId:t,owner:n=((w=this.scope.owner)==null?void 0:w.publicKey)||v.default,mint1:r,mint2:o,ammConfig:s,initialPrice:a,startTime:c,computeBudgetConfig:u,forerunCreate:l,getObserveState:m,txVersion:d}=e,f=this.createTxBuilder(),[g,p,y]=new Ce(new v(r.address).toBuffer()).gt(new Ce(new v(o.address).toBuffer()))?[o,r,new S(1).div(a)]:[r,o,a],b=O.priceToSqrtPriceX64(y,g.decimals,p.decimals),h=await me.createPoolInstructions({connection:this.scope.connection,programId:t,owner:n,mintA:g,mintB:p,ammConfigId:s.id,initialPriceX64:b,startTime:c,forerunCreate:!m&&l});return f.addInstruction(h),f.addCustomComputeBudget(u),f.versionBuild({txVersion:d,extInfo:{address:G(C({},h.address),{programId:t.toString(),id:h.address.poolId.toString(),mintA:g,mintB:p,openTime:c.toString(),vault:{A:h.address.mintAVault.toString(),B:h.address.mintBVault.toString()},rewardInfos:[],config:{id:s.id.toString(),index:s.index,protocolFeeRate:s.protocolFeeRate,tradeFeeRate:s.tradeFeeRate,tickSpacing:s.tickSpacing,fundFeeRate:s.fundFeeRate,description:s.description,defaultRange:0,defaultRangePoint:[]}}),mockPoolInfo:C({type:"Concentrated",rewardDefaultPoolInfos:"Clmm",id:h.address.poolId.toString(),mintA:g,mintB:p,feeRate:s.tradeFeeRate,openTime:c.toString(),programId:t.toString(),price:y.toNumber(),config:{id:s.id.toString(),index:s.index,protocolFeeRate:s.protocolFeeRate,tradeFeeRate:s.tradeFeeRate,tickSpacing:s.tickSpacing,fundFeeRate:s.fundFeeRate,description:s.description,defaultRange:0,defaultRangePoint:[]}},Fi),forerunCreate:l}})}async openPositionFromBase({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:c,associatedOnly:u=!0,checkCreateATAOwner:l=!1,withMetadata:m="create",getEphemeralSigners:d,computeBudgetConfig:f,txVersion:g}){this.scope.availability.addConcentratedPosition===!1&&this.logAndCreateError("add position feature disabled in your region"),this.scope.checkOwner();let p=this.createTxBuilder(),y=null,b=null,h=n.useSOLBalance&&e.mintA.address===Q.toString(),w=n.useSOLBalance&&e.mintB.address===Q.toString(),[A,k]=s==="MintA"?[a,c]:[c,a],{account:T,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new v(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:h||A.isZero()?{payer:this.scope.ownerPubKey,amount:A}:void 0,skipCloseAccount:!h,notUseTokenAccount:h,associatedOnly:h?!1:u,checkCreateATAOwner:l});T&&(y=T),p.addInstruction(x||{});let{account:B,instructionParams:M}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new v(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:w||k.isZero()?{payer:this.scope.ownerPubKey,amount:k}:void 0,skipCloseAccount:!w,notUseTokenAccount:w,associatedOnly:w?!1:u,checkCreateATAOwner:l});B&&(b=B),p.addInstruction(M||{}),(!y||!b)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",{ownerTokenAccountA:y==null?void 0:y.toBase58(),ownerTokenAccountB:b==null?void 0:b.toBase58()});let L=t||await this.getClmmPoolKeys(e.id),R=await me.openPositionFromBaseInstructions({poolInfo:e,poolKeys:L,ownerInfo:G(C({},n),{feePayer:this.scope.ownerPubKey,wallet:this.scope.ownerPubKey,tokenAccountA:y,tokenAccountB:b}),tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:c,withMetadata:m,getEphemeralSigners:d});return p.addInstruction(R),p.addCustomComputeBudget(f),p.versionBuild({txVersion:g,extInfo:C({},R.address)})}async openPositionFromLiquidity({poolInfo:e,poolKeys:t,ownerInfo:n,amountMaxA:r,amountMaxB:o,tickLower:s,tickUpper:a,liquidity:c,associatedOnly:u=!0,checkCreateATAOwner:l=!1,withMetadata:m="create",txVersion:d,getEphemeralSigners:f}){this.scope.availability.createConcentratedPosition===!1&&this.logAndCreateError("open position feature disabled in your region");let g=this.createTxBuilder(),p=null,y=null,b=n.useSOLBalance&&e.mintA.address===Q.toBase58(),h=n.useSOLBalance&&e.mintB.address===Q.toBase58(),{account:w,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new v(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:b||r.isZero()?{payer:this.scope.ownerPubKey,amount:r}:void 0,skipCloseAccount:!b,notUseTokenAccount:b,associatedOnly:b?!1:u,checkCreateATAOwner:l});w&&(p=w),g.addInstruction(A||{});let{account:k,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new v(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:h||o.isZero()?{payer:this.scope.ownerPubKey,amount:o}:void 0,skipCloseAccount:!h,notUseTokenAccount:h,associatedOnly:h?!1:u,checkCreateATAOwner:l});k&&(y=k),g.addInstruction(T||{}),(p===void 0||y===void 0)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let x=t||await this.getClmmPoolKeys(e.id),B=await me.openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:x,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:p,tokenAccountB:y},tickLower:s,tickUpper:a,liquidity:c,amountMaxA:r,amountMaxB:o,withMetadata:m,getEphemeralSigners:f});return g.addInstruction(B),g.versionBuild({txVersion:d,extInfo:{address:B.address}})}async increasePositionFromLiquidity(e){let{poolInfo:t,poolKeys:n,ownerPosition:r,amountMaxA:o,amountMaxB:s,liquidity:a,ownerInfo:c,associatedOnly:u=!0,checkCreateATAOwner:l=!1,computeBudgetConfig:m,txVersion:d}=e,f=this.createTxBuilder(),g,p,y=c.useSOLBalance&&t.mintA.address===Q.toString(),b=c.useSOLBalance&&t.mintB.address===Q.toString(),{account:h,instructionParams:w}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new v(t.mintA.address),notUseTokenAccount:y,owner:this.scope.ownerPubKey,createInfo:y||o.isZero()?{payer:this.scope.ownerPubKey,amount:o}:void 0,skipCloseAccount:!y,associatedOnly:y?!1:u,checkCreateATAOwner:l});h&&(g=h),f.addInstruction(w||{});let{account:A,instructionParams:k}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new v(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:b||s.isZero()?{payer:this.scope.ownerPubKey,amount:s}:void 0,notUseTokenAccount:b,skipCloseAccount:!b,associatedOnly:b?!1:u,checkCreateATAOwner:l});A&&(p=A),f.addInstruction(k||{}),!g&&!p&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let T=n!=null?n:await this.getClmmPoolKeys(t.id),x=me.increasePositionFromLiquidityInstructions({poolInfo:t,poolKeys:T,ownerPosition:r,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:g,tokenAccountB:p},liquidity:a,amountMaxA:o,amountMaxB:s});return f.addInstruction(x),f.addCustomComputeBudget(m),f.versionBuild({txVersion:d,extInfo:{address:x.address}})}async increasePositionFromBase(e){let{poolInfo:t,ownerPosition:n,base:r,baseAmount:o,otherAmountMax:s,ownerInfo:a,associatedOnly:c=!0,checkCreateATAOwner:u=!1,computeBudgetConfig:l,txVersion:m}=e,d=this.createTxBuilder(),f,g,p=a.useSOLBalance&&t.mintA.address===Q.toString(),y=a.useSOLBalance&&t.mintB.address===Q.toString(),{account:b,instructionParams:h}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new v(t.mintA.address),notUseTokenAccount:p,owner:this.scope.ownerPubKey,createInfo:p||(r==="MintA"?o:s).isZero()?{payer:this.scope.ownerPubKey,amount:r==="MintA"?o:s}:void 0,skipCloseAccount:!p,associatedOnly:p?!1:c,checkCreateATAOwner:u});b&&(f=b),d.addInstruction(h||{});let{account:w,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new v(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:y||(r==="MintA"?s:o).isZero()?{payer:this.scope.ownerPubKey,amount:r==="MintA"?s:o}:void 0,notUseTokenAccount:y,skipCloseAccount:!y,associatedOnly:y?!1:c,checkCreateATAOwner:u});w&&(g=w),d.addInstruction(A||{}),!f&&!g&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let k=await this.getClmmPoolKeys(t.id),T=me.increasePositionFromBaseInstructions({poolInfo:t,poolKeys:k,ownerPosition:n,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:f,tokenAccountB:g},base:r,baseAmount:o,otherAmountMax:s});return d.addInstruction(T),d.addCustomComputeBudget(l),d.versionBuild({txVersion:m,extInfo:{address:T.address}})}async decreaseLiquidity(e){let{poolInfo:t,poolKeys:n,ownerPosition:r,ownerInfo:o,amountMinA:s,amountMinB:a,liquidity:c,associatedOnly:u=!0,checkCreateATAOwner:l=!1,computeBudgetConfig:m,txVersion:d}=e;this.scope.availability.removeConcentratedPosition===!1&&this.logAndCreateError("remove position feature disabled in your region");let f=this.createTxBuilder(),g=o.useSOLBalance&&t.mintA.address===Q.toString(),p=o.useSOLBalance&&t.mintB.address===Q.toString(),y,b,{account:h,instructionParams:w}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new v(t.mintA.address),notUseTokenAccount:g,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!g,associatedOnly:g?!1:u,checkCreateATAOwner:l});y=h,w&&f.addInstruction(w);let{account:A,instructionParams:k}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new v(t.mintB.address),notUseTokenAccount:p,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!p,associatedOnly:p?!1:u,checkCreateATAOwner:l});b=A,k&&f.addInstruction(k);let T=[];for(let L of t.rewardDefaultInfos){let R=o.useSOLBalance&&L.mint.address===Q.toString(),Z;if(L.mint.address===t.mintA.address)Z=y;else if(L.mint.address===t.mintB.address)Z=b;else{let{account:ee,instructionParams:ce}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new v(L.mint.programId),mint:new v(L.mint.address),notUseTokenAccount:R,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!R,associatedOnly:R?!1:u,checkCreateATAOwner:l});Z=ee,ce&&f.addInstruction(ce)}T.push(Z)}!y&&!b&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccountRawInfos);let x=n!=null?n:await this.getClmmPoolKeys(t.id),B=await me.decreaseLiquidityInstructions({poolInfo:t,poolKeys:x,ownerPosition:r,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:y,tokenAccountB:b,rewardAccounts:T},liquidity:c,amountMinA:s,amountMinB:a});f.addInstruction({instructions:B.instructions,instructionTypes:[ue.ClmmDecreasePosition]});let M=C({},B.address);if(o.closePosition){let L=await me.closePositionInstructions({poolInfo:t,poolKeys:x,ownerInfo:{wallet:this.scope.ownerPubKey},ownerPosition:r});f.addInstruction({endInstructions:L.instructions,endInstructionTypes:L.instructionTypes}),M=C(C({},M),L.address)}return f.addCustomComputeBudget(m),f.versionBuild({txVersion:d,extInfo:{address:M}})}async closePosition({poolInfo:e,poolKeys:t,ownerPosition:n,txVersion:r}){this.scope.availability.removeConcentratedPosition===!1&&this.logAndCreateError("remove position feature disabled in your region");let o=this.createTxBuilder(),s=t!=null?t:await this.getClmmPoolKeys(e.id),a=me.closePositionInstructions({poolInfo:e,poolKeys:s,ownerInfo:{wallet:this.scope.ownerPubKey},ownerPosition:n});return o.addInstruction(a).versionBuild({txVersion:r,extInfo:{address:a.address}})}async initReward({poolInfo:e,ownerInfo:t,rewardInfo:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){n.endTime<=n.openTime&&this.logAndCreateError("reward time error","rewardInfo",n);let c=this.createTxBuilder(),u=t.useSOLBalance&&n.mint.address.toString()===Q.toString(),l=n.perSecond.mul(n.endTime-n.openTime),{account:m,instructionParams:d}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new v(n.mint.address),mint:new v(n.mint.address),notUseTokenAccount:!!u,skipCloseAccount:!u,owner:this.scope.ownerPubKey,createInfo:u?{payer:t.feePayer||this.scope.ownerPubKey,amount:new Ce(new S(l.toFixed(0)).gte(l)?l.toFixed(0):l.add(1).toFixed(0))}:void 0,associatedOnly:u?!1:r,checkCreateATAOwner:o});d&&c.addInstruction(d),m||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let f=await this.getClmmPoolKeys(e.id),g=me.initRewardInstructions({poolInfo:e,poolKeys:f,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:m},rewardInfo:{programId:new v(n.mint.programId),mint:new v(n.mint.address),openTime:n.openTime,endTime:n.endTime,emissionsPerSecondX64:D.decimalToX64(n.perSecond)}});return c.addInstruction(g),c.addCustomComputeBudget(s),c.versionBuild({txVersion:a,extInfo:{address:g.address}})}async initRewards({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfos:r,associatedOnly:o=!0,checkCreateATAOwner:s=!1,computeBudgetConfig:a,txVersion:c}){for(let m of r)m.endTime<=m.openTime&&this.logAndCreateError("reward time error","rewardInfo",m);let u=this.createTxBuilder(),l={};for(let m of r){let d=n.useSOLBalance&&m.mint.address===Q.toString(),f=m.perSecond.mul(m.endTime-m.openTime),{account:g,instructionParams:p}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new v(m.mint.programId),mint:new v(m.mint.address),notUseTokenAccount:!!d,skipCloseAccount:!d,owner:this.scope.ownerPubKey,createInfo:d?{payer:n.feePayer||this.scope.ownerPubKey,amount:new Ce(new S(f.toFixed(0)).gte(f)?f.toFixed(0):f.add(1).toFixed(0))}:void 0,associatedOnly:d?!1:o,checkCreateATAOwner:s});p&&u.addInstruction(p),g||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let y=t!=null?t:await this.getClmmPoolKeys(e.id),b=me.initRewardInstructions({poolInfo:e,poolKeys:y,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:g},rewardInfo:{programId:new v(m.mint.programId),mint:new v(m.mint.address),openTime:m.openTime,endTime:m.endTime,emissionsPerSecondX64:D.decimalToX64(m.perSecond)}});l=C(C({},l),b.address),u.addInstruction(b)}return u.addCustomComputeBudget(a),u.versionBuild({txVersion:c,extInfo:{address:l}})}async setReward({poolInfo:e,ownerInfo:t,rewardInfo:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){n.endTime<=n.openTime&&this.logAndCreateError("reward time error","rewardInfo",n);let c=this.createTxBuilder(),u=t.useSOLBalance&&n.mint.equals(Q),{account:l,instructionParams:m}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:n.programId,mint:n.mint,notUseTokenAccount:u,owner:this.scope.ownerPubKey,createInfo:u?{payer:t.feePayer||this.scope.ownerPubKey,amount:new Ce(new S(n.perSecond.sub(n.endTime-n.openTime).toFixed(0)).gte(n.perSecond.sub(n.endTime-n.openTime))?n.perSecond.sub(n.endTime-n.openTime).toFixed(0):n.perSecond.sub(n.endTime-n.openTime).add(1).toFixed(0))}:void 0,associatedOnly:u?!1:r,checkCreateATAOwner:o});m&&c.addInstruction(m),l||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let d=await this.getClmmPoolKeys(e.id),f=me.setRewardInstructions({poolInfo:e,poolKeys:d,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:l},rewardInfo:{mint:n.mint,openTime:n.openTime,endTime:n.endTime,emissionsPerSecondX64:D.decimalToX64(n.perSecond)}});return c.addInstruction(f),c.addCustomComputeBudget(s),c.versionBuild({txVersion:a,extInfo:{address:f.address}})}async setRewards({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfos:r,associatedOnly:o=!0,checkCreateATAOwner:s=!1,computeBudgetConfig:a,txVersion:c}){let u=this.createTxBuilder(),l={};for(let m of r){m.endTime<=m.openTime&&this.logAndCreateError("reward time error","rewardInfo",m);let d=n.useSOLBalance&&m.mint.address===Q.toString(),{account:f,instructionParams:g}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new v(m.mint.programId),mint:new v(m.mint.address),notUseTokenAccount:d,owner:this.scope.ownerPubKey,createInfo:d?{payer:n.feePayer||this.scope.ownerPubKey,amount:new Ce(new S(m.perSecond.sub(m.endTime-m.openTime).toFixed(0)).gte(m.perSecond.sub(m.endTime-m.openTime))?m.perSecond.sub(m.endTime-m.openTime).toFixed(0):m.perSecond.sub(m.endTime-m.openTime).add(1).toFixed(0))}:void 0,associatedOnly:d?!1:o,checkCreateATAOwner:s});g&&u.addInstruction(g),f||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let p=t!=null?t:await this.getClmmPoolKeys(e.id),y=me.setRewardInstructions({poolInfo:e,poolKeys:p,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:f},rewardInfo:{mint:new v(m.mint.address),openTime:m.openTime,endTime:m.endTime,emissionsPerSecondX64:D.decimalToX64(m.perSecond)}});u.addInstruction(y),l=C(C({},l),y.address)}return u.addCustomComputeBudget(a),u.versionBuild({txVersion:c,extInfo:{address:l}})}async collectReward({poolInfo:e,ownerInfo:t,rewardMint:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1}){let s=e.rewardDefaultInfos.find(f=>f.mint.address===n.toString());s||this.logAndCreateError("reward mint error","not found reward mint",n);let a=this.createTxBuilder(),c=t.useSOLBalance&&n.equals(Q),{account:u,instructionParams:l}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new v(s.mint.programId),mint:n,notUseTokenAccount:c,owner:this.scope.ownerPubKey,skipCloseAccount:!c,createInfo:{payer:t.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:c?!1:r,checkCreateATAOwner:o});l&&a.addInstruction(l),u||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let m=await this.getClmmPoolKeys(e.id),d=me.collectRewardInstructions({poolInfo:e,poolKeys:m,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:u},rewardMint:n});return a.addInstruction(d),a.build({address:d.address})}async collectRewards({poolInfo:e,ownerInfo:t,rewardMints:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1}){let s=this.createTxBuilder(),a={};for(let c of n){let u=e.rewardDefaultInfos.find(p=>p.mint.address===c.toString());if(!u){this.logAndCreateError("reward mint error","not found reward mint",c);continue}let l=t.useSOLBalance&&c.equals(Q),{account:m,instructionParams:d}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new v(u.mint.programId),mint:c,notUseTokenAccount:l,owner:this.scope.ownerPubKey,skipCloseAccount:!l,createInfo:{payer:t.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:l?!1:r,checkCreateATAOwner:o});m||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos),d&&s.addInstruction(d);let f=await this.getClmmPoolKeys(e.id),g=me.collectRewardInstructions({poolInfo:e,poolKeys:f,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:m},rewardMint:c});s.addInstruction(g),a=C(C({},a),g.address)}return s.build({address:a})}async swap({poolInfo:e,poolKeys:t,inputMint:n,amountIn:r,amountOutMin:o,priceLimit:s,observationId:a,ownerInfo:c,remainingAccounts:u,associatedOnly:l=!0,checkCreateATAOwner:m=!1,txVersion:d,computeBudgetConfig:f}){let g=this.createTxBuilder(),p=n.toString()===e.mintA.address,y=c.useSOLBalance&&e.mintA.address===Q.toBase58(),b=c.useSOLBalance&&e.mintB.address===Q.toBase58(),h;!s||s.equals(new S(0))?h=p?ze.add(new Ce(1)):He.sub(new Ce(1)):h=O.priceToSqrtPriceX64(s,e.mintA.decimals,e.mintB.decimals);let w;if(!w){let{account:T,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new v(e.mintA.address),notUseTokenAccount:y,owner:this.scope.ownerPubKey,skipCloseAccount:!y,createInfo:y||!p?{payer:c.feePayer||this.scope.ownerPubKey,amount:p?r:0}:void 0,associatedOnly:y?!1:l,checkCreateATAOwner:m});w=T,x&&g.addInstruction(x)}let A;if(!A){let{account:T,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new v(e.mintB.address),notUseTokenAccount:b,owner:this.scope.ownerPubKey,skipCloseAccount:!b,createInfo:b||p?{payer:c.feePayer||this.scope.ownerPubKey,amount:p?0:r}:void 0,associatedOnly:b?!1:l,checkCreateATAOwner:m});A=T,x&&g.addInstruction(x)}(!w||!A)&&this.logAndCreateError("user do not have token account",{tokenA:e.mintA.symbol||e.mintA.address,tokenB:e.mintB.symbol||e.mintB.address,ownerTokenAccountA:w,ownerTokenAccountB:A,mintAUseSOLBalance:y,mintBUseSOLBalance:b,associatedOnly:l});let k=t!=null?t:await this.getClmmPoolKeys(e.id);return g.addInstruction(me.makeSwapBaseInInstructions({poolInfo:e,poolKeys:k,observationId:a,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:w,tokenAccountB:A},inputMint:new v(n),amountIn:r,amountOutMin:o,sqrtPriceLimitX64:h,remainingAccounts:u})),g.addCustomComputeBudget(f),g.versionBuild({txVersion:d})}async swapBaseOut({poolInfo:e,poolKeys:t,outputMint:n,amountOut:r,amountInMax:o,priceLimit:s,observationId:a,ownerInfo:c,remainingAccounts:u,associatedOnly:l=!0,checkCreateATAOwner:m=!1,txVersion:d,computeBudgetConfig:f}){let g=this.createTxBuilder(),p=n.toString()===e.mintB.address,y=c.useSOLBalance&&e.mintA.address===Q.toBase58(),b=c.useSOLBalance&&e.mintB.address===Q.toBase58(),h;!s||s.equals(new S(0))?h=n.toString()===e.mintB.address?ze.add(new Ce(1)):He.sub(new Ce(1)):h=O.priceToSqrtPriceX64(s,e.mintA.decimals,e.mintB.decimals);let w;if(!w){let{account:T,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new v(e.mintA.address),notUseTokenAccount:y,owner:this.scope.ownerPubKey,skipCloseAccount:!y,createInfo:y||!p?{payer:c.feePayer||this.scope.ownerPubKey,amount:p?o:0}:void 0,associatedOnly:y?!1:l,checkCreateATAOwner:m});w=T,x&&g.addInstruction(x)}let A;if(!A){let{account:T,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new v(e.mintB.address),notUseTokenAccount:b,owner:this.scope.ownerPubKey,skipCloseAccount:!b,createInfo:b||p?{payer:c.feePayer||this.scope.ownerPubKey,amount:p?0:o}:void 0,associatedOnly:b?!1:l,checkCreateATAOwner:m});A=T,x&&g.addInstruction(x)}(!w||!A)&&this.logAndCreateError("user do not have token account",{tokenA:e.mintA.symbol||e.mintA.address,tokenB:e.mintB.symbol||e.mintB.address,ownerTokenAccountA:w,ownerTokenAccountB:A,mintAUseSOLBalance:y,mintBUseSOLBalance:b,associatedOnly:l});let k=t!=null?t:await this.getClmmPoolKeys(e.id);return g.addInstruction(me.makeSwapBaseOutInstructions({poolInfo:e,poolKeys:k,observationId:a,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:w,tokenAccountB:A},outputMint:new v(n),amountOut:r,amountInMax:o,sqrtPriceLimitX64:h,remainingAccounts:u})),g.addCustomComputeBudget(f),g.versionBuild({txVersion:d})}async harvestAllRewards({allPoolInfo:e,allPositions:t,ownerInfo:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1,programId:s,txVersion:a,computeBudgetConfig:c}){let u={};for(let m of this.scope.account.tokenAccountRawInfos)r?Ue(this.scope.ownerPubKey,m.accountInfo.mint,s).publicKey.equals(m.pubkey)&&(u[m.accountInfo.mint.toString()]=m.pubkey):u[m.accountInfo.mint.toString()]=m.pubkey;let l=this.createTxBuilder();for(let m of Object.values(e)){if(t[m.id]===void 0||!t[m.id].find(w=>!w.liquidity.isZero()||w.rewardInfos.find(A=>!A.rewardAmountOwed.isZero())))continue;let d=m,f=n.useSOLBalance&&d.mintA.address===Q.toString(),g=n.useSOLBalance&&d.mintB.address===Q.toString(),p=u[d.mintA.address];if(!p){let{account:w,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:d.mintA.programId,mint:new v(d.mintA.address),notUseTokenAccount:f,owner:this.scope.ownerPubKey,skipCloseAccount:!f,createInfo:{payer:n.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:f?!1:r,checkCreateATAOwner:o});p=w,A&&l.addInstruction(A)}let y=u[d.mintB.address];if(!y){let{account:w,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:d.mintB.programId,mint:new v(d.mintB.address),notUseTokenAccount:g,owner:this.scope.ownerPubKey,skipCloseAccount:!g,createInfo:{payer:n.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:g?!1:r,checkCreateATAOwner:o});y=w,A&&l.addInstruction(A)}u[d.mintA.address]=p,u[d.mintB.address]=y;let b=[];for(let w of d.rewardDefaultInfos){let A=n.useSOLBalance&&w.mint.address===Q.toString(),k=u[w.mint.address];if(!k){let{account:T,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new v(w.mint.programId),mint:new v(w.mint.address),notUseTokenAccount:A,owner:this.scope.ownerPubKey,skipCloseAccount:!A,createInfo:{payer:n.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:A?!1:r});k=T,x&&l.addInstruction(x)}u[w.mint.address]=k,b.push(k)}let h=await this.getClmmPoolKeys(d.id);for(let w of t[m.id]){let A=me.decreaseLiquidityInstructions({poolInfo:d,poolKeys:h,ownerPosition:w,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:p,tokenAccountB:y,rewardAccounts:b},liquidity:new Ce(0),amountMinA:new Ce(0),amountMinB:new Ce(0)});l.addInstruction(A)}}return a===0?l.sizeCheckBuildV0({computeBudgetConfig:c}):l.sizeCheckBuild({computeBudgetConfig:c})}async getWhiteListMint({programId:e}){let t=await this.scope.connection.getAccountInfo(_t(e).publicKey);return t?Ji.decode(t.data).whitelistMints.filter(r=>!r.equals(v.default)):[]}async getOwnerPositionInfo({programId:e}){await this.scope.account.fetchWalletTokenAccounts();let n=this.scope.account.tokenAccountRawInfos.filter(s=>s.accountInfo.amount.eq(new Ce(1))).map(s=>Le(new v(e),s.accountInfo.mint).publicKey),r=await this.scope.connection.getMultipleAccountsInfo(n),o=[];return r.forEach(s=>{if(!s)return;let a=pn.decode(s.data);o.push(a)}),o}async getRpcClmmPoolInfo({poolId:e}){return(await this.getRpcClmmPoolInfos({poolIds:[e]}))[String(e)]}async getRpcClmmPoolInfos({poolIds:e,config:t}){let n=await st(this.scope.connection,e.map(o=>({pubkey:new v(o)})),t),r={};for(let o=0;o<e.length;o++){let s=n[o];if(s===null||!s.accountInfo)throw Error("fetch pool info error: "+String(e[o]));let a=fn.decode(s.accountInfo.data),c=O.sqrtPriceX64ToPrice(a.sqrtPriceX64,a.mintDecimalsA,a.mintDecimalsB).toNumber();r[String(e[o])]=G(C({},a),{currentPrice:c,programId:s.accountInfo.owner})}return r}async getComputeClmmPoolInfos({clmmPoolsRpcInfo:e,mintInfos:t}){let n=new Set(Object.keys(e).map(c=>e[c].ammConfig.toBase58())),r=await st(this.scope.connection,Array.from(n).map(c=>({pubkey:new v(c)}))),o={};r.forEach(c=>{!c.accountInfo||(o[c.pubkey.toBase58()]=Yi.decode(c.accountInfo.data))});let s=await le.fetchComputeMultipleClmmInfo({connection:this.scope.connection,rpcDataMap:e,poolList:Object.keys(e).map(c=>{var m,d,f,g;let[u,l]=[e[c].mintA.toBase58(),e[c].mintB.toBase58()];return{id:c,programId:e[c].programId.toBase58(),mintA:Fn({address:u,decimals:e[c].mintDecimalsA,programId:t[u].programId.toBase58()||sr.toBase58(),extensions:{feeConfig:(m=t[u])!=null&&m.feeConfig?Dn((d=t[u])==null?void 0:d.feeConfig):void 0}}),mintB:Fn({address:l,decimals:e[c].mintDecimalsB,programId:t[l].programId.toBase58()||sr.toBase58(),extensions:{feeConfig:(f=t[l])!=null&&f.feeConfig?Dn((g=t[l])==null?void 0:g.feeConfig):void 0}}),price:e[c].currentPrice,config:G(C({},o[e[c].ammConfig.toBase58()]),{id:e[c].ammConfig.toBase58(),fundFeeRate:0,description:"",defaultRange:0,defaultRangePoint:[]})}})}),a=await le.fetchMultiplePoolTickArrays({connection:this.scope.connection,poolKeys:Object.values(s)});return{computeClmmPoolInfo:s,computePoolTickData:a}}async getPoolInfoFromRpc(e){var l;let t=await this.getRpcClmmPoolInfo({poolId:e}),n=new Set([t.mintA.toBase58(),t.mintB.toBase58()]),r=await Ni({connection:this.scope.connection,mints:Array.from(n).map(m=>new v(m))}),{computeClmmPoolInfo:o,computePoolTickData:s}=await this.scope.clmm.getComputeClmmPoolInfos({clmmPoolsRpcInfo:{[e]:t},mintInfos:r}),a=await st(this.scope.connection,[{pubkey:t.vaultA},{pubkey:t.vaultB}]),c=tr(o[e]);if(!a[0].accountInfo||!a[1].accountInfo)throw new Error("pool vault data not found");c.mintAmountA=Number(or.decode(a[0].accountInfo.data).amount.toString()),c.mintAmountB=Number(or.decode((l=a[1].accountInfo)==null?void 0:l.data).amount.toString());let u=G(C({},o[e]),{id:e,programId:t.programId.toBase58(),openTime:t.startTime.toString(),vault:{A:t.vaultA.toBase58(),B:t.vaultB.toBase58()},rewardInfos:[],config:c.config});return{poolInfo:c,poolKeys:u,computePoolInfo:o[e],tickData:s}}};export{ar as Clmm};
//# sourceMappingURL=clmm.mjs.map