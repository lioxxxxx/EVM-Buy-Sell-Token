var rr=Object.defineProperty,ir=Object.defineProperties;var or=Object.getOwnPropertyDescriptors;var Ye=Object.getOwnPropertySymbols;var en=Object.prototype.hasOwnProperty,tn=Object.prototype.propertyIsEnumerable;var $t=(n,t,e)=>t in n?rr(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,K=(n,t)=>{for(var e in t||(t={}))en.call(t,e)&&$t(n,e,t[e]);if(Ye)for(var e of Ye(t))tn.call(t,e)&&$t(n,e,t[e]);return n},G=(n,t)=>ir(n,or(t));var ce=(n,t)=>{var e={};for(var r in n)en.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&Ye)for(var r of Ye(n))t.indexOf(r)<0&&tn.call(n,r)&&(e[r]=n[r]);return e};import{PublicKey as x}from"@solana/web3.js";import{NATIVE_MINT as wt,TOKEN_PROGRAM_ID as pe,AccountLayout as Ji}from"@solana/spl-token";import pi from"big.js";import Fs from"bn.js";import te from"bn.js";var xe=9e15,be=1e9,Pt="0123456789abcdef",Xe="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Qe="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",Tt={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-xe,maxE:xe,crypto:!1},sn,le,I=!0,et="[DecimalError] ",he=et+"Invalid argument: ",an=et+"Precision limit exceeded",un=et+"crypto unavailable",cn="[object Decimal]",J=Math.floor,z=Math.pow,sr=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,ar=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,ur=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,ln=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,re=1e7,S=7,cr=9007199254740991,lr=Xe.length-1,At=Qe.length-1,h={toStringTag:cn};h.absoluteValue=h.abs=function(){var n=new this.constructor(this);return n.s<0&&(n.s=1),B(n)};h.ceil=function(){return B(new this.constructor(this),this.e+1,2)};h.clampedTo=h.clamp=function(n,t){var e,r=this,i=r.constructor;if(n=new i(n),t=new i(t),!n.s||!t.s)return new i(NaN);if(n.gt(t))throw Error(he+t);return e=r.cmp(n),e<0?n:r.cmp(t)>0?t:new i(r)};h.comparedTo=h.cmp=function(n){var t,e,r,i,o=this,s=o.d,a=(n=new o.constructor(n)).d,u=o.s,c=n.s;if(!s||!a)return!u||!c?NaN:u!==c?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-c:0;if(u!==c)return u;if(o.e!==n.e)return o.e>n.e^u<0?1:-1;for(r=s.length,i=a.length,t=0,e=r<i?r:i;t<e;++t)if(s[t]!==a[t])return s[t]>a[t]^u<0?1:-1;return r===i?0:r>i^u<0?1:-1};h.cosine=h.cos=function(){var n,t,e=this,r=e.constructor;return e.d?e.d[0]?(n=r.precision,t=r.rounding,r.precision=n+Math.max(e.e,e.sd())+S,r.rounding=1,e=mr(r,gn(r,e)),r.precision=n,r.rounding=t,B(le==2||le==3?e.neg():e,n,t,!0)):new r(1):new r(NaN)};h.cubeRoot=h.cbrt=function(){var n,t,e,r,i,o,s,a,u,c,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(I=!1,o=l.s*z(l.s*l,1/3),!o||Math.abs(o)==1/0?(e=Y(l.d),n=l.e,(o=(n-e.length+1)%3)&&(e+=o==1||o==-2?"0":"00"),o=z(e,1/3),n=J((n+1)/3)-(n%3==(n<0?-1:2)),o==1/0?e="5e"+n:(e=o.toExponential(),e=e.slice(0,e.indexOf("e")+1)+n),r=new m(e),r.s=l.s):r=new m(o.toString()),s=(n=m.precision)+3;;)if(a=r,u=a.times(a).times(a),c=u.plus(l),r=V(c.plus(l).times(a),c.plus(u),s+2,1),Y(a.d).slice(0,s)===(e=Y(r.d)).slice(0,s))if(e=e.slice(s-3,s+1),e=="9999"||!i&&e=="4999"){if(!i&&(B(a,n+1,0),a.times(a).times(a).eq(l))){r=a;break}s+=4,i=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(B(r,n+1,1),t=!r.times(r).times(r).eq(l));break}return I=!0,B(r,n,m.rounding,t)};h.decimalPlaces=h.dp=function(){var n,t=this.d,e=NaN;if(t){if(n=t.length-1,e=(n-J(this.e/S))*S,n=t[n],n)for(;n%10==0;n/=10)e--;e<0&&(e=0)}return e};h.dividedBy=h.div=function(n){return V(this,new this.constructor(n))};h.dividedToIntegerBy=h.divToInt=function(n){var t=this,e=t.constructor;return B(V(t,new e(n),0,1,1),e.precision,e.rounding)};h.equals=h.eq=function(n){return this.cmp(n)===0};h.floor=function(){return B(new this.constructor(this),this.e+1,3)};h.greaterThan=h.gt=function(n){return this.cmp(n)>0};h.greaterThanOrEqualTo=h.gte=function(n){var t=this.cmp(n);return t==1||t===0};h.hyperbolicCosine=h.cosh=function(){var n,t,e,r,i,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;e=s.precision,r=s.rounding,s.precision=e+Math.max(o.e,o.sd())+4,s.rounding=1,i=o.d.length,i<32?(n=Math.ceil(i/3),t=(1/nt(4,n)).toString()):(n=16,t="2.3283064365386962890625e-10"),o=Be(s,1,o.times(t),new s(1),!0);for(var u,c=n,l=new s(8);c--;)u=o.times(o),o=a.minus(u.times(l.minus(u.times(l))));return B(o,s.precision=e,s.rounding=r,!0)};h.hyperbolicSine=h.sinh=function(){var n,t,e,r,i=this,o=i.constructor;if(!i.isFinite()||i.isZero())return new o(i);if(t=o.precision,e=o.rounding,o.precision=t+Math.max(i.e,i.sd())+4,o.rounding=1,r=i.d.length,r<3)i=Be(o,2,i,i,!0);else{n=1.4*Math.sqrt(r),n=n>16?16:n|0,i=i.times(1/nt(5,n)),i=Be(o,2,i,i,!0);for(var s,a=new o(5),u=new o(16),c=new o(20);n--;)s=i.times(i),i=i.times(a.plus(s.times(u.times(s).plus(c))))}return o.precision=t,o.rounding=e,B(i,t,e,!0)};h.hyperbolicTangent=h.tanh=function(){var n,t,e=this,r=e.constructor;return e.isFinite()?e.isZero()?new r(e):(n=r.precision,t=r.rounding,r.precision=n+7,r.rounding=1,V(e.sinh(),e.cosh(),r.precision=n,r.rounding=t)):new r(e.s)};h.inverseCosine=h.acos=function(){var n,t=this,e=t.constructor,r=t.abs().cmp(1),i=e.precision,o=e.rounding;return r!==-1?r===0?t.isNeg()?ne(e,i,o):new e(0):new e(NaN):t.isZero()?ne(e,i+4,o).times(.5):(e.precision=i+6,e.rounding=1,t=t.asin(),n=ne(e,i+4,o).times(.5),e.precision=i,e.rounding=o,n.minus(t))};h.inverseHyperbolicCosine=h.acosh=function(){var n,t,e=this,r=e.constructor;return e.lte(1)?new r(e.eq(1)?0:NaN):e.isFinite()?(n=r.precision,t=r.rounding,r.precision=n+Math.max(Math.abs(e.e),e.sd())+4,r.rounding=1,I=!1,e=e.times(e).minus(1).sqrt().plus(e),I=!0,r.precision=n,r.rounding=t,e.ln()):new r(e)};h.inverseHyperbolicSine=h.asinh=function(){var n,t,e=this,r=e.constructor;return!e.isFinite()||e.isZero()?new r(e):(n=r.precision,t=r.rounding,r.precision=n+2*Math.max(Math.abs(e.e),e.sd())+6,r.rounding=1,I=!1,e=e.times(e).plus(1).sqrt().plus(e),I=!0,r.precision=n,r.rounding=t,e.ln())};h.inverseHyperbolicTangent=h.atanh=function(){var n,t,e,r,i=this,o=i.constructor;return i.isFinite()?i.e>=0?new o(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(n=o.precision,t=o.rounding,r=i.sd(),Math.max(r,n)<2*-i.e-1?B(new o(i),n,t,!0):(o.precision=e=r-i.e,i=V(i.plus(1),new o(1).minus(i),e+n,1),o.precision=n+4,o.rounding=1,i=i.ln(),o.precision=n,o.rounding=t,i.times(.5))):new o(NaN)};h.inverseSine=h.asin=function(){var n,t,e,r,i=this,o=i.constructor;return i.isZero()?new o(i):(t=i.abs().cmp(1),e=o.precision,r=o.rounding,t!==-1?t===0?(n=ne(o,e+4,r).times(.5),n.s=i.s,n):new o(NaN):(o.precision=e+6,o.rounding=1,i=i.div(new o(1).minus(i.times(i)).sqrt().plus(1)).atan(),o.precision=e,o.rounding=r,i.times(2)))};h.inverseTangent=h.atan=function(){var n,t,e,r,i,o,s,a,u,c=this,l=c.constructor,m=l.precision,f=l.rounding;if(c.isFinite()){if(c.isZero())return new l(c);if(c.abs().eq(1)&&m+4<=At)return s=ne(l,m+4,f).times(.25),s.s=c.s,s}else{if(!c.s)return new l(NaN);if(m+4<=At)return s=ne(l,m+4,f).times(.5),s.s=c.s,s}for(l.precision=a=m+10,l.rounding=1,e=Math.min(28,a/S+2|0),n=e;n;--n)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(I=!1,t=Math.ceil(a/S),r=1,u=c.times(c),s=new l(c),i=c;n!==-1;)if(i=i.times(u),o=s.minus(i.div(r+=2)),i=i.times(u),s=o.plus(i.div(r+=2)),s.d[t]!==void 0)for(n=t;s.d[n]===o.d[n]&&n--;);return e&&(s=s.times(2<<e-1)),I=!0,B(s,l.precision=m,l.rounding=f,!0)};h.isFinite=function(){return!!this.d};h.isInteger=h.isInt=function(){return!!this.d&&J(this.e/S)>this.d.length-2};h.isNaN=function(){return!this.s};h.isNegative=h.isNeg=function(){return this.s<0};h.isPositive=h.isPos=function(){return this.s>0};h.isZero=function(){return!!this.d&&this.d[0]===0};h.lessThan=h.lt=function(n){return this.cmp(n)<0};h.lessThanOrEqualTo=h.lte=function(n){return this.cmp(n)<1};h.logarithm=h.log=function(n){var t,e,r,i,o,s,a,u,c=this,l=c.constructor,m=l.precision,f=l.rounding,p=5;if(n==null)n=new l(10),t=!0;else{if(n=new l(n),e=n.d,n.s<0||!e||!e[0]||n.eq(1))return new l(NaN);t=n.eq(10)}if(e=c.d,c.s<0||!e||!e[0]||c.eq(1))return new l(e&&!e[0]?-1/0:c.s!=1?NaN:e?0:1/0);if(t)if(e.length>1)o=!0;else{for(i=e[0];i%10===0;)i/=10;o=i!==1}if(I=!1,a=m+p,s=ge(c,a),r=t?$e(l,a+10):ge(n,a),u=V(s,r,a,1),Me(u.d,i=m,f))do if(a+=10,s=ge(c,a),r=t?$e(l,a+10):ge(n,a),u=V(s,r,a,1),!o){+Y(u.d).slice(i+1,i+15)+1==1e14&&(u=B(u,m+1,0));break}while(Me(u.d,i+=10,f));return I=!0,B(u,m,f)};h.minus=h.sub=function(n){var t,e,r,i,o,s,a,u,c,l,m,f,p=this,y=p.constructor;if(n=new y(n),!p.d||!n.d)return!p.s||!n.s?n=new y(NaN):p.d?n.s=-n.s:n=new y(n.d||p.s!==n.s?p:NaN),n;if(p.s!=n.s)return n.s=-n.s,p.plus(n);if(c=p.d,f=n.d,a=y.precision,u=y.rounding,!c[0]||!f[0]){if(f[0])n.s=-n.s;else if(c[0])n=new y(p);else return new y(u===3?-0:0);return I?B(n,a,u):n}if(e=J(n.e/S),l=J(p.e/S),c=c.slice(),o=l-e,o){for(m=o<0,m?(t=c,o=-o,s=f.length):(t=f,e=l,s=c.length),r=Math.max(Math.ceil(a/S),s)+2,o>r&&(o=r,t.length=1),t.reverse(),r=o;r--;)t.push(0);t.reverse()}else{for(r=c.length,s=f.length,m=r<s,m&&(s=r),r=0;r<s;r++)if(c[r]!=f[r]){m=c[r]<f[r];break}o=0}for(m&&(t=c,c=f,f=t,n.s=-n.s),s=c.length,r=f.length-s;r>0;--r)c[s++]=0;for(r=f.length;r>o;){if(c[--r]<f[r]){for(i=r;i&&c[--i]===0;)c[i]=re-1;--c[i],c[r]+=re}c[r]-=f[r]}for(;c[--s]===0;)c.pop();for(;c[0]===0;c.shift())--e;return c[0]?(n.d=c,n.e=tt(c,e),I?B(n,a,u):n):new y(u===3?-0:0)};h.modulo=h.mod=function(n){var t,e=this,r=e.constructor;return n=new r(n),!e.d||!n.s||n.d&&!n.d[0]?new r(NaN):!n.d||e.d&&!e.d[0]?B(new r(e),r.precision,r.rounding):(I=!1,r.modulo==9?(t=V(e,n.abs(),0,3,1),t.s*=n.s):t=V(e,n,0,r.modulo,1),t=t.times(n),I=!0,e.minus(t))};h.naturalExponential=h.exp=function(){return xt(this)};h.naturalLogarithm=h.ln=function(){return ge(this)};h.negated=h.neg=function(){var n=new this.constructor(this);return n.s=-n.s,B(n)};h.plus=h.add=function(n){var t,e,r,i,o,s,a,u,c,l,m=this,f=m.constructor;if(n=new f(n),!m.d||!n.d)return!m.s||!n.s?n=new f(NaN):m.d||(n=new f(n.d||m.s===n.s?m:NaN)),n;if(m.s!=n.s)return n.s=-n.s,m.minus(n);if(c=m.d,l=n.d,a=f.precision,u=f.rounding,!c[0]||!l[0])return l[0]||(n=new f(m)),I?B(n,a,u):n;if(o=J(m.e/S),r=J(n.e/S),c=c.slice(),i=o-r,i){for(i<0?(e=c,i=-i,s=l.length):(e=l,r=o,s=c.length),o=Math.ceil(a/S),s=o>s?o+1:s+1,i>s&&(i=s,e.length=1),e.reverse();i--;)e.push(0);e.reverse()}for(s=c.length,i=l.length,s-i<0&&(i=s,e=l,l=c,c=e),t=0;i;)t=(c[--i]=c[i]+l[i]+t)/re|0,c[i]%=re;for(t&&(c.unshift(t),++r),s=c.length;c[--s]==0;)c.pop();return n.d=c,n.e=tt(c,r),I?B(n,a,u):n};h.precision=h.sd=function(n){var t,e=this;if(n!==void 0&&n!==!!n&&n!==1&&n!==0)throw Error(he+n);return e.d?(t=mn(e.d),n&&e.e+1>t&&(t=e.e+1)):t=NaN,t};h.round=function(){var n=this,t=n.constructor;return B(new t(n),n.e+1,t.rounding)};h.sine=h.sin=function(){var n,t,e=this,r=e.constructor;return e.isFinite()?e.isZero()?new r(e):(n=r.precision,t=r.rounding,r.precision=n+Math.max(e.e,e.sd())+S,r.rounding=1,e=pr(r,gn(r,e)),r.precision=n,r.rounding=t,B(le>2?e.neg():e,n,t,!0)):new r(NaN)};h.squareRoot=h.sqrt=function(){var n,t,e,r,i,o,s=this,a=s.d,u=s.e,c=s.s,l=s.constructor;if(c!==1||!a||!a[0])return new l(!c||c<0&&(!a||a[0])?NaN:a?s:1/0);for(I=!1,c=Math.sqrt(+s),c==0||c==1/0?(t=Y(a),(t.length+u)%2==0&&(t+="0"),c=Math.sqrt(t),u=J((u+1)/2)-(u<0||u%2),c==1/0?t="5e"+u:(t=c.toExponential(),t=t.slice(0,t.indexOf("e")+1)+u),r=new l(t)):r=new l(c.toString()),e=(u=l.precision)+3;;)if(o=r,r=o.plus(V(s,o,e+2,1)).times(.5),Y(o.d).slice(0,e)===(t=Y(r.d)).slice(0,e))if(t=t.slice(e-3,e+1),t=="9999"||!i&&t=="4999"){if(!i&&(B(o,u+1,0),o.times(o).eq(s))){r=o;break}e+=4,i=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(B(r,u+1,1),n=!r.times(r).eq(s));break}return I=!0,B(r,u,l.rounding,n)};h.tangent=h.tan=function(){var n,t,e=this,r=e.constructor;return e.isFinite()?e.isZero()?new r(e):(n=r.precision,t=r.rounding,r.precision=n+10,r.rounding=1,e=e.sin(),e.s=1,e=V(e,new r(1).minus(e.times(e)).sqrt(),n+10,0),r.precision=n,r.rounding=t,B(le==2||le==4?e.neg():e,n,t,!0)):new r(NaN)};h.times=h.mul=function(n){var t,e,r,i,o,s,a,u,c,l=this,m=l.constructor,f=l.d,p=(n=new m(n)).d;if(n.s*=l.s,!f||!f[0]||!p||!p[0])return new m(!n.s||f&&!f[0]&&!p||p&&!p[0]&&!f?NaN:!f||!p?n.s/0:n.s*0);for(e=J(l.e/S)+J(n.e/S),u=f.length,c=p.length,u<c&&(o=f,f=p,p=o,s=u,u=c,c=s),o=[],s=u+c,r=s;r--;)o.push(0);for(r=c;--r>=0;){for(t=0,i=u+r;i>r;)a=o[i]+p[r]*f[i-r-1]+t,o[i--]=a%re|0,t=a/re|0;o[i]=(o[i]+t)%re|0}for(;!o[--s];)o.pop();return t?++e:o.shift(),n.d=o,n.e=tt(o,e),I?B(n,m.precision,m.rounding):n};h.toBinary=function(n,t){return kt(this,2,n,t)};h.toDecimalPlaces=h.toDP=function(n,t){var e=this,r=e.constructor;return e=new r(e),n===void 0?e:($(n,0,be),t===void 0?t=r.rounding:$(t,0,8),B(e,n+e.e+1,t))};h.toExponential=function(n,t){var e,r=this,i=r.constructor;return n===void 0?e=se(r,!0):($(n,0,be),t===void 0?t=i.rounding:$(t,0,8),r=B(new i(r),n+1,t),e=se(r,!0,n+1)),r.isNeg()&&!r.isZero()?"-"+e:e};h.toFixed=function(n,t){var e,r,i=this,o=i.constructor;return n===void 0?e=se(i):($(n,0,be),t===void 0?t=o.rounding:$(t,0,8),r=B(new o(i),n+i.e+1,t),e=se(r,!1,n+r.e+1)),i.isNeg()&&!i.isZero()?"-"+e:e};h.toFraction=function(n){var t,e,r,i,o,s,a,u,c,l,m,f,p=this,y=p.d,d=p.constructor;if(!y)return new d(p);if(c=e=new d(1),r=u=new d(0),t=new d(r),o=t.e=mn(y)-p.e-1,s=o%S,t.d[0]=z(10,s<0?S+s:s),n==null)n=o>0?t:c;else{if(a=new d(n),!a.isInt()||a.lt(c))throw Error(he+a);n=a.gt(t)?o>0?t:c:a}for(I=!1,a=new d(Y(y)),l=d.precision,d.precision=o=y.length*S*2;m=V(a,t,0,1,1),i=e.plus(m.times(r)),i.cmp(n)!=1;)e=r,r=i,i=c,c=u.plus(m.times(i)),u=i,i=t,t=a.minus(m.times(i)),a=i;return i=V(n.minus(e),r,0,1,1),u=u.plus(i.times(c)),e=e.plus(i.times(r)),u.s=c.s=p.s,f=V(c,r,o,1).minus(p).abs().cmp(V(u,e,o,1).minus(p).abs())<1?[c,r]:[u,e],d.precision=l,I=!0,f};h.toHexadecimal=h.toHex=function(n,t){return kt(this,16,n,t)};h.toNearest=function(n,t){var e=this,r=e.constructor;if(e=new r(e),n==null){if(!e.d)return e;n=new r(1),t=r.rounding}else{if(n=new r(n),t===void 0?t=r.rounding:$(t,0,8),!e.d)return n.s?e:n;if(!n.d)return n.s&&(n.s=e.s),n}return n.d[0]?(I=!1,e=V(e,n,0,t,1).times(n),I=!0,B(e)):(n.s=e.s,e=n),e};h.toNumber=function(){return+this};h.toOctal=function(n,t){return kt(this,8,n,t)};h.toPower=h.pow=function(n){var t,e,r,i,o,s,a=this,u=a.constructor,c=+(n=new u(n));if(!a.d||!n.d||!a.d[0]||!n.d[0])return new u(z(+a,c));if(a=new u(a),a.eq(1))return a;if(r=u.precision,o=u.rounding,n.eq(1))return B(a,r,o);if(t=J(n.e/S),t>=n.d.length-1&&(e=c<0?-c:c)<=cr)return i=fn(u,a,e,r),n.s<0?new u(1).div(i):B(i,r,o);if(s=a.s,s<0){if(t<n.d.length-1)return new u(NaN);if((n.d[t]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return e=z(+a,c),t=e==0||!isFinite(e)?J(c*(Math.log("0."+Y(a.d))/Math.LN10+a.e+1)):new u(e+"").e,t>u.maxE+1||t<u.minE-1?new u(t>0?s/0:0):(I=!1,u.rounding=a.s=1,e=Math.min(12,(t+"").length),i=xt(n.times(ge(a,r+e)),r),i.d&&(i=B(i,r+5,1),Me(i.d,r,o)&&(t=r+10,i=B(xt(n.times(ge(a,t+e)),t),t+5,1),+Y(i.d).slice(r+1,r+15)+1==1e14&&(i=B(i,r+1,0)))),i.s=s,I=!0,u.rounding=o,B(i,r,o))};h.toPrecision=function(n,t){var e,r=this,i=r.constructor;return n===void 0?e=se(r,r.e<=i.toExpNeg||r.e>=i.toExpPos):($(n,1,be),t===void 0?t=i.rounding:$(t,0,8),r=B(new i(r),n,t),e=se(r,n<=r.e||r.e<=i.toExpNeg,n)),r.isNeg()&&!r.isZero()?"-"+e:e};h.toSignificantDigits=h.toSD=function(n,t){var e=this,r=e.constructor;return n===void 0?(n=r.precision,t=r.rounding):($(n,1,be),t===void 0?t=r.rounding:$(t,0,8)),B(new r(e),n,t)};h.toString=function(){var n=this,t=n.constructor,e=se(n,n.e<=t.toExpNeg||n.e>=t.toExpPos);return n.isNeg()&&!n.isZero()?"-"+e:e};h.truncated=h.trunc=function(){return B(new this.constructor(this),this.e+1,1)};h.valueOf=h.toJSON=function(){var n=this,t=n.constructor,e=se(n,n.e<=t.toExpNeg||n.e>=t.toExpPos);return n.isNeg()?"-"+e:e};function Y(n){var t,e,r,i=n.length-1,o="",s=n[0];if(i>0){for(o+=s,t=1;t<i;t++)r=n[t]+"",e=S-r.length,e&&(o+=de(e)),o+=r;s=n[t],r=s+"",e=S-r.length,e&&(o+=de(e))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function $(n,t,e){if(n!==~~n||n<t||n>e)throw Error(he+n)}function Me(n,t,e,r){var i,o,s,a;for(o=n[0];o>=10;o/=10)--t;return--t<0?(t+=S,i=0):(i=Math.ceil((t+1)/S),t%=S),o=z(10,S-t),a=n[i]%o|0,r==null?t<3?(t==0?a=a/100|0:t==1&&(a=a/10|0),s=e<4&&a==99999||e>3&&a==49999||a==5e4||a==0):s=(e<4&&a+1==o||e>3&&a+1==o/2)&&(n[i+1]/o/100|0)==z(10,t-2)-1||(a==o/2||a==0)&&(n[i+1]/o/100|0)==0:t<4?(t==0?a=a/1e3|0:t==1?a=a/100|0:t==2&&(a=a/10|0),s=(r||e<4)&&a==9999||!r&&e>3&&a==4999):s=((r||e<4)&&a+1==o||!r&&e>3&&a+1==o/2)&&(n[i+1]/o/1e3|0)==z(10,t-3)-1,s}function Je(n,t,e){for(var r,i=[0],o,s=0,a=n.length;s<a;){for(o=i.length;o--;)i[o]*=t;for(i[0]+=Pt.indexOf(n.charAt(s++)),r=0;r<i.length;r++)i[r]>e-1&&(i[r+1]===void 0&&(i[r+1]=0),i[r+1]+=i[r]/e|0,i[r]%=e)}return i.reverse()}function mr(n,t){var e,r,i;if(t.isZero())return t;r=t.d.length,r<32?(e=Math.ceil(r/3),i=(1/nt(4,e)).toString()):(e=16,i="2.3283064365386962890625e-10"),n.precision+=e,t=Be(n,1,t.times(i),new n(1));for(var o=e;o--;){var s=t.times(t);t=s.times(s).minus(s).times(8).plus(1)}return n.precision-=e,t}var V=function(){function n(r,i,o){var s,a=0,u=r.length;for(r=r.slice();u--;)s=r[u]*i+a,r[u]=s%o|0,a=s/o|0;return a&&r.unshift(a),r}function t(r,i,o,s){var a,u;if(o!=s)u=o>s?1:-1;else for(a=u=0;a<o;a++)if(r[a]!=i[a]){u=r[a]>i[a]?1:-1;break}return u}function e(r,i,o,s){for(var a=0;o--;)r[o]-=a,a=r[o]<i[o]?1:0,r[o]=a*s+r[o]-i[o];for(;!r[0]&&r.length>1;)r.shift()}return function(r,i,o,s,a,u){var c,l,m,f,p,y,d,P,T,w,g,b,k,A,M,C,R,E,F,v,j=r.constructor,Z=r.s==i.s?1:-1,W=r.d,_=i.d;if(!W||!W[0]||!_||!_[0])return new j(!r.s||!i.s||(W?_&&W[0]==_[0]:!_)?NaN:W&&W[0]==0||!_?Z*0:Z/0);for(u?(p=1,l=r.e-i.e):(u=re,p=S,l=J(r.e/p)-J(i.e/p)),F=_.length,R=W.length,T=new j(Z),w=T.d=[],m=0;_[m]==(W[m]||0);m++);if(_[m]>(W[m]||0)&&l--,o==null?(A=o=j.precision,s=j.rounding):a?A=o+(r.e-i.e)+1:A=o,A<0)w.push(1),y=!0;else{if(A=A/p+2|0,m=0,F==1){for(f=0,_=_[0],A++;(m<R||f)&&A--;m++)M=f*u+(W[m]||0),w[m]=M/_|0,f=M%_|0;y=f||m<R}else{for(f=u/(_[0]+1)|0,f>1&&(_=n(_,f,u),W=n(W,f,u),F=_.length,R=W.length),C=F,g=W.slice(0,F),b=g.length;b<F;)g[b++]=0;v=_.slice(),v.unshift(0),E=_[0],_[1]>=u/2&&++E;do f=0,c=t(_,g,F,b),c<0?(k=g[0],F!=b&&(k=k*u+(g[1]||0)),f=k/E|0,f>1?(f>=u&&(f=u-1),d=n(_,f,u),P=d.length,b=g.length,c=t(d,g,P,b),c==1&&(f--,e(d,F<P?v:_,P,u))):(f==0&&(c=f=1),d=_.slice()),P=d.length,P<b&&d.unshift(0),e(g,d,b,u),c==-1&&(b=g.length,c=t(_,g,F,b),c<1&&(f++,e(g,F<b?v:_,b,u))),b=g.length):c===0&&(f++,g=[0]),w[m++]=f,c&&g[0]?g[b++]=W[C]||0:(g=[W[C]],b=1);while((C++<R||g[0]!==void 0)&&A--);y=g[0]!==void 0}w[0]||w.shift()}if(p==1)T.e=l,sn=y;else{for(m=1,f=w[0];f>=10;f/=10)m++;T.e=m+l*p-1,B(T,a?o+T.e+1:o,s,y)}return T}}();function B(n,t,e,r){var i,o,s,a,u,c,l,m,f,p=n.constructor;e:if(t!=null){if(m=n.d,!m)return n;for(i=1,a=m[0];a>=10;a/=10)i++;if(o=t-i,o<0)o+=S,s=t,l=m[f=0],u=l/z(10,i-s-1)%10|0;else if(f=Math.ceil((o+1)/S),a=m.length,f>=a)if(r){for(;a++<=f;)m.push(0);l=u=0,i=1,o%=S,s=o-S+1}else break e;else{for(l=a=m[f],i=1;a>=10;a/=10)i++;o%=S,s=o-S+i,u=s<0?0:l/z(10,i-s-1)%10|0}if(r=r||t<0||m[f+1]!==void 0||(s<0?l:l%z(10,i-s-1)),c=e<4?(u||r)&&(e==0||e==(n.s<0?3:2)):u>5||u==5&&(e==4||r||e==6&&(o>0?s>0?l/z(10,i-s):0:m[f-1])%10&1||e==(n.s<0?8:7)),t<1||!m[0])return m.length=0,c?(t-=n.e+1,m[0]=z(10,(S-t%S)%S),n.e=-t||0):m[0]=n.e=0,n;if(o==0?(m.length=f,a=1,f--):(m.length=f+1,a=z(10,S-o),m[f]=s>0?(l/z(10,i-s)%z(10,s)|0)*a:0),c)for(;;)if(f==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(n.e++,m[0]==re&&(m[0]=1));break}else{if(m[f]+=a,m[f]!=re)break;m[f--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return I&&(n.e>p.maxE?(n.d=null,n.e=NaN):n.e<p.minE&&(n.e=0,n.d=[0])),n}function se(n,t,e){if(!n.isFinite())return dn(n);var r,i=n.e,o=Y(n.d),s=o.length;return t?(e&&(r=e-s)>0?o=o.charAt(0)+"."+o.slice(1)+de(r):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(n.e<0?"e":"e+")+n.e):i<0?(o="0."+de(-i-1)+o,e&&(r=e-s)>0&&(o+=de(r))):i>=s?(o+=de(i+1-s),e&&(r=e-i-1)>0&&(o=o+"."+de(r))):((r=i+1)<s&&(o=o.slice(0,r)+"."+o.slice(r)),e&&(r=e-s)>0&&(i+1===s&&(o+="."),o+=de(r))),o}function tt(n,t){var e=n[0];for(t*=S;e>=10;e/=10)t++;return t}function $e(n,t,e){if(t>lr)throw I=!0,e&&(n.precision=e),Error(an);return B(new n(Xe),t,1,!0)}function ne(n,t,e){if(t>At)throw Error(an);return B(new n(Qe),t,e,!0)}function mn(n){var t=n.length-1,e=t*S+1;if(t=n[t],t){for(;t%10==0;t/=10)e--;for(t=n[0];t>=10;t/=10)e++}return e}function de(n){for(var t="";n--;)t+="0";return t}function fn(n,t,e,r){var i,o=new n(1),s=Math.ceil(r/S+4);for(I=!1;;){if(e%2&&(o=o.times(t),rn(o.d,s)&&(i=!0)),e=J(e/2),e===0){e=o.d.length-1,i&&o.d[e]===0&&++o.d[e];break}t=t.times(t),rn(t.d,s)}return I=!0,o}function nn(n){return n.d[n.d.length-1]&1}function pn(n,t,e){for(var r,i=new n(t[0]),o=0;++o<t.length;)if(r=new n(t[o]),r.s)i[e](r)&&(i=r);else{i=r;break}return i}function xt(n,t){var e,r,i,o,s,a,u,c=0,l=0,m=0,f=n.constructor,p=f.rounding,y=f.precision;if(!n.d||!n.d[0]||n.e>17)return new f(n.d?n.d[0]?n.s<0?0:1/0:1:n.s?n.s<0?0:n:0/0);for(t==null?(I=!1,u=y):u=t,a=new f(.03125);n.e>-2;)n=n.times(a),m+=5;for(r=Math.log(z(2,m))/Math.LN10*2+5|0,u+=r,e=o=s=new f(1),f.precision=u;;){if(o=B(o.times(n),u,1),e=e.times(++l),a=s.plus(V(o,e,u,1)),Y(a.d).slice(0,u)===Y(s.d).slice(0,u)){for(i=m;i--;)s=B(s.times(s),u,1);if(t==null)if(c<3&&Me(s.d,u-r,p,c))f.precision=u+=10,e=o=a=new f(1),l=0,c++;else return B(s,f.precision=y,p,I=!0);else return f.precision=y,s}s=a}}function ge(n,t){var e,r,i,o,s,a,u,c,l,m,f,p=1,y=10,d=n,P=d.d,T=d.constructor,w=T.rounding,g=T.precision;if(d.s<0||!P||!P[0]||!d.e&&P[0]==1&&P.length==1)return new T(P&&!P[0]?-1/0:d.s!=1?NaN:P?0:d);if(t==null?(I=!1,l=g):l=t,T.precision=l+=y,e=Y(P),r=e.charAt(0),Math.abs(o=d.e)<15e14){for(;r<7&&r!=1||r==1&&e.charAt(1)>3;)d=d.times(n),e=Y(d.d),r=e.charAt(0),p++;o=d.e,r>1?(d=new T("0."+e),o++):d=new T(r+"."+e.slice(1))}else return c=$e(T,l+2,g).times(o+""),d=ge(new T(r+"."+e.slice(1)),l-y).plus(c),T.precision=g,t==null?B(d,g,w,I=!0):d;for(m=d,u=s=d=V(d.minus(1),d.plus(1),l,1),f=B(d.times(d),l,1),i=3;;){if(s=B(s.times(f),l,1),c=u.plus(V(s,new T(i),l,1)),Y(c.d).slice(0,l)===Y(u.d).slice(0,l))if(u=u.times(2),o!==0&&(u=u.plus($e(T,l+2,g).times(o+""))),u=V(u,new T(p),l,1),t==null)if(Me(u.d,l-y,w,a))T.precision=l+=y,c=s=d=V(m.minus(1),m.plus(1),l,1),f=B(d.times(d),l,1),i=a=1;else return B(u,T.precision=g,w,I=!0);else return T.precision=g,u;u=c,i+=2}}function dn(n){return String(n.s*n.s/0)}function Bt(n,t){var e,r,i;for((e=t.indexOf("."))>-1&&(t=t.replace(".","")),(r=t.search(/e/i))>0?(e<0&&(e=r),e+=+t.slice(r+1),t=t.substring(0,r)):e<0&&(e=t.length),r=0;t.charCodeAt(r)===48;r++);for(i=t.length;t.charCodeAt(i-1)===48;--i);if(t=t.slice(r,i),t){if(i-=r,n.e=e=e-r-1,n.d=[],r=(e+1)%S,e<0&&(r+=S),r<i){for(r&&n.d.push(+t.slice(0,r)),i-=S;r<i;)n.d.push(+t.slice(r,r+=S));t=t.slice(r),r=S-t.length}else r-=i;for(;r--;)t+="0";n.d.push(+t),I&&(n.e>n.constructor.maxE?(n.d=null,n.e=NaN):n.e<n.constructor.minE&&(n.e=0,n.d=[0]))}else n.e=0,n.d=[0];return n}function fr(n,t){var e,r,i,o,s,a,u,c,l;if(t.indexOf("_")>-1){if(t=t.replace(/(\d)_(?=\d)/g,"$1"),ln.test(t))return Bt(n,t)}else if(t==="Infinity"||t==="NaN")return+t||(n.s=NaN),n.e=NaN,n.d=null,n;if(ar.test(t))e=16,t=t.toLowerCase();else if(sr.test(t))e=2;else if(ur.test(t))e=8;else throw Error(he+t);for(o=t.search(/p/i),o>0?(u=+t.slice(o+1),t=t.substring(2,o)):t=t.slice(2),o=t.indexOf("."),s=o>=0,r=n.constructor,s&&(t=t.replace(".",""),a=t.length,o=a-o,i=fn(r,new r(e),o,o*2)),c=Je(t,e,re),l=c.length-1,o=l;c[o]===0;--o)c.pop();return o<0?new r(n.s*0):(n.e=tt(c,l),n.d=c,I=!1,s&&(n=V(n,i,a*4)),u&&(n=n.times(Math.abs(u)<54?z(2,u):Re.pow(2,u))),I=!0,n)}function pr(n,t){var e,r=t.d.length;if(r<3)return t.isZero()?t:Be(n,2,t,t);e=1.4*Math.sqrt(r),e=e>16?16:e|0,t=t.times(1/nt(5,e)),t=Be(n,2,t,t);for(var i,o=new n(5),s=new n(16),a=new n(20);e--;)i=t.times(t),t=t.times(o.plus(i.times(s.times(i).minus(a))));return t}function Be(n,t,e,r,i){var o,s,a,u,c=1,l=n.precision,m=Math.ceil(l/S);for(I=!1,u=e.times(e),a=new n(r);;){if(s=V(a.times(u),new n(t++*t++),l,1),a=i?r.plus(s):r.minus(s),r=V(s.times(u),new n(t++*t++),l,1),s=a.plus(r),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=r,r=s,s=o,c++}return I=!0,s.d.length=m+1,s}function nt(n,t){for(var e=n;--t;)e*=n;return e}function gn(n,t){var e,r=t.s<0,i=ne(n,n.precision,1),o=i.times(.5);if(t=t.abs(),t.lte(o))return le=r?4:1,t;if(e=t.divToInt(i),e.isZero())le=r?3:2;else{if(t=t.minus(e.times(i)),t.lte(o))return le=nn(e)?r?2:3:r?4:1,t;le=nn(e)?r?1:4:r?3:2}return t.minus(i).abs()}function kt(n,t,e,r){var i,o,s,a,u,c,l,m,f,p=n.constructor,y=e!==void 0;if(y?($(e,1,be),r===void 0?r=p.rounding:$(r,0,8)):(e=p.precision,r=p.rounding),!n.isFinite())l=dn(n);else{for(l=se(n),s=l.indexOf("."),y?(i=2,t==16?e=e*4-3:t==8&&(e=e*3-2)):i=t,s>=0&&(l=l.replace(".",""),f=new p(1),f.e=l.length-s,f.d=Je(se(f),10,i),f.e=f.d.length),m=Je(l,10,i),o=u=m.length;m[--u]==0;)m.pop();if(!m[0])l=y?"0p+0":"0";else{if(s<0?o--:(n=new p(n),n.d=m,n.e=o,n=V(n,f,e,r,0,i),m=n.d,o=n.e,c=sn),s=m[e],a=i/2,c=c||m[e+1]!==void 0,c=r<4?(s!==void 0||c)&&(r===0||r===(n.s<0?3:2)):s>a||s===a&&(r===4||c||r===6&&m[e-1]&1||r===(n.s<0?8:7)),m.length=e,c)for(;++m[--e]>i-1;)m[e]=0,e||(++o,m.unshift(1));for(u=m.length;!m[u-1];--u);for(s=0,l="";s<u;s++)l+=Pt.charAt(m[s]);if(y){if(u>1)if(t==16||t==8){for(s=t==16?4:3,--u;u%s;u++)l+="0";for(m=Je(l,i,t),u=m.length;!m[u-1];--u);for(s=1,l="1.";s<u;s++)l+=Pt.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>u)for(o-=u;o--;)l+="0";else o<u&&(l=l.slice(0,o)+"."+l.slice(o))}l=(t==16?"0x":t==2?"0b":t==8?"0o":"")+l}return n.s<0?"-"+l:l}function rn(n,t){if(n.length>t)return n.length=t,!0}function dr(n){return new this(n).abs()}function gr(n){return new this(n).acos()}function hr(n){return new this(n).acosh()}function br(n,t){return new this(n).plus(t)}function yr(n){return new this(n).asin()}function wr(n){return new this(n).asinh()}function Pr(n){return new this(n).atan()}function Tr(n){return new this(n).atanh()}function Ar(n,t){n=new this(n),t=new this(t);var e,r=this.precision,i=this.rounding,o=r+4;return!n.s||!t.s?e=new this(NaN):!n.d&&!t.d?(e=ne(this,o,1).times(t.s>0?.25:.75),e.s=n.s):!t.d||n.isZero()?(e=t.s<0?ne(this,r,i):new this(0),e.s=n.s):!n.d||t.isZero()?(e=ne(this,o,1).times(.5),e.s=n.s):t.s<0?(this.precision=o,this.rounding=1,e=this.atan(V(n,t,o,1)),t=ne(this,o,1),this.precision=r,this.rounding=i,e=n.s<0?e.minus(t):e.plus(t)):e=this.atan(V(n,t,o,1)),e}function xr(n){return new this(n).cbrt()}function Br(n){return B(n=new this(n),n.e+1,2)}function kr(n,t,e){return new this(n).clamp(t,e)}function Sr(n){if(!n||typeof n!="object")throw Error(et+"Object expected");var t,e,r,i=n.defaults===!0,o=["precision",1,be,"rounding",0,8,"toExpNeg",-xe,0,"toExpPos",0,xe,"maxE",0,xe,"minE",-xe,0,"modulo",0,9];for(t=0;t<o.length;t+=3)if(e=o[t],i&&(this[e]=Tt[e]),(r=n[e])!==void 0)if(J(r)===r&&r>=o[t+1]&&r<=o[t+2])this[e]=r;else throw Error(he+e+": "+r);if(e="crypto",i&&(this[e]=Tt[e]),(r=n[e])!==void 0)if(r===!0||r===!1||r===0||r===1)if(r)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[e]=!0;else throw Error(un);else this[e]=!1;else throw Error(he+e+": "+r);return this}function Cr(n){return new this(n).cos()}function Ir(n){return new this(n).cosh()}function hn(n){var t,e,r;function i(o){var s,a,u,c=this;if(!(c instanceof i))return new i(o);if(c.constructor=i,on(o)){c.s=o.s,I?!o.d||o.e>i.maxE?(c.e=NaN,c.d=null):o.e<i.minE?(c.e=0,c.d=[0]):(c.e=o.e,c.d=o.d.slice()):(c.e=o.e,c.d=o.d?o.d.slice():o.d);return}if(u=typeof o,u==="number"){if(o===0){c.s=1/o<0?-1:1,c.e=0,c.d=[0];return}if(o<0?(o=-o,c.s=-1):c.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;I?s>i.maxE?(c.e=NaN,c.d=null):s<i.minE?(c.e=0,c.d=[0]):(c.e=s,c.d=[o]):(c.e=s,c.d=[o]);return}else if(o*0!==0){o||(c.s=NaN),c.e=NaN,c.d=null;return}return Bt(c,o.toString())}else if(u!=="string")throw Error(he+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),c.s=-1):(a===43&&(o=o.slice(1)),c.s=1),ln.test(o)?Bt(c,o):fr(c,o)}if(i.prototype=h,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.EUCLID=9,i.config=i.set=Sr,i.clone=hn,i.isDecimal=on,i.abs=dr,i.acos=gr,i.acosh=hr,i.add=br,i.asin=yr,i.asinh=wr,i.atan=Pr,i.atanh=Tr,i.atan2=Ar,i.cbrt=xr,i.ceil=Br,i.clamp=kr,i.cos=Cr,i.cosh=Ir,i.div=Nr,i.exp=Lr,i.floor=Mr,i.hypot=Rr,i.ln=Dr,i.log=Er,i.log10=vr,i.log2=Kr,i.max=Or,i.min=Fr,i.mod=_r,i.mul=Wr,i.pow=Vr,i.random=qr,i.round=Ur,i.sign=Gr,i.sin=Hr,i.sinh=zr,i.sqrt=jr,i.sub=Zr,i.sum=Yr,i.tan=Jr,i.tanh=Xr,i.trunc=Qr,n===void 0&&(n={}),n&&n.defaults!==!0)for(r=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],t=0;t<r.length;)n.hasOwnProperty(e=r[t++])||(n[e]=this[e]);return i.config(n),i}function Nr(n,t){return new this(n).div(t)}function Lr(n){return new this(n).exp()}function Mr(n){return B(n=new this(n),n.e+1,3)}function Rr(){var n,t,e=new this(0);for(I=!1,n=0;n<arguments.length;)if(t=new this(arguments[n++]),t.d)e.d&&(e=e.plus(t.times(t)));else{if(t.s)return I=!0,new this(1/0);e=t}return I=!0,e.sqrt()}function on(n){return n instanceof Re||n&&n.toStringTag===cn||!1}function Dr(n){return new this(n).ln()}function Er(n,t){return new this(n).log(t)}function Kr(n){return new this(n).log(2)}function vr(n){return new this(n).log(10)}function Or(){return pn(this,arguments,"lt")}function Fr(){return pn(this,arguments,"gt")}function _r(n,t){return new this(n).mod(t)}function Wr(n,t){return new this(n).mul(t)}function Vr(n,t){return new this(n).pow(t)}function qr(n){var t,e,r,i,o=0,s=new this(1),a=[];if(n===void 0?n=this.precision:$(n,1,be),r=Math.ceil(n/S),this.crypto)if(crypto.getRandomValues)for(t=crypto.getRandomValues(new Uint32Array(r));o<r;)i=t[o],i>=429e7?t[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=i%1e7;else if(crypto.randomBytes){for(t=crypto.randomBytes(r*=4);o<r;)i=t[o]+(t[o+1]<<8)+(t[o+2]<<16)+((t[o+3]&127)<<24),i>=214e7?crypto.randomBytes(4).copy(t,o):(a.push(i%1e7),o+=4);o=r/4}else throw Error(un);else for(;o<r;)a[o++]=Math.random()*1e7|0;for(r=a[--o],n%=S,r&&n&&(i=z(10,S-n),a[o]=(r/i|0)*i);a[o]===0;o--)a.pop();if(o<0)e=0,a=[0];else{for(e=-1;a[0]===0;e-=S)a.shift();for(r=1,i=a[0];i>=10;i/=10)r++;r<S&&(e-=S-r)}return s.e=e,s.d=a,s}function Ur(n){return B(n=new this(n),n.e+1,this.rounding)}function Gr(n){return n=new this(n),n.d?n.d[0]?n.s:0*n.s:n.s||NaN}function Hr(n){return new this(n).sin()}function zr(n){return new this(n).sinh()}function jr(n){return new this(n).sqrt()}function Zr(n,t){return new this(n).sub(t)}function Yr(){var n=0,t=arguments,e=new this(t[n]);for(I=!1;e.s&&++n<t.length;)e=e.plus(t[n]);return I=!0,B(e,this.precision,this.rounding)}function Jr(n){return new this(n).tan()}function Xr(n){return new this(n).tanh()}function Qr(n){return B(n=new this(n),n.e+1,1)}h[Symbol.for("nodejs.util.inspect.custom")]=h.toString;h[Symbol.toStringTag]="Decimal";var Re=h.constructor=hn(Tt);Xe=new Re(Xe);Qe=new Re(Qe);var ee=Re;import{PublicKey as Nt}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as $r}from"@solana/spl-token";import{PublicKey as U,SystemProgram as bn,SYSVAR_RENT_PUBKEY as ei}from"@solana/web3.js";function St({pubkey:n,isSigner:t=!1,isWritable:e=!0}){return{pubkey:n,isWritable:e,isSigner:t}}var ro=[St({pubkey:$r,isWritable:!1}),St({pubkey:bn.programId,isWritable:!1}),St({pubkey:ei,isWritable:!1})];function Ct({publicKey:n,transformSol:t}){let e=yn(n.toString());if(e instanceof U)return t&&e.equals(De)?me:e;if(t&&e.toString()===De.toBase58())return me;if(typeof e=="string"){if(e===U.default.toBase58())return U.default;try{return new U(e)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function yn(n){try{return new U(n)}catch{return n}}var io=new U("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),wn=new U("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Pn=new U("SysvarRent111111111111111111111111111111111"),oo=new U("SysvarC1ock11111111111111111111111111111111"),so=new U("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),ao=new U("Sysvar1nstructions1111111111111111111111111"),Tn=bn.programId,uo=new U("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),co=new U("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),lo=new U("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),mo=new U("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),fo=new U("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),po=new U("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),go=new U("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),ho=new U("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),bo=new U("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),yo=new U("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),wo=new U("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),me=new U("So11111111111111111111111111111111111111112"),De=U.default;function rt(n){return Ct({publicKey:n,transformSol:!0})}import{PublicKey as ti}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as An}from"@solana/spl-token";var It={chainId:101,address:ti.default.toBase58(),programId:An.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},ye={chainId:101,address:"So11111111111111111111111111111111111111112",programId:An.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};var Lt=class{constructor({mint:t,decimals:e,symbol:r,name:i,skipMint:o=!1,isToken2022:s=!1}){if(t===De.toBase58()||t instanceof Nt&&De.equals(t)){this.decimals=ye.decimals,this.symbol=ye.symbol,this.name=ye.name,this.mint=new Nt(ye.address),this.isToken2022=!1;return}this.decimals=e,this.symbol=r||t.toString().substring(0,6),this.name=i||t.toString().substring(0,6),this.mint=o?Nt.default:Ct({publicKey:t}),this.isToken2022=s}equals(t){return this===t?!0:this.mint.equals(t.mint)}},Te=Lt;Te.WSOL=new Lt(G(K({},ye),{mint:ye.address}));import{get as xn,set as ni}from"lodash";var Mt=class{constructor(t){this.logLevel=t.logLevel!==void 0?t.logLevel:0,this.name=t.name}set level(t){this.logLevel=t}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(t){return t<=this.logLevel}error(...t){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...t),this):this}logWithError(...t){let e=t.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(e)}warning(...t){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...t),this):this}info(...t){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...t),this):this}debug(...t){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...t),this):this}},Bn={},ri={};function X(n){let t=xn(Bn,n);if(!t){let e=xn(ri,n);t=new Mt({name:n,logLevel:e}),ni(Bn,n,t)}return t}import ot from"big.js";import si from"bn.js";import ai from"decimal.js-light";import ii from"toformat";var oi=ii,Ee=oi;var it=X("module/fraction"),Rt=Ee(ot),Ke=Ee(ai),ui={[0]:Ke.ROUND_DOWN,[1]:Ke.ROUND_HALF_UP,[2]:Ke.ROUND_UP},ci={[0]:ot.roundDown,[1]:ot.roundHalfUp,[2]:ot.roundUp},q=class{constructor(t,e=new si(1)){this.numerator=we(t),this.denominator=we(e)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new q(this.denominator,this.numerator)}add(t){let e=t instanceof q?t:new q(we(t));return this.denominator.eq(e.denominator)?new q(this.numerator.add(e.numerator),this.denominator):new q(this.numerator.mul(e.denominator).add(e.numerator.mul(this.denominator)),this.denominator.mul(e.denominator))}sub(t){let e=t instanceof q?t:new q(we(t));return this.denominator.eq(e.denominator)?new q(this.numerator.sub(e.numerator),this.denominator):new q(this.numerator.mul(e.denominator).sub(e.numerator.mul(this.denominator)),this.denominator.mul(e.denominator))}mul(t){let e=t instanceof q?t:new q(we(t));return new q(this.numerator.mul(e.numerator),this.denominator.mul(e.denominator))}div(t){let e=t instanceof q?t:new q(we(t));return new q(this.numerator.mul(e.denominator),this.denominator.mul(e.numerator))}toSignificant(t,e={groupSeparator:""},r=1){Number.isInteger(t)||it.logWithError(`${t} is not an integer.`),t<=0&&it.logWithError(`${t} is not positive.`),Ke.set({precision:t+1,rounding:ui[r]});let i=new Ke(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(t);return i.toFormat(i.decimalPlaces(),e)}toFixed(t,e={groupSeparator:""},r=1){return Number.isInteger(t)||it.logWithError(`${t} is not an integer.`),t<0&&it.logWithError(`${t} is negative.`),Rt.DP=t,Rt.RM=ci[r]||1,new Rt(this.numerator.toString()).div(this.denominator.toString()).toFormat(t,e)}isZero(){return this.numerator.isZero()}};var jo=X("Raydium_price");var Dt=class{constructor({decimals:t,symbol:e="UNKNOWN",name:r="UNKNOWN"}){this.decimals=t,this.symbol=e,this.name=r}equals(t){return this===t}},st=Dt;st.SOL=new Dt(It);import mi from"bn.js";var kn=new q(new mi(100)),ae=class extends q{toSignificant(t=5,e,r){return this.mul(kn).toSignificant(t,e,r)}toFixed(t=2,e,r){return this.mul(kn).toFixed(t,e,r)}};import{PublicKey as us}from"@solana/web3.js";import ls from"bn.js";var Et=new te(0),Cs=new te(1),Is=new te(2),Ns=new te(3),Ls=new te(5),fi=new te(10),Ms=new te(100),Rs=new te(1e3),Ds=new te(1e4),Cn=9007199254740991;function we(n){let t=X("Raydium_parseBigNumberish");if(n instanceof te)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new te(n);t.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&t.logWithError(`BigNumberish number underflow: ${n}`),(n>=Cn||n<=-Cn)&&t.logWithError(`BigNumberish number overflow: ${n}`),new te(String(n))):typeof n=="bigint"?new te(n.toString()):(t.error(`invalid BigNumberish value: ${n}`),new te(0))}var zs=X("Raydium_amount"),js=Ee(pi);import{PublicKey as wi}from"@solana/web3.js";import{PublicKey as di,ComputeBudgetProgram as In,Transaction as Ln,TransactionMessage as gi,Keypair as Mn,VersionedTransaction as Rn}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as hi}from"@solana/spl-token";var fe={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut"};var Nn=X("Raydium_txUtil"),Dn=1644;function at(n){let t=[],e=[];return n.microLamports&&(t.push(In.setComputeUnitPrice({microLamports:n.microLamports})),e.push(fe.SetComputeUnitPrice)),n.units&&(t.push(In.setComputeUnitLimit({units:n.units})),e.push(fe.SetComputeUnitLimit)),{instructions:t,instructionTypes:e}}async function ke(n,t){var r,i;let e=t!=null?t:"confirmed";try{return((i=await((r=n.getLatestBlockhash)==null?void 0:r.call(n,{commitment:e})))==null?void 0:i.blockhash)||(await n.getRecentBlockhash(e)).blockhash}catch{return(await n.getRecentBlockhash(e)).blockhash}}function bi(n,t){n.length<1&&Nn.logWithError(`no instructions provided: ${n.toString()}`),t.length<1&&Nn.logWithError(`no signers provided:, ${t.toString()}`);let e=new Ln;e.recentBlockhash="11111111111111111111111111111111",e.feePayer=t[0],e.add(...n);try{return Buffer.from(e.serialize({verifySignatures:!1})).toString("base64").length<Dn}catch{return!1}}function Pe(n,t){let[e,r]=di.findProgramAddressSync(n,t);return{publicKey:e,nonce:r}}function ve({instructions:n,payer:t,signers:e}){return bi(n,[t,...e])}function Oe({instructions:n,payer:t,lookupTableAddressAccount:e,recentBlockhash:r=Mn.generate().publicKey.toString()}){let o=new gi({payerKey:t,recentBlockhash:r,instructions:n}).compileToV0Message(Object.values(e!=null?e:{}));try{return Buffer.from(new Rn(o).serialize()).toString("base64").length<Dn}catch{return!1}}var yi=n=>Buffer.isBuffer(n)?n:n instanceof Uint8Array?Buffer.from(n.buffer,n.byteOffset,n.byteLength):Buffer.from(n);function Ae(n){let t=[];return n.forEach(e=>{e instanceof Ln&&(e.recentBlockhash||(e.recentBlockhash=hi.toBase58()),e.feePayer||(e.feePayer=Mn.generate().publicKey));let r=e.serialize({requireAllSignatures:!1,verifySignatures:!1});e instanceof Rn&&(r=yi(r));let i=r.toString("base64");t.push(i)}),console.log("simulate tx string:",t),t}import{TOKEN_PROGRAM_ID as Pi}from"@solana/spl-token";function En(n,t,e){return Pe([n.toBuffer(),(e!=null?e:Pi).toBuffer(),t.toBuffer()],new wi("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import qt from"bn.js";import vn from"bn.js";var vt=new vn(1e6);function Ti(n,t,e){return n.mul(t).add(e).sub(new vn(1)).div(e)}function Kn(n,t,e){return n.mul(t).div(e)}var ut=class{static tradingFee(t,e){return Ti(t,e,vt)}static protocolFee(t,e){return Kn(t,e,vt)}static fundFee(t,e){return Kn(t,e,vt)}};import Fe from"bn.js";function ct(n,t){if(t.isZero())throw Error("divisor is zero");return n.mod(t)}function Ai(n,t){if(t.isZero())throw Error("rhs is zero");let e=n.div(t);if(e.isZero())throw Error("quotient is zero");let r=ct(n,t);return r.gt(Se)&&(e=e.add(new Fe(1)),t=n.div(e),r=ct(n,e),r.gt(Se)&&(t=t.add(new Fe(1)))),[e,t]}var Se=new Fe(0),lt=class{static swapWithoutFees(t,e,r){let i=e.mul(r),o=e.add(t),[s,a]=Ai(i,o),u=a.sub(e),c=r.sub(s);if(c.isZero())throw Error("destinationAmountSwapped is zero");return{sourceAmountSwapped:u,destinationAmountSwapped:c}}static lpTokensToTradingTokens(t,e,r,i,o){let s=t.mul(r).div(e),a=t.mul(i).div(e);if(o===0)return{tokenAmount0:s,tokenAmount1:a};if(o===1)return ct(t.mul(r),e).gt(Se)&&s.gt(Se)&&(s=s.add(new Fe(1))),ct(t.mul(i),e).gt(Se)&&a.gt(Se)&&(a=a.add(new Fe(1))),{tokenAmount0:s,tokenAmount1:a};throw Error("roundDirection value error")}};import{PublicKey as We,sendAndConfirmTransaction as Vt,Transaction as Ve,TransactionMessage as qe,VersionedTransaction as Ue}from"@solana/web3.js";import Ci from"axios";import{PublicKey as _n,AddressLookupTableAccount as mt}from"@solana/web3.js";import{PublicKey as On}from"@solana/web3.js";import{MINT_SIZE as xi,TOKEN_PROGRAM_ID as Bi,getTransferFeeConfig as ki,unpackMint as Si}from"@solana/spl-token";var Ot=X("Raydium_accountInfo_util");async function _t(n,t,e){let{batchRequest:r,commitment:i="confirmed",chunkCount:o=100}=K({batchRequest:!1},e),s=Ft(t,o),a=new Array(s.length).fill([]);if(r){let u=s.map(m=>{let f=n._buildArgs([m.map(p=>p.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:f}}),c=Ft(u,10);a=(await(await Promise.all(c.map(async m=>await n._rpcBatchRequest(m)))).flat()).map(m=>(m.error&&Ot.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.error.message}`),m.result.value.map(f=>{if(f){let{data:p,executable:y,lamports:d,owner:P,rentEpoch:T}=f;return p.length!==2&&p[1]!=="base64"&&Ot.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:y,lamports:d,owner:new On(P),rentEpoch:T}}return null})))}else try{a=await Promise.all(s.map(u=>n.getMultipleAccountsInfo(u,i)))}catch(u){u instanceof Error&&Ot.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.message}`)}return a.flat()}async function _e(n,t,e){let r=await _t(n,t.map(i=>i.pubkey),e);return t.map((i,o)=>G(K({},i),{accountInfo:r[o]}))}async function Fn({connection:n,mints:t,config:e}){var o,s,a;if(t.length===0)return{};let r=await _e(n,t.map(u=>({pubkey:rt(u)})),e),i={};for(let u of r){if(!u.accountInfo||u.accountInfo.data.length<xi){console.log("invalid mint account",u.pubkey.toBase58());continue}let c=Si(u.pubkey,u.accountInfo,(o=u.accountInfo)==null?void 0:o.owner);i[u.pubkey.toString()]=G(K({},c),{programId:((s=u.accountInfo)==null?void 0:s.owner)||Bi,feeConfig:(a=ki(c))!=null?a:void 0})}return i[On.default.toBase58()]=i[me.toBase58()],i}async function Wt({connection:n,address:t}){let e=await _t(n,[...new Set(t.map(i=>i.toString()))].map(i=>new _n(i))),r={};for(let i=0;i<t.length;i++){let o=e[i],s=t[i];if(!o)continue;let a=new mt({key:s,state:mt.deserialize(o.data)});r[s.toString()]=a,ft[s.toString()]=a}return r}var ft={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new mt({key:new _n("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:mt.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};var pt=class{constructor(t){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=t.connection,this.feePayer=t.feePayer,this.signAllTransactions=t.signAllTransactions,this.owner=t.owner,this.cluster=t.cluster,this.blockhashCommitment=t.blockhashCommitment,this.api=t.api}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var r;let t=(await Ci.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:e}=(r=t==null?void 0:t[15])!=null?r:{};if(!!e)return{units:6e5,microLamports:Math.min(Math.ceil(e*1e6/6e5),25e3)}}addCustomComputeBudget(t){if(t){let{instructions:e,instructionTypes:r}=at(t);return this.instructions.unshift(...e),this.instructionTypes.unshift(...r),!0}return!1}async calComputeBudget({config:t,defaultIns:e}){try{let r=t||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(r))return;e&&this.instructions.unshift(...e)}catch{e&&this.instructions.unshift(...e)}}addInstruction({instructions:t=[],endInstructions:e=[],signers:r=[],instructionTypes:i=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...t),this.endInstructions.push(...e),this.signers.push(...r),this.instructionTypes.push(...i),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==We.default.toString())),this}async versionBuild({txVersion:t,extInfo:e}){return t===0?await this.buildV0(K({},e||{})):this.build(e)}build(t){var r;let e=new Ve;return this.allInstructions.length&&e.add(...this.allInstructions),e.feePayer=this.feePayer,((r=this.owner)==null?void 0:r.signer)&&!this.signers.some(i=>i.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:e,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async i=>{var c;let{recentBlockHash:o,skipPreflight:s=!0,sendAndConfirm:a}=i||{},u=o!=null?o:await ke(this.connection,this.blockhashCommitment);if(e.recentBlockhash=u,this.signers.length&&e.sign(...this.signers),Ae([e]),(c=this.owner)!=null&&c.isKeyPair)return{txId:a?await Vt(this.connection,e,this.signers.find(m=>m.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(e.serialize(),{skipPreflight:s}),signedTx:e};if(this.signAllTransactions){let l=await this.signAllTransactions([e]);return{txId:await this.connection.sendRawTransaction(l[0].serialize(),{skipPreflight:s}),signedTx:l[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:t||{}}}buildMultiTx(t){var c;let{extraPreBuildData:e=[],extInfo:r}=t,{transaction:i}=this.build(r),o=e.filter(l=>l.transaction.instructions.length>0),s=[i,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],u=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(c=this.owner)!=null&&c.signer&&a.forEach(l=>{l.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:u,execute:async l=>{var P;let{sequentially:m,onTxUpdate:f,recentBlockHash:p,skipPreflight:y=!0}=l||{},d=p!=null?p:await ke(this.connection,this.blockhashCommitment);if((P=this.owner)!=null&&P.isKeyPair){if(m){let T=[];for(let w of s){let g=await Vt(this.connection,w,this.signers.find(b=>b.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:y});T.push(g)}return{txIds:T,signedTxs:s}}return{txIds:await await Promise.all(s.map(async T=>(T.recentBlockhash=d,await this.connection.sendRawTransaction(T.serialize(),{skipPreflight:y})))),signedTxs:s}}if(this.signAllTransactions){let T=s.map((g,b)=>(g.recentBlockhash=d,a[b].length&&g.sign(...a[b]),g));Ae(T);let w=await this.signAllTransactions(T);if(m){let g=0,b=[],k=async()=>{if(!w[g])return;let A=await this.connection.sendRawTransaction(w[g].serialize(),{skipPreflight:y});b.push({txId:A,status:"sent",signedTx:w[g]}),f==null||f([...b]),g++,this.connection.onSignature(A,M=>{let C=b.findIndex(R=>R.txId===A);C>-1&&(b[C].status=M.err?"error":"success"),f==null||f([...b]),M.err||k()},"processed"),this.connection.getSignatureStatus(A)};return await k(),{txIds:b.map(A=>A.txId),signedTxs:w}}else{let g=[];for(let b=0;b<w.length;b+=1){let k=await this.connection.sendRawTransaction(w[b].serialize(),{skipPreflight:y});g.push(k)}return{txIds:g,signedTxs:w}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async versionMultiBuild({extraPreBuildData:t,txVersion:e,extInfo:r}){return e===0?await this.buildV0MultiTx({extraPreBuildData:t,buildProps:r||{}}):this.buildMultiTx({extraPreBuildData:t,extInfo:r})}async buildV0(t){var d;let y=t||{},{lookupTableCache:e={},lookupTableAddress:r=[],forerunCreate:i,recentBlockhash:o}=y,s=ce(y,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),a=K(K({},this.cluster==="devnet"?{}:ft),e),u=Array.from(new Set([...r,...this.lookupTableAddress])),c=[];for(let P of u)a[P]===void 0&&c.push(new We(P));let l=await Wt({connection:this.connection,address:c});for(let[P,T]of Object.entries(l))a[P]=T;let m=i?We.default.toBase58():o!=null?o:await ke(this.connection,this.blockhashCommitment),f=new qe({payerKey:this.feePayer,recentBlockhash:m,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(a));((d=this.owner)==null?void 0:d.signer)&&!this.signers.some(P=>P.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let p=new Ue(f);return p.sign(this.signers),{builder:this,transaction:p,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async P=>{var g;let{skipPreflight:T=!0,sendAndConfirm:w}=P||{};if(Ae([p]),(g=this.owner)!=null&&g.isKeyPair){let b=await this.connection.sendTransaction(p,{skipPreflight:T});if(w){let{lastValidBlockHeight:k,blockhash:A}=await this.connection.getLatestBlockhash({commitment:this.blockhashCommitment});await this.connection.confirmTransaction({blockhash:A,lastValidBlockHeight:k,signature:b},"confirmed")}return{txId:b,signedTx:p}}if(this.signAllTransactions){let b=await this.signAllTransactions([p]);return{txId:await this.connection.sendTransaction(b[0],{skipPreflight:T}),signedTx:b[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildV0MultiTx(t){var c;let{extraPreBuildData:e=[],buildProps:r}=t,{transaction:i}=await this.buildV0(r),o=e.filter(l=>l.builder.instructions.length>0),s=[i,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],u=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(c=this.owner)!=null&&c.signer&&a.forEach(l=>{l.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(l,m)=>{l.sign(a[m])}),{builder:this,transactions:s,signers:a,instructionTypes:u,buildProps:r,execute:async l=>{var d;let{sequentially:m,onTxUpdate:f,recentBlockHash:p,skipPreflight:y=!0}=l||{};if(p&&s.forEach(P=>P.message.recentBlockhash=p),Ae(s),(d=this.owner)!=null&&d.isKeyPair){if(m){let P=[];for(let T of s){let w=await this.connection.sendTransaction(T,{skipPreflight:y}),{lastValidBlockHeight:g,blockhash:b}=await this.connection.getLatestBlockhash({commitment:this.blockhashCommitment});await this.connection.confirmTransaction({blockhash:b,lastValidBlockHeight:g,signature:w},"confirmed"),P.push(w)}return{txIds:P,signedTxs:s}}return{txIds:await Promise.all(s.map(async P=>await this.connection.sendTransaction(P,{skipPreflight:y}))),signedTxs:s}}if(this.signAllTransactions){let P=await this.signAllTransactions(s);if(m){let T=0,w=[],g=async()=>{if(!P[T])return;let b=await this.connection.sendTransaction(P[T],{skipPreflight:y});w.push({txId:b,status:"sent",signedTx:P[T]}),f==null||f([...w]),T++,this.connection.onSignature(b,k=>{let A=w.findIndex(M=>M.txId===b);A>-1&&(w[A].status=k.err?"error":"success"),f==null||f([...w]),k.err||g()},"processed"),this.connection.getSignatureStatus(b)};return g(),{txIds:[],signedTxs:P}}else{let T=[];for(let w=0;w<P.length;w+=1){let g=await this.connection.sendTransaction(P[w],{skipPreflight:y});T.push(g)}return{txIds:T,signedTxs:P}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuild(t){var l;let c=t||{},{computeBudgetConfig:e}=c,r=ce(c,["computeBudgetConfig"]),i=e?at(e):{instructions:[],instructionTypes:[]},o=this.signers.reduce((m,f)=>G(K({},m),{[f.publicKey.toBase58()]:f}),{}),s=[],a=[],u=[];if(this.allInstructions.forEach(m=>{let f=[...u,m],p=e?[...i.instructions,...f]:f,d=[...new Set(f.map(P=>P.keys.filter(T=>T.isSigner).map(T=>T.pubkey.toString())).flat()).values()].map(P=>new We(P));if(u.length<12&&ve({instructions:p,payer:this.feePayer,signers:d})||ve({instructions:f,payer:this.feePayer,signers:d}))u.push(m);else{if(u.length===0)throw Error("item ins too big");ve({instructions:e?[...i.instructions,...u]:[...u],payer:this.feePayer,signers:d})?s.push(new Ve().add(...i.instructions,...u)):s.push(new Ve().add(...u)),a.push(Array.from(new Set(u.map(P=>P.keys.filter(T=>T.isSigner).map(T=>T.pubkey.toString())).flat())).map(P=>o[P]).filter(P=>P!==void 0)),u=[m]}}),u.length>0){let f=[...new Set(u.map(p=>p.keys.filter(y=>y.isSigner).map(y=>y.pubkey.toString())).flat()).values()].map(p=>o[p]).filter(p=>p!==void 0);ve({instructions:e?[...i.instructions,...u]:[...u],payer:this.feePayer,signers:f.map(p=>p.publicKey)})?s.push(new Ve().add(...i.instructions,...u)):s.push(new Ve().add(...u)),a.push(f)}return s.forEach(m=>m.feePayer=this.feePayer),(l=this.owner)!=null&&l.signer&&a.forEach(m=>{m.some(f=>f.publicKey.equals(this.owner.publicKey))||m.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:this.instructionTypes,execute:async m=>{var T;let{sequentially:f,onTxUpdate:p,recentBlockHash:y,skipPreflight:d=!0}=m||{},P=y!=null?y:await ke(this.connection,this.blockhashCommitment);if(s.forEach(async(w,g)=>{w.recentBlockhash=P,a[g].length&&w.sign(...a[g])}),Ae(s),(T=this.owner)!=null&&T.isKeyPair){if(f){let w=[];for(let g of s){let b=await Vt(this.connection,g,this.signers.find(k=>k.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:d});w.push(b)}return{txIds:w,signedTxs:s}}return{txIds:await Promise.all(s.map(async w=>await this.connection.sendRawTransaction(w.serialize(),{skipPreflight:d}))),signedTxs:s}}if(this.signAllTransactions){let w=await this.signAllTransactions(s);if(f){let g=0,b=[],k=async()=>{if(!w[g])return;let A=await this.connection.sendRawTransaction(w[g].serialize(),{skipPreflight:d});b.push({txId:A,status:"sent",signedTx:w[g]}),p==null||p([...b]),g++,this.connection.onSignature(A,M=>{let C=b.findIndex(R=>R.txId===A);C>-1&&(b[C].status=M.err?"error":"success"),p==null||p([...b]),M.err||k()},"processed"),this.connection.getSignatureStatus(A)};return await k(),{txIds:b.map(A=>A.txId),signedTxs:w}}else{let g=[];for(let b=0;b<w.length;b+=1){let k=await this.connection.sendRawTransaction(w[b].serialize(),{skipPreflight:d});g.push(k)}return{txIds:g,signedTxs:w}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuildV0(t){var T;let P=t||{},{computeBudgetConfig:e,lookupTableCache:r={},lookupTableAddress:i=[]}=P,o=ce(P,["computeBudgetConfig","lookupTableCache","lookupTableAddress"]),s=K(K({},this.cluster==="devnet"?{}:ft),r),a=Array.from(new Set([...this.lookupTableAddress,...i])),u=[];for(let w of a)s[w]===void 0&&u.push(new We(w));let c=await Wt({connection:this.connection,address:u});for(let[w,g]of Object.entries(c))s[w]=g;let l=e?at(e):{instructions:[],instructionTypes:[]},m=await ke(this.connection,this.blockhashCommitment),f=this.signers.reduce((w,g)=>G(K({},w),{[g.publicKey.toBase58()]:g}),{}),p=[],y=[],d=[];if(this.allInstructions.forEach(w=>{let g=[...d,w],b=e?[...l.instructions,...g]:g;if(d.length<12&&Oe({instructions:b,payer:this.feePayer,lookupTableAddressAccount:s})||Oe({instructions:g,payer:this.feePayer,lookupTableAddressAccount:s}))d.push(w);else{if(d.length===0)throw Error("item ins too big");let k={};for(let A of[...new Set(a)])s[A]!==void 0&&(k[A]=s[A]);if(e&&Oe({instructions:[...l.instructions,...d],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:m})){let A=new qe({payerKey:this.feePayer,recentBlockhash:m,instructions:[...l.instructions,...d]}).compileToV0Message(Object.values(s));p.push(new Ue(A))}else{let A=new qe({payerKey:this.feePayer,recentBlockhash:m,instructions:[...d]}).compileToV0Message(Object.values(s));p.push(new Ue(A))}y.push(Array.from(new Set(d.map(A=>A.keys.filter(M=>M.isSigner).map(M=>M.pubkey.toString())).flat())).map(A=>f[A]).filter(A=>A!==void 0)),d=[w]}}),d.length>0){let g=[...new Set(d.map(b=>b.keys.filter(k=>k.isSigner).map(k=>k.pubkey.toString())).flat()).values()].map(b=>f[b]).filter(b=>b!==void 0);if(e&&Oe({instructions:[...l.instructions,...d],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:m})){let b=new qe({payerKey:this.feePayer,recentBlockhash:m,instructions:[...l.instructions,...d]}).compileToV0Message(Object.values(s));p.push(new Ue(b))}else{let b=new qe({payerKey:this.feePayer,recentBlockhash:m,instructions:[...d]}).compileToV0Message(Object.values(s));p.push(new Ue(b))}y.push(g)}return(T=this.owner)!=null&&T.signer&&y.forEach(w=>{w.some(g=>g.publicKey.equals(this.owner.publicKey))||w.push(this.owner.signer)}),{builder:this,transactions:p,buildProps:t,signers:y,instructionTypes:this.instructionTypes,execute:async w=>{var M;let{sequentially:g,onTxUpdate:b,recentBlockHash:k,skipPreflight:A=!0}=w||{};if(p.map(async(C,R)=>{y[R].length&&C.sign(y[R]),k&&(C.message.recentBlockhash=k)}),Ae(p),(M=this.owner)!=null&&M.isKeyPair){if(g){let C=[];for(let R of p){let E=await this.connection.sendTransaction(R,{skipPreflight:A}),{lastValidBlockHeight:F,blockhash:v}=await this.connection.getLatestBlockhash({commitment:this.blockhashCommitment});await this.connection.confirmTransaction({blockhash:v,lastValidBlockHeight:F,signature:E},"confirmed"),C.push(E)}return{txIds:C,signedTxs:p}}return{txIds:await Promise.all(p.map(async C=>await this.connection.sendTransaction(C,{skipPreflight:A}))),signedTxs:p}}if(this.signAllTransactions){let C=await this.signAllTransactions(p);if(g){let R=0,E=[],F=async()=>{if(!C[R])return;let v=await this.connection.sendTransaction(C[R],{skipPreflight:A});E.push({txId:v,status:"sent",signedTx:C[R]}),b==null||b([...E]),R++,this.connection.onSignature(v,j=>{let Z=E.findIndex(W=>W.txId===v);Z>-1&&(E[Z].status=j.err?"error":"success"),b==null||b([...E]),j.err||F()},"processed"),this.connection.getSignatureStatus(v)};return F(),{txIds:[],signedTxs:C}}else{let R=[];for(let E=0;E<C.length;E+=1){let F=await this.connection.sendTransaction(C[E],{skipPreflight:A});R.push(F)}return{txIds:R,signedTxs:C}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}};function Ft(n,t=1,e=[]){let r=[...n];if(t<=0)return e;for(;r.length;)e.push(r.splice(0,t));return e}import{PublicKey as D}from"@solana/web3.js";var eu=new D("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),tu=new D("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),nu=new D("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),ru=new D("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),iu=new D("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),ou=new D("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),su=new D("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),au=new D("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),uu=new D("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),cu=new D("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),lu=new D("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),mu=new D("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),fu=new D("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),pu=new D("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),du=new D("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),gu=new D("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),hu=new D("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),bu=new D("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),yu=new D("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Ii=new D("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),Ni=new D("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),Li=new D("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2");var wu={SERUM_MARKET:D.default,OPENBOOK_MARKET:new D("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:D.default,FarmV3:new D("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new D("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new D("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new D("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new D("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new D("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),Router:new D("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:Ii,CREATE_CPMM_POOL_AUTH:Ni,CREATE_CPMM_POOL_FEE_ACC:Li,FEE_DESTINATION_ID:new D("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR")};import ie from"bn.js";var Ge=1e4;function Ie(n,t,e,r){if(t===void 0)return{amount:n,fee:void 0,expirationTime:void 0};let i=G(K({},t),{olderTransferFee:{epoch:BigInt(t.olderTransferFee.epoch),maximumFee:BigInt(t.olderTransferFee.maximumFee),transferFeeBasisPoints:t.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(t.newerTransferFee.epoch),maximumFee:BigInt(t.newerTransferFee.maximumFee),transferFeeBasisPoints:t.newerTransferFee.transferFeeBasisPoints}}),o=e.epoch<i.newerTransferFee.epoch?i.olderTransferFee:i.newerTransferFee,s=new ie(o.maximumFee.toString()),a=e.epoch<i.newerTransferFee.epoch?(Number(i.newerTransferFee.epoch)*e.slotsInEpoch-e.absoluteSlot)*400/1e3:void 0;if(r)if(o.transferFeeBasisPoints===Ge){let u=new ie(o.maximumFee.toString());return{amount:n.add(u),fee:u,expirationTime:a}}else{let u=Ce(n.mul(new ie(Ge)),new ie(Ge-o.transferFeeBasisPoints)),c=new ie(o.maximumFee.toString()),l=u.sub(n).gt(c)?n.add(c):u,m=Ce(l.mul(new ie(o.transferFeeBasisPoints)),new ie(Ge)),f=m.gt(s)?s:m;return{amount:l,fee:f,expirationTime:a}}else{let u=Ce(n.mul(new ie(o.transferFeeBasisPoints)),new ie(Ge)),c=u.gt(s)?s:u;return{amount:n,fee:c,expirationTime:a}}}function Ce(n,t){let{div:e,mod:r}=n.divmod(t);return r.gt(new ie(0))?e.add(new ie(1)):e}import dt from"decimal.js-light";var gt=class{static validate_supply(t,e){if(t.isZero())throw Error("tokenAmount0 is zero");if(e.isZero())throw Error("tokenAmount1 is zero")}static swap(t,e,r,i){let o=ut.tradingFee(t,i),s=t.sub(o),{sourceAmountSwapped:a,destinationAmountSwapped:u}=lt.swapWithoutFees(s,e,r),c=a.add(o);return{newSwapSourceAmount:e.add(c),newSwapDestinationAmount:r.sub(u),sourceAmountSwapped:c,destinationAmountSwapped:u,tradeFee:o}}static swapBaseOut({poolMintA:t,poolMintB:e,tradeFeeRate:r,baseReserve:i,quoteReserve:o,outputMint:s,outputAmount:a}){let[u,c,l,m,f]=e.address===s.toString()?[i,o,t.decimals,e.decimals,t.address]:[o,i,e.decimals,t.decimals,e.address],p=new dt(c.toString()).div(10**m).div(new dt(u.toString()).div(10**l)),y=a.gte(c)?c.sub(new qt(1)):a,d=c.sub(y),P=Ce(u.mul(y),d),T=Ce(P.mul(new qt(1e6)),new qt(1e6).sub(r)),w=T.sub(P),g=new dt(y.toString()).div(10**m).div(new dt(T.toString()).div(10**l)),b=p.isZero()?0:g.sub(p).div(p).abs().toNumber();return{amountRealOut:y,amountIn:T,amountInWithoutFee:P,tradeFee:w,priceImpact:b}}};var Ut=(...n)=>n.map(t=>{try{return typeof t=="object"?JSON.stringify(t):t}catch{return t}}).join(", "),He=class{constructor({scope:t,moduleName:e}){this.disabled=!1;this.scope=t,this.logger=X(e)}createTxBuilder(t){return this.scope.checkOwner(),new pt({connection:this.scope.connection,feePayer:t||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...t){this.logger.debug(Ut(t))}logInfo(...t){this.logger.info(Ut(t))}logAndCreateError(...t){let e=Ut(t);throw new Error(e)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};var Mi=Buffer.from("vault_and_lp_mint_auth_seed","utf8"),Xu=Buffer.from("amm_config","utf8"),Ri=Buffer.from("pool","utf8"),Di=Buffer.from("pool_lp_mint","utf8"),Ei=Buffer.from("pool_vault","utf8"),Ki=Buffer.from("observation","utf8");function ht(n){return Pe([Mi],n)}function vi(n,t,e,r){return Pe([Ri,t.toBuffer(),e.toBuffer(),r.toBuffer()],n)}function Oi(n,t){return Pe([Di,t.toBuffer()],n)}function Wn(n,t,e){return Pe([Ei,t.toBuffer(),e.toBuffer()],n)}function bt(n,t){return Pe([Ki,t.toBuffer()],n)}function Vn({programId:n,configId:t,mintA:e,mintB:r}){let i=ht(n).publicKey,o=vi(n,t,e,r).publicKey,s=Oi(n,o).publicKey,a=Wn(n,o,e).publicKey,u=Wn(n,o,r).publicKey,c=bt(n,o).publicKey;return{poolId:o,configId:t,authority:i,lpMint:s,vaultA:a,vaultB:u,observationId:c}}import{TransactionInstruction as ze}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Jt,TOKEN_2022_PROGRAM_ID as Yn,ASSOCIATED_TOKEN_PROGRAM_ID as Zi}from"@solana/spl-token";import{PublicKey as Hi}from"@solana/web3.js";import zn,{isBN as jn}from"bn.js";import{bits as ec,BitStructure as tc,blob as Fi,Blob as nc,cstr as rc,f32 as ic,f32be as oc,f64 as sc,f64be as ac,greedy as uc,Layout as _i,ns64 as cc,ns64be as lc,nu64 as mc,nu64be as fc,offset as pc,s16 as dc,s16be as gc,s24 as hc,s24be as bc,s32 as yc,s32be as wc,s40 as Pc,s40be as Tc,s48 as Ac,s48be as xc,s8 as Bc,seq as Wi,struct as kc,Structure as Vi,u16 as qi,u16be as Sc,u24 as Cc,u24be as Ic,u32 as Nc,u32be as Lc,u40 as Mc,u40be as Rc,u48 as Dc,u48be as Ec,u8 as Ui,UInt as Gi,union as Kc,Union as vc,unionLayoutDiscriminator as Oc,utf8 as Fc}from"@solana/buffer-layout";var Gt=_i,qn=Vi;var Ht=Gi;var Un=Ui,Gn=qi;var Hn=Wi;var Ne=Fi;var zt=class extends Gt{constructor(e,r,i){super(e,i);this.blob=Ne(e),this.signed=r}decode(e,r=0){let i=new zn(this.blob.decode(e,r),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(e,r,i=0){return typeof e=="number"&&(e=new zn(e)),this.signed&&(e=e.toTwos(this.span*8)),this.blob.encode(e.toArrayLike(Buffer,"le",this.span),r,i)}};function ue(n){return new Ht(1,n)}function Zt(n){return new Ht(4,n)}function O(n){return new zt(8,!1,n)}var yt=class extends Gt{constructor(e,r,i,o){super(e.span,o);this.layout=e,this.decoder=r,this.encoder=i}decode(e,r){return this.decoder(this.layout.decode(e,r))}encode(e,r,i){return this.layout.encode(this.encoder(e),r,i)}getSpan(e,r){return this.layout.getSpan(e,r)}};function Q(n){return new yt(Ne(32),t=>new Hi(t),t=>t.toBuffer(),n)}function Zn(n){return new yt(Un(),zi,ji,n)}function zi(n){if(n===0)return!1;if(n===1)return!0;throw new Error("Invalid bool: "+n)}function ji(n){return n?1:0}var jt=class extends qn{decode(t,e){return super.decode(t,e)}};function oe(n,t,e){return new jt(n,t,e)}function Yt(n,t,e){let r,i=typeof t=="number"?t:jn(t)?t.toNumber():new Proxy(t,{get(o,s){if(!r){let a=Reflect.get(o,"count");r=jn(a)?a.toNumber():a,Reflect.set(o,"count",r)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(r=a),Reflect.set(o,s,a)}});return Hn(n,i,e)}var Yi=X("Raydium_cpmm"),je={initialize:[175,175,109,31,13,152,155,237],deposit:[242,35,198,137,82,225,242,182],withdraw:[183,18,70,156,148,109,161,34],swapBaseInput:[143,190,90,218,196,30,51,222],swapBaseOutput:[55,217,98,86,163,74,180,173]};function Jn(n,t,e,r,i,o,s,a,u,c,l,m,f,p,y,d,P,T,w,g){let b=oe([O("amountMaxA"),O("amountMaxB"),O("openTime")]),k=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:P,isSigner:!1,isWritable:!0},{pubkey:Jt,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:Zi,isSigner:!1,isWritable:!1},{pubkey:Tn,isSigner:!1,isWritable:!1},{pubkey:Pn,isSigner:!1,isWritable:!1}],A=Buffer.alloc(b.span);return b.encode({amountMaxA:T,amountMaxB:w,openTime:g},A),new ze({keys:k,programId:n,data:Buffer.from([...je.initialize,...A])})}function Xn(n,t,e,r,i,o,s,a,u,c,l,m,f,p,y){let d=oe([O("lpAmount"),O("amountMaxA"),O("amountMaxB")]),P=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:Jt,isSigner:!1,isWritable:!1},{pubkey:Yn,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!0}],T=Buffer.alloc(d.span);return Yi.debug("cpmm deposit data",{lpAmount:f.toString(),amountMaxA:p.toString(),amountMaxB:y.toString()}),d.encode({lpAmount:f,amountMaxA:p,amountMaxB:y},T),new ze({keys:P,programId:n,data:Buffer.from([...je.deposit,...T])})}function Qn(n,t,e,r,i,o,s,a,u,c,l,m,f,p,y){let d=oe([O("lpAmount"),O("amountMinA"),O("amountMinB")]),P=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:Jt,isSigner:!1,isWritable:!1},{pubkey:Yn,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:wn,isSigner:!1,isWritable:!1}],T=Buffer.alloc(d.span);return d.encode({lpAmount:f,amountMinA:p,amountMinB:y},T),new ze({keys:P,programId:n,data:Buffer.from([...je.withdraw,...T])})}function $n(n,t,e,r,i,o,s,a,u,c,l,m,f,p,y,d){let P=oe([O("amountIn"),O("amounOutMin")]),T=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!0}],w=Buffer.alloc(P.span);return P.encode({amountIn:y,amounOutMin:d},w),new ze({keys:T,programId:n,data:Buffer.from([...je.swapBaseInput,...w])})}function er(n,t,e,r,i,o,s,a,u,c,l,m,f,p,y,d){let P=oe([O("amountInMax"),O("amountOut")]),T=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!0}],w=Buffer.alloc(P.span);return P.encode({amountInMax:y,amountOut:d},w),new ze({keys:T,programId:n,data:Buffer.from([...je.swapBaseOutput,...w])})}import H from"bn.js";var tr=oe([Ne(8),ue("bump"),Zn("disableCreatePool"),Gn("index"),O("tradeFeeRate"),O("protocolFeeRate"),O("fundFeeRate"),O("createPoolFee"),Q("protocolOwner"),Q("fundOwner"),Yt(O(),16)]),nr=oe([Ne(8),Q("configId"),Q("poolCreator"),Q("vaultA"),Q("vaultB"),Q("mintLp"),Q("mintA"),Q("mintB"),Q("mintProgramA"),Q("mintProgramB"),Q("observationId"),ue("bump"),ue("status"),ue("lpDecimals"),ue("mintDecimalA"),ue("mintDecimalB"),O("lpAmount"),O("protocolFeesMintA"),O("protocolFeesMintB"),O("fundFeesMintA"),O("fundFeesMintB"),O("openTime"),Yt(O(),32)]);var al=oe([Zt("mintAuthorityOption"),Q("mintAuthority"),O("supply"),ue("decimals"),ue("isInitialized"),Zt("freezeAuthorityOption"),Q("freezeAuthority")]);import{PublicKey as ml}from"@solana/web3.js";import{MintLayout as pl,TOKEN_PROGRAM_ID as gl}from"@solana/spl-token";var Le=i=>{var o=i,{address:n,programId:t,decimals:e}=o,r=ce(o,["address","programId","decimals"]);return K({chainId:101,address:rt(n).toBase58(),programId:t,logoURI:"",symbol:"",name:"",decimals:e,tags:[],extensions:r.extensions||{}},r)},Ze=n=>n?G(K({},n),{transferFeeConfigAuthority:n.transferFeeConfigAuthority.toBase58(),withdrawWithheldAuthority:n.withdrawWithheldAuthority.toBase58(),withheldAmount:n.withheldAmount.toString(),olderTransferFee:G(K({},n.olderTransferFee),{epoch:n.olderTransferFee.epoch.toString(),maximumFee:n.olderTransferFee.maximumFee.toString()}),newerTransferFee:G(K({},n.newerTransferFee),{epoch:n.newerTransferFee.epoch.toString(),maximumFee:n.newerTransferFee.maximumFee.toString()})}):void 0;var Xt=class extends He{constructor(t){super(t)}async load(){this.checkDisabled()}async getCpmmPoolKeys(t){return(await this.scope.api.fetchPoolKeysById({idList:[t]}))[0]}async getRpcPoolInfo(t,e){return(await this.getRpcPoolInfos([t],e))[t]}async getRpcPoolInfos(t,e){let r=await _e(this.scope.connection,t.map(m=>({pubkey:new x(m)}))),i={},o=new Set,s=[];for(let m=0;m<t.length;m++){let f=r[m];if(f.accountInfo===null)throw Error("fetch pool info error: "+String(t[m]));let p=nr.decode(f.accountInfo.data);i[String(t[m])]=G(K({},p),{programId:f.accountInfo.owner}),o.add(String(p.configId)),s.push(p.vaultA,p.vaultB)}let a={};if(e){let m=[...o],f=await _e(this.scope.connection,m.map(p=>({pubkey:new x(p)})));for(let p=0;p<m.length;p++){let y=f[p].accountInfo;if(y===null)throw Error("fetch pool config error: "+m[p]);a[m[p]]=tr.decode(y.data)}}let u={},c=await _e(this.scope.connection,s.map(m=>({pubkey:new x(m)})));for(let m=0;m<s.length;m++){let f=c[m].accountInfo;if(f===null)throw Error("fetch vault info error: "+s[m]);u[String(s[m])]=new H(Ji.decode(f.data).amount.toString())}let l={};for(let[m,f]of Object.entries(i)){let p=u[f.vaultA.toString()].sub(f.protocolFeesMintA).sub(f.fundFeesMintA),y=u[f.vaultB.toString()].sub(f.protocolFeesMintB).sub(f.fundFeesMintB);l[m]=G(K({},f),{baseReserve:p,quoteReserve:y,vaultAAmount:u[f.vaultA.toString()],vaultBAmount:u[f.vaultB.toString()],configInfo:a[f.configId.toString()],poolPrice:new ee(y.toString()).div(new ee(10).pow(f.mintDecimalB)).div(new ee(p.toString()).div(new ee(10).pow(f.mintDecimalA)))})}return l}toComputePoolInfos({pools:t,mintInfos:e}){return Object.keys(t).reduce((r,i)=>{var u,c,l,m;let o=t[i],[s,a]=[o.mintA.toBase58(),o.mintB.toBase58()];return G(K({},r),{[i]:G(K({},o),{id:new x(i),configInfo:o.configInfo,version:7,authority:ht(o.programId).publicKey,mintA:Le({address:s,decimals:o.mintDecimalA,programId:o.mintProgramA.toBase58(),extensions:{feeConfig:(u=e[s])!=null&&u.feeConfig?Ze((c=e[s])==null?void 0:c.feeConfig):void 0}}),mintB:Le({address:a,decimals:o.mintDecimalB,programId:o.mintProgramB.toBase58(),extensions:{feeConfig:(l=e[a])!=null&&l.feeConfig?Ze((m=e[a])==null?void 0:m.feeConfig):void 0}})})})},{})}async getPoolInfoFromRpc(t){let e=await this.getRpcPoolInfo(t,!0),r=await Fn({connection:this.scope.connection,mints:[e.mintA,e.mintB]}),i=Le({address:e.mintA.toBase58(),decimals:e.mintDecimalA,programId:e.mintProgramA.toBase58(),extensions:{feeConfig:r[e.mintA.toBase58()].feeConfig?Ze(r[e.mintA.toBase58()].feeConfig):void 0}}),o=Le({address:e.mintB.toBase58(),decimals:e.mintDecimalB,programId:e.mintProgramB.toBase58(),extensions:{feeConfig:r[e.mintB.toBase58()].feeConfig?Ze(r[e.mintB.toBase58()].feeConfig):void 0}}),s=Le({address:e.mintLp.toBase58(),decimals:e.lpDecimals,programId:pe.toBase58()}),a={id:e.configId.toBase58(),index:e.configInfo.index,protocolFeeRate:e.configInfo.protocolFeeRate.toNumber(),tradeFeeRate:e.configInfo.tradeFeeRate.toNumber(),fundFeeRate:e.configInfo.fundFeeRate.toNumber(),createPoolFee:e.configInfo.createPoolFee.toString()},u={volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[]};return{poolInfo:{programId:e.programId.toBase58(),id:t,type:"Standard",lpMint:s,lpPrice:0,lpAmount:e.lpAmount.toNumber(),config:a,mintA:i,mintB:o,rewardDefaultInfos:[],rewardDefaultPoolInfos:"Ecosystem",price:e.poolPrice.toNumber(),mintAmountA:new ee(e.vaultAAmount.toString()).div(10**i.decimals).toNumber(),mintAmountB:new ee(e.vaultBAmount.toString()).div(10**o.decimals).toNumber(),feeRate:e.configInfo.tradeFeeRate.toNumber(),openTime:e.openTime.toString(),tvl:0,day:u,week:u,month:u,pooltype:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0},poolKeys:{programId:e.programId.toBase58(),id:t,mintA:i,mintB:o,openTime:e.openTime.toString(),vault:{A:e.vaultA.toBase58(),B:e.vaultB.toBase58()},authority:ht(e.programId).publicKey.toBase58(),mintLp:s,config:a},rpcData:e}}async createPool(m){var f=m,{programId:t,poolFeeAccount:e,startTime:r,ownerInfo:i,associatedOnly:o=!1,checkCreateATAOwner:s=!1,txVersion:a,feeConfig:u,computeBudgetConfig:c}=f,l=ce(f,["programId","poolFeeAccount","startTime","ownerInfo","associatedOnly","checkCreateATAOwner","txVersion","feeConfig","computeBudgetConfig"]);var j,Z,W;let p=i.feePayer||((j=this.scope.owner)==null?void 0:j.publicKey),y=new H(new x(l.mintA.address).toBuffer()).lte(new H(new x(l.mintB.address).toBuffer())),[d,P]=y?[l.mintA,l.mintB]:[l.mintB,l.mintA],[T,w]=y?[l.mintAAmount,l.mintBAmount]:[l.mintBAmount,l.mintAAmount],g=i.useSOLBalance&&d.address===wt.toBase58(),b=i.useSOLBalance&&P.address===wt.toBase58(),[k,A]=[new x(d.address),new x(P.address)],M=this.createTxBuilder(),{account:C,instructionParams:R}=await this.scope.account.getOrCreateTokenAccount({mint:k,tokenProgram:d.programId,owner:this.scope.ownerPubKey,createInfo:g?{payer:p,amount:T}:void 0,notUseTokenAccount:g,skipCloseAccount:!g,associatedOnly:g?!1:o,checkCreateATAOwner:s});M.addInstruction(R||{});let{account:E,instructionParams:F}=await this.scope.account.getOrCreateTokenAccount({mint:new x(P.address),tokenProgram:P.programId,owner:this.scope.ownerPubKey,createInfo:b?{payer:p,amount:w}:void 0,notUseTokenAccount:b,skipCloseAccount:!b,associatedOnly:b?!1:o,checkCreateATAOwner:s});if(M.addInstruction(F||{}),C===void 0||E===void 0)throw Error("you don't has some token account");let v=Vn({programId:t,configId:new x(u.id),mintA:k,mintB:A});return M.addInstruction({instructions:[Jn(t,this.scope.ownerPubKey,new x(u.id),v.authority,v.poolId,k,A,v.lpMint,C,E,En(this.scope.ownerPubKey,v.lpMint).publicKey,v.vaultA,v.vaultB,e,new x((Z=d.programId)!=null?Z:pe),new x((W=P.programId)!=null?W:pe),v.observationId,T,w,r)],instructionTypes:[fe.CpmmCreatePool]}),M.addCustomComputeBudget(c),M.versionBuild({txVersion:a,extInfo:{address:G(K({},v),{mintA:d,mintB:P,programId:t,poolFeeAccount:e,feeConfig:u})}})}async addLiquidity(t){let{poolInfo:e,poolKeys:r,inputAmount:i,baseIn:o,slippage:s,computeResult:a,computeBudgetConfig:u,config:c,txVersion:l}=t;this.scope.availability.addStandardPosition===!1&&this.logAndCreateError("add liquidity feature disabled in your region"),i.isZero()&&this.logAndCreateError("amounts must greater than zero","amountInA",{amountInA:i.toString()});let{account:m}=this.scope,{bypassAssociatedCheck:f,checkCreateATAOwner:p}=K({bypassAssociatedCheck:!1,checkCreateATAOwner:!1},c),y=a?void 0:await this.getRpcPoolInfo(e.id),{liquidity:d,inputAmountFee:P,anotherAmount:T}=a||this.computePairAmount({poolInfo:G(K({},e),{lpAmount:new ee(y.lpAmount.toString()).div(10**e.lpMint.decimals).toNumber()}),baseReserve:y.baseReserve,quoteReserve:y.quoteReserve,slippage:new ae(0),baseIn:o,epochInfo:await this.scope.fetchEpochInfo(),amount:new ee(i.toString()).div(10**(o?e.mintA.decimals:e.mintB.decimals))}),w=T.amount,g=e.mintA.address===wt.toString(),b=e.mintB.address===wt.toString(),k=this.createTxBuilder(),[A,M]=[new x(e.mintA.address),new x(e.mintB.address)],{account:C,instructionParams:R}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new x(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:g||(o?i:w).isZero()?{payer:this.scope.ownerPubKey,amount:o?i:w}:void 0,skipCloseAccount:!g,notUseTokenAccount:g,associatedOnly:!1,checkCreateATAOwner:p});k.addInstruction(R||{});let{account:E,instructionParams:F}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new x(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:b||(o?w:i).isZero()?{payer:this.scope.ownerPubKey,amount:o?w:i}:void 0,skipCloseAccount:!b,notUseTokenAccount:b,associatedOnly:!1,checkCreateATAOwner:p});k.addInstruction(F||{}),!C&&!E&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",m.tokenAccounts);let v=await m.getCreatedTokenAccount({mint:new x(e.lpMint.address)}),Qt=await m.handleTokenAccount({side:"out",amount:0,mint:new x(e.lpMint.address),tokenAccount:v,bypassAssociatedCheck:f,checkCreateATAOwner:p}),{tokenAccount:j}=Qt,Z=ce(Qt,["tokenAccount"]);k.addInstruction(Z);let W=r!=null?r:await this.getCpmmPoolKeys(e.id),_=new ae(new H(1)).sub(s);return k.addInstruction({instructions:[Xn(new x(e.programId),this.scope.ownerPubKey,new x(W.authority),new x(e.id),j,C,E,new x(W.vault.A),new x(W.vault.B),A,M,new x(e.lpMint.address),a?a==null?void 0:a.liquidity:_.mul(d).quotient,o?P.amount:w,o?w:P.amount)],instructionTypes:[fe.CpmmAddLiquidity],lookupTableAddress:W.lookupTableAccount?[W.lookupTableAccount]:[]}),k.addCustomComputeBudget(u),k.versionBuild({txVersion:l})}async withdrawLiquidity(t){var j,Z;let{poolInfo:e,poolKeys:r,lpAmount:i,slippage:o,computeBudgetConfig:s,txVersion:a}=t;this.scope.availability.addStandardPosition===!1&&this.logAndCreateError("add liquidity feature disabled in your region");let u=new ae(new H(1)).sub(o),c=await this.getRpcPoolInfo(e.id),[l,m]=[u.mul(i.mul(c.baseReserve).div(c.lpAmount)).quotient,u.mul(i.mul(c.quoteReserve).div(c.lpAmount)).quotient],f=await this.scope.fetchEpochInfo(),[p,y]=[Ie(l,e.mintA.extensions.feeConfig,f,!1),Ie(m,e.mintB.extensions.feeConfig,f,!1)],{account:d}=this.scope,P=this.createTxBuilder(),[T,w]=[new x(e.mintA.address),new x(e.mintB.address)],g=T.equals(me),b=w.equals(me),k,A,{account:M,instructionParams:C}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new x(e.mintA.address),notUseTokenAccount:g,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!g,associatedOnly:!g,checkCreateATAOwner:!1});k=M,C&&P.addInstruction(C);let{account:R,instructionParams:E}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new x(e.mintB.address),notUseTokenAccount:b,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!b,associatedOnly:!b,checkCreateATAOwner:!1});A=R,E&&P.addInstruction(E),(!k||!A)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",d.tokenAccounts);let F=await d.getCreatedTokenAccount({mint:new x(e.lpMint.address)});F||this.logAndCreateError("cannot found lp token account","tokenAccounts",d.tokenAccounts);let v=r!=null?r:await this.getCpmmPoolKeys(e.id);return P.addInstruction({instructions:[Qn(new x(e.programId),this.scope.ownerPubKey,new x(v.authority),new x(e.id),F,k,A,new x(v.vault.A),new x(v.vault.B),T,w,new x(e.lpMint.address),i,l.sub((j=p.fee)!=null?j:new H(0)),m.sub((Z=y.fee)!=null?Z:new H(0)))],instructionTypes:[fe.CpmmWithdrawLiquidity],lookupTableAddress:v.lookupTableAccount?[v.lookupTableAccount]:[]}),P.addCustomComputeBudget(s),P.versionBuild({txVersion:a})}async swap(t){var R,E,F,v,j,Z;let{poolInfo:e,poolKeys:r,baseIn:i,fixedOut:o,inputAmount:s,swapResult:a,slippage:u=0,config:c,computeBudgetConfig:l,txVersion:m}=t,{bypassAssociatedCheck:f,checkCreateATAOwner:p,associatedOnly:y}=K({bypassAssociatedCheck:!1,checkCreateATAOwner:!1,associatedOnly:!0},c),d=this.createTxBuilder(),[P,T]=[new x(e.mintA.address),new x(e.mintB.address)];o?a.sourceAmountSwapped=a.sourceAmountSwapped.mul(new H((1+u)*1e4)).div(new H(1e4)):a.destinationAmountSwapped=a.destinationAmountSwapped.mul(new H((1-u)*1e4)).div(new H(1e4));let w=e.mintA.address===me.toBase58(),g=e.mintB.address===me.toBase58(),{account:b,instructionParams:k}=await this.scope.account.getOrCreateTokenAccount({mint:P,tokenProgram:new x((R=e.mintA.programId)!=null?R:pe),owner:this.scope.ownerPubKey,createInfo:w||!i?{payer:this.scope.ownerPubKey,amount:i?a.sourceAmountSwapped:0}:void 0,notUseTokenAccount:w,skipCloseAccount:!w,associatedOnly:w?!1:y,checkCreateATAOwner:p});k&&d.addInstruction(k);let{account:A,instructionParams:M}=await this.scope.account.getOrCreateTokenAccount({mint:T,tokenProgram:new x((E=e.mintB.programId)!=null?E:pe),owner:this.scope.ownerPubKey,createInfo:g||i?{payer:this.scope.ownerPubKey,amount:i?0:a.sourceAmountSwapped}:void 0,notUseTokenAccount:g,skipCloseAccount:!g,associatedOnly:g?!1:y,checkCreateATAOwner:p});M&&d.addInstruction(M),(!b||!A)&&this.logAndCreateError("user do not have token account",{mintA:e.mintA.symbol||e.mintA.address,mintB:e.mintB.symbol||e.mintB.address,mintATokenAcc:b,mintBTokenAcc:A,mintAUseSOLBalance:w,mintBUseSOLBalance:g,associatedOnly:y});let C=r!=null?r:await this.getCpmmPoolKeys(e.id);return d.addInstruction({instructions:[o?er(new x(e.programId),this.scope.ownerPubKey,new x(C.authority),new x(C.config.id),new x(e.id),i?b:A,i?A:b,new x(C.vault[i?"A":"B"]),new x(C.vault[i?"B":"A"]),new x((j=e[i?"mintA":"mintB"].programId)!=null?j:pe),new x((Z=e[i?"mintB":"mintA"].programId)!=null?Z:pe),i?P:T,i?T:P,bt(new x(e.programId),new x(e.id)).publicKey,a.sourceAmountSwapped,a.destinationAmountSwapped):$n(new x(e.programId),this.scope.ownerPubKey,new x(C.authority),new x(C.config.id),new x(e.id),i?b:A,i?A:b,new x(C.vault[i?"A":"B"]),new x(C.vault[i?"B":"A"]),new x((F=e[i?"mintA":"mintB"].programId)!=null?F:pe),new x((v=e[i?"mintB":"mintA"].programId)!=null?v:pe),i?P:T,i?T:P,bt(new x(e.programId),new x(e.id)).publicKey,s,a.destinationAmountSwapped)],instructionTypes:[o?fe.CpmmSwapBaseOut:fe.ClmmSwapBaseIn]}),d.addCustomComputeBudget(l),d.versionBuild({txVersion:m})}computeSwapAmount({pool:t,amountIn:e,outputMint:r,slippage:i}){let o=r.toString()===t.mintB.address,s=gt.swap(e,o?t.baseReserve:t.quoteReserve,o?t.quoteReserve:t.baseReserve,t.configInfo.tradeFeeRate),a=new ee(s.destinationAmountSwapped.toString()).div(s.sourceAmountSwapped.toString()),u=s.destinationAmountSwapped.mul(new H((1-i)*1e4)).div(new H(1e4));return{allTrade:s.sourceAmountSwapped.eq(e),amountIn:e,amountOut:s.destinationAmountSwapped,minAmountOut:u,executionPrice:a,fee:s.tradeFee,priceImpact:t.poolPrice.sub(a).div(t.poolPrice)}}computePairAmount({poolInfo:t,baseReserve:e,quoteReserve:r,amount:i,slippage:o,epochInfo:s,baseIn:a}){var w,g,b,k,A,M,C,R;let u=1-Number(o.toSignificant())/100,c=new H(new ee(i).mul(10**t[a?"mintA":"mintB"].decimals).mul(u).toFixed(0)),l=Ie(c,t[a?"mintA":"mintB"].extensions.feeConfig,s,!1),m=c.sub((w=l.fee)!=null?w:new H(0)),f=new H(new ee(t.lpAmount).mul(10**t.lpMint.decimals).toFixed(0,ee.ROUND_DOWN));this.logDebug("baseReserve:",e.toString(),"quoteReserve:",r.toString()),this.logDebug("tokenIn:",a?t.mintA.symbol:t.mintB.symbol,"amountIn:",c.toString(),"amountInFee:",(b=(g=l.fee)==null?void 0:g.toString())!=null?b:0,"anotherToken:",a?t.mintB.symbol:t.mintA.symbol,"slippage:",`${o.toSignificant()}%`);let p=a?"base":"quote";this.logDebug("input side:",p);let y=m.mul(f).div(p==="base"?e:r),d={amount:Et,fee:void 0,expirationTime:void 0};if(!m.isZero()){let E=Xi(y,e,r,f);this.logDebug("lpAmountData:",{amountA:E.amountA.toString(),amountB:E.amountB.toString()}),d=Ie(E[a?"amountB":"amountA"],t[a?"mintB":"mintA"].extensions.feeConfig,s,!0)}let P=new ae(new H(1)).add(o),T=Ie(P.mul(d.amount.sub((k=d.fee)!=null?k:new H(0))).quotient,t[a?"mintB":"mintA"].extensions.feeConfig,s,!0);return this.logDebug("anotherAmount:",d.amount.toString(),"anotherAmountFee:",(M=(A=d.fee)==null?void 0:A.toString())!=null?M:0,"maxAnotherAmount:",T.amount.toString(),"maxAnotherAmountFee:",(R=(C=T.fee)==null?void 0:C.toString())!=null?R:0),{inputAmountFee:l,anotherAmount:d,maxAnotherAmount:T,liquidity:y}}};function Xi(n,t,e,r){let i=n.mul(t).div(r);!i.isZero()&&!n.mul(t).mod(r).isZero()&&(i=i.add(new H(1)));let o=n.mul(e).div(r);return!o.isZero()&&!n.mul(e).mod(r).isZero()&&(o=o.add(new H(1))),{amountA:i,amountB:o}}export{Xt as default};
//# sourceMappingURL=cpmm.mjs.map